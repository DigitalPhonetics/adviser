
<!DOCTYPE html>

<html class="no-js" lang="en">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width,initial-scale=1" name="viewport"/>
<link href="https://digitalphonetics.github.io/adviser/api/services/" rel="canonical"/>
<link href="../../assets/images/favicon.png" rel="shortcut icon"/>
<meta content="mkdocs-1.1, mkdocs-material-5.1.4" name="generator"/>
<title>Services - Adviser</title>
<link href="../../assets/stylesheets/main.c4007cdc.min.css" rel="stylesheet"/>
<link crossorigin="" href="https://fonts.gstatic.com" rel="preconnect"/>
<link href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&amp;display=fallback" rel="stylesheet"/>
<style>body,input{font-family:"Roboto",-apple-system,BlinkMacSystemFont,Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono",SFMono-Regular,Consolas,Menlo,monospace}</style>
<link href="../../custom.css" rel="stylesheet"/>
</head>
<body dir="ltr">
<input autocomplete="off" class="md-toggle" data-md-toggle="drawer" id="__drawer" type="checkbox"/>
<input autocomplete="off" class="md-toggle" data-md-toggle="search" id="__search" type="checkbox"/>
<label class="md-overlay" for="__drawer"></label>
<div data-md-component="skip">
<a class="md-skip" href="#services">
          Skip to content
        </a>
</div>
<div data-md-component="announce">
</div>
<header class="md-header" data-md-component="header">
<nav aria-label="Header" class="md-header-nav md-grid">
<a aria-label="Adviser" class="md-header-nav__button md-logo" href="https://digitalphonetics.github.io/adviser/" title="Adviser">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M12 8a3 3 0 003-3 3 3 0 00-3-3 3 3 0 00-3 3 3 3 0 003 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"></path></svg>
</a>
<label class="md-header-nav__button md-icon" for="__drawer">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"></path></svg>
</label>
<div class="md-header-nav__title" data-md-component="header-title">
<div class="md-header-nav__ellipsis">
<span class="md-header-nav__topic md-ellipsis">
            Adviser
          </span>
<span class="md-header-nav__topic md-ellipsis">
            
              Services
            
          </span>
</div>
</div>
<label class="md-header-nav__button md-icon" for="__search">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M9.5 3A6.5 6.5 0 0116 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 019.5 16 6.5 6.5 0 013 9.5 6.5 6.5 0 019.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"></path></svg>
</label>
<div class="md-search" data-md-component="search" role="dialog">
<label class="md-search__overlay" for="__search"></label>
<div class="md-search__inner" role="search">
<form class="md-search__form" name="search">
<input aria-label="Search" autocapitalize="off" autocomplete="off" autocorrect="off" class="md-search__input" data-md-component="search-query" data-md-state="active" name="query" placeholder="Search" spellcheck="false" type="text"/>
<label class="md-search__icon md-icon" for="__search">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M9.5 3A6.5 6.5 0 0116 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 019.5 16 6.5 6.5 0 013 9.5 6.5 6.5 0 019.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"></path></svg>
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"></path></svg>
</label>
<button aria-label="Clear" class="md-search__icon md-icon" data-md-component="search-reset" tabindex="-1" type="reset">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"></path></svg>
</button>
</form>
<div class="md-search__output">
<div class="md-search__scrollwrap" data-md-scrollfix="">
<div class="md-search-result" data-md-component="search-result">
<div class="md-search-result__meta">
            Initializing search
          </div>
<ol class="md-search-result__list"></ol>
</div>
</div>
</div>
</div>
</div>
<div class="md-header-nav__source">
<a class="md-source" href="https://github.com/DigitalPhonetics/adviser/" title="Go to repository">
<div class="md-source__icon md-icon">
<svg viewbox="0 0 448 512" xmlns="http://www.w3.org/2000/svg"><path d="M439.55 236.05L244 40.45a28.87 28.87 0 00-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 01-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 000 40.81l195.61 195.6a28.86 28.86 0 0040.8 0l194.69-194.69a28.86 28.86 0 000-40.81z"></path></svg>
</div>
<div class="md-source__repository">
    GitHub
  </div>
</a>
</div>
</nav>
</header>
<div class="md-container" data-md-component="container">
<main class="md-main" data-md-component="main">
<div class="md-main__inner md-grid">
<div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
<div class="md-sidebar__scrollwrap">
<div class="md-sidebar__inner">
<nav aria-label="Navigation" class="md-nav md-nav--primary" data-md-level="0">
<label class="md-nav__title" for="__drawer">
<a aria-label="Adviser" class="md-nav__button md-logo" href="https://digitalphonetics.github.io/adviser/" title="Adviser">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M12 8a3 3 0 003-3 3 3 0 00-3-3 3 3 0 00-3 3 3 3 0 003 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"></path></svg>
</a>
    Adviser
  </label>
<div class="md-nav__source">
<a class="md-source" href="https://github.com/DigitalPhonetics/adviser/" title="Go to repository">
<div class="md-source__icon md-icon">
<svg viewbox="0 0 448 512" xmlns="http://www.w3.org/2000/svg"><path d="M439.55 236.05L244 40.45a28.87 28.87 0 00-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 01-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 000 40.81l195.61 195.6a28.86 28.86 0 0040.8 0l194.69-194.69a28.86 28.86 0 000-40.81z"></path></svg>
</div>
<div class="md-source__repository">
    GitHub
  </div>
</a>
</div>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../.." title="Home">
      Home
    </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../getting-started/" title="Getting Started">
      Getting Started
    </a>
</li>
<li class="md-nav__item md-nav__item--active md-nav__item--nested">
<input checked="" class="md-nav__toggle md-toggle" data-md-toggle="nav-3" id="nav-3" type="checkbox"/>
<label class="md-nav__link" for="nav-3">
      Reference
      <span class="md-nav__icon md-icon">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"></path></svg>
</span>
</label>
<nav aria-label="Reference" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="nav-3">
<span class="md-nav__icon md-icon">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"></path></svg>
</span>
        Reference
      </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item md-nav__item--active">
<input class="md-nav__toggle md-toggle" data-md-toggle="toc" id="__toc" type="checkbox"/>
<label class="md-nav__link md-nav__link--active" for="__toc">
        Services
        <span class="md-nav__icon md-icon">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M3 9h14V7H3v2m0 4h14v-2H3v2m0 4h14v-2H3v2m16 0h2v-2h-2v2m0-10v2h2V7h-2m0 6h2v-2h-2v2z"></path></svg>
</span>
</label>
<a class="md-nav__link md-nav__link--active" href="./" title="Services">
      Services
    </a>
<nav aria-label="Table of contents" class="md-nav md-nav--secondary">
<label class="md-nav__title" for="__toc">
<span class="md-nav__icon md-icon">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"></path></svg>
</span>
      Table of contents
    </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="#adviser.services">
    adviser.services
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#adviser.services.backchannel">
    backchannel
  </a>
<nav aria-label="backchannel" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#adviser.services.backchannel.acoustic_backchanneller">
    acoustic_backchanneller
  </a>
<nav aria-label="acoustic_backchanneller" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#adviser.services.backchannel.acoustic_backchanneller.AcousticBackchanneller">
    AcousticBackchanneller
  </a>
<nav aria-label="AcousticBackchanneller" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#adviser.services.backchannel.acoustic_backchanneller.AcousticBackchanneller.__init__">
    __init__()
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#adviser.services.backchannel.acoustic_backchanneller.AcousticBackchanneller.backchannel_prediction">
    backchannel_prediction()
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#adviser.services.backchannel.acoustic_backchanneller.AcousticBackchanneller.load_model">
    load_model()
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#adviser.services.backchannel.acoustic_backchanneller.AcousticBackchanneller.split_input_data">
    split_input_data()
  </a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#adviser.services.backchannel.PytorchAcousticBackchanneler">
    PytorchAcousticBackchanneler
  </a>
<nav aria-label="PytorchAcousticBackchanneler" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#adviser.services.backchannel.PytorchAcousticBackchanneler.PytorchAcousticBackchanneler">
    PytorchAcousticBackchanneler
  </a>
<nav aria-label="PytorchAcousticBackchanneler" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#adviser.services.backchannel.PytorchAcousticBackchanneler.PytorchAcousticBackchanneler.__init__">
    __init__()
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#adviser.services.backchannel.PytorchAcousticBackchanneler.PytorchAcousticBackchanneler.forward">
    forward()
  </a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#adviser.services.bst">
    bst
  </a>
<nav aria-label="bst" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#adviser.services.bst.bst">
    bst
  </a>
<nav aria-label="bst" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#adviser.services.bst.bst.HandcraftedBST">
    HandcraftedBST
  </a>
<nav aria-label="HandcraftedBST" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#adviser.services.bst.bst.HandcraftedBST.__init__">
    __init__()
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#adviser.services.bst.bst.HandcraftedBST.dialog_start">
    dialog_start()
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#adviser.services.bst.bst.HandcraftedBST.update_bst">
    update_bst()
  </a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#adviser.services.domain_tracker">
    domain_tracker
  </a>
<nav aria-label="domain_tracker" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#adviser.services.domain_tracker.domain_tracker">
    domain_tracker
  </a>
<nav aria-label="domain_tracker" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#adviser.services.domain_tracker.domain_tracker.DomainTracker">
    DomainTracker
  </a>
<nav aria-label="DomainTracker" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#adviser.services.domain_tracker.domain_tracker.DomainTracker.__init__">
    __init__()
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#adviser.services.domain_tracker.domain_tracker.DomainTracker.dialog_start">
    dialog_start()
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#adviser.services.domain_tracker.domain_tracker.DomainTracker.domains_to_str">
    domains_to_str()
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#adviser.services.domain_tracker.domain_tracker.DomainTracker.select_domain">
    select_domain()
  </a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#adviser.services.emotion">
    emotion
  </a>
<nav aria-label="emotion" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#adviser.services.emotion.EmotionRecognition">
    EmotionRecognition
  </a>
<nav aria-label="EmotionRecognition" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#adviser.services.emotion.EmotionRecognition.EmotionRecognition">
    EmotionRecognition
  </a>
<nav aria-label="EmotionRecognition" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#adviser.services.emotion.EmotionRecognition.EmotionRecognition.__init__">
    __init__()
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#adviser.services.emotion.EmotionRecognition.EmotionRecognition.predict_from_audio">
    predict_from_audio()
  </a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#adviser.services.engagement">
    engagement
  </a>
<nav aria-label="engagement" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#adviser.services.engagement.engagement_tracker">
    engagement_tracker
  </a>
<nav aria-label="engagement_tracker" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#adviser.services.engagement.engagement_tracker.EngagementTracker">
    EngagementTracker
  </a>
<nav aria-label="EngagementTracker" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#adviser.services.engagement.engagement_tracker.EngagementTracker.__init__">
    __init__()
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#adviser.services.engagement.engagement_tracker.EngagementTracker.dialog_end">
    dialog_end()
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#adviser.services.engagement.engagement_tracker.EngagementTracker.dialog_exit">
    dialog_exit()
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#adviser.services.engagement.engagement_tracker.EngagementTracker.dialog_start">
    dialog_start()
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#adviser.services.engagement.engagement_tracker.EngagementTracker.publish_gaze_directions">
    publish_gaze_directions()
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#adviser.services.engagement.engagement_tracker.EngagementTracker.yield_gaze_direction">
    yield_gaze_direction()
  </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#adviser.services.engagement.engagement_tracker.get_root_dir">
    get_root_dir()
  </a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#adviser.services.hci">
    hci
  </a>
<nav aria-label="hci" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#adviser.services.hci.console">
    console
  </a>
<nav aria-label="console" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#adviser.services.hci.console.ConsoleInput">
    ConsoleInput
  </a>
<nav aria-label="ConsoleInput" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#adviser.services.hci.console.ConsoleInput.__init__">
    __init__()
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#adviser.services.hci.console.ConsoleInput.dialog_start">
    dialog_start()
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#adviser.services.hci.console.ConsoleInput.get_user_input">
    get_user_input()
  </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#adviser.services.hci.console.ConsoleOutput">
    ConsoleOutput
  </a>
<nav aria-label="ConsoleOutput" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#adviser.services.hci.console.ConsoleOutput.__init__">
    __init__()
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#adviser.services.hci.console.ConsoleOutput.print_sys_utterance">
    print_sys_utterance()
  </a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#adviser.services.hci.gui">
    gui
  </a>
<nav aria-label="gui" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#adviser.services.hci.gui.GUIServer">
    GUIServer
  </a>
<nav aria-label="GUIServer" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#adviser.services.hci.gui.GUIServer.__init__">
    __init__()
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#adviser.services.hci.gui.GUIServer.forward_emotion_message_to_react">
    forward_emotion_message_to_react()
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#adviser.services.hci.gui.GUIServer.forward_engagement_message_to_react">
    forward_engagement_message_to_react()
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#adviser.services.hci.gui.GUIServer.forward_sys_message_to_react">
    forward_sys_message_to_react()
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#adviser.services.hci.gui.GUIServer.forward_user_message_to_react">
    forward_user_message_to_react()
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#adviser.services.hci.gui.GUIServer.start_dialog">
    start_dialog()
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#adviser.services.hci.gui.GUIServer.user_utterance">
    user_utterance()
  </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#adviser.services.hci.gui.get_root_dir">
    get_root_dir()
  </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#adviser.services.hci.speech">
    speech
  </a>
<nav aria-label="speech" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#adviser.services.hci.speech.cleaners">
    cleaners
  </a>
<nav aria-label="cleaners" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#adviser.services.hci.speech.cleaners.basic_cleaners">
    basic_cleaners()
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#adviser.services.hci.speech.cleaners.collapse_whitespace">
    collapse_whitespace()
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#adviser.services.hci.speech.cleaners.convert_to_ascii">
    convert_to_ascii()
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#adviser.services.hci.speech.cleaners.custom_english_cleaners">
    custom_english_cleaners()
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#adviser.services.hci.speech.cleaners.english_cleaners">
    english_cleaners()
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#adviser.services.hci.speech.cleaners.expand_abbreviations">
    expand_abbreviations()
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#adviser.services.hci.speech.cleaners.expand_acronym">
    expand_acronym()
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#adviser.services.hci.speech.cleaners.expand_email">
    expand_email()
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#adviser.services.hci.speech.cleaners.expand_numbers">
    expand_numbers()
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#adviser.services.hci.speech.cleaners.expand_symbols">
    expand_symbols()
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#adviser.services.hci.speech.cleaners.lowercase">
    lowercase()
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#adviser.services.hci.speech.cleaners.normalize_numbers">
    normalize_numbers()
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#adviser.services.hci.speech.cleaners.remove_unnecessary_symbols">
    remove_unnecessary_symbols()
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#adviser.services.hci.speech.cleaners.transliteration_cleaners">
    transliteration_cleaners()
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#adviser.services.hci.speech.cleaners.uppercase">
    uppercase()
  </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#adviser.services.hci.speech.speech_utility">
    speech_utility
  </a>
<nav aria-label="speech_utility" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#adviser.services.hci.speech.speech_utility.delete_file">
    delete_file()
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#adviser.services.hci.speech.speech_utility.sound_array_to_file">
    sound_array_to_file()
  </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#adviser.services.hci.speech.SpeechInputDecoder">
    SpeechInputDecoder
  </a>
<nav aria-label="SpeechInputDecoder" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#adviser.services.hci.speech.SpeechInputDecoder.SpeechInputDecoder">
    SpeechInputDecoder
  </a>
<nav aria-label="SpeechInputDecoder" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#adviser.services.hci.speech.SpeechInputDecoder.SpeechInputDecoder.__init__">
    __init__()
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#adviser.services.hci.speech.SpeechInputDecoder.SpeechInputDecoder.features_to_text">
    features_to_text()
  </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#adviser.services.hci.speech.SpeechInputDecoder.get_root_dir">
    get_root_dir()
  </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#adviser.services.hci.speech.SpeechInputFeatureExtractor">
    SpeechInputFeatureExtractor
  </a>
<nav aria-label="SpeechInputFeatureExtractor" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#adviser.services.hci.speech.SpeechInputFeatureExtractor.SpeechInputFeatureExtractor">
    SpeechInputFeatureExtractor
  </a>
<nav aria-label="SpeechInputFeatureExtractor" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#adviser.services.hci.speech.SpeechInputFeatureExtractor.SpeechInputFeatureExtractor.__init__">
    __init__()
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#adviser.services.hci.speech.SpeechInputFeatureExtractor.SpeechInputFeatureExtractor.speech_to_fbank">
    speech_to_fbank()
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#adviser.services.hci.speech.SpeechInputFeatureExtractor.SpeechInputFeatureExtractor.speech_to_features">
    speech_to_features()
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#adviser.services.hci.speech.SpeechInputFeatureExtractor.SpeechInputFeatureExtractor.speech_to_mfcc">
    speech_to_mfcc()
  </a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#adviser.services.hci.speech.SpeechOutputGenerator">
    SpeechOutputGenerator
  </a>
<nav aria-label="SpeechOutputGenerator" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#adviser.services.hci.speech.SpeechOutputGenerator.SpeechOutputGenerator">
    SpeechOutputGenerator
  </a>
<nav aria-label="SpeechOutputGenerator" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#adviser.services.hci.speech.SpeechOutputGenerator.SpeechOutputGenerator.__init__">
    __init__()
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#adviser.services.hci.speech.SpeechOutputGenerator.SpeechOutputGenerator.generate_speech">
    generate_speech()
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#adviser.services.hci.speech.SpeechOutputGenerator.SpeechOutputGenerator.preprocess_text_input">
    preprocess_text_input()
  </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#adviser.services.hci.speech.SpeechOutputGenerator.get_root_dir">
    get_root_dir()
  </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#adviser.services.hci.speech.SpeechOutputPlayer">
    SpeechOutputPlayer
  </a>
<nav aria-label="SpeechOutputPlayer" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#adviser.services.hci.speech.SpeechOutputPlayer.SpeechOutputPlayer">
    SpeechOutputPlayer
  </a>
<nav aria-label="SpeechOutputPlayer" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#adviser.services.hci.speech.SpeechOutputPlayer.SpeechOutputPlayer.__init__">
    __init__()
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#adviser.services.hci.speech.SpeechOutputPlayer.SpeechOutputPlayer.speak">
    speak()
  </a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#adviser.services.hci.speech.SpeechRecorder">
    SpeechRecorder
  </a>
<nav aria-label="SpeechRecorder" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#adviser.services.hci.speech.SpeechRecorder.SpeechRecorder">
    SpeechRecorder
  </a>
<nav aria-label="SpeechRecorder" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#adviser.services.hci.speech.SpeechRecorder.SpeechRecorder.__init__">
    __init__()
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#adviser.services.hci.speech.SpeechRecorder.SpeechRecorder.record_user_utterance">
    record_user_utterance()
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#adviser.services.hci.speech.SpeechRecorder.SpeechRecorder.start_recorder">
    start_recorder()
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#adviser.services.hci.speech.SpeechRecorder.SpeechRecorder.start_recording">
    start_recording()
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#adviser.services.hci.speech.SpeechRecorder.SpeechRecorder.threshold_plotter_generator">
    threshold_plotter_generator()
  </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#adviser.services.hci.speech.SpeechRecorder.voice_sanitizer">
    voice_sanitizer()
  </a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#adviser.services.hci.video">
    video
  </a>
<nav aria-label="video" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#adviser.services.hci.video.FeatureExtractor">
    FeatureExtractor
  </a>
<nav aria-label="FeatureExtractor" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#adviser.services.hci.video.FeatureExtractor.VideoFeatureExtractor">
    VideoFeatureExtractor
  </a>
<nav aria-label="VideoFeatureExtractor" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#adviser.services.hci.video.FeatureExtractor.VideoFeatureExtractor.__init__">
    __init__()
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#adviser.services.hci.video.FeatureExtractor.VideoFeatureExtractor.extract_fl_features">
    extract_fl_features()
  </a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#adviser.services.hci.video.VideoInput">
    VideoInput
  </a>
<nav aria-label="VideoInput" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#adviser.services.hci.video.VideoInput.VideoInput">
    VideoInput
  </a>
<nav aria-label="VideoInput" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#adviser.services.hci.video.VideoInput.VideoInput.__init__">
    __init__()
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#adviser.services.hci.video.VideoInput.VideoInput.capture">
    capture()
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#adviser.services.hci.video.VideoInput.VideoInput.dialog_end">
    dialog_end()
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#adviser.services.hci.video.VideoInput.VideoInput.dialog_start">
    dialog_start()
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#adviser.services.hci.video.VideoInput.VideoInput.publish_img">
    publish_img()
  </a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#adviser.services.nlg">
    nlg
  </a>
<nav aria-label="nlg" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#adviser.services.nlg.affective_nlg">
    affective_nlg
  </a>
<nav aria-label="affective_nlg" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#adviser.services.nlg.affective_nlg.HandcraftedEmotionNLG">
    HandcraftedEmotionNLG
  </a>
<nav aria-label="HandcraftedEmotionNLG" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#adviser.services.nlg.affective_nlg.HandcraftedEmotionNLG.__init__">
    __init__()
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#adviser.services.nlg.affective_nlg.HandcraftedEmotionNLG.generate_system_utterance">
    generate_system_utterance()
  </a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#adviser.services.nlg.bc_nlg">
    bc_nlg
  </a>
<nav aria-label="bc_nlg" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#adviser.services.nlg.bc_nlg.BackchannelHandcraftedNLG">
    BackchannelHandcraftedNLG
  </a>
<nav aria-label="BackchannelHandcraftedNLG" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#adviser.services.nlg.bc_nlg.BackchannelHandcraftedNLG.__init__">
    __init__()
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#adviser.services.nlg.bc_nlg.BackchannelHandcraftedNLG.publish_system_utterance">
    publish_system_utterance()
  </a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#adviser.services.nlg.nlg">
    nlg
  </a>
<nav aria-label="nlg" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#adviser.services.nlg.nlg.HandcraftedNLG">
    HandcraftedNLG
  </a>
<nav aria-label="HandcraftedNLG" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#adviser.services.nlg.nlg.HandcraftedNLG.__init__">
    __init__()
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#adviser.services.nlg.nlg.HandcraftedNLG.generate_system_utterance">
    generate_system_utterance()
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#adviser.services.nlg.nlg.HandcraftedNLG.publish_system_utterance">
    publish_system_utterance()
  </a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#adviser.services.nlg.templates">
    templates
  </a>
<nav aria-label="templates" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#adviser.services.nlg.templates.builtinfunctions">
    builtinfunctions
  </a>
<nav aria-label="builtinfunctions" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#adviser.services.nlg.templates.builtinfunctions.ForEntryFunction">
    ForEntryFunction
  </a>
<nav aria-label="ForEntryFunction" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#adviser.services.nlg.templates.builtinfunctions.ForEntryFunction.__init__">
    __init__()
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#adviser.services.nlg.templates.builtinfunctions.ForEntryFunction.apply">
    apply()
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#adviser.services.nlg.templates.builtinfunctions.ForEntryFunction.is_applicable">
    is_applicable()
  </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#adviser.services.nlg.templates.builtinfunctions.ForEntryListFunction">
    ForEntryListFunction
  </a>
<nav aria-label="ForEntryListFunction" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#adviser.services.nlg.templates.builtinfunctions.ForEntryListFunction.__init__">
    __init__()
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#adviser.services.nlg.templates.builtinfunctions.ForEntryListFunction.apply">
    apply()
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#adviser.services.nlg.templates.builtinfunctions.ForEntryListFunction.is_applicable">
    is_applicable()
  </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#adviser.services.nlg.templates.builtinfunctions.ForFunction">
    ForFunction
  </a>
<nav aria-label="ForFunction" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#adviser.services.nlg.templates.builtinfunctions.ForFunction.__init__">
    __init__()
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#adviser.services.nlg.templates.builtinfunctions.ForFunction.apply">
    apply()
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#adviser.services.nlg.templates.builtinfunctions.ForFunction.is_applicable">
    is_applicable()
  </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#adviser.services.nlg.templates.builtinfunctions.PythonFunction">
    PythonFunction
  </a>
<nav aria-label="PythonFunction" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#adviser.services.nlg.templates.builtinfunctions.PythonFunction.__init__">
    __init__()
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#adviser.services.nlg.templates.builtinfunctions.PythonFunction.apply">
    apply()
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#adviser.services.nlg.templates.builtinfunctions.PythonFunction.is_applicable">
    is_applicable()
  </a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#adviser.services.nlg.templates.parsing">
    parsing
  </a>
<nav aria-label="parsing" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#adviser.services.nlg.templates.parsing.automaton">
    automaton
  </a>
<nav aria-label="automaton" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#adviser.services.nlg.templates.parsing.automaton.ModifiedPushdownAutomaton">
    ModifiedPushdownAutomaton
  </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#adviser.services.nlg.templates.parsing.configuration">
    configuration
  </a>
<nav aria-label="configuration" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#adviser.services.nlg.templates.parsing.configuration.Configuration">
    Configuration
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#adviser.services.nlg.templates.parsing.configuration.DefaultTransition">
    DefaultTransition
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#adviser.services.nlg.templates.parsing.configuration.SimpleForwardDefaultTransition">
    SimpleForwardDefaultTransition
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#adviser.services.nlg.templates.parsing.configuration.State">
    State
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#adviser.services.nlg.templates.parsing.configuration.StateDescription">
    StateDescription
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#adviser.services.nlg.templates.parsing.configuration.Transition">
    Transition
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#adviser.services.nlg.templates.parsing.configuration.TransitionWithAction">
    TransitionWithAction
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#adviser.services.nlg.templates.parsing.configuration.TransitionWithoutAction">
    TransitionWithoutAction
  </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#adviser.services.nlg.templates.parsing.exceptions">
    exceptions
  </a>
<nav aria-label="exceptions" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#adviser.services.nlg.templates.parsing.exceptions.ParsingError">
    ParsingError
  </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#adviser.services.nlg.templates.parsing.parsers">
    parsers
  </a>
<nav aria-label="parsers" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#adviser.services.nlg.templates.parsing.parsers.messageparser">
    messageparser
  </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#adviser.services.nlg.templates.parsing.stack">
    stack
  </a>
<nav aria-label="stack" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#adviser.services.nlg.templates.parsing.stack.AutomatonStack">
    AutomatonStack
  </a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#adviser.services.nlg.templates.preprocessing">
    preprocessing
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#adviser.services.nlg.templates.templatefile">
    templatefile
  </a>
<nav aria-label="templatefile" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#adviser.services.nlg.templates.templatefile.TemplateFile">
    TemplateFile
  </a>
<nav aria-label="TemplateFile" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#adviser.services.nlg.templates.templatefile.TemplateFile.__init__">
    __init__()
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#adviser.services.nlg.templates.templatefile.TemplateFile.add_python_function">
    add_python_function()
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#adviser.services.nlg.templates.templatefile.TemplateFile.create_message">
    create_message()
  </a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#adviser.services.nlu">
    nlu
  </a>
<nav aria-label="nlu" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#adviser.services.nlu.nlu">
    nlu
  </a>
<nav aria-label="nlu" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#adviser.services.nlu.nlu.HandcraftedNLU">
    HandcraftedNLU
  </a>
<nav aria-label="HandcraftedNLU" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#adviser.services.nlu.nlu.HandcraftedNLU.__init__">
    __init__()
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#adviser.services.nlu.nlu.HandcraftedNLU.extract_user_acts">
    extract_user_acts()
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#adviser.services.nlu.nlu.HandcraftedNLU.start_dialog">
    start_dialog()
  </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#adviser.services.nlu.nlu.get_root_dir">
    get_root_dir()
  </a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#adviser.services.policy">
    policy
  </a>
<nav aria-label="policy" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#adviser.services.policy.affective_policy">
    affective_policy
  </a>
<nav aria-label="affective_policy" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#adviser.services.policy.affective_policy.EmotionPolicy">
    EmotionPolicy
  </a>
<nav aria-label="EmotionPolicy" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#adviser.services.policy.affective_policy.EmotionPolicy.__init__">
    __init__()
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#adviser.services.policy.affective_policy.EmotionPolicy.choose_sys_emotion">
    choose_sys_emotion()
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#adviser.services.policy.affective_policy.EmotionPolicy.dialog_start">
    dialog_start()
  </a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#adviser.services.policy.policy_api">
    policy_api
  </a>
<nav aria-label="policy_api" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#adviser.services.policy.policy_api.HandcraftedPolicy">
    HandcraftedPolicy
  </a>
<nav aria-label="HandcraftedPolicy" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#adviser.services.policy.policy_api.HandcraftedPolicy.__init__">
    __init__()
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#adviser.services.policy.policy_api.HandcraftedPolicy.choose_sys_act">
    choose_sys_act()
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#adviser.services.policy.policy_api.HandcraftedPolicy.dialog_start">
    dialog_start()
  </a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#adviser.services.policy.policy_handcrafted">
    policy_handcrafted
  </a>
<nav aria-label="policy_handcrafted" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#adviser.services.policy.policy_handcrafted.HandcraftedPolicy">
    HandcraftedPolicy
  </a>
<nav aria-label="HandcraftedPolicy" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#adviser.services.policy.policy_handcrafted.HandcraftedPolicy.__init__">
    __init__()
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#adviser.services.policy.policy_handcrafted.HandcraftedPolicy.choose_sys_act">
    choose_sys_act()
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#adviser.services.policy.policy_handcrafted.HandcraftedPolicy.dialog_start">
    dialog_start()
  </a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#adviser.services.policy.rl">
    rl
  </a>
<nav aria-label="rl" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#adviser.services.policy.rl.dqn">
    dqn
  </a>
<nav aria-label="dqn" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#adviser.services.policy.rl.dqn.DQN">
    DQN
  </a>
<nav aria-label="DQN" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#adviser.services.policy.rl.dqn.DQN.__init__">
    __init__()
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#adviser.services.policy.rl.dqn.DQN.forward">
    forward()
  </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#adviser.services.policy.rl.dqn.DuelingDQN">
    DuelingDQN
  </a>
<nav aria-label="DuelingDQN" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#adviser.services.policy.rl.dqn.DuelingDQN.__init__">
    __init__()
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#adviser.services.policy.rl.dqn.DuelingDQN.forward">
    forward()
  </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#adviser.services.policy.rl.dqn.NetArchitecture">
    NetArchitecture
  </a>
<nav aria-label="NetArchitecture" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#adviser.services.policy.rl.dqn.NetArchitecture.__new__">
    __new__()
  </a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#adviser.services.policy.rl.dqnpolicy">
    dqnpolicy
  </a>
<nav aria-label="dqnpolicy" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#adviser.services.policy.rl.dqnpolicy.DQNPolicy">
    DQNPolicy
  </a>
<nav aria-label="DQNPolicy" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#adviser.services.policy.rl.dqnpolicy.DQNPolicy.__init__">
    __init__()
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#adviser.services.policy.rl.dqnpolicy.DQNPolicy.choose_sys_act">
    choose_sys_act()
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#adviser.services.policy.rl.dqnpolicy.DQNPolicy.dialog_end">
    dialog_end()
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#adviser.services.policy.rl.dqnpolicy.DQNPolicy.dialog_start">
    dialog_start()
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#adviser.services.policy.rl.dqnpolicy.DQNPolicy.end">
    end()
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#adviser.services.policy.rl.dqnpolicy.DQNPolicy.eps_scheduler">
    eps_scheduler()
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#adviser.services.policy.rl.dqnpolicy.DQNPolicy.eval">
    eval()
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#adviser.services.policy.rl.dqnpolicy.DQNPolicy.load">
    load()
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#adviser.services.policy.rl.dqnpolicy.DQNPolicy.loss">
    loss()
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#adviser.services.policy.rl.dqnpolicy.DQNPolicy.save">
    save()
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#adviser.services.policy.rl.dqnpolicy.DQNPolicy.select_action_eps_greedy">
    select_action_eps_greedy()
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#adviser.services.policy.rl.dqnpolicy.DQNPolicy.train">
    train()
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#adviser.services.policy.rl.dqnpolicy.DQNPolicy.train_batch">
    train_batch()
  </a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#adviser.services.policy.rl.experience_buffer">
    experience_buffer
  </a>
<nav aria-label="experience_buffer" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#adviser.services.policy.rl.experience_buffer.Buffer">
    Buffer
  </a>
<nav aria-label="Buffer" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#adviser.services.policy.rl.experience_buffer.Buffer.__init__">
    __init__()
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#adviser.services.policy.rl.experience_buffer.Buffer.__len__">
    __len__()
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#adviser.services.policy.rl.experience_buffer.Buffer.print_contents">
    print_contents()
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#adviser.services.policy.rl.experience_buffer.Buffer.sample">
    sample()
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#adviser.services.policy.rl.experience_buffer.Buffer.store">
    store()
  </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#adviser.services.policy.rl.experience_buffer.NaivePrioritizedBuffer">
    NaivePrioritizedBuffer
  </a>
<nav aria-label="NaivePrioritizedBuffer" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#adviser.services.policy.rl.experience_buffer.NaivePrioritizedBuffer.__init__">
    __init__()
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#adviser.services.policy.rl.experience_buffer.NaivePrioritizedBuffer.sample">
    sample()
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#adviser.services.policy.rl.experience_buffer.NaivePrioritizedBuffer.store">
    store()
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#adviser.services.policy.rl.experience_buffer.NaivePrioritizedBuffer.update">
    update()
  </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#adviser.services.policy.rl.experience_buffer.UniformBuffer">
    UniformBuffer
  </a>
<nav aria-label="UniformBuffer" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#adviser.services.policy.rl.experience_buffer.UniformBuffer.__init__">
    __init__()
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#adviser.services.policy.rl.experience_buffer.UniformBuffer.sample">
    sample()
  </a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#adviser.services.policy.rl.policy_rl">
    policy_rl
  </a>
<nav aria-label="policy_rl" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#adviser.services.policy.rl.policy_rl.RLPolicy">
    RLPolicy
  </a>
<nav aria-label="RLPolicy" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#adviser.services.policy.rl.policy_rl.RLPolicy.__init__">
    __init__()
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#adviser.services.policy.rl.policy_rl.RLPolicy.action_idx">
    action_idx()
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#adviser.services.policy.rl.policy_rl.RLPolicy.action_name">
    action_name()
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#adviser.services.policy.rl.policy_rl.RLPolicy.beliefstate_dict_to_vector">
    beliefstate_dict_to_vector()
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#adviser.services.policy.rl.policy_rl.RLPolicy.end_dialog">
    end_dialog()
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#adviser.services.policy.rl.policy_rl.RLPolicy.expand_system_action">
    expand_system_action()
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#adviser.services.policy.rl.policy_rl.RLPolicy.turn_end">
    turn_end()
  </a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#adviser.services.policy.rl.train_dqnpolicy">
    train_dqnpolicy
  </a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../examples/" title="Examples">
      Examples
    </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../utils/" title="Utils">
      Utils
    </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../tools/" title="Tools">
      Tools
    </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" data-md-toggle="nav-4" id="nav-4" type="checkbox"/>
<label class="md-nav__link" for="nav-4">
      Tutorials
      <span class="md-nav__icon md-icon">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"></path></svg>
</span>
</label>
<nav aria-label="Tutorials" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="nav-4">
<span class="md-nav__icon md-icon">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"></path></svg>
</span>
        Tutorials
      </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../tutorials/introduction/" title="Introduction">
      Introduction
    </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../tutorials/services/" title="Services">
      Services
    </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../tutorials/dialogsystem/" title="Dialog System">
      Dialog System
    </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../tutorials/advanced/" title="Advanced">
      Advanced
    </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../faq/" title="FAQ">
      FAQ
    </a>
</li>
</ul>
</nav>
</div>
</div>
</div>
<div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
<div class="md-sidebar__scrollwrap">
<div class="md-sidebar__inner">
<nav aria-label="Table of contents" class="md-nav md-nav--secondary">
<label class="md-nav__title" for="__toc">
<span class="md-nav__icon md-icon">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"></path></svg>
</span>
      Table of contents
    </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="#adviser.services">
    adviser.services
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#adviser.services.backchannel">
    backchannel
  </a>
<nav aria-label="backchannel" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#adviser.services.backchannel.acoustic_backchanneller">
    acoustic_backchanneller
  </a>
<nav aria-label="acoustic_backchanneller" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#adviser.services.backchannel.acoustic_backchanneller.AcousticBackchanneller">
    AcousticBackchanneller
  </a>
<nav aria-label="AcousticBackchanneller" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#adviser.services.backchannel.acoustic_backchanneller.AcousticBackchanneller.__init__">
    __init__()
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#adviser.services.backchannel.acoustic_backchanneller.AcousticBackchanneller.backchannel_prediction">
    backchannel_prediction()
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#adviser.services.backchannel.acoustic_backchanneller.AcousticBackchanneller.load_model">
    load_model()
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#adviser.services.backchannel.acoustic_backchanneller.AcousticBackchanneller.split_input_data">
    split_input_data()
  </a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#adviser.services.backchannel.PytorchAcousticBackchanneler">
    PytorchAcousticBackchanneler
  </a>
<nav aria-label="PytorchAcousticBackchanneler" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#adviser.services.backchannel.PytorchAcousticBackchanneler.PytorchAcousticBackchanneler">
    PytorchAcousticBackchanneler
  </a>
<nav aria-label="PytorchAcousticBackchanneler" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#adviser.services.backchannel.PytorchAcousticBackchanneler.PytorchAcousticBackchanneler.__init__">
    __init__()
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#adviser.services.backchannel.PytorchAcousticBackchanneler.PytorchAcousticBackchanneler.forward">
    forward()
  </a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#adviser.services.bst">
    bst
  </a>
<nav aria-label="bst" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#adviser.services.bst.bst">
    bst
  </a>
<nav aria-label="bst" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#adviser.services.bst.bst.HandcraftedBST">
    HandcraftedBST
  </a>
<nav aria-label="HandcraftedBST" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#adviser.services.bst.bst.HandcraftedBST.__init__">
    __init__()
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#adviser.services.bst.bst.HandcraftedBST.dialog_start">
    dialog_start()
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#adviser.services.bst.bst.HandcraftedBST.update_bst">
    update_bst()
  </a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#adviser.services.domain_tracker">
    domain_tracker
  </a>
<nav aria-label="domain_tracker" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#adviser.services.domain_tracker.domain_tracker">
    domain_tracker
  </a>
<nav aria-label="domain_tracker" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#adviser.services.domain_tracker.domain_tracker.DomainTracker">
    DomainTracker
  </a>
<nav aria-label="DomainTracker" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#adviser.services.domain_tracker.domain_tracker.DomainTracker.__init__">
    __init__()
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#adviser.services.domain_tracker.domain_tracker.DomainTracker.dialog_start">
    dialog_start()
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#adviser.services.domain_tracker.domain_tracker.DomainTracker.domains_to_str">
    domains_to_str()
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#adviser.services.domain_tracker.domain_tracker.DomainTracker.select_domain">
    select_domain()
  </a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#adviser.services.emotion">
    emotion
  </a>
<nav aria-label="emotion" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#adviser.services.emotion.EmotionRecognition">
    EmotionRecognition
  </a>
<nav aria-label="EmotionRecognition" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#adviser.services.emotion.EmotionRecognition.EmotionRecognition">
    EmotionRecognition
  </a>
<nav aria-label="EmotionRecognition" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#adviser.services.emotion.EmotionRecognition.EmotionRecognition.__init__">
    __init__()
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#adviser.services.emotion.EmotionRecognition.EmotionRecognition.predict_from_audio">
    predict_from_audio()
  </a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#adviser.services.engagement">
    engagement
  </a>
<nav aria-label="engagement" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#adviser.services.engagement.engagement_tracker">
    engagement_tracker
  </a>
<nav aria-label="engagement_tracker" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#adviser.services.engagement.engagement_tracker.EngagementTracker">
    EngagementTracker
  </a>
<nav aria-label="EngagementTracker" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#adviser.services.engagement.engagement_tracker.EngagementTracker.__init__">
    __init__()
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#adviser.services.engagement.engagement_tracker.EngagementTracker.dialog_end">
    dialog_end()
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#adviser.services.engagement.engagement_tracker.EngagementTracker.dialog_exit">
    dialog_exit()
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#adviser.services.engagement.engagement_tracker.EngagementTracker.dialog_start">
    dialog_start()
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#adviser.services.engagement.engagement_tracker.EngagementTracker.publish_gaze_directions">
    publish_gaze_directions()
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#adviser.services.engagement.engagement_tracker.EngagementTracker.yield_gaze_direction">
    yield_gaze_direction()
  </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#adviser.services.engagement.engagement_tracker.get_root_dir">
    get_root_dir()
  </a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#adviser.services.hci">
    hci
  </a>
<nav aria-label="hci" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#adviser.services.hci.console">
    console
  </a>
<nav aria-label="console" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#adviser.services.hci.console.ConsoleInput">
    ConsoleInput
  </a>
<nav aria-label="ConsoleInput" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#adviser.services.hci.console.ConsoleInput.__init__">
    __init__()
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#adviser.services.hci.console.ConsoleInput.dialog_start">
    dialog_start()
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#adviser.services.hci.console.ConsoleInput.get_user_input">
    get_user_input()
  </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#adviser.services.hci.console.ConsoleOutput">
    ConsoleOutput
  </a>
<nav aria-label="ConsoleOutput" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#adviser.services.hci.console.ConsoleOutput.__init__">
    __init__()
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#adviser.services.hci.console.ConsoleOutput.print_sys_utterance">
    print_sys_utterance()
  </a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#adviser.services.hci.gui">
    gui
  </a>
<nav aria-label="gui" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#adviser.services.hci.gui.GUIServer">
    GUIServer
  </a>
<nav aria-label="GUIServer" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#adviser.services.hci.gui.GUIServer.__init__">
    __init__()
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#adviser.services.hci.gui.GUIServer.forward_emotion_message_to_react">
    forward_emotion_message_to_react()
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#adviser.services.hci.gui.GUIServer.forward_engagement_message_to_react">
    forward_engagement_message_to_react()
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#adviser.services.hci.gui.GUIServer.forward_sys_message_to_react">
    forward_sys_message_to_react()
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#adviser.services.hci.gui.GUIServer.forward_user_message_to_react">
    forward_user_message_to_react()
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#adviser.services.hci.gui.GUIServer.start_dialog">
    start_dialog()
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#adviser.services.hci.gui.GUIServer.user_utterance">
    user_utterance()
  </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#adviser.services.hci.gui.get_root_dir">
    get_root_dir()
  </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#adviser.services.hci.speech">
    speech
  </a>
<nav aria-label="speech" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#adviser.services.hci.speech.cleaners">
    cleaners
  </a>
<nav aria-label="cleaners" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#adviser.services.hci.speech.cleaners.basic_cleaners">
    basic_cleaners()
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#adviser.services.hci.speech.cleaners.collapse_whitespace">
    collapse_whitespace()
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#adviser.services.hci.speech.cleaners.convert_to_ascii">
    convert_to_ascii()
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#adviser.services.hci.speech.cleaners.custom_english_cleaners">
    custom_english_cleaners()
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#adviser.services.hci.speech.cleaners.english_cleaners">
    english_cleaners()
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#adviser.services.hci.speech.cleaners.expand_abbreviations">
    expand_abbreviations()
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#adviser.services.hci.speech.cleaners.expand_acronym">
    expand_acronym()
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#adviser.services.hci.speech.cleaners.expand_email">
    expand_email()
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#adviser.services.hci.speech.cleaners.expand_numbers">
    expand_numbers()
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#adviser.services.hci.speech.cleaners.expand_symbols">
    expand_symbols()
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#adviser.services.hci.speech.cleaners.lowercase">
    lowercase()
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#adviser.services.hci.speech.cleaners.normalize_numbers">
    normalize_numbers()
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#adviser.services.hci.speech.cleaners.remove_unnecessary_symbols">
    remove_unnecessary_symbols()
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#adviser.services.hci.speech.cleaners.transliteration_cleaners">
    transliteration_cleaners()
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#adviser.services.hci.speech.cleaners.uppercase">
    uppercase()
  </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#adviser.services.hci.speech.speech_utility">
    speech_utility
  </a>
<nav aria-label="speech_utility" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#adviser.services.hci.speech.speech_utility.delete_file">
    delete_file()
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#adviser.services.hci.speech.speech_utility.sound_array_to_file">
    sound_array_to_file()
  </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#adviser.services.hci.speech.SpeechInputDecoder">
    SpeechInputDecoder
  </a>
<nav aria-label="SpeechInputDecoder" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#adviser.services.hci.speech.SpeechInputDecoder.SpeechInputDecoder">
    SpeechInputDecoder
  </a>
<nav aria-label="SpeechInputDecoder" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#adviser.services.hci.speech.SpeechInputDecoder.SpeechInputDecoder.__init__">
    __init__()
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#adviser.services.hci.speech.SpeechInputDecoder.SpeechInputDecoder.features_to_text">
    features_to_text()
  </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#adviser.services.hci.speech.SpeechInputDecoder.get_root_dir">
    get_root_dir()
  </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#adviser.services.hci.speech.SpeechInputFeatureExtractor">
    SpeechInputFeatureExtractor
  </a>
<nav aria-label="SpeechInputFeatureExtractor" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#adviser.services.hci.speech.SpeechInputFeatureExtractor.SpeechInputFeatureExtractor">
    SpeechInputFeatureExtractor
  </a>
<nav aria-label="SpeechInputFeatureExtractor" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#adviser.services.hci.speech.SpeechInputFeatureExtractor.SpeechInputFeatureExtractor.__init__">
    __init__()
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#adviser.services.hci.speech.SpeechInputFeatureExtractor.SpeechInputFeatureExtractor.speech_to_fbank">
    speech_to_fbank()
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#adviser.services.hci.speech.SpeechInputFeatureExtractor.SpeechInputFeatureExtractor.speech_to_features">
    speech_to_features()
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#adviser.services.hci.speech.SpeechInputFeatureExtractor.SpeechInputFeatureExtractor.speech_to_mfcc">
    speech_to_mfcc()
  </a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#adviser.services.hci.speech.SpeechOutputGenerator">
    SpeechOutputGenerator
  </a>
<nav aria-label="SpeechOutputGenerator" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#adviser.services.hci.speech.SpeechOutputGenerator.SpeechOutputGenerator">
    SpeechOutputGenerator
  </a>
<nav aria-label="SpeechOutputGenerator" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#adviser.services.hci.speech.SpeechOutputGenerator.SpeechOutputGenerator.__init__">
    __init__()
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#adviser.services.hci.speech.SpeechOutputGenerator.SpeechOutputGenerator.generate_speech">
    generate_speech()
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#adviser.services.hci.speech.SpeechOutputGenerator.SpeechOutputGenerator.preprocess_text_input">
    preprocess_text_input()
  </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#adviser.services.hci.speech.SpeechOutputGenerator.get_root_dir">
    get_root_dir()
  </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#adviser.services.hci.speech.SpeechOutputPlayer">
    SpeechOutputPlayer
  </a>
<nav aria-label="SpeechOutputPlayer" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#adviser.services.hci.speech.SpeechOutputPlayer.SpeechOutputPlayer">
    SpeechOutputPlayer
  </a>
<nav aria-label="SpeechOutputPlayer" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#adviser.services.hci.speech.SpeechOutputPlayer.SpeechOutputPlayer.__init__">
    __init__()
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#adviser.services.hci.speech.SpeechOutputPlayer.SpeechOutputPlayer.speak">
    speak()
  </a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#adviser.services.hci.speech.SpeechRecorder">
    SpeechRecorder
  </a>
<nav aria-label="SpeechRecorder" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#adviser.services.hci.speech.SpeechRecorder.SpeechRecorder">
    SpeechRecorder
  </a>
<nav aria-label="SpeechRecorder" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#adviser.services.hci.speech.SpeechRecorder.SpeechRecorder.__init__">
    __init__()
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#adviser.services.hci.speech.SpeechRecorder.SpeechRecorder.record_user_utterance">
    record_user_utterance()
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#adviser.services.hci.speech.SpeechRecorder.SpeechRecorder.start_recorder">
    start_recorder()
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#adviser.services.hci.speech.SpeechRecorder.SpeechRecorder.start_recording">
    start_recording()
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#adviser.services.hci.speech.SpeechRecorder.SpeechRecorder.threshold_plotter_generator">
    threshold_plotter_generator()
  </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#adviser.services.hci.speech.SpeechRecorder.voice_sanitizer">
    voice_sanitizer()
  </a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#adviser.services.hci.video">
    video
  </a>
<nav aria-label="video" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#adviser.services.hci.video.FeatureExtractor">
    FeatureExtractor
  </a>
<nav aria-label="FeatureExtractor" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#adviser.services.hci.video.FeatureExtractor.VideoFeatureExtractor">
    VideoFeatureExtractor
  </a>
<nav aria-label="VideoFeatureExtractor" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#adviser.services.hci.video.FeatureExtractor.VideoFeatureExtractor.__init__">
    __init__()
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#adviser.services.hci.video.FeatureExtractor.VideoFeatureExtractor.extract_fl_features">
    extract_fl_features()
  </a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#adviser.services.hci.video.VideoInput">
    VideoInput
  </a>
<nav aria-label="VideoInput" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#adviser.services.hci.video.VideoInput.VideoInput">
    VideoInput
  </a>
<nav aria-label="VideoInput" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#adviser.services.hci.video.VideoInput.VideoInput.__init__">
    __init__()
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#adviser.services.hci.video.VideoInput.VideoInput.capture">
    capture()
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#adviser.services.hci.video.VideoInput.VideoInput.dialog_end">
    dialog_end()
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#adviser.services.hci.video.VideoInput.VideoInput.dialog_start">
    dialog_start()
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#adviser.services.hci.video.VideoInput.VideoInput.publish_img">
    publish_img()
  </a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#adviser.services.nlg">
    nlg
  </a>
<nav aria-label="nlg" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#adviser.services.nlg.affective_nlg">
    affective_nlg
  </a>
<nav aria-label="affective_nlg" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#adviser.services.nlg.affective_nlg.HandcraftedEmotionNLG">
    HandcraftedEmotionNLG
  </a>
<nav aria-label="HandcraftedEmotionNLG" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#adviser.services.nlg.affective_nlg.HandcraftedEmotionNLG.__init__">
    __init__()
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#adviser.services.nlg.affective_nlg.HandcraftedEmotionNLG.generate_system_utterance">
    generate_system_utterance()
  </a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#adviser.services.nlg.bc_nlg">
    bc_nlg
  </a>
<nav aria-label="bc_nlg" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#adviser.services.nlg.bc_nlg.BackchannelHandcraftedNLG">
    BackchannelHandcraftedNLG
  </a>
<nav aria-label="BackchannelHandcraftedNLG" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#adviser.services.nlg.bc_nlg.BackchannelHandcraftedNLG.__init__">
    __init__()
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#adviser.services.nlg.bc_nlg.BackchannelHandcraftedNLG.publish_system_utterance">
    publish_system_utterance()
  </a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#adviser.services.nlg.nlg">
    nlg
  </a>
<nav aria-label="nlg" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#adviser.services.nlg.nlg.HandcraftedNLG">
    HandcraftedNLG
  </a>
<nav aria-label="HandcraftedNLG" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#adviser.services.nlg.nlg.HandcraftedNLG.__init__">
    __init__()
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#adviser.services.nlg.nlg.HandcraftedNLG.generate_system_utterance">
    generate_system_utterance()
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#adviser.services.nlg.nlg.HandcraftedNLG.publish_system_utterance">
    publish_system_utterance()
  </a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#adviser.services.nlg.templates">
    templates
  </a>
<nav aria-label="templates" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#adviser.services.nlg.templates.builtinfunctions">
    builtinfunctions
  </a>
<nav aria-label="builtinfunctions" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#adviser.services.nlg.templates.builtinfunctions.ForEntryFunction">
    ForEntryFunction
  </a>
<nav aria-label="ForEntryFunction" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#adviser.services.nlg.templates.builtinfunctions.ForEntryFunction.__init__">
    __init__()
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#adviser.services.nlg.templates.builtinfunctions.ForEntryFunction.apply">
    apply()
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#adviser.services.nlg.templates.builtinfunctions.ForEntryFunction.is_applicable">
    is_applicable()
  </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#adviser.services.nlg.templates.builtinfunctions.ForEntryListFunction">
    ForEntryListFunction
  </a>
<nav aria-label="ForEntryListFunction" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#adviser.services.nlg.templates.builtinfunctions.ForEntryListFunction.__init__">
    __init__()
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#adviser.services.nlg.templates.builtinfunctions.ForEntryListFunction.apply">
    apply()
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#adviser.services.nlg.templates.builtinfunctions.ForEntryListFunction.is_applicable">
    is_applicable()
  </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#adviser.services.nlg.templates.builtinfunctions.ForFunction">
    ForFunction
  </a>
<nav aria-label="ForFunction" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#adviser.services.nlg.templates.builtinfunctions.ForFunction.__init__">
    __init__()
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#adviser.services.nlg.templates.builtinfunctions.ForFunction.apply">
    apply()
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#adviser.services.nlg.templates.builtinfunctions.ForFunction.is_applicable">
    is_applicable()
  </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#adviser.services.nlg.templates.builtinfunctions.PythonFunction">
    PythonFunction
  </a>
<nav aria-label="PythonFunction" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#adviser.services.nlg.templates.builtinfunctions.PythonFunction.__init__">
    __init__()
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#adviser.services.nlg.templates.builtinfunctions.PythonFunction.apply">
    apply()
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#adviser.services.nlg.templates.builtinfunctions.PythonFunction.is_applicable">
    is_applicable()
  </a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#adviser.services.nlg.templates.parsing">
    parsing
  </a>
<nav aria-label="parsing" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#adviser.services.nlg.templates.parsing.automaton">
    automaton
  </a>
<nav aria-label="automaton" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#adviser.services.nlg.templates.parsing.automaton.ModifiedPushdownAutomaton">
    ModifiedPushdownAutomaton
  </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#adviser.services.nlg.templates.parsing.configuration">
    configuration
  </a>
<nav aria-label="configuration" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#adviser.services.nlg.templates.parsing.configuration.Configuration">
    Configuration
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#adviser.services.nlg.templates.parsing.configuration.DefaultTransition">
    DefaultTransition
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#adviser.services.nlg.templates.parsing.configuration.SimpleForwardDefaultTransition">
    SimpleForwardDefaultTransition
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#adviser.services.nlg.templates.parsing.configuration.State">
    State
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#adviser.services.nlg.templates.parsing.configuration.StateDescription">
    StateDescription
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#adviser.services.nlg.templates.parsing.configuration.Transition">
    Transition
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#adviser.services.nlg.templates.parsing.configuration.TransitionWithAction">
    TransitionWithAction
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#adviser.services.nlg.templates.parsing.configuration.TransitionWithoutAction">
    TransitionWithoutAction
  </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#adviser.services.nlg.templates.parsing.exceptions">
    exceptions
  </a>
<nav aria-label="exceptions" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#adviser.services.nlg.templates.parsing.exceptions.ParsingError">
    ParsingError
  </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#adviser.services.nlg.templates.parsing.parsers">
    parsers
  </a>
<nav aria-label="parsers" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#adviser.services.nlg.templates.parsing.parsers.messageparser">
    messageparser
  </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#adviser.services.nlg.templates.parsing.stack">
    stack
  </a>
<nav aria-label="stack" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#adviser.services.nlg.templates.parsing.stack.AutomatonStack">
    AutomatonStack
  </a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#adviser.services.nlg.templates.preprocessing">
    preprocessing
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#adviser.services.nlg.templates.templatefile">
    templatefile
  </a>
<nav aria-label="templatefile" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#adviser.services.nlg.templates.templatefile.TemplateFile">
    TemplateFile
  </a>
<nav aria-label="TemplateFile" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#adviser.services.nlg.templates.templatefile.TemplateFile.__init__">
    __init__()
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#adviser.services.nlg.templates.templatefile.TemplateFile.add_python_function">
    add_python_function()
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#adviser.services.nlg.templates.templatefile.TemplateFile.create_message">
    create_message()
  </a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#adviser.services.nlu">
    nlu
  </a>
<nav aria-label="nlu" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#adviser.services.nlu.nlu">
    nlu
  </a>
<nav aria-label="nlu" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#adviser.services.nlu.nlu.HandcraftedNLU">
    HandcraftedNLU
  </a>
<nav aria-label="HandcraftedNLU" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#adviser.services.nlu.nlu.HandcraftedNLU.__init__">
    __init__()
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#adviser.services.nlu.nlu.HandcraftedNLU.extract_user_acts">
    extract_user_acts()
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#adviser.services.nlu.nlu.HandcraftedNLU.start_dialog">
    start_dialog()
  </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#adviser.services.nlu.nlu.get_root_dir">
    get_root_dir()
  </a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#adviser.services.policy">
    policy
  </a>
<nav aria-label="policy" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#adviser.services.policy.affective_policy">
    affective_policy
  </a>
<nav aria-label="affective_policy" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#adviser.services.policy.affective_policy.EmotionPolicy">
    EmotionPolicy
  </a>
<nav aria-label="EmotionPolicy" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#adviser.services.policy.affective_policy.EmotionPolicy.__init__">
    __init__()
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#adviser.services.policy.affective_policy.EmotionPolicy.choose_sys_emotion">
    choose_sys_emotion()
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#adviser.services.policy.affective_policy.EmotionPolicy.dialog_start">
    dialog_start()
  </a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#adviser.services.policy.policy_api">
    policy_api
  </a>
<nav aria-label="policy_api" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#adviser.services.policy.policy_api.HandcraftedPolicy">
    HandcraftedPolicy
  </a>
<nav aria-label="HandcraftedPolicy" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#adviser.services.policy.policy_api.HandcraftedPolicy.__init__">
    __init__()
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#adviser.services.policy.policy_api.HandcraftedPolicy.choose_sys_act">
    choose_sys_act()
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#adviser.services.policy.policy_api.HandcraftedPolicy.dialog_start">
    dialog_start()
  </a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#adviser.services.policy.policy_handcrafted">
    policy_handcrafted
  </a>
<nav aria-label="policy_handcrafted" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#adviser.services.policy.policy_handcrafted.HandcraftedPolicy">
    HandcraftedPolicy
  </a>
<nav aria-label="HandcraftedPolicy" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#adviser.services.policy.policy_handcrafted.HandcraftedPolicy.__init__">
    __init__()
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#adviser.services.policy.policy_handcrafted.HandcraftedPolicy.choose_sys_act">
    choose_sys_act()
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#adviser.services.policy.policy_handcrafted.HandcraftedPolicy.dialog_start">
    dialog_start()
  </a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#adviser.services.policy.rl">
    rl
  </a>
<nav aria-label="rl" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#adviser.services.policy.rl.dqn">
    dqn
  </a>
<nav aria-label="dqn" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#adviser.services.policy.rl.dqn.DQN">
    DQN
  </a>
<nav aria-label="DQN" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#adviser.services.policy.rl.dqn.DQN.__init__">
    __init__()
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#adviser.services.policy.rl.dqn.DQN.forward">
    forward()
  </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#adviser.services.policy.rl.dqn.DuelingDQN">
    DuelingDQN
  </a>
<nav aria-label="DuelingDQN" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#adviser.services.policy.rl.dqn.DuelingDQN.__init__">
    __init__()
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#adviser.services.policy.rl.dqn.DuelingDQN.forward">
    forward()
  </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#adviser.services.policy.rl.dqn.NetArchitecture">
    NetArchitecture
  </a>
<nav aria-label="NetArchitecture" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#adviser.services.policy.rl.dqn.NetArchitecture.__new__">
    __new__()
  </a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#adviser.services.policy.rl.dqnpolicy">
    dqnpolicy
  </a>
<nav aria-label="dqnpolicy" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#adviser.services.policy.rl.dqnpolicy.DQNPolicy">
    DQNPolicy
  </a>
<nav aria-label="DQNPolicy" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#adviser.services.policy.rl.dqnpolicy.DQNPolicy.__init__">
    __init__()
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#adviser.services.policy.rl.dqnpolicy.DQNPolicy.choose_sys_act">
    choose_sys_act()
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#adviser.services.policy.rl.dqnpolicy.DQNPolicy.dialog_end">
    dialog_end()
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#adviser.services.policy.rl.dqnpolicy.DQNPolicy.dialog_start">
    dialog_start()
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#adviser.services.policy.rl.dqnpolicy.DQNPolicy.end">
    end()
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#adviser.services.policy.rl.dqnpolicy.DQNPolicy.eps_scheduler">
    eps_scheduler()
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#adviser.services.policy.rl.dqnpolicy.DQNPolicy.eval">
    eval()
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#adviser.services.policy.rl.dqnpolicy.DQNPolicy.load">
    load()
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#adviser.services.policy.rl.dqnpolicy.DQNPolicy.loss">
    loss()
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#adviser.services.policy.rl.dqnpolicy.DQNPolicy.save">
    save()
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#adviser.services.policy.rl.dqnpolicy.DQNPolicy.select_action_eps_greedy">
    select_action_eps_greedy()
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#adviser.services.policy.rl.dqnpolicy.DQNPolicy.train">
    train()
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#adviser.services.policy.rl.dqnpolicy.DQNPolicy.train_batch">
    train_batch()
  </a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#adviser.services.policy.rl.experience_buffer">
    experience_buffer
  </a>
<nav aria-label="experience_buffer" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#adviser.services.policy.rl.experience_buffer.Buffer">
    Buffer
  </a>
<nav aria-label="Buffer" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#adviser.services.policy.rl.experience_buffer.Buffer.__init__">
    __init__()
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#adviser.services.policy.rl.experience_buffer.Buffer.__len__">
    __len__()
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#adviser.services.policy.rl.experience_buffer.Buffer.print_contents">
    print_contents()
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#adviser.services.policy.rl.experience_buffer.Buffer.sample">
    sample()
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#adviser.services.policy.rl.experience_buffer.Buffer.store">
    store()
  </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#adviser.services.policy.rl.experience_buffer.NaivePrioritizedBuffer">
    NaivePrioritizedBuffer
  </a>
<nav aria-label="NaivePrioritizedBuffer" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#adviser.services.policy.rl.experience_buffer.NaivePrioritizedBuffer.__init__">
    __init__()
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#adviser.services.policy.rl.experience_buffer.NaivePrioritizedBuffer.sample">
    sample()
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#adviser.services.policy.rl.experience_buffer.NaivePrioritizedBuffer.store">
    store()
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#adviser.services.policy.rl.experience_buffer.NaivePrioritizedBuffer.update">
    update()
  </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#adviser.services.policy.rl.experience_buffer.UniformBuffer">
    UniformBuffer
  </a>
<nav aria-label="UniformBuffer" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#adviser.services.policy.rl.experience_buffer.UniformBuffer.__init__">
    __init__()
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#adviser.services.policy.rl.experience_buffer.UniformBuffer.sample">
    sample()
  </a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#adviser.services.policy.rl.policy_rl">
    policy_rl
  </a>
<nav aria-label="policy_rl" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#adviser.services.policy.rl.policy_rl.RLPolicy">
    RLPolicy
  </a>
<nav aria-label="RLPolicy" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#adviser.services.policy.rl.policy_rl.RLPolicy.__init__">
    __init__()
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#adviser.services.policy.rl.policy_rl.RLPolicy.action_idx">
    action_idx()
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#adviser.services.policy.rl.policy_rl.RLPolicy.action_name">
    action_name()
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#adviser.services.policy.rl.policy_rl.RLPolicy.beliefstate_dict_to_vector">
    beliefstate_dict_to_vector()
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#adviser.services.policy.rl.policy_rl.RLPolicy.end_dialog">
    end_dialog()
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#adviser.services.policy.rl.policy_rl.RLPolicy.expand_system_action">
    expand_system_action()
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#adviser.services.policy.rl.policy_rl.RLPolicy.turn_end">
    turn_end()
  </a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#adviser.services.policy.rl.train_dqnpolicy">
    train_dqnpolicy
  </a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</div>
</div>
</div>
<div class="md-content">
<article class="md-content__inner md-typeset">
<a class="md-content__button md-icon" href="https://github.com/DigitalPhonetics/adviser/edit/master/docs/api/services.md" title="Edit this page">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M20.71 7.04c.39-.39.39-1.04 0-1.41l-2.34-2.34c-.37-.39-1.02-.39-1.41 0l-1.84 1.83 3.75 3.75M3 17.25V21h3.75L17.81 9.93l-3.75-3.75L3 17.25z"></path></svg>
</a>
<h1 id="services">Services<a class="headerlink" href="#services" title="Permanent link"></a></h1>
<div class="doc doc-object doc-module">
<h2 class="hidden-toc" href="#adviser.services" id="adviser.services" style="visibility: hidden; width: 0; height: 0;">
<a class="headerlink" href="#adviser.services" title="Permanent link"></a></h2>
<div class="doc doc-contents first">
<div class="doc doc-children">
<div class="doc doc-object doc-module">
<h2 class="doc doc-heading" id="adviser.services.backchannel">
<code>backchannel</code>
<span class="doc doc-properties">
<small class="doc doc-property doc-property-special"><code>special</code></small>
</span>
<a class="headerlink" href="#adviser.services.backchannel" title="Permanent link"></a></h2>
<div class="doc doc-contents">
<div class="doc doc-children">
<div class="doc doc-object doc-module">
<h3 class="doc doc-heading" id="adviser.services.backchannel.acoustic_backchanneller">
<code>acoustic_backchanneller</code>
<a class="headerlink" href="#adviser.services.backchannel.acoustic_backchanneller" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<div class="doc doc-children">
<div class="doc doc-object doc-class">
<h4 class="doc doc-heading" id="adviser.services.backchannel.acoustic_backchanneller.AcousticBackchanneller">
<code>AcousticBackchanneller</code>
<a class="headerlink" href="#adviser.services.backchannel.acoustic_backchanneller.AcousticBackchanneller" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>AcousticBackchanneller predicts a backchannel given the last user utterance.
       The model can predict: No backchannel (0), Assessment (1), Continuer (2)
       The backchannel realization is added in the NLG module.</p>
<div class="doc doc-children">
<div class="doc doc-object doc-method">
<h5 class="doc doc-heading" id="adviser.services.backchannel.acoustic_backchanneller.AcousticBackchanneller.__init__">
<code class="highlight language-python">
__init__<span class="p">(</span><span class="bp">self</span><span class="p">)</span> </code>
<span class="doc doc-properties">
<small class="doc doc-property doc-property-special"><code>special</code></small>
</span>
<a class="headerlink" href="#adviser.services.backchannel.acoustic_backchanneller.AcousticBackchanneller.__init__" title="Permanent link"></a></h5>
<div class="doc doc-contents">
<details class="quote">
<summary>Source code in <code>adviser/services/backchannel/acoustic_backchanneller.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>41
42
43
44
45</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="n">Service</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">speech_in_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="vm">__file__</span><span class="p">))</span> <span class="o">+</span> <span class="s1">'/'</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">trained_model_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s1">'resources'</span><span class="p">,</span> <span class="s1">'models'</span><span class="p">,</span> <span class="s1">'backchannel'</span><span class="p">)</span> <span class="o">+</span> <span class="s1">'/pytorch_acoustic_backchanneller.pt'</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">load_model</span><span class="p">()</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h5 class="doc doc-heading" id="adviser.services.backchannel.acoustic_backchanneller.AcousticBackchanneller.backchannel_prediction">
<code class="highlight language-python">
backchannel_prediction<span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> </code>
<a class="headerlink" href="#adviser.services.backchannel.acoustic_backchanneller.AcousticBackchanneller.backchannel_prediction" title="Permanent link"></a></h5>
<div class="doc doc-contents">
<details class="quote">
<summary>Source code in <code>adviser/services/backchannel/acoustic_backchanneller.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>551
552
553
554
555
556
557
558
559
560
561
562
563
564
565
566
567
568
569
570
571
572
573
574
575
576
577
578
579
580
581
582</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">delegate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="n">func_inst</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">func</span><span class="o">.</span><span class="vm">__name__</span><span class="p">)</span>

    <span class="n">callargs</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">args</span><span class="p">)</span>
    <span class="k">if</span> <span class="bp">self</span> <span class="ow">in</span> <span class="n">callargs</span><span class="p">:</span>    <span class="c1"># remove self when in *args, because already known to function</span>
        <span class="n">callargs</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">func</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">callargs</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">result</span><span class="p">:</span>
        <span class="c1"># fix! (user could have multiple "/" characters in topic - only use last one )</span>
        <span class="n">domains</span> <span class="o">=</span> <span class="p">{</span><span class="n">res</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">"/"</span><span class="p">)[</span><span class="mi">0</span><span class="p">]:</span> <span class="n">res</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">"/"</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span> <span class="k">if</span> <span class="s2">"/"</span> <span class="ow">in</span> <span class="n">res</span> <span class="k">else</span> <span class="s2">""</span> <span class="k">for</span> <span class="n">res</span> <span class="ow">in</span> <span class="n">result</span><span class="p">}</span>
        <span class="n">result</span> <span class="o">=</span> <span class="p">{</span><span class="n">key</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">"/"</span><span class="p">)[</span><span class="mi">0</span><span class="p">]:</span> <span class="n">result</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">result</span><span class="p">}</span>

    <span class="k">if</span> <span class="n">func_inst</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_publish_sockets</span><span class="p">:</span>
        <span class="c1"># not a publisher, just normal function</span>
        <span class="k">return</span> <span class="n">result</span>

    <span class="n">socket</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_publish_sockets</span><span class="p">[</span><span class="n">func_inst</span><span class="p">]</span>
    <span class="n">domain</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_domain_name</span>
    <span class="k">if</span> <span class="n">socket</span> <span class="ow">and</span> <span class="n">result</span><span class="p">:</span>
        <span class="c1"># publish messages</span>
        <span class="k">for</span> <span class="n">topic</span> <span class="ow">in</span> <span class="n">pub_topics</span><span class="p">:</span>
        <span class="c1"># for topic in result: # NOTE publish any returned value in dict with it's key as topic</span>
            <span class="k">if</span> <span class="n">topic</span> <span class="ow">in</span> <span class="n">result</span><span class="p">:</span>
                <span class="n">domain</span> <span class="o">=</span> <span class="n">domain</span> <span class="k">if</span> <span class="n">domain</span> <span class="k">else</span> <span class="n">domains</span><span class="p">[</span><span class="n">topic</span><span class="p">]</span>
                <span class="n">topic_domain_str</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="n">topic</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">domain</span><span class="si">}</span><span class="s2">"</span> <span class="k">if</span> <span class="n">domain</span> <span class="k">else</span> <span class="n">topic</span>
                <span class="k">if</span> <span class="n">topic</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_pub_topic_domains</span><span class="p">:</span>
                    <span class="n">topic_domain_str</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="n">topic</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_pub_topic_domains</span><span class="p">[</span><span class="n">topic</span><span class="p">]</span><span class="si">}</span><span class="s2">"</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_pub_topic_domains</span><span class="p">[</span><span class="n">topic</span><span class="p">]</span> <span class="k">else</span> <span class="n">topic</span>
                <span class="n">_send_msg</span><span class="p">(</span><span class="n">socket</span><span class="p">,</span> <span class="n">topic_domain_str</span><span class="p">,</span> <span class="n">result</span><span class="p">[</span><span class="n">topic</span><span class="p">])</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">debug_logger</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">debug_logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
                        <span class="sa">f</span><span class="s2">"- (DS): sent message from </span><span class="si">{</span><span class="n">func</span><span class="si">}</span><span class="s2"> to topic </span><span class="si">{</span><span class="n">topic_domain_str</span><span class="si">}</span><span class="s2">:</span><span class="se">\n</span><span class="s2">   </span><span class="si">{</span><span class="n">result</span><span class="p">[</span><span class="n">topic</span><span class="p">]</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">result</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h5 class="doc doc-heading" id="adviser.services.backchannel.acoustic_backchanneller.AcousticBackchanneller.load_model">
<code class="highlight language-python">
load_model<span class="p">(</span><span class="bp">self</span><span class="p">)</span> </code>
<a class="headerlink" href="#adviser.services.backchannel.acoustic_backchanneller.AcousticBackchanneller.load_model" title="Permanent link"></a></h5>
<div class="doc doc-contents">
<p>The PyTorch Backchannel model is instantiated and the pretrained parameters are loaded.</p>
<details class="quote">
<summary>Source code in <code>adviser/services/backchannel/acoustic_backchanneller.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>47
48
49
50
51
52
53
54
55</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">load_model</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">"""</span>
<span class="sd">    The PyTorch Backchannel model is instantiated and the pretrained parameters are loaded.</span>

<span class="sd">    Returns:</span>
<span class="sd">    """</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">model</span> <span class="o">=</span> <span class="n">PytorchAcousticBackchanneler</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">load_state_dict</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">trained_model_path</span><span class="p">))</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">eval</span><span class="p">()</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h5 class="doc doc-heading" id="adviser.services.backchannel.acoustic_backchanneller.AcousticBackchanneller.split_input_data">
<code class="highlight language-python">
split_input_data<span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mfcc_features</span><span class="p">)</span> </code>
<a class="headerlink" href="#adviser.services.backchannel.acoustic_backchanneller.AcousticBackchanneller.split_input_data" title="Permanent link"></a></h5>
<div class="doc doc-contents">
<p>Preprocess and segmentation of MFCC features of the user's speech.
Segmentation is done every 150ms without overlapping.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>mfcc_features</code></td>
<td><code>numpy.array</code></td>
<td>
<p>mffcc features of users speech</p>
</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>new_data (list)</code></td>
<td>
<p>segmented mfcc features</p>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>adviser/services/backchannel/acoustic_backchanneller.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">split_input_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mfcc_features</span><span class="p">):</span>
    <span class="sd">"""</span>
<span class="sd">    Preprocess and segmentation of MFCC features of the user's speech.</span>
<span class="sd">    Segmentation is done every 150ms without overlapping.</span>

<span class="sd">    Args:</span>
<span class="sd">        mfcc_features (numpy.array): mffcc features of users speech</span>

<span class="sd">    Returns:</span>
<span class="sd">        new_data (list): segmented mfcc features</span>

<span class="sd">    """</span>
    <span class="n">input_height</span> <span class="o">=</span> <span class="mi">150</span>  <span class="c1"># this stands for 150ms</span>
    <span class="n">input_length</span> <span class="o">=</span> <span class="n">mfcc_features</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">zero_shape</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">mfcc_features</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
    <span class="n">zero_shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">input_height</span>
    <span class="n">ranges</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">reversed</span><span class="p">([</span><span class="n">idx</span> <span class="k">for</span> <span class="n">idx</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">input_length</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="n">input_height</span><span class="p">)]))</span>
    <span class="n">new_data</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">ranges</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">r</span> <span class="o">&lt;</span> <span class="n">input_height</span><span class="p">:</span>
            <span class="n">zero_data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">zero_shape</span><span class="p">)</span>
            <span class="n">zero_data</span><span class="p">[</span><span class="o">-</span><span class="n">r</span><span class="p">:,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">mfcc_features</span><span class="p">[:</span><span class="n">r</span><span class="p">,</span> <span class="p">:]</span>
            <span class="n">new_data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">zero_data</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">new_data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">mfcc_features</span><span class="p">[</span><span class="n">r</span> <span class="o">-</span> <span class="n">input_height</span><span class="p">:</span><span class="n">r</span><span class="p">,</span> <span class="p">:])</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">new_data</span><span class="p">)</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="doc doc-object doc-module">
<h3 class="doc doc-heading" id="adviser.services.backchannel.PytorchAcousticBackchanneler">
<code>PytorchAcousticBackchanneler</code>
<a class="headerlink" href="#adviser.services.backchannel.PytorchAcousticBackchanneler" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<div class="doc doc-children">
<div class="doc doc-object doc-class">
<h4 class="doc doc-heading" id="adviser.services.backchannel.PytorchAcousticBackchanneler.PytorchAcousticBackchanneler">
<code>PytorchAcousticBackchanneler</code>
<a class="headerlink" href="#adviser.services.backchannel.PytorchAcousticBackchanneler.PytorchAcousticBackchanneler" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>Class for defining the Deep Backchannel model in PyTorch</p>
<div class="doc doc-children">
<div class="doc doc-object doc-method">
<h5 class="doc doc-heading" id="adviser.services.backchannel.PytorchAcousticBackchanneler.PytorchAcousticBackchanneler.__init__">
<code class="highlight language-python">
__init__<span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parameters</span><span class="o">=</span><span class="p">[],</span> <span class="n">load_params</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span> </code>
<span class="doc doc-properties">
<small class="doc doc-property doc-property-special"><code>special</code></small>
</span>
<a class="headerlink" href="#adviser.services.backchannel.PytorchAcousticBackchanneler.PytorchAcousticBackchanneler.__init__" title="Permanent link"></a></h5>
<div class="doc doc-contents">
<p>Defines the elements/layers of the neural network as well as loads the pretrained parameters</p>
<p>The model is constituted by two parallel CNNs followed by a concatenation, a  FFN and a softmax layer.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>parameters</code></td>
<td><code>list</code></td>
<td>
<p>list of pre-trained parameters to be used for prediction</p>
</td>
<td><code>[]</code></td>
</tr>
<tr>
<td><code>load_params</code></td>
<td><code>bool</code></td>
<td>
<p>Bool to signal if params should be loaded</p>
</td>
<td><code>False</code></td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>adviser/services/backchannel/PytorchAcousticBackchanneler.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parameters</span><span class="p">:</span><span class="nb">list</span><span class="o">=</span><span class="p">[],</span> <span class="n">load_params</span><span class="p">:</span><span class="nb">bool</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="sd">"""</span>
<span class="sd">    Defines the elements/layers of the neural network as well as loads the pretrained parameters</span>

<span class="sd">    The model is constituted by two parallel CNNs followed by a concatenation, a  FFN and a softmax layer.</span>

<span class="sd">    Args:</span>
<span class="sd">        parameters (list): list of pre-trained parameters to be used for prediction</span>
<span class="sd">        load_params (bool): Bool to signal if params should be loaded</span>
<span class="sd">    """</span>
    <span class="nb">super</span><span class="p">(</span><span class="n">PytorchAcousticBackchanneler</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>

    <span class="c1"># First CNN</span>
    <span class="n">cnn</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">Conv2d</span><span class="p">(</span><span class="n">in_channels</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">out_channels</span><span class="o">=</span><span class="mi">16</span><span class="p">,</span> <span class="n">kernel_size</span><span class="o">=</span><span class="p">(</span><span class="mi">11</span><span class="p">,</span> <span class="mi">13</span><span class="p">),</span> <span class="n">stride</span><span class="o">=</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">1</span><span class="p">))</span>
    <span class="k">if</span> <span class="n">load_params</span><span class="p">:</span>
        <span class="n">weights</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="n">parameters</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
        <span class="n">cnn</span><span class="o">.</span><span class="n">weight</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">Parameter</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">(</span><span class="n">weights</span><span class="p">)</span><span class="o">.</span><span class="n">float</span><span class="p">())</span>
        <span class="n">cnn</span><span class="o">.</span><span class="n">bias</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">Parameter</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">(</span><span class="n">parameters</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">])</span><span class="o">.</span><span class="n">float</span><span class="p">())</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">cnn1</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">Sequential</span><span class="p">(</span>
        <span class="n">cnn</span><span class="p">,</span>
        <span class="n">nn</span><span class="o">.</span><span class="n">ReLU</span><span class="p">(),</span>
        <span class="n">nn</span><span class="o">.</span><span class="n">MaxPool2d</span><span class="p">((</span><span class="mi">23</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
    <span class="p">)</span>

    <span class="c1"># Second CNN</span>
    <span class="n">cnn</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">Conv2d</span><span class="p">(</span><span class="n">in_channels</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">out_channels</span><span class="o">=</span><span class="mi">16</span><span class="p">,</span> <span class="n">kernel_size</span> <span class="o">=</span> <span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">13</span><span class="p">),</span> <span class="n">stride</span><span class="o">=</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">1</span><span class="p">))</span>
    <span class="k">if</span> <span class="n">load_params</span><span class="p">:</span>
        <span class="n">weights</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="n">parameters</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">))</span>
        <span class="n">cnn</span><span class="o">.</span><span class="n">weight</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">Parameter</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">(</span><span class="n">weights</span><span class="p">)</span><span class="o">.</span><span class="n">float</span><span class="p">())</span>
        <span class="n">cnn</span><span class="o">.</span><span class="n">bias</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">Parameter</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">(</span><span class="n">parameters</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">])</span><span class="o">.</span><span class="n">float</span><span class="p">())</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">cnn2</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">Sequential</span><span class="p">(</span>
        <span class="n">cnn</span><span class="p">,</span>
        <span class="n">nn</span><span class="o">.</span><span class="n">ReLU</span><span class="p">(),</span>
        <span class="n">nn</span><span class="o">.</span><span class="n">MaxPool2d</span><span class="p">((</span><span class="mi">23</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
    <span class="p">)</span>

    <span class="c1"># Linear layer</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">linear1</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">Linear</span><span class="p">(</span><span class="n">in_features</span><span class="o">=</span><span class="mi">64</span><span class="p">,</span> <span class="n">out_features</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">load_params</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">linear1</span><span class="o">.</span><span class="n">weight</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">Parameter</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">(</span><span class="n">parameters</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">T</span><span class="p">)</span><span class="o">.</span><span class="n">float</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">linear1</span><span class="o">.</span><span class="n">bias</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">Parameter</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">(</span><span class="n">parameters</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="mi">1</span><span class="p">])</span><span class="o">.</span><span class="n">float</span><span class="p">())</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">relu</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">ReLU</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">dropout</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">Dropout</span><span class="p">(</span><span class="mf">0.5</span><span class="p">)</span>

    <span class="c1"># Softmax</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">linear2</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">Linear</span><span class="p">(</span><span class="n">in_features</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">out_features</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">load_params</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">linear2</span><span class="o">.</span><span class="n">weight</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">Parameter</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">(</span><span class="n">parameters</span><span class="p">[</span><span class="mi">3</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">T</span><span class="p">)</span><span class="o">.</span><span class="n">float</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">linear2</span><span class="o">.</span><span class="n">bias</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">Parameter</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">(</span><span class="n">parameters</span><span class="p">[</span><span class="mi">3</span><span class="p">][</span><span class="mi">1</span><span class="p">])</span><span class="o">.</span><span class="n">float</span><span class="p">())</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">softmax</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">Softmax</span><span class="p">(</span><span class="n">dim</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h5 class="doc doc-heading" id="adviser.services.backchannel.PytorchAcousticBackchanneler.PytorchAcousticBackchanneler.forward">
<code class="highlight language-python">
forward<span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">feat_inputs</span><span class="p">)</span> </code>
<a class="headerlink" href="#adviser.services.backchannel.PytorchAcousticBackchanneler.PytorchAcousticBackchanneler.forward" title="Permanent link"></a></h5>
<div class="doc doc-contents">
<p>PyTorch forward method used for training and prediction. It defines the interaction between layers.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>feat_inputs</code></td>
<td><code>numpy array</code></td>
<td>
<p>It contains the network's input.</p>
</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>out (torch.tensor)</code></td>
<td>
<p>Network's output</p>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>adviser/services/backchannel/PytorchAcousticBackchanneler.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">forward</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">feat_inputs</span><span class="p">):</span>
    <span class="sd">"""</span>
<span class="sd">    PyTorch forward method used for training and prediction. It defines the interaction between layers.</span>
<span class="sd">    Args:</span>
<span class="sd">        feat_inputs (numpy array): It contains the network's input.</span>

<span class="sd">    Returns:</span>
<span class="sd">        out (torch.tensor): Network's output</span>
<span class="sd">    """</span>
    <span class="n">feat_inputs</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">(</span><span class="n">feat_inputs</span><span class="p">)</span><span class="o">.</span><span class="n">float</span><span class="p">()</span>
    <span class="n">feat_inputs</span> <span class="o">=</span> <span class="n">feat_inputs</span><span class="o">.</span><span class="n">unsqueeze</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">cnn_1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cnn1</span><span class="p">(</span><span class="n">feat_inputs</span><span class="p">)</span>
    <span class="n">cnn_1</span> <span class="o">=</span> <span class="n">cnn_1</span><span class="o">.</span><span class="n">flatten</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">cnn_2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cnn2</span><span class="p">(</span><span class="n">feat_inputs</span><span class="p">)</span><span class="o">.</span><span class="n">flatten</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">out</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">cat</span><span class="p">((</span><span class="n">cnn_1</span><span class="p">,</span> <span class="n">cnn_2</span><span class="p">),</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">out</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">linear1</span><span class="p">(</span><span class="n">out</span><span class="p">)</span>
    <span class="n">out</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">relu</span><span class="p">(</span><span class="n">out</span><span class="p">)</span>
    <span class="n">out</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dropout</span><span class="p">(</span><span class="n">out</span><span class="p">)</span>
    <span class="n">out</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">linear2</span><span class="p">(</span><span class="n">out</span><span class="p">)</span>
    <span class="n">out</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">softmax</span><span class="p">(</span><span class="n">out</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">out</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="doc doc-object doc-module">
<h2 class="doc doc-heading" id="adviser.services.bst">
<code>bst</code>
<span class="doc doc-properties">
<small class="doc doc-property doc-property-special"><code>special</code></small>
</span>
<a class="headerlink" href="#adviser.services.bst" title="Permanent link"></a></h2>
<div class="doc doc-contents">
<div class="doc doc-children">
<div class="doc doc-object doc-module">
<h3 class="doc doc-heading" id="adviser.services.bst.bst">
<code>bst</code>
<a class="headerlink" href="#adviser.services.bst.bst" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<div class="doc doc-children">
<div class="doc doc-object doc-class">
<h4 class="doc doc-heading" id="adviser.services.bst.bst.HandcraftedBST">
<code>HandcraftedBST</code>
<a class="headerlink" href="#adviser.services.bst.bst.HandcraftedBST" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>A rule-based approach to belief state tracking.</p>
<div class="doc doc-children">
<div class="doc doc-object doc-method">
<h5 class="doc doc-heading" id="adviser.services.bst.bst.HandcraftedBST.__init__">
<code class="highlight language-python">
__init__<span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">domain</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">logger</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span> </code>
<span class="doc doc-properties">
<small class="doc doc-property doc-property-special"><code>special</code></small>
</span>
<a class="headerlink" href="#adviser.services.bst.bst.HandcraftedBST.__init__" title="Permanent link"></a></h5>
<div class="doc doc-contents">
<details class="quote">
<summary>Source code in <code>adviser/services/bst/bst.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>33
34
35
36</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">domain</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">logger</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="n">Service</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">domain</span><span class="o">=</span><span class="n">domain</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">logger</span> <span class="o">=</span> <span class="n">logger</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">bs</span> <span class="o">=</span> <span class="n">BeliefState</span><span class="p">(</span><span class="n">domain</span><span class="p">)</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h5 class="doc doc-heading" id="adviser.services.bst.bst.HandcraftedBST.dialog_start">
<code class="highlight language-python">
dialog_start<span class="p">(</span><span class="bp">self</span><span class="p">)</span> </code>
<a class="headerlink" href="#adviser.services.bst.bst.HandcraftedBST.dialog_start" title="Permanent link"></a></h5>
<div class="doc doc-contents">
<p>Restets the belief state so it is ready for a new dialog</p>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>(dict)</code></td>
<td>
<p>a dictionary with a single entry where the key is 'beliefstate'and
        the value is a new BeliefState object</p>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>adviser/services/bst/bst.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>69
70
71
72
73
74
75
76
77
78</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">dialog_start</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">"""</span>
<span class="sd">        Restets the belief state so it is ready for a new dialog</span>

<span class="sd">        Returns:</span>
<span class="sd">            (dict): a dictionary with a single entry where the key is 'beliefstate'and</span>
<span class="sd">                    the value is a new BeliefState object</span>
<span class="sd">    """</span>
    <span class="c1"># initialize belief state</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">bs</span> <span class="o">=</span> <span class="n">BeliefState</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">domain</span><span class="p">)</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h5 class="doc doc-heading" id="adviser.services.bst.bst.HandcraftedBST.update_bst">
<code class="highlight language-python">
update_bst<span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> </code>
<a class="headerlink" href="#adviser.services.bst.bst.HandcraftedBST.update_bst" title="Permanent link"></a></h5>
<div class="doc doc-contents">
<details class="quote">
<summary>Source code in <code>adviser/services/bst/bst.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>551
552
553
554
555
556
557
558
559
560
561
562
563
564
565
566
567
568
569
570
571
572
573
574
575
576
577
578
579
580
581
582</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">delegate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="n">func_inst</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">func</span><span class="o">.</span><span class="vm">__name__</span><span class="p">)</span>

    <span class="n">callargs</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">args</span><span class="p">)</span>
    <span class="k">if</span> <span class="bp">self</span> <span class="ow">in</span> <span class="n">callargs</span><span class="p">:</span>    <span class="c1"># remove self when in *args, because already known to function</span>
        <span class="n">callargs</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">func</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">callargs</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">result</span><span class="p">:</span>
        <span class="c1"># fix! (user could have multiple "/" characters in topic - only use last one )</span>
        <span class="n">domains</span> <span class="o">=</span> <span class="p">{</span><span class="n">res</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">"/"</span><span class="p">)[</span><span class="mi">0</span><span class="p">]:</span> <span class="n">res</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">"/"</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span> <span class="k">if</span> <span class="s2">"/"</span> <span class="ow">in</span> <span class="n">res</span> <span class="k">else</span> <span class="s2">""</span> <span class="k">for</span> <span class="n">res</span> <span class="ow">in</span> <span class="n">result</span><span class="p">}</span>
        <span class="n">result</span> <span class="o">=</span> <span class="p">{</span><span class="n">key</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">"/"</span><span class="p">)[</span><span class="mi">0</span><span class="p">]:</span> <span class="n">result</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">result</span><span class="p">}</span>

    <span class="k">if</span> <span class="n">func_inst</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_publish_sockets</span><span class="p">:</span>
        <span class="c1"># not a publisher, just normal function</span>
        <span class="k">return</span> <span class="n">result</span>

    <span class="n">socket</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_publish_sockets</span><span class="p">[</span><span class="n">func_inst</span><span class="p">]</span>
    <span class="n">domain</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_domain_name</span>
    <span class="k">if</span> <span class="n">socket</span> <span class="ow">and</span> <span class="n">result</span><span class="p">:</span>
        <span class="c1"># publish messages</span>
        <span class="k">for</span> <span class="n">topic</span> <span class="ow">in</span> <span class="n">pub_topics</span><span class="p">:</span>
        <span class="c1"># for topic in result: # NOTE publish any returned value in dict with it's key as topic</span>
            <span class="k">if</span> <span class="n">topic</span> <span class="ow">in</span> <span class="n">result</span><span class="p">:</span>
                <span class="n">domain</span> <span class="o">=</span> <span class="n">domain</span> <span class="k">if</span> <span class="n">domain</span> <span class="k">else</span> <span class="n">domains</span><span class="p">[</span><span class="n">topic</span><span class="p">]</span>
                <span class="n">topic_domain_str</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="n">topic</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">domain</span><span class="si">}</span><span class="s2">"</span> <span class="k">if</span> <span class="n">domain</span> <span class="k">else</span> <span class="n">topic</span>
                <span class="k">if</span> <span class="n">topic</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_pub_topic_domains</span><span class="p">:</span>
                    <span class="n">topic_domain_str</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="n">topic</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_pub_topic_domains</span><span class="p">[</span><span class="n">topic</span><span class="p">]</span><span class="si">}</span><span class="s2">"</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_pub_topic_domains</span><span class="p">[</span><span class="n">topic</span><span class="p">]</span> <span class="k">else</span> <span class="n">topic</span>
                <span class="n">_send_msg</span><span class="p">(</span><span class="n">socket</span><span class="p">,</span> <span class="n">topic_domain_str</span><span class="p">,</span> <span class="n">result</span><span class="p">[</span><span class="n">topic</span><span class="p">])</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">debug_logger</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">debug_logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
                        <span class="sa">f</span><span class="s2">"- (DS): sent message from </span><span class="si">{</span><span class="n">func</span><span class="si">}</span><span class="s2"> to topic </span><span class="si">{</span><span class="n">topic_domain_str</span><span class="si">}</span><span class="s2">:</span><span class="se">\n</span><span class="s2">   </span><span class="si">{</span><span class="n">result</span><span class="p">[</span><span class="n">topic</span><span class="p">]</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">result</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="doc doc-object doc-module">
<h2 class="doc doc-heading" id="adviser.services.domain_tracker">
<code>domain_tracker</code>
<span class="doc doc-properties">
<small class="doc doc-property doc-property-special"><code>special</code></small>
</span>
<a class="headerlink" href="#adviser.services.domain_tracker" title="Permanent link"></a></h2>
<div class="doc doc-contents">
<div class="doc doc-children">
<div class="doc doc-object doc-module">
<h3 class="doc doc-heading" id="adviser.services.domain_tracker.domain_tracker">
<code>domain_tracker</code>
<a class="headerlink" href="#adviser.services.domain_tracker.domain_tracker" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>The console module provides ADVISER services for tracking current domain</p>
<div class="doc doc-children">
<div class="doc doc-object doc-class">
<h4 class="doc doc-heading" id="adviser.services.domain_tracker.domain_tracker.DomainTracker">
<code>DomainTracker</code>
<a class="headerlink" href="#adviser.services.domain_tracker.domain_tracker.DomainTracker" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>Responsible for selecting which domain should be active at a given time.
Current implmentation uses keywords to switch domains.</p>
<div class="doc doc-children">
<div class="doc doc-object doc-method">
<h5 class="doc doc-heading" id="adviser.services.domain_tracker.domain_tracker.DomainTracker.__init__">
<code class="highlight language-python">
__init__<span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">domains</span><span class="p">,</span> <span class="n">greet_on_first_turn</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span> </code>
<span class="doc doc-properties">
<small class="doc doc-property doc-property-special"><code>special</code></small>
</span>
<a class="headerlink" href="#adviser.services.domain_tracker.domain_tracker.DomainTracker.__init__" title="Permanent link"></a></h5>
<div class="doc doc-contents">
<details class="quote">
<summary>Source code in <code>adviser/services/domain_tracker/domain_tracker.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>34
35
36
37
38</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">domains</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Domain</span><span class="p">],</span> <span class="n">greet_on_first_turn</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">):</span>
    <span class="n">Service</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">domain</span><span class="o">=</span><span class="s2">""</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">domains</span> <span class="o">=</span> <span class="n">domains</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">current_domain</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">greet_on_first_turn</span> <span class="o">=</span> <span class="n">greet_on_first_turn</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h5 class="doc doc-heading" id="adviser.services.domain_tracker.domain_tracker.DomainTracker.dialog_start">
<code class="highlight language-python">
dialog_start<span class="p">(</span><span class="bp">self</span><span class="p">)</span> </code>
<a class="headerlink" href="#adviser.services.domain_tracker.domain_tracker.DomainTracker.dialog_start" title="Permanent link"></a></h5>
<div class="doc doc-contents">
<p>Resets the domain tracker for the start of a new dialog</p>
<details class="quote">
<summary>Source code in <code>adviser/services/domain_tracker/domain_tracker.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>40
41
42
43
44
45</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">dialog_start</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">"""</span>
<span class="sd">        Resets the domain tracker for the start of a new dialog</span>
<span class="sd">    """</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">turn</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">current_domain</span> <span class="o">=</span> <span class="kc">None</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h5 class="doc doc-heading" id="adviser.services.domain_tracker.domain_tracker.DomainTracker.domains_to_str">
<code class="highlight language-python">
domains_to_str<span class="p">(</span><span class="bp">self</span><span class="p">)</span> </code>
<a class="headerlink" href="#adviser.services.domain_tracker.domain_tracker.DomainTracker.domains_to_str" title="Permanent link"></a></h5>
<div class="doc doc-contents">
<p>Method to create the greeting on the first turn, grammatically joins the names of possible domains into
a string</p>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>(str)</code></td>
<td>
<p>String representing a list of all domain names the system can talk about</p>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>adviser/services/domain_tracker/domain_tracker.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span> 98
 99
100
101
102
103
104
105
106
107
108
109
110
111</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">domains_to_str</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">"""</span>
<span class="sd">        Method to create the greeting on the first turn, grammatically joins the names of possible domains into</span>
<span class="sd">        a string</span>

<span class="sd">        Returns:</span>
<span class="sd">            (str): String representing a list of all domain names the system can talk about</span>
<span class="sd">    """</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">domains</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">domains</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">get_display_name</span><span class="p">()</span>
    <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">domains</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
        <span class="k">return</span> <span class="s2">" and "</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">d</span><span class="o">.</span><span class="n">get_display_name</span><span class="p">()</span> <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">domains</span><span class="p">])</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="s2">", "</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">d</span><span class="o">.</span><span class="n">get_display_name</span><span class="p">()</span> <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">domains</span><span class="p">][:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span> <span class="o">+</span> <span class="sa">f</span><span class="s2">", and </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">domains</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">get_display_name</span><span class="p">()</span><span class="si">}</span><span class="s2">"</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h5 class="doc doc-heading" id="adviser.services.domain_tracker.domain_tracker.DomainTracker.select_domain">
<code class="highlight language-python">
select_domain<span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> </code>
<a class="headerlink" href="#adviser.services.domain_tracker.domain_tracker.DomainTracker.select_domain" title="Permanent link"></a></h5>
<div class="doc doc-contents">
<details class="quote">
<summary>Source code in <code>adviser/services/domain_tracker/domain_tracker.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>551
552
553
554
555
556
557
558
559
560
561
562
563
564
565
566
567
568
569
570
571
572
573
574
575
576
577
578
579
580
581
582</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">delegate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="n">func_inst</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">func</span><span class="o">.</span><span class="vm">__name__</span><span class="p">)</span>

    <span class="n">callargs</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">args</span><span class="p">)</span>
    <span class="k">if</span> <span class="bp">self</span> <span class="ow">in</span> <span class="n">callargs</span><span class="p">:</span>    <span class="c1"># remove self when in *args, because already known to function</span>
        <span class="n">callargs</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">func</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">callargs</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">result</span><span class="p">:</span>
        <span class="c1"># fix! (user could have multiple "/" characters in topic - only use last one )</span>
        <span class="n">domains</span> <span class="o">=</span> <span class="p">{</span><span class="n">res</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">"/"</span><span class="p">)[</span><span class="mi">0</span><span class="p">]:</span> <span class="n">res</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">"/"</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span> <span class="k">if</span> <span class="s2">"/"</span> <span class="ow">in</span> <span class="n">res</span> <span class="k">else</span> <span class="s2">""</span> <span class="k">for</span> <span class="n">res</span> <span class="ow">in</span> <span class="n">result</span><span class="p">}</span>
        <span class="n">result</span> <span class="o">=</span> <span class="p">{</span><span class="n">key</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">"/"</span><span class="p">)[</span><span class="mi">0</span><span class="p">]:</span> <span class="n">result</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">result</span><span class="p">}</span>

    <span class="k">if</span> <span class="n">func_inst</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_publish_sockets</span><span class="p">:</span>
        <span class="c1"># not a publisher, just normal function</span>
        <span class="k">return</span> <span class="n">result</span>

    <span class="n">socket</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_publish_sockets</span><span class="p">[</span><span class="n">func_inst</span><span class="p">]</span>
    <span class="n">domain</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_domain_name</span>
    <span class="k">if</span> <span class="n">socket</span> <span class="ow">and</span> <span class="n">result</span><span class="p">:</span>
        <span class="c1"># publish messages</span>
        <span class="k">for</span> <span class="n">topic</span> <span class="ow">in</span> <span class="n">pub_topics</span><span class="p">:</span>
        <span class="c1"># for topic in result: # NOTE publish any returned value in dict with it's key as topic</span>
            <span class="k">if</span> <span class="n">topic</span> <span class="ow">in</span> <span class="n">result</span><span class="p">:</span>
                <span class="n">domain</span> <span class="o">=</span> <span class="n">domain</span> <span class="k">if</span> <span class="n">domain</span> <span class="k">else</span> <span class="n">domains</span><span class="p">[</span><span class="n">topic</span><span class="p">]</span>
                <span class="n">topic_domain_str</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="n">topic</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">domain</span><span class="si">}</span><span class="s2">"</span> <span class="k">if</span> <span class="n">domain</span> <span class="k">else</span> <span class="n">topic</span>
                <span class="k">if</span> <span class="n">topic</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_pub_topic_domains</span><span class="p">:</span>
                    <span class="n">topic_domain_str</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="n">topic</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_pub_topic_domains</span><span class="p">[</span><span class="n">topic</span><span class="p">]</span><span class="si">}</span><span class="s2">"</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_pub_topic_domains</span><span class="p">[</span><span class="n">topic</span><span class="p">]</span> <span class="k">else</span> <span class="n">topic</span>
                <span class="n">_send_msg</span><span class="p">(</span><span class="n">socket</span><span class="p">,</span> <span class="n">topic_domain_str</span><span class="p">,</span> <span class="n">result</span><span class="p">[</span><span class="n">topic</span><span class="p">])</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">debug_logger</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">debug_logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
                        <span class="sa">f</span><span class="s2">"- (DS): sent message from </span><span class="si">{</span><span class="n">func</span><span class="si">}</span><span class="s2"> to topic </span><span class="si">{</span><span class="n">topic_domain_str</span><span class="si">}</span><span class="s2">:</span><span class="se">\n</span><span class="s2">   </span><span class="si">{</span><span class="n">result</span><span class="p">[</span><span class="n">topic</span><span class="p">]</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">result</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="doc doc-object doc-module">
<h2 class="doc doc-heading" id="adviser.services.emotion">
<code>emotion</code>
<span class="doc doc-properties">
<small class="doc doc-property doc-property-special"><code>special</code></small>
</span>
<a class="headerlink" href="#adviser.services.emotion" title="Permanent link"></a></h2>
<div class="doc doc-contents">
<div class="doc doc-children">
<div class="doc doc-object doc-module">
<h3 class="doc doc-heading" id="adviser.services.emotion.EmotionRecognition">
<code>EmotionRecognition</code>
<a class="headerlink" href="#adviser.services.emotion.EmotionRecognition" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>Emotion recognition module.</p>
<div class="doc doc-children">
<div class="doc doc-object doc-class">
<h4 class="doc doc-heading" id="adviser.services.emotion.EmotionRecognition.EmotionRecognition">
<code>EmotionRecognition</code>
<a class="headerlink" href="#adviser.services.emotion.EmotionRecognition.EmotionRecognition" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>Emotion recognition module.</p>
<div class="codehilite">
<pre><span></span><code><span class="err">This module receives acoustic features, loads pretrained models and outputs</span>
<span class="err">predictions of emotional states. It can easily be extended/adapted to use</span>
<span class="err">different models and facial features in addition.</span>
</code></pre>
</div>
<div class="doc doc-children">
<div class="doc doc-object doc-method">
<h5 class="doc doc-heading" id="adviser.services.emotion.EmotionRecognition.EmotionRecognition.__init__">
<code class="highlight language-python">
__init__<span class="p">(</span><span class="bp">self</span><span class="p">)</span> </code>
<span class="doc doc-properties">
<small class="doc doc-property doc-property-special"><code>special</code></small>
</span>
<a class="headerlink" href="#adviser.services.emotion.EmotionRecognition.EmotionRecognition.__init__" title="Permanent link"></a></h5>
<div class="doc doc-contents">
<p>Emotion recognition module.</p>
<p>On initialization all necessary models are loaded.</p>
<details class="quote">
<summary>Source code in <code>adviser/services/emotion/EmotionRecognition.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">""" Emotion recognition module.</span>

<span class="sd">    On initialization all necessary models are loaded.</span>
<span class="sd">    """</span>
    <span class="n">Service</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">emotion_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="vm">__file__</span><span class="p">))</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">model_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span>
        <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">emotion_dir</span><span class="p">,</span> <span class="s2">".."</span><span class="p">,</span> <span class="s2">".."</span><span class="p">,</span> <span class="s2">"resources"</span><span class="p">,</span> <span class="s2">"models"</span><span class="p">,</span> <span class="s2">"emotion"</span>
        <span class="p">)</span>
    <span class="p">)</span>

    <span class="k">def</span> <span class="nf">load_args</span><span class="p">(</span><span class="n">emo_representation</span><span class="p">):</span>
        <span class="n">arg_dict</span> <span class="o">=</span> <span class="n">pickle</span><span class="o">.</span><span class="n">load</span><span class="p">(</span>
            <span class="nb">open</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">model_path</span><span class="p">,</span> <span class="sa">f</span><span class="s1">'</span><span class="si">{</span><span class="n">emo_representation</span><span class="si">}</span><span class="s1">_args.pkl'</span><span class="p">),</span>
                 <span class="s1">'rb'</span><span class="p">)</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="n">arg_dict</span>

    <span class="k">def</span> <span class="nf">load_model</span><span class="p">(</span><span class="n">emo_representation</span><span class="p">,</span> <span class="n">arg_dict</span><span class="p">):</span>
        <span class="n">ARGS</span> <span class="o">=</span> <span class="n">arg_dict</span><span class="p">[</span><span class="s1">'args'</span><span class="p">]</span>
        <span class="n">model</span> <span class="o">=</span> <span class="n">cnn</span><span class="p">(</span>
            <span class="n">kernel_size</span><span class="o">=</span><span class="p">(</span><span class="n">ARGS</span><span class="o">.</span><span class="n">height</span><span class="p">,</span> <span class="n">arg_dict</span><span class="p">[</span><span class="s1">'D_in'</span><span class="p">]),</span>
            <span class="n">D_out</span><span class="o">=</span><span class="n">arg_dict</span><span class="p">[</span><span class="s1">'D_out'</span><span class="p">],</span>
            <span class="n">args</span><span class="o">=</span><span class="n">ARGS</span>
        <span class="p">)</span>
        <span class="n">model</span><span class="o">.</span><span class="n">load_state_dict</span><span class="p">(</span>
            <span class="n">torch</span><span class="o">.</span><span class="n">load</span><span class="p">(</span>
                <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model_path</span><span class="p">,</span>
                             <span class="sa">f</span><span class="s1">'</span><span class="si">{</span><span class="n">emo_representation</span><span class="si">}</span><span class="s1">_model_params.pt'</span><span class="p">),</span>
                <span class="n">map_location</span><span class="o">=</span><span class="n">torch</span><span class="o">.</span><span class="n">device</span><span class="p">(</span><span class="s1">'cpu'</span><span class="p">)</span>
            <span class="p">)</span>
        <span class="p">)</span>
        <span class="n">model</span><span class="o">.</span><span class="n">eval</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">model</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">emo_representations</span> <span class="o">=</span> <span class="p">[</span><span class="s1">'category'</span><span class="p">,</span> <span class="s1">'arousal'</span><span class="p">,</span> <span class="s1">'valence'</span><span class="p">]</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">models</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">args</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">emo_representation</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">emo_representations</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="n">emo_representation</span><span class="p">]</span> <span class="o">=</span> <span class="n">load_args</span><span class="p">(</span><span class="n">emo_representation</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">models</span><span class="p">[</span><span class="n">emo_representation</span><span class="p">]</span> <span class="o">=</span> <span class="n">load_model</span><span class="p">(</span>
            <span class="n">emo_representation</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="n">emo_representation</span><span class="p">]</span>
        <span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">arousal_mapping</span> <span class="o">=</span> <span class="p">{</span><span class="mi">0</span><span class="p">:</span> <span class="s1">'low'</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span> <span class="s1">'medium'</span><span class="p">,</span> <span class="mi">2</span><span class="p">:</span> <span class="s1">'high'</span><span class="p">}</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">valence_mapping</span> <span class="o">=</span> <span class="p">{</span><span class="mi">0</span><span class="p">:</span> <span class="s1">'negative'</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span> <span class="s1">'neutral'</span><span class="p">,</span> <span class="mi">2</span><span class="p">:</span> <span class="s1">'positive'</span><span class="p">}</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">category_mapping</span> <span class="o">=</span> <span class="p">{</span>
        <span class="mi">0</span><span class="p">:</span> <span class="n">EmotionType</span><span class="o">.</span><span class="n">Angry</span><span class="p">,</span>
        <span class="mi">1</span><span class="p">:</span> <span class="n">EmotionType</span><span class="o">.</span><span class="n">Happy</span><span class="p">,</span>
        <span class="mi">2</span><span class="p">:</span> <span class="n">EmotionType</span><span class="o">.</span><span class="n">Neutral</span><span class="p">,</span>
        <span class="mi">3</span><span class="p">:</span> <span class="n">EmotionType</span><span class="o">.</span><span class="n">Sad</span>
    <span class="p">}</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h5 class="doc doc-heading" id="adviser.services.emotion.EmotionRecognition.EmotionRecognition.predict_from_audio">
<code class="highlight language-python">
predict_from_audio<span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> </code>
<a class="headerlink" href="#adviser.services.emotion.EmotionRecognition.EmotionRecognition.predict_from_audio" title="Permanent link"></a></h5>
<div class="doc doc-contents">
<details class="quote">
<summary>Source code in <code>adviser/services/emotion/EmotionRecognition.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>551
552
553
554
555
556
557
558
559
560
561
562
563
564
565
566
567
568
569
570
571
572
573
574
575
576
577
578
579
580
581
582</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">delegate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="n">func_inst</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">func</span><span class="o">.</span><span class="vm">__name__</span><span class="p">)</span>

    <span class="n">callargs</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">args</span><span class="p">)</span>
    <span class="k">if</span> <span class="bp">self</span> <span class="ow">in</span> <span class="n">callargs</span><span class="p">:</span>    <span class="c1"># remove self when in *args, because already known to function</span>
        <span class="n">callargs</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">func</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">callargs</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">result</span><span class="p">:</span>
        <span class="c1"># fix! (user could have multiple "/" characters in topic - only use last one )</span>
        <span class="n">domains</span> <span class="o">=</span> <span class="p">{</span><span class="n">res</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">"/"</span><span class="p">)[</span><span class="mi">0</span><span class="p">]:</span> <span class="n">res</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">"/"</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span> <span class="k">if</span> <span class="s2">"/"</span> <span class="ow">in</span> <span class="n">res</span> <span class="k">else</span> <span class="s2">""</span> <span class="k">for</span> <span class="n">res</span> <span class="ow">in</span> <span class="n">result</span><span class="p">}</span>
        <span class="n">result</span> <span class="o">=</span> <span class="p">{</span><span class="n">key</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">"/"</span><span class="p">)[</span><span class="mi">0</span><span class="p">]:</span> <span class="n">result</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">result</span><span class="p">}</span>

    <span class="k">if</span> <span class="n">func_inst</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_publish_sockets</span><span class="p">:</span>
        <span class="c1"># not a publisher, just normal function</span>
        <span class="k">return</span> <span class="n">result</span>

    <span class="n">socket</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_publish_sockets</span><span class="p">[</span><span class="n">func_inst</span><span class="p">]</span>
    <span class="n">domain</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_domain_name</span>
    <span class="k">if</span> <span class="n">socket</span> <span class="ow">and</span> <span class="n">result</span><span class="p">:</span>
        <span class="c1"># publish messages</span>
        <span class="k">for</span> <span class="n">topic</span> <span class="ow">in</span> <span class="n">pub_topics</span><span class="p">:</span>
        <span class="c1"># for topic in result: # NOTE publish any returned value in dict with it's key as topic</span>
            <span class="k">if</span> <span class="n">topic</span> <span class="ow">in</span> <span class="n">result</span><span class="p">:</span>
                <span class="n">domain</span> <span class="o">=</span> <span class="n">domain</span> <span class="k">if</span> <span class="n">domain</span> <span class="k">else</span> <span class="n">domains</span><span class="p">[</span><span class="n">topic</span><span class="p">]</span>
                <span class="n">topic_domain_str</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="n">topic</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">domain</span><span class="si">}</span><span class="s2">"</span> <span class="k">if</span> <span class="n">domain</span> <span class="k">else</span> <span class="n">topic</span>
                <span class="k">if</span> <span class="n">topic</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_pub_topic_domains</span><span class="p">:</span>
                    <span class="n">topic_domain_str</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="n">topic</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_pub_topic_domains</span><span class="p">[</span><span class="n">topic</span><span class="p">]</span><span class="si">}</span><span class="s2">"</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_pub_topic_domains</span><span class="p">[</span><span class="n">topic</span><span class="p">]</span> <span class="k">else</span> <span class="n">topic</span>
                <span class="n">_send_msg</span><span class="p">(</span><span class="n">socket</span><span class="p">,</span> <span class="n">topic_domain_str</span><span class="p">,</span> <span class="n">result</span><span class="p">[</span><span class="n">topic</span><span class="p">])</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">debug_logger</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">debug_logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
                        <span class="sa">f</span><span class="s2">"- (DS): sent message from </span><span class="si">{</span><span class="n">func</span><span class="si">}</span><span class="s2"> to topic </span><span class="si">{</span><span class="n">topic_domain_str</span><span class="si">}</span><span class="s2">:</span><span class="se">\n</span><span class="s2">   </span><span class="si">{</span><span class="n">result</span><span class="p">[</span><span class="n">topic</span><span class="p">]</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">result</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="doc doc-object doc-module">
<h2 class="doc doc-heading" id="adviser.services.engagement">
<code>engagement</code>
<span class="doc doc-properties">
<small class="doc doc-property doc-property-special"><code>special</code></small>
</span>
<a class="headerlink" href="#adviser.services.engagement" title="Permanent link"></a></h2>
<div class="doc doc-contents">
<div class="doc doc-children">
<div class="doc doc-object doc-module">
<h3 class="doc doc-heading" id="adviser.services.engagement.engagement_tracker">
<code>engagement_tracker</code>
<a class="headerlink" href="#adviser.services.engagement.engagement_tracker" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<div class="doc doc-children">
<div class="doc doc-object doc-class">
<h4 class="doc doc-heading" id="adviser.services.engagement.engagement_tracker.EngagementTracker">
<code>EngagementTracker</code>
<a class="headerlink" href="#adviser.services.engagement.engagement_tracker.EngagementTracker" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>Start feature extraction with OpenFace.
Requires OpenFace to be installed - instructions can be found in tool/openface.txt</p>
<div class="doc doc-children">
<div class="doc doc-object doc-method">
<h5 class="doc doc-heading" id="adviser.services.engagement.engagement_tracker.EngagementTracker.__init__">
<code class="highlight language-python">
__init__<span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">domain</span><span class="o">=</span><span class="s1">''</span><span class="p">,</span> <span class="n">camera_id</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">openface_port</span><span class="o">=</span><span class="mi">6004</span><span class="p">,</span> <span class="n">delay</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">identifier</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span> </code>
<span class="doc doc-properties">
<small class="doc doc-property doc-property-special"><code>special</code></small>
</span>
<a class="headerlink" href="#adviser.services.engagement.engagement_tracker.EngagementTracker.__init__" title="Permanent link"></a></h5>
<div class="doc doc-contents">
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>camera_id</code></td>
<td><code>int</code></td>
<td>
<p>index of the camera you want to use (if you only have one camera: 0)</p>
</td>
<td><code>0</code></td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>adviser/services/engagement/engagement_tracker.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">domain</span><span class="o">=</span><span class="s2">""</span><span class="p">,</span> <span class="n">camera_id</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">openface_port</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">6004</span><span class="p">,</span> <span class="n">delay</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span> <span class="n">identifier</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">"""</span>
<span class="sd">    Args:</span>
<span class="sd">        camera_id: index of the camera you want to use (if you only have one camera: 0)</span>
<span class="sd">    """</span>
    <span class="n">Service</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">domain</span><span class="o">=</span><span class="s2">""</span><span class="p">,</span> <span class="n">identifier</span><span class="o">=</span><span class="n">identifier</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">camera_id</span> <span class="o">=</span> <span class="n">camera_id</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">openface_port</span> <span class="o">=</span> <span class="n">openface_port</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">openface_running</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">threshold</span> <span class="o">=</span> <span class="n">delay</span>   <span class="c1"># provide number of seconds as parameter, one second = 15 frames</span>

    <span class="n">ctx</span> <span class="o">=</span> <span class="n">Context</span><span class="o">.</span><span class="n">instance</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">openface_endpoint</span> <span class="o">=</span> <span class="n">ctx</span><span class="o">.</span><span class="n">socket</span><span class="p">(</span><span class="n">zmq</span><span class="o">.</span><span class="n">PAIR</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">openface_endpoint</span><span class="o">.</span><span class="n">bind</span><span class="p">(</span><span class="sa">f</span><span class="s2">"tcp://127.0.0.1:</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">openface_port</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>

    <span class="n">startExtraction</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">get_root_dir</span><span class="p">(),</span> <span class="s1">'tools/OpenFace/build/bin/FaceLandmarkVidZMQ'</span><span class="p">)</span><span class="si">}</span><span class="s2"> -device </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">camera_id</span><span class="si">}</span><span class="s2"> -port 6004"</span>    <span class="c1"># todo config open face port</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">p_openface</span> <span class="o">=</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">Popen</span><span class="p">(</span><span class="n">startExtraction</span><span class="o">.</span><span class="n">split</span><span class="p">(),</span> <span class="n">stdout</span><span class="o">=</span><span class="n">subprocess</span><span class="o">.</span><span class="n">PIPE</span><span class="p">)</span>	<span class="c1"># start OpenFace</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">extracting</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">extractor_thread</span> <span class="o">=</span> <span class="kc">None</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h5 class="doc doc-heading" id="adviser.services.engagement.engagement_tracker.EngagementTracker.dialog_end">
<code class="highlight language-python">
dialog_end<span class="p">(</span><span class="bp">self</span><span class="p">)</span> </code>
<a class="headerlink" href="#adviser.services.engagement.engagement_tracker.EngagementTracker.dialog_end" title="Permanent link"></a></h5>
<div class="doc doc-contents">
<p>This function is called after a dialog ended (Topics.DIALOG_END message was received).
You should overwrite this function to record dialog-level information. </p>
<details class="quote">
<summary>Source code in <code>adviser/services/engagement/engagement_tracker.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>145
146
147
148
149</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">dialog_end</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="c1"># Set openface to non-publishing mode and wait until it is ready</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">openface_endpoint</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="nb">bytes</span><span class="p">(</span><span class="sa">f</span><span class="s2">"OPENFACE_END"</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">"ascii"</span><span class="p">))</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">extractor_thread</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">extractor_thread</span><span class="o">.</span><span class="n">join</span><span class="p">()</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h5 class="doc doc-heading" id="adviser.services.engagement.engagement_tracker.EngagementTracker.dialog_exit">
<code class="highlight language-python">
dialog_exit<span class="p">(</span><span class="bp">self</span><span class="p">)</span> </code>
<a class="headerlink" href="#adviser.services.engagement.engagement_tracker.EngagementTracker.dialog_exit" title="Permanent link"></a></h5>
<div class="doc doc-contents">
<p>This function is called when the dialog system is shutting down.
You should overwrite this function to stop your threads and cleanup any open resources. </p>
<details class="quote">
<summary>Source code in <code>adviser/services/engagement/engagement_tracker.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>151
152
153</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">dialog_exit</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="c1"># close openface process</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">p_openface</span><span class="o">.</span><span class="n">kill</span><span class="p">()</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h5 class="doc doc-heading" id="adviser.services.engagement.engagement_tracker.EngagementTracker.dialog_start">
<code class="highlight language-python">
dialog_start<span class="p">(</span><span class="bp">self</span><span class="p">)</span> </code>
<a class="headerlink" href="#adviser.services.engagement.engagement_tracker.EngagementTracker.dialog_start" title="Permanent link"></a></h5>
<div class="doc doc-contents">
<p>This function is called before the first message to a new dialog is published.
You should overwrite this function to set/reset dialog-level variables. </p>
<details class="quote">
<summary>Source code in <code>adviser/services/engagement/engagement_tracker.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>69
70
71
72
73
74
75
76
77
78
79
80</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">dialog_start</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="c1"># Set openface to publishing mode and wait until it is ready</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">openface_endpoint</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="nb">bytes</span><span class="p">(</span><span class="sa">f</span><span class="s2">"OPENFACE_START"</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">"ascii"</span><span class="p">))</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">extracting</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="k">while</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">extracting</span><span class="p">:</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">openface_endpoint</span><span class="o">.</span><span class="n">recv</span><span class="p">()</span>    <span class="c1"># receive started signal</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="n">msg</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s2">"utf-8"</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">msg</span> <span class="o">==</span> <span class="s2">"OPENFACE_STARTED"</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">"START EXTRACTION"</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">extracting</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">extractor_thread</span> <span class="o">=</span> <span class="n">Thread</span><span class="p">(</span><span class="n">target</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">publish_gaze_directions</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">extractor_thread</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h5 class="doc doc-heading" id="adviser.services.engagement.engagement_tracker.EngagementTracker.publish_gaze_directions">
<code class="highlight language-python">
publish_gaze_directions<span class="p">(</span><span class="bp">self</span><span class="p">)</span> </code>
<a class="headerlink" href="#adviser.services.engagement.engagement_tracker.EngagementTracker.publish_gaze_directions" title="Permanent link"></a></h5>
<div class="doc doc-contents">
<p>Meant to be used in a thread.
Runs an inifinte loop polling features from OpenFace library, parsing them and extracting engagement features.
Calls <code>yield_gaze_direction</code> to publish the polled and processed engagement features.</p>
<details class="quote">
<summary>Source code in <code>adviser/services/engagement/engagement_tracker.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span> 96
 97
 98
 99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">publish_gaze_directions</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">"""</span>
<span class="sd">    Meant to be used in a thread.</span>
<span class="sd">    Runs an inifinte loop polling features from OpenFace library, parsing them and extracting engagement features.</span>
<span class="sd">    Calls `yield_gaze_direction` to publish the polled and processed engagement features.</span>
<span class="sd">    """</span>

    <span class="n">x_coordinates</span><span class="o">=</span><span class="p">[]</span>
    <span class="n">y_coordinates</span><span class="o">=</span><span class="p">[]</span>

    <span class="n">norm</span> <span class="o">=</span> <span class="mf">0.0</span>			<span class="c1"># center point of screen; should be close(r) to 0</span>
    <span class="n">looking</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="k">while</span> <span class="bp">self</span><span class="o">.</span><span class="n">extracting</span><span class="p">:</span>
        <span class="n">req</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">openface_endpoint</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="nb">bytes</span><span class="p">(</span><span class="sa">f</span><span class="s2">"OPENFACE_PULL"</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">"ascii"</span><span class="p">))</span>
        <span class="n">msg</span> <span class="o">=</span>  <span class="bp">self</span><span class="o">.</span><span class="n">openface_endpoint</span><span class="o">.</span><span class="n">recv</span><span class="p">()</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="n">msg</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s2">"utf-8"</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">msg</span> <span class="o">==</span> <span class="s2">"OPENFACE_ENDED"</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">extracting</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="n">msg_data</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>

            <span class="n">gaze_x</span> <span class="o">=</span> <span class="n">msg_data</span><span class="p">[</span><span class="s2">"gaze"</span><span class="p">][</span><span class="s2">"angle"</span><span class="p">][</span><span class="s2">"x"</span><span class="p">]</span>
            <span class="n">gaze_y</span> <span class="o">=</span> <span class="n">msg_data</span><span class="p">[</span><span class="s2">"gaze"</span><span class="p">][</span><span class="s2">"angle"</span><span class="p">][</span><span class="s2">"y"</span><span class="p">]</span>

            <span class="n">gaze_x</span> <span class="o">=</span> <span class="n">sqrt</span><span class="p">(</span><span class="n">gaze_x</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>				<span class="c1"># gaze_angle_x (left-right movement), square + root is done to yield only positive values</span>
            <span class="n">gaze_y</span> <span class="o">=</span> <span class="n">sqrt</span><span class="p">(</span><span class="n">gaze_y</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>				<span class="c1"># gaze_angle_y (up-down movement) </span>
            <span class="n">x_coordinates</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">gaze_x</span><span class="p">)</span>
            <span class="n">y_coordinates</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">gaze_y</span><span class="p">)</span>
            <span class="n">current</span> <span class="o">=</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">x_coordinates</span><span class="p">))</span><span class="o">-</span><span class="mi">1</span>
            <span class="k">if</span> <span class="n">current</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">threshold</span><span class="p">:</span>
                <span class="n">previous_x</span> <span class="o">=</span> <span class="n">mean</span><span class="p">(</span><span class="n">x_coordinates</span><span class="p">[</span><span class="n">current</span><span class="o">-</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">threshold</span><span class="o">+</span><span class="mi">1</span><span class="p">):</span><span class="n">current</span><span class="p">])</span>		<span class="c1"># obtain the average of previous frames</span>
                <span class="n">previous_y</span> <span class="o">=</span> <span class="n">mean</span><span class="p">(</span><span class="n">y_coordinates</span><span class="p">[</span><span class="n">current</span><span class="o">-</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">threshold</span><span class="o">+</span><span class="mi">1</span><span class="p">):</span><span class="n">current</span><span class="p">])</span>
                <span class="n">difference_x</span> <span class="o">=</span> <span class="n">sqrt</span><span class="p">((</span><span class="n">norm</span> <span class="o">-</span> <span class="n">previous_x</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>					<span class="c1"># compare current frame to average of previous frames</span>
                <span class="n">difference_y</span> <span class="o">=</span> <span class="n">sqrt</span><span class="p">((</span><span class="n">norm</span> <span class="o">-</span> <span class="n">previous_y</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
                <span class="c1"># print(difference_x, difference_y)</span>
                <span class="k">if</span> <span class="n">difference_x</span> <span class="o">&lt;</span> <span class="mf">0.15</span> <span class="ow">and</span> <span class="n">difference_y</span> <span class="o">&lt;</span> <span class="mf">0.15</span><span class="p">:</span>				<span class="c1"># check whether difference between current and previous frames exceeds certain threshold (regulates tolerance/strictness)</span>
                    <span class="k">if</span> <span class="n">looking</span> <span class="o">!=</span> <span class="kc">True</span><span class="p">:</span>
                        <span class="n">looking</span> <span class="o">=</span> <span class="kc">True</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">yield_gaze_direction</span><span class="p">(</span><span class="n">engagement</span><span class="o">=</span><span class="n">EngagementType</span><span class="o">.</span><span class="n">High</span><span class="p">,</span> <span class="n">gaze_direction</span><span class="o">=</span><span class="p">(</span><span class="n">gaze_x</span><span class="p">,</span> <span class="n">gaze_y</span><span class="p">))</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">looking</span> <span class="o">!=</span> <span class="kc">False</span><span class="p">:</span>
                        <span class="n">looking</span> <span class="o">=</span> <span class="kc">False</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">yield_gaze_direction</span><span class="p">(</span><span class="n">engagement</span><span class="o">=</span><span class="n">EngagementType</span><span class="o">.</span><span class="n">Low</span><span class="p">,</span> <span class="n">gaze_direction</span><span class="o">=</span><span class="p">(</span><span class="n">gaze_x</span><span class="p">,</span> <span class="n">gaze_y</span><span class="p">))</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="c1"># import traceback</span>
            <span class="c1"># traceback.print_exc()</span>
            <span class="k">pass</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h5 class="doc doc-heading" id="adviser.services.engagement.engagement_tracker.EngagementTracker.yield_gaze_direction">
<code class="highlight language-python">
yield_gaze_direction<span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> </code>
<a class="headerlink" href="#adviser.services.engagement.engagement_tracker.EngagementTracker.yield_gaze_direction" title="Permanent link"></a></h5>
<div class="doc doc-contents">
<details class="quote">
<summary>Source code in <code>adviser/services/engagement/engagement_tracker.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>551
552
553
554
555
556
557
558
559
560
561
562
563
564
565
566
567
568
569
570
571
572
573
574
575
576
577
578
579
580
581
582</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">delegate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="n">func_inst</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">func</span><span class="o">.</span><span class="vm">__name__</span><span class="p">)</span>

    <span class="n">callargs</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">args</span><span class="p">)</span>
    <span class="k">if</span> <span class="bp">self</span> <span class="ow">in</span> <span class="n">callargs</span><span class="p">:</span>    <span class="c1"># remove self when in *args, because already known to function</span>
        <span class="n">callargs</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">func</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">callargs</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">result</span><span class="p">:</span>
        <span class="c1"># fix! (user could have multiple "/" characters in topic - only use last one )</span>
        <span class="n">domains</span> <span class="o">=</span> <span class="p">{</span><span class="n">res</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">"/"</span><span class="p">)[</span><span class="mi">0</span><span class="p">]:</span> <span class="n">res</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">"/"</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span> <span class="k">if</span> <span class="s2">"/"</span> <span class="ow">in</span> <span class="n">res</span> <span class="k">else</span> <span class="s2">""</span> <span class="k">for</span> <span class="n">res</span> <span class="ow">in</span> <span class="n">result</span><span class="p">}</span>
        <span class="n">result</span> <span class="o">=</span> <span class="p">{</span><span class="n">key</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">"/"</span><span class="p">)[</span><span class="mi">0</span><span class="p">]:</span> <span class="n">result</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">result</span><span class="p">}</span>

    <span class="k">if</span> <span class="n">func_inst</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_publish_sockets</span><span class="p">:</span>
        <span class="c1"># not a publisher, just normal function</span>
        <span class="k">return</span> <span class="n">result</span>

    <span class="n">socket</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_publish_sockets</span><span class="p">[</span><span class="n">func_inst</span><span class="p">]</span>
    <span class="n">domain</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_domain_name</span>
    <span class="k">if</span> <span class="n">socket</span> <span class="ow">and</span> <span class="n">result</span><span class="p">:</span>
        <span class="c1"># publish messages</span>
        <span class="k">for</span> <span class="n">topic</span> <span class="ow">in</span> <span class="n">pub_topics</span><span class="p">:</span>
        <span class="c1"># for topic in result: # NOTE publish any returned value in dict with it's key as topic</span>
            <span class="k">if</span> <span class="n">topic</span> <span class="ow">in</span> <span class="n">result</span><span class="p">:</span>
                <span class="n">domain</span> <span class="o">=</span> <span class="n">domain</span> <span class="k">if</span> <span class="n">domain</span> <span class="k">else</span> <span class="n">domains</span><span class="p">[</span><span class="n">topic</span><span class="p">]</span>
                <span class="n">topic_domain_str</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="n">topic</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">domain</span><span class="si">}</span><span class="s2">"</span> <span class="k">if</span> <span class="n">domain</span> <span class="k">else</span> <span class="n">topic</span>
                <span class="k">if</span> <span class="n">topic</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_pub_topic_domains</span><span class="p">:</span>
                    <span class="n">topic_domain_str</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="n">topic</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_pub_topic_domains</span><span class="p">[</span><span class="n">topic</span><span class="p">]</span><span class="si">}</span><span class="s2">"</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_pub_topic_domains</span><span class="p">[</span><span class="n">topic</span><span class="p">]</span> <span class="k">else</span> <span class="n">topic</span>
                <span class="n">_send_msg</span><span class="p">(</span><span class="n">socket</span><span class="p">,</span> <span class="n">topic_domain_str</span><span class="p">,</span> <span class="n">result</span><span class="p">[</span><span class="n">topic</span><span class="p">])</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">debug_logger</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">debug_logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
                        <span class="sa">f</span><span class="s2">"- (DS): sent message from </span><span class="si">{</span><span class="n">func</span><span class="si">}</span><span class="s2"> to topic </span><span class="si">{</span><span class="n">topic_domain_str</span><span class="si">}</span><span class="s2">:</span><span class="se">\n</span><span class="s2">   </span><span class="si">{</span><span class="n">result</span><span class="p">[</span><span class="n">topic</span><span class="p">]</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">result</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
</div>
</div>
</div>
<div class="doc doc-object doc-function">
<h4 class="doc doc-heading" id="adviser.services.engagement.engagement_tracker.get_root_dir">
<code class="highlight language-python">
get_root_dir<span class="p">()</span> </code>
<a class="headerlink" href="#adviser.services.engagement.engagement_tracker.get_root_dir" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<details class="quote">
<summary>Source code in <code>adviser/services/engagement/engagement_tracker.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>39
40</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">get_root_dir</span><span class="p">():</span>
    <span class="k">return</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="vm">__file__</span><span class="p">))))</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="doc doc-object doc-module">
<h2 class="doc doc-heading" id="adviser.services.hci">
<code>hci</code>
<span class="doc doc-properties">
<small class="doc doc-property doc-property-special"><code>special</code></small>
</span>
<a class="headerlink" href="#adviser.services.hci" title="Permanent link"></a></h2>
<div class="doc doc-contents">
<div class="doc doc-children">
<div class="doc doc-object doc-module">
<h3 class="doc doc-heading" id="adviser.services.hci.console">
<code>console</code>
<a class="headerlink" href="#adviser.services.hci.console" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>The console module provides ADVISER modules that access the console for input and output.</p>
<div class="doc doc-children">
<div class="doc doc-object doc-class">
<h4 class="doc doc-heading" id="adviser.services.hci.console.ConsoleInput">
<code>ConsoleInput</code>
<a class="headerlink" href="#adviser.services.hci.console.ConsoleInput" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>Gets the user utterance from the console.</p>
<p>Waits for the built-in input function to return a non-empty text.</p>
<div class="doc doc-children">
<div class="doc doc-object doc-method">
<h5 class="doc doc-heading" id="adviser.services.hci.console.ConsoleInput.__init__">
<code class="highlight language-python">
__init__<span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">domain</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">conversation_log_dir</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">language</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span> </code>
<span class="doc doc-properties">
<small class="doc doc-property doc-property-special"><code>special</code></small>
</span>
<a class="headerlink" href="#adviser.services.hci.console.ConsoleInput.__init__" title="Permanent link"></a></h5>
<div class="doc doc-contents">
<details class="quote">
<summary>Source code in <code>adviser/services/hci/console.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>40
41
42
43
44
45</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">domain</span><span class="p">:</span> <span class="n">Domain</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">conversation_log_dir</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">language</span><span class="p">:</span> <span class="n">Language</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
    <span class="n">Service</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">domain</span><span class="o">=</span><span class="n">domain</span><span class="p">)</span>
    <span class="c1"># self.language = language</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">language</span> <span class="o">=</span> <span class="n">Language</span><span class="o">.</span><span class="n">ENGLISH</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">conversation_log_dir</span> <span class="o">=</span> <span class="n">conversation_log_dir</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">interaction_count</span> <span class="o">=</span> <span class="mi">0</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h5 class="doc doc-heading" id="adviser.services.hci.console.ConsoleInput.dialog_start">
<code class="highlight language-python">
dialog_start<span class="p">(</span><span class="bp">self</span><span class="p">)</span> </code>
<a class="headerlink" href="#adviser.services.hci.console.ConsoleInput.dialog_start" title="Permanent link"></a></h5>
<div class="doc doc-contents">
<p>This function is called before the first message to a new dialog is published.
You should overwrite this function to set/reset dialog-level variables. </p>
<details class="quote">
<summary>Source code in <code>adviser/services/hci/console.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>49
50</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">dialog_start</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">interaction_count</span> <span class="o">=</span> <span class="mi">0</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h5 class="doc doc-heading" id="adviser.services.hci.console.ConsoleInput.get_user_input">
<code class="highlight language-python">
get_user_input<span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> </code>
<a class="headerlink" href="#adviser.services.hci.console.ConsoleInput.get_user_input" title="Permanent link"></a></h5>
<div class="doc doc-contents">
<details class="quote">
<summary>Source code in <code>adviser/services/hci/console.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>551
552
553
554
555
556
557
558
559
560
561
562
563
564
565
566
567
568
569
570
571
572
573
574
575
576
577
578
579
580
581
582</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">delegate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="n">func_inst</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">func</span><span class="o">.</span><span class="vm">__name__</span><span class="p">)</span>

    <span class="n">callargs</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">args</span><span class="p">)</span>
    <span class="k">if</span> <span class="bp">self</span> <span class="ow">in</span> <span class="n">callargs</span><span class="p">:</span>    <span class="c1"># remove self when in *args, because already known to function</span>
        <span class="n">callargs</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">func</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">callargs</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">result</span><span class="p">:</span>
        <span class="c1"># fix! (user could have multiple "/" characters in topic - only use last one )</span>
        <span class="n">domains</span> <span class="o">=</span> <span class="p">{</span><span class="n">res</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">"/"</span><span class="p">)[</span><span class="mi">0</span><span class="p">]:</span> <span class="n">res</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">"/"</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span> <span class="k">if</span> <span class="s2">"/"</span> <span class="ow">in</span> <span class="n">res</span> <span class="k">else</span> <span class="s2">""</span> <span class="k">for</span> <span class="n">res</span> <span class="ow">in</span> <span class="n">result</span><span class="p">}</span>
        <span class="n">result</span> <span class="o">=</span> <span class="p">{</span><span class="n">key</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">"/"</span><span class="p">)[</span><span class="mi">0</span><span class="p">]:</span> <span class="n">result</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">result</span><span class="p">}</span>

    <span class="k">if</span> <span class="n">func_inst</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_publish_sockets</span><span class="p">:</span>
        <span class="c1"># not a publisher, just normal function</span>
        <span class="k">return</span> <span class="n">result</span>

    <span class="n">socket</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_publish_sockets</span><span class="p">[</span><span class="n">func_inst</span><span class="p">]</span>
    <span class="n">domain</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_domain_name</span>
    <span class="k">if</span> <span class="n">socket</span> <span class="ow">and</span> <span class="n">result</span><span class="p">:</span>
        <span class="c1"># publish messages</span>
        <span class="k">for</span> <span class="n">topic</span> <span class="ow">in</span> <span class="n">pub_topics</span><span class="p">:</span>
        <span class="c1"># for topic in result: # NOTE publish any returned value in dict with it's key as topic</span>
            <span class="k">if</span> <span class="n">topic</span> <span class="ow">in</span> <span class="n">result</span><span class="p">:</span>
                <span class="n">domain</span> <span class="o">=</span> <span class="n">domain</span> <span class="k">if</span> <span class="n">domain</span> <span class="k">else</span> <span class="n">domains</span><span class="p">[</span><span class="n">topic</span><span class="p">]</span>
                <span class="n">topic_domain_str</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="n">topic</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">domain</span><span class="si">}</span><span class="s2">"</span> <span class="k">if</span> <span class="n">domain</span> <span class="k">else</span> <span class="n">topic</span>
                <span class="k">if</span> <span class="n">topic</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_pub_topic_domains</span><span class="p">:</span>
                    <span class="n">topic_domain_str</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="n">topic</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_pub_topic_domains</span><span class="p">[</span><span class="n">topic</span><span class="p">]</span><span class="si">}</span><span class="s2">"</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_pub_topic_domains</span><span class="p">[</span><span class="n">topic</span><span class="p">]</span> <span class="k">else</span> <span class="n">topic</span>
                <span class="n">_send_msg</span><span class="p">(</span><span class="n">socket</span><span class="p">,</span> <span class="n">topic_domain_str</span><span class="p">,</span> <span class="n">result</span><span class="p">[</span><span class="n">topic</span><span class="p">])</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">debug_logger</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">debug_logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
                        <span class="sa">f</span><span class="s2">"- (DS): sent message from </span><span class="si">{</span><span class="n">func</span><span class="si">}</span><span class="s2"> to topic </span><span class="si">{</span><span class="n">topic_domain_str</span><span class="si">}</span><span class="s2">:</span><span class="se">\n</span><span class="s2">   </span><span class="si">{</span><span class="n">result</span><span class="p">[</span><span class="n">topic</span><span class="p">]</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">result</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
</div>
</div>
</div>
<div class="doc doc-object doc-class">
<h4 class="doc doc-heading" id="adviser.services.hci.console.ConsoleOutput">
<code>ConsoleOutput</code>
<a class="headerlink" href="#adviser.services.hci.console.ConsoleOutput" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>Writes the system utterance to the console.</p>
<div class="doc doc-children">
<div class="doc doc-object doc-method">
<h5 class="doc doc-heading" id="adviser.services.hci.console.ConsoleOutput.__init__">
<code class="highlight language-python">
__init__<span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">domain</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span> </code>
<span class="doc doc-properties">
<small class="doc doc-property doc-property-special"><code>special</code></small>
</span>
<a class="headerlink" href="#adviser.services.hci.console.ConsoleOutput.__init__" title="Permanent link"></a></h5>
<div class="doc doc-contents">
<details class="quote">
<summary>Source code in <code>adviser/services/hci/console.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>113
114</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">domain</span><span class="p">:</span> <span class="n">Domain</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
    <span class="n">Service</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">domain</span><span class="o">=</span><span class="n">domain</span><span class="p">)</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h5 class="doc doc-heading" id="adviser.services.hci.console.ConsoleOutput.print_sys_utterance">
<code class="highlight language-python">
print_sys_utterance<span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> </code>
<a class="headerlink" href="#adviser.services.hci.console.ConsoleOutput.print_sys_utterance" title="Permanent link"></a></h5>
<div class="doc doc-contents">
<details class="quote">
<summary>Source code in <code>adviser/services/hci/console.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>551
552
553
554
555
556
557
558
559
560
561
562
563
564
565
566
567
568
569
570
571
572
573
574
575
576
577
578
579
580
581
582</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">delegate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="n">func_inst</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">func</span><span class="o">.</span><span class="vm">__name__</span><span class="p">)</span>

    <span class="n">callargs</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">args</span><span class="p">)</span>
    <span class="k">if</span> <span class="bp">self</span> <span class="ow">in</span> <span class="n">callargs</span><span class="p">:</span>    <span class="c1"># remove self when in *args, because already known to function</span>
        <span class="n">callargs</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">func</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">callargs</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">result</span><span class="p">:</span>
        <span class="c1"># fix! (user could have multiple "/" characters in topic - only use last one )</span>
        <span class="n">domains</span> <span class="o">=</span> <span class="p">{</span><span class="n">res</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">"/"</span><span class="p">)[</span><span class="mi">0</span><span class="p">]:</span> <span class="n">res</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">"/"</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span> <span class="k">if</span> <span class="s2">"/"</span> <span class="ow">in</span> <span class="n">res</span> <span class="k">else</span> <span class="s2">""</span> <span class="k">for</span> <span class="n">res</span> <span class="ow">in</span> <span class="n">result</span><span class="p">}</span>
        <span class="n">result</span> <span class="o">=</span> <span class="p">{</span><span class="n">key</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">"/"</span><span class="p">)[</span><span class="mi">0</span><span class="p">]:</span> <span class="n">result</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">result</span><span class="p">}</span>

    <span class="k">if</span> <span class="n">func_inst</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_publish_sockets</span><span class="p">:</span>
        <span class="c1"># not a publisher, just normal function</span>
        <span class="k">return</span> <span class="n">result</span>

    <span class="n">socket</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_publish_sockets</span><span class="p">[</span><span class="n">func_inst</span><span class="p">]</span>
    <span class="n">domain</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_domain_name</span>
    <span class="k">if</span> <span class="n">socket</span> <span class="ow">and</span> <span class="n">result</span><span class="p">:</span>
        <span class="c1"># publish messages</span>
        <span class="k">for</span> <span class="n">topic</span> <span class="ow">in</span> <span class="n">pub_topics</span><span class="p">:</span>
        <span class="c1"># for topic in result: # NOTE publish any returned value in dict with it's key as topic</span>
            <span class="k">if</span> <span class="n">topic</span> <span class="ow">in</span> <span class="n">result</span><span class="p">:</span>
                <span class="n">domain</span> <span class="o">=</span> <span class="n">domain</span> <span class="k">if</span> <span class="n">domain</span> <span class="k">else</span> <span class="n">domains</span><span class="p">[</span><span class="n">topic</span><span class="p">]</span>
                <span class="n">topic_domain_str</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="n">topic</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">domain</span><span class="si">}</span><span class="s2">"</span> <span class="k">if</span> <span class="n">domain</span> <span class="k">else</span> <span class="n">topic</span>
                <span class="k">if</span> <span class="n">topic</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_pub_topic_domains</span><span class="p">:</span>
                    <span class="n">topic_domain_str</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="n">topic</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_pub_topic_domains</span><span class="p">[</span><span class="n">topic</span><span class="p">]</span><span class="si">}</span><span class="s2">"</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_pub_topic_domains</span><span class="p">[</span><span class="n">topic</span><span class="p">]</span> <span class="k">else</span> <span class="n">topic</span>
                <span class="n">_send_msg</span><span class="p">(</span><span class="n">socket</span><span class="p">,</span> <span class="n">topic_domain_str</span><span class="p">,</span> <span class="n">result</span><span class="p">[</span><span class="n">topic</span><span class="p">])</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">debug_logger</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">debug_logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
                        <span class="sa">f</span><span class="s2">"- (DS): sent message from </span><span class="si">{</span><span class="n">func</span><span class="si">}</span><span class="s2"> to topic </span><span class="si">{</span><span class="n">topic_domain_str</span><span class="si">}</span><span class="s2">:</span><span class="se">\n</span><span class="s2">   </span><span class="si">{</span><span class="n">result</span><span class="p">[</span><span class="n">topic</span><span class="p">]</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">result</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="doc doc-object doc-module">
<h3 class="doc doc-heading" id="adviser.services.hci.gui">
<code>gui</code>
<a class="headerlink" href="#adviser.services.hci.gui" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<div class="doc doc-children">
<div class="doc doc-object doc-class">
<h4 class="doc doc-heading" id="adviser.services.hci.gui.GUIServer">
<code>GUIServer</code>
<a class="headerlink" href="#adviser.services.hci.gui.GUIServer" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>Service for the React-based Web-UI.
Run this as a remote service:
    * run this file seperately, will start the GUI Server
    * run the dialog system in another python instance, add a RemoteService with identifier <code>GUIServer</code></p>
<div class="doc doc-children">
<div class="doc doc-object doc-method">
<h5 class="doc doc-heading" id="adviser.services.hci.gui.GUIServer.__init__">
<code class="highlight language-python">
__init__<span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">socketio</span><span class="p">,</span> <span class="n">identifier</span><span class="o">=</span><span class="s1">'GUIServer'</span><span class="p">,</span> <span class="n">logger</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span> </code>
<span class="doc doc-properties">
<small class="doc doc-property doc-property-special"><code>special</code></small>
</span>
<a class="headerlink" href="#adviser.services.hci.gui.GUIServer.__init__" title="Permanent link"></a></h5>
<div class="doc doc-contents">
<details class="quote">
<summary>Source code in <code>adviser/services/hci/gui.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>62
63
64
65</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">socketio</span><span class="p">,</span> <span class="n">identifier</span><span class="o">=</span><span class="s2">"GUIServer"</span><span class="p">,</span> <span class="n">logger</span><span class="p">:</span> <span class="n">DiasysLogger</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
    <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">domain</span><span class="o">=</span><span class="s1">''</span><span class="p">,</span> <span class="n">identifier</span><span class="o">=</span><span class="n">identifier</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">socketio</span> <span class="o">=</span> <span class="n">socketio</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">logger</span> <span class="o">=</span> <span class="n">logger</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h5 class="doc doc-heading" id="adviser.services.hci.gui.GUIServer.forward_emotion_message_to_react">
<code class="highlight language-python">
forward_emotion_message_to_react<span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> </code>
<a class="headerlink" href="#adviser.services.hci.gui.GUIServer.forward_emotion_message_to_react" title="Permanent link"></a></h5>
<div class="doc doc-contents">
<details class="quote">
<summary>Source code in <code>adviser/services/hci/gui.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>551
552
553
554
555
556
557
558
559
560
561
562
563
564
565
566
567
568
569
570
571
572
573
574
575
576
577
578
579
580
581
582</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">delegate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="n">func_inst</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">func</span><span class="o">.</span><span class="vm">__name__</span><span class="p">)</span>

    <span class="n">callargs</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">args</span><span class="p">)</span>
    <span class="k">if</span> <span class="bp">self</span> <span class="ow">in</span> <span class="n">callargs</span><span class="p">:</span>    <span class="c1"># remove self when in *args, because already known to function</span>
        <span class="n">callargs</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">func</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">callargs</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">result</span><span class="p">:</span>
        <span class="c1"># fix! (user could have multiple "/" characters in topic - only use last one )</span>
        <span class="n">domains</span> <span class="o">=</span> <span class="p">{</span><span class="n">res</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">"/"</span><span class="p">)[</span><span class="mi">0</span><span class="p">]:</span> <span class="n">res</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">"/"</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span> <span class="k">if</span> <span class="s2">"/"</span> <span class="ow">in</span> <span class="n">res</span> <span class="k">else</span> <span class="s2">""</span> <span class="k">for</span> <span class="n">res</span> <span class="ow">in</span> <span class="n">result</span><span class="p">}</span>
        <span class="n">result</span> <span class="o">=</span> <span class="p">{</span><span class="n">key</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">"/"</span><span class="p">)[</span><span class="mi">0</span><span class="p">]:</span> <span class="n">result</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">result</span><span class="p">}</span>

    <span class="k">if</span> <span class="n">func_inst</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_publish_sockets</span><span class="p">:</span>
        <span class="c1"># not a publisher, just normal function</span>
        <span class="k">return</span> <span class="n">result</span>

    <span class="n">socket</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_publish_sockets</span><span class="p">[</span><span class="n">func_inst</span><span class="p">]</span>
    <span class="n">domain</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_domain_name</span>
    <span class="k">if</span> <span class="n">socket</span> <span class="ow">and</span> <span class="n">result</span><span class="p">:</span>
        <span class="c1"># publish messages</span>
        <span class="k">for</span> <span class="n">topic</span> <span class="ow">in</span> <span class="n">pub_topics</span><span class="p">:</span>
        <span class="c1"># for topic in result: # NOTE publish any returned value in dict with it's key as topic</span>
            <span class="k">if</span> <span class="n">topic</span> <span class="ow">in</span> <span class="n">result</span><span class="p">:</span>
                <span class="n">domain</span> <span class="o">=</span> <span class="n">domain</span> <span class="k">if</span> <span class="n">domain</span> <span class="k">else</span> <span class="n">domains</span><span class="p">[</span><span class="n">topic</span><span class="p">]</span>
                <span class="n">topic_domain_str</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="n">topic</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">domain</span><span class="si">}</span><span class="s2">"</span> <span class="k">if</span> <span class="n">domain</span> <span class="k">else</span> <span class="n">topic</span>
                <span class="k">if</span> <span class="n">topic</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_pub_topic_domains</span><span class="p">:</span>
                    <span class="n">topic_domain_str</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="n">topic</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_pub_topic_domains</span><span class="p">[</span><span class="n">topic</span><span class="p">]</span><span class="si">}</span><span class="s2">"</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_pub_topic_domains</span><span class="p">[</span><span class="n">topic</span><span class="p">]</span> <span class="k">else</span> <span class="n">topic</span>
                <span class="n">_send_msg</span><span class="p">(</span><span class="n">socket</span><span class="p">,</span> <span class="n">topic_domain_str</span><span class="p">,</span> <span class="n">result</span><span class="p">[</span><span class="n">topic</span><span class="p">])</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">debug_logger</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">debug_logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
                        <span class="sa">f</span><span class="s2">"- (DS): sent message from </span><span class="si">{</span><span class="n">func</span><span class="si">}</span><span class="s2"> to topic </span><span class="si">{</span><span class="n">topic_domain_str</span><span class="si">}</span><span class="s2">:</span><span class="se">\n</span><span class="s2">   </span><span class="si">{</span><span class="n">result</span><span class="p">[</span><span class="n">topic</span><span class="p">]</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">result</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h5 class="doc doc-heading" id="adviser.services.hci.gui.GUIServer.forward_engagement_message_to_react">
<code class="highlight language-python">
forward_engagement_message_to_react<span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> </code>
<a class="headerlink" href="#adviser.services.hci.gui.GUIServer.forward_engagement_message_to_react" title="Permanent link"></a></h5>
<div class="doc doc-contents">
<details class="quote">
<summary>Source code in <code>adviser/services/hci/gui.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>551
552
553
554
555
556
557
558
559
560
561
562
563
564
565
566
567
568
569
570
571
572
573
574
575
576
577
578
579
580
581
582</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">delegate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="n">func_inst</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">func</span><span class="o">.</span><span class="vm">__name__</span><span class="p">)</span>

    <span class="n">callargs</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">args</span><span class="p">)</span>
    <span class="k">if</span> <span class="bp">self</span> <span class="ow">in</span> <span class="n">callargs</span><span class="p">:</span>    <span class="c1"># remove self when in *args, because already known to function</span>
        <span class="n">callargs</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">func</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">callargs</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">result</span><span class="p">:</span>
        <span class="c1"># fix! (user could have multiple "/" characters in topic - only use last one )</span>
        <span class="n">domains</span> <span class="o">=</span> <span class="p">{</span><span class="n">res</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">"/"</span><span class="p">)[</span><span class="mi">0</span><span class="p">]:</span> <span class="n">res</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">"/"</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span> <span class="k">if</span> <span class="s2">"/"</span> <span class="ow">in</span> <span class="n">res</span> <span class="k">else</span> <span class="s2">""</span> <span class="k">for</span> <span class="n">res</span> <span class="ow">in</span> <span class="n">result</span><span class="p">}</span>
        <span class="n">result</span> <span class="o">=</span> <span class="p">{</span><span class="n">key</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">"/"</span><span class="p">)[</span><span class="mi">0</span><span class="p">]:</span> <span class="n">result</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">result</span><span class="p">}</span>

    <span class="k">if</span> <span class="n">func_inst</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_publish_sockets</span><span class="p">:</span>
        <span class="c1"># not a publisher, just normal function</span>
        <span class="k">return</span> <span class="n">result</span>

    <span class="n">socket</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_publish_sockets</span><span class="p">[</span><span class="n">func_inst</span><span class="p">]</span>
    <span class="n">domain</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_domain_name</span>
    <span class="k">if</span> <span class="n">socket</span> <span class="ow">and</span> <span class="n">result</span><span class="p">:</span>
        <span class="c1"># publish messages</span>
        <span class="k">for</span> <span class="n">topic</span> <span class="ow">in</span> <span class="n">pub_topics</span><span class="p">:</span>
        <span class="c1"># for topic in result: # NOTE publish any returned value in dict with it's key as topic</span>
            <span class="k">if</span> <span class="n">topic</span> <span class="ow">in</span> <span class="n">result</span><span class="p">:</span>
                <span class="n">domain</span> <span class="o">=</span> <span class="n">domain</span> <span class="k">if</span> <span class="n">domain</span> <span class="k">else</span> <span class="n">domains</span><span class="p">[</span><span class="n">topic</span><span class="p">]</span>
                <span class="n">topic_domain_str</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="n">topic</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">domain</span><span class="si">}</span><span class="s2">"</span> <span class="k">if</span> <span class="n">domain</span> <span class="k">else</span> <span class="n">topic</span>
                <span class="k">if</span> <span class="n">topic</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_pub_topic_domains</span><span class="p">:</span>
                    <span class="n">topic_domain_str</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="n">topic</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_pub_topic_domains</span><span class="p">[</span><span class="n">topic</span><span class="p">]</span><span class="si">}</span><span class="s2">"</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_pub_topic_domains</span><span class="p">[</span><span class="n">topic</span><span class="p">]</span> <span class="k">else</span> <span class="n">topic</span>
                <span class="n">_send_msg</span><span class="p">(</span><span class="n">socket</span><span class="p">,</span> <span class="n">topic_domain_str</span><span class="p">,</span> <span class="n">result</span><span class="p">[</span><span class="n">topic</span><span class="p">])</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">debug_logger</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">debug_logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
                        <span class="sa">f</span><span class="s2">"- (DS): sent message from </span><span class="si">{</span><span class="n">func</span><span class="si">}</span><span class="s2"> to topic </span><span class="si">{</span><span class="n">topic_domain_str</span><span class="si">}</span><span class="s2">:</span><span class="se">\n</span><span class="s2">   </span><span class="si">{</span><span class="n">result</span><span class="p">[</span><span class="n">topic</span><span class="p">]</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">result</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h5 class="doc doc-heading" id="adviser.services.hci.gui.GUIServer.forward_sys_message_to_react">
<code class="highlight language-python">
forward_sys_message_to_react<span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> </code>
<a class="headerlink" href="#adviser.services.hci.gui.GUIServer.forward_sys_message_to_react" title="Permanent link"></a></h5>
<div class="doc doc-contents">
<details class="quote">
<summary>Source code in <code>adviser/services/hci/gui.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>551
552
553
554
555
556
557
558
559
560
561
562
563
564
565
566
567
568
569
570
571
572
573
574
575
576
577
578
579
580
581
582</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">delegate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="n">func_inst</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">func</span><span class="o">.</span><span class="vm">__name__</span><span class="p">)</span>

    <span class="n">callargs</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">args</span><span class="p">)</span>
    <span class="k">if</span> <span class="bp">self</span> <span class="ow">in</span> <span class="n">callargs</span><span class="p">:</span>    <span class="c1"># remove self when in *args, because already known to function</span>
        <span class="n">callargs</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">func</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">callargs</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">result</span><span class="p">:</span>
        <span class="c1"># fix! (user could have multiple "/" characters in topic - only use last one )</span>
        <span class="n">domains</span> <span class="o">=</span> <span class="p">{</span><span class="n">res</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">"/"</span><span class="p">)[</span><span class="mi">0</span><span class="p">]:</span> <span class="n">res</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">"/"</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span> <span class="k">if</span> <span class="s2">"/"</span> <span class="ow">in</span> <span class="n">res</span> <span class="k">else</span> <span class="s2">""</span> <span class="k">for</span> <span class="n">res</span> <span class="ow">in</span> <span class="n">result</span><span class="p">}</span>
        <span class="n">result</span> <span class="o">=</span> <span class="p">{</span><span class="n">key</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">"/"</span><span class="p">)[</span><span class="mi">0</span><span class="p">]:</span> <span class="n">result</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">result</span><span class="p">}</span>

    <span class="k">if</span> <span class="n">func_inst</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_publish_sockets</span><span class="p">:</span>
        <span class="c1"># not a publisher, just normal function</span>
        <span class="k">return</span> <span class="n">result</span>

    <span class="n">socket</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_publish_sockets</span><span class="p">[</span><span class="n">func_inst</span><span class="p">]</span>
    <span class="n">domain</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_domain_name</span>
    <span class="k">if</span> <span class="n">socket</span> <span class="ow">and</span> <span class="n">result</span><span class="p">:</span>
        <span class="c1"># publish messages</span>
        <span class="k">for</span> <span class="n">topic</span> <span class="ow">in</span> <span class="n">pub_topics</span><span class="p">:</span>
        <span class="c1"># for topic in result: # NOTE publish any returned value in dict with it's key as topic</span>
            <span class="k">if</span> <span class="n">topic</span> <span class="ow">in</span> <span class="n">result</span><span class="p">:</span>
                <span class="n">domain</span> <span class="o">=</span> <span class="n">domain</span> <span class="k">if</span> <span class="n">domain</span> <span class="k">else</span> <span class="n">domains</span><span class="p">[</span><span class="n">topic</span><span class="p">]</span>
                <span class="n">topic_domain_str</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="n">topic</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">domain</span><span class="si">}</span><span class="s2">"</span> <span class="k">if</span> <span class="n">domain</span> <span class="k">else</span> <span class="n">topic</span>
                <span class="k">if</span> <span class="n">topic</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_pub_topic_domains</span><span class="p">:</span>
                    <span class="n">topic_domain_str</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="n">topic</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_pub_topic_domains</span><span class="p">[</span><span class="n">topic</span><span class="p">]</span><span class="si">}</span><span class="s2">"</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_pub_topic_domains</span><span class="p">[</span><span class="n">topic</span><span class="p">]</span> <span class="k">else</span> <span class="n">topic</span>
                <span class="n">_send_msg</span><span class="p">(</span><span class="n">socket</span><span class="p">,</span> <span class="n">topic_domain_str</span><span class="p">,</span> <span class="n">result</span><span class="p">[</span><span class="n">topic</span><span class="p">])</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">debug_logger</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">debug_logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
                        <span class="sa">f</span><span class="s2">"- (DS): sent message from </span><span class="si">{</span><span class="n">func</span><span class="si">}</span><span class="s2"> to topic </span><span class="si">{</span><span class="n">topic_domain_str</span><span class="si">}</span><span class="s2">:</span><span class="se">\n</span><span class="s2">   </span><span class="si">{</span><span class="n">result</span><span class="p">[</span><span class="n">topic</span><span class="p">]</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">result</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h5 class="doc doc-heading" id="adviser.services.hci.gui.GUIServer.forward_user_message_to_react">
<code class="highlight language-python">
forward_user_message_to_react<span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> </code>
<a class="headerlink" href="#adviser.services.hci.gui.GUIServer.forward_user_message_to_react" title="Permanent link"></a></h5>
<div class="doc doc-contents">
<details class="quote">
<summary>Source code in <code>adviser/services/hci/gui.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>551
552
553
554
555
556
557
558
559
560
561
562
563
564
565
566
567
568
569
570
571
572
573
574
575
576
577
578
579
580
581
582</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">delegate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="n">func_inst</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">func</span><span class="o">.</span><span class="vm">__name__</span><span class="p">)</span>

    <span class="n">callargs</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">args</span><span class="p">)</span>
    <span class="k">if</span> <span class="bp">self</span> <span class="ow">in</span> <span class="n">callargs</span><span class="p">:</span>    <span class="c1"># remove self when in *args, because already known to function</span>
        <span class="n">callargs</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">func</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">callargs</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">result</span><span class="p">:</span>
        <span class="c1"># fix! (user could have multiple "/" characters in topic - only use last one )</span>
        <span class="n">domains</span> <span class="o">=</span> <span class="p">{</span><span class="n">res</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">"/"</span><span class="p">)[</span><span class="mi">0</span><span class="p">]:</span> <span class="n">res</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">"/"</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span> <span class="k">if</span> <span class="s2">"/"</span> <span class="ow">in</span> <span class="n">res</span> <span class="k">else</span> <span class="s2">""</span> <span class="k">for</span> <span class="n">res</span> <span class="ow">in</span> <span class="n">result</span><span class="p">}</span>
        <span class="n">result</span> <span class="o">=</span> <span class="p">{</span><span class="n">key</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">"/"</span><span class="p">)[</span><span class="mi">0</span><span class="p">]:</span> <span class="n">result</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">result</span><span class="p">}</span>

    <span class="k">if</span> <span class="n">func_inst</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_publish_sockets</span><span class="p">:</span>
        <span class="c1"># not a publisher, just normal function</span>
        <span class="k">return</span> <span class="n">result</span>

    <span class="n">socket</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_publish_sockets</span><span class="p">[</span><span class="n">func_inst</span><span class="p">]</span>
    <span class="n">domain</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_domain_name</span>
    <span class="k">if</span> <span class="n">socket</span> <span class="ow">and</span> <span class="n">result</span><span class="p">:</span>
        <span class="c1"># publish messages</span>
        <span class="k">for</span> <span class="n">topic</span> <span class="ow">in</span> <span class="n">pub_topics</span><span class="p">:</span>
        <span class="c1"># for topic in result: # NOTE publish any returned value in dict with it's key as topic</span>
            <span class="k">if</span> <span class="n">topic</span> <span class="ow">in</span> <span class="n">result</span><span class="p">:</span>
                <span class="n">domain</span> <span class="o">=</span> <span class="n">domain</span> <span class="k">if</span> <span class="n">domain</span> <span class="k">else</span> <span class="n">domains</span><span class="p">[</span><span class="n">topic</span><span class="p">]</span>
                <span class="n">topic_domain_str</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="n">topic</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">domain</span><span class="si">}</span><span class="s2">"</span> <span class="k">if</span> <span class="n">domain</span> <span class="k">else</span> <span class="n">topic</span>
                <span class="k">if</span> <span class="n">topic</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_pub_topic_domains</span><span class="p">:</span>
                    <span class="n">topic_domain_str</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="n">topic</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_pub_topic_domains</span><span class="p">[</span><span class="n">topic</span><span class="p">]</span><span class="si">}</span><span class="s2">"</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_pub_topic_domains</span><span class="p">[</span><span class="n">topic</span><span class="p">]</span> <span class="k">else</span> <span class="n">topic</span>
                <span class="n">_send_msg</span><span class="p">(</span><span class="n">socket</span><span class="p">,</span> <span class="n">topic_domain_str</span><span class="p">,</span> <span class="n">result</span><span class="p">[</span><span class="n">topic</span><span class="p">])</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">debug_logger</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">debug_logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
                        <span class="sa">f</span><span class="s2">"- (DS): sent message from </span><span class="si">{</span><span class="n">func</span><span class="si">}</span><span class="s2"> to topic </span><span class="si">{</span><span class="n">topic_domain_str</span><span class="si">}</span><span class="s2">:</span><span class="se">\n</span><span class="s2">   </span><span class="si">{</span><span class="n">result</span><span class="p">[</span><span class="n">topic</span><span class="p">]</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">result</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h5 class="doc doc-heading" id="adviser.services.hci.gui.GUIServer.start_dialog">
<code class="highlight language-python">
start_dialog<span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> </code>
<a class="headerlink" href="#adviser.services.hci.gui.GUIServer.start_dialog" title="Permanent link"></a></h5>
<div class="doc doc-contents">
<details class="quote">
<summary>Source code in <code>adviser/services/hci/gui.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>551
552
553
554
555
556
557
558
559
560
561
562
563
564
565
566
567
568
569
570
571
572
573
574
575
576
577
578
579
580
581
582</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">delegate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="n">func_inst</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">func</span><span class="o">.</span><span class="vm">__name__</span><span class="p">)</span>

    <span class="n">callargs</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">args</span><span class="p">)</span>
    <span class="k">if</span> <span class="bp">self</span> <span class="ow">in</span> <span class="n">callargs</span><span class="p">:</span>    <span class="c1"># remove self when in *args, because already known to function</span>
        <span class="n">callargs</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">func</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">callargs</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">result</span><span class="p">:</span>
        <span class="c1"># fix! (user could have multiple "/" characters in topic - only use last one )</span>
        <span class="n">domains</span> <span class="o">=</span> <span class="p">{</span><span class="n">res</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">"/"</span><span class="p">)[</span><span class="mi">0</span><span class="p">]:</span> <span class="n">res</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">"/"</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span> <span class="k">if</span> <span class="s2">"/"</span> <span class="ow">in</span> <span class="n">res</span> <span class="k">else</span> <span class="s2">""</span> <span class="k">for</span> <span class="n">res</span> <span class="ow">in</span> <span class="n">result</span><span class="p">}</span>
        <span class="n">result</span> <span class="o">=</span> <span class="p">{</span><span class="n">key</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">"/"</span><span class="p">)[</span><span class="mi">0</span><span class="p">]:</span> <span class="n">result</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">result</span><span class="p">}</span>

    <span class="k">if</span> <span class="n">func_inst</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_publish_sockets</span><span class="p">:</span>
        <span class="c1"># not a publisher, just normal function</span>
        <span class="k">return</span> <span class="n">result</span>

    <span class="n">socket</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_publish_sockets</span><span class="p">[</span><span class="n">func_inst</span><span class="p">]</span>
    <span class="n">domain</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_domain_name</span>
    <span class="k">if</span> <span class="n">socket</span> <span class="ow">and</span> <span class="n">result</span><span class="p">:</span>
        <span class="c1"># publish messages</span>
        <span class="k">for</span> <span class="n">topic</span> <span class="ow">in</span> <span class="n">pub_topics</span><span class="p">:</span>
        <span class="c1"># for topic in result: # NOTE publish any returned value in dict with it's key as topic</span>
            <span class="k">if</span> <span class="n">topic</span> <span class="ow">in</span> <span class="n">result</span><span class="p">:</span>
                <span class="n">domain</span> <span class="o">=</span> <span class="n">domain</span> <span class="k">if</span> <span class="n">domain</span> <span class="k">else</span> <span class="n">domains</span><span class="p">[</span><span class="n">topic</span><span class="p">]</span>
                <span class="n">topic_domain_str</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="n">topic</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">domain</span><span class="si">}</span><span class="s2">"</span> <span class="k">if</span> <span class="n">domain</span> <span class="k">else</span> <span class="n">topic</span>
                <span class="k">if</span> <span class="n">topic</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_pub_topic_domains</span><span class="p">:</span>
                    <span class="n">topic_domain_str</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="n">topic</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_pub_topic_domains</span><span class="p">[</span><span class="n">topic</span><span class="p">]</span><span class="si">}</span><span class="s2">"</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_pub_topic_domains</span><span class="p">[</span><span class="n">topic</span><span class="p">]</span> <span class="k">else</span> <span class="n">topic</span>
                <span class="n">_send_msg</span><span class="p">(</span><span class="n">socket</span><span class="p">,</span> <span class="n">topic_domain_str</span><span class="p">,</span> <span class="n">result</span><span class="p">[</span><span class="n">topic</span><span class="p">])</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">debug_logger</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">debug_logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
                        <span class="sa">f</span><span class="s2">"- (DS): sent message from </span><span class="si">{</span><span class="n">func</span><span class="si">}</span><span class="s2"> to topic </span><span class="si">{</span><span class="n">topic_domain_str</span><span class="si">}</span><span class="s2">:</span><span class="se">\n</span><span class="s2">   </span><span class="si">{</span><span class="n">result</span><span class="p">[</span><span class="n">topic</span><span class="p">]</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">result</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h5 class="doc doc-heading" id="adviser.services.hci.gui.GUIServer.user_utterance">
<code class="highlight language-python">
user_utterance<span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> </code>
<a class="headerlink" href="#adviser.services.hci.gui.GUIServer.user_utterance" title="Permanent link"></a></h5>
<div class="doc doc-contents">
<details class="quote">
<summary>Source code in <code>adviser/services/hci/gui.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>551
552
553
554
555
556
557
558
559
560
561
562
563
564
565
566
567
568
569
570
571
572
573
574
575
576
577
578
579
580
581
582</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">delegate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="n">func_inst</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">func</span><span class="o">.</span><span class="vm">__name__</span><span class="p">)</span>

    <span class="n">callargs</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">args</span><span class="p">)</span>
    <span class="k">if</span> <span class="bp">self</span> <span class="ow">in</span> <span class="n">callargs</span><span class="p">:</span>    <span class="c1"># remove self when in *args, because already known to function</span>
        <span class="n">callargs</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">func</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">callargs</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">result</span><span class="p">:</span>
        <span class="c1"># fix! (user could have multiple "/" characters in topic - only use last one )</span>
        <span class="n">domains</span> <span class="o">=</span> <span class="p">{</span><span class="n">res</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">"/"</span><span class="p">)[</span><span class="mi">0</span><span class="p">]:</span> <span class="n">res</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">"/"</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span> <span class="k">if</span> <span class="s2">"/"</span> <span class="ow">in</span> <span class="n">res</span> <span class="k">else</span> <span class="s2">""</span> <span class="k">for</span> <span class="n">res</span> <span class="ow">in</span> <span class="n">result</span><span class="p">}</span>
        <span class="n">result</span> <span class="o">=</span> <span class="p">{</span><span class="n">key</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">"/"</span><span class="p">)[</span><span class="mi">0</span><span class="p">]:</span> <span class="n">result</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">result</span><span class="p">}</span>

    <span class="k">if</span> <span class="n">func_inst</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_publish_sockets</span><span class="p">:</span>
        <span class="c1"># not a publisher, just normal function</span>
        <span class="k">return</span> <span class="n">result</span>

    <span class="n">socket</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_publish_sockets</span><span class="p">[</span><span class="n">func_inst</span><span class="p">]</span>
    <span class="n">domain</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_domain_name</span>
    <span class="k">if</span> <span class="n">socket</span> <span class="ow">and</span> <span class="n">result</span><span class="p">:</span>
        <span class="c1"># publish messages</span>
        <span class="k">for</span> <span class="n">topic</span> <span class="ow">in</span> <span class="n">pub_topics</span><span class="p">:</span>
        <span class="c1"># for topic in result: # NOTE publish any returned value in dict with it's key as topic</span>
            <span class="k">if</span> <span class="n">topic</span> <span class="ow">in</span> <span class="n">result</span><span class="p">:</span>
                <span class="n">domain</span> <span class="o">=</span> <span class="n">domain</span> <span class="k">if</span> <span class="n">domain</span> <span class="k">else</span> <span class="n">domains</span><span class="p">[</span><span class="n">topic</span><span class="p">]</span>
                <span class="n">topic_domain_str</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="n">topic</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">domain</span><span class="si">}</span><span class="s2">"</span> <span class="k">if</span> <span class="n">domain</span> <span class="k">else</span> <span class="n">topic</span>
                <span class="k">if</span> <span class="n">topic</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_pub_topic_domains</span><span class="p">:</span>
                    <span class="n">topic_domain_str</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="n">topic</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_pub_topic_domains</span><span class="p">[</span><span class="n">topic</span><span class="p">]</span><span class="si">}</span><span class="s2">"</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_pub_topic_domains</span><span class="p">[</span><span class="n">topic</span><span class="p">]</span> <span class="k">else</span> <span class="n">topic</span>
                <span class="n">_send_msg</span><span class="p">(</span><span class="n">socket</span><span class="p">,</span> <span class="n">topic_domain_str</span><span class="p">,</span> <span class="n">result</span><span class="p">[</span><span class="n">topic</span><span class="p">])</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">debug_logger</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">debug_logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
                        <span class="sa">f</span><span class="s2">"- (DS): sent message from </span><span class="si">{</span><span class="n">func</span><span class="si">}</span><span class="s2"> to topic </span><span class="si">{</span><span class="n">topic_domain_str</span><span class="si">}</span><span class="s2">:</span><span class="se">\n</span><span class="s2">   </span><span class="si">{</span><span class="n">result</span><span class="p">[</span><span class="n">topic</span><span class="p">]</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">result</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
</div>
</div>
</div>
<div class="doc doc-object doc-function">
<h4 class="doc doc-heading" id="adviser.services.hci.gui.get_root_dir">
<code class="highlight language-python">
get_root_dir<span class="p">()</span> </code>
<a class="headerlink" href="#adviser.services.hci.gui.get_root_dir" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<details class="quote">
<summary>Source code in <code>adviser/services/hci/gui.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>32
33</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">get_root_dir</span><span class="p">():</span>
    <span class="k">return</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="vm">__file__</span><span class="p">)),</span> <span class="s2">".."</span><span class="p">,</span> <span class="s2">".."</span><span class="p">))</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
</div>
</div>
</div>
<div class="doc doc-object doc-module">
<h3 class="doc doc-heading" id="adviser.services.hci.speech">
<code>speech</code>
<span class="doc doc-properties">
<small class="doc doc-property doc-property-special"><code>special</code></small>
</span>
<a class="headerlink" href="#adviser.services.hci.speech" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<div class="doc doc-children">
<div class="doc doc-object doc-module">
<h4 class="doc doc-heading" id="adviser.services.hci.speech.cleaners">
<code>cleaners</code>
<a class="headerlink" href="#adviser.services.hci.speech.cleaners" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>This file is derived from https://github.com/keithito/tacotron.</p>
<div class="doc doc-children">
<div class="doc doc-object doc-function">
<h5 class="doc doc-heading" id="adviser.services.hci.speech.cleaners.basic_cleaners">
<code class="highlight language-python">
basic_cleaners<span class="p">(</span><span class="n">text</span><span class="p">)</span> </code>
<a class="headerlink" href="#adviser.services.hci.speech.cleaners.basic_cleaners" title="Permanent link"></a></h5>
<div class="doc doc-contents">
<p>Basic pipeline that lowercases and collapses whitespace without transliteration.</p>
<details class="quote">
<summary>Source code in <code>adviser/services/hci/speech/cleaners.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>208
209
210
211
212</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">basic_cleaners</span><span class="p">(</span><span class="n">text</span><span class="p">):</span>
    <span class="sd">"""Basic pipeline that lowercases and collapses whitespace without transliteration."""</span>
    <span class="n">text</span> <span class="o">=</span> <span class="n">lowercase</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>
    <span class="n">text</span> <span class="o">=</span> <span class="n">collapse_whitespace</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">text</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-function">
<h5 class="doc doc-heading" id="adviser.services.hci.speech.cleaners.collapse_whitespace">
<code class="highlight language-python">
collapse_whitespace<span class="p">(</span><span class="n">text</span><span class="p">)</span> </code>
<a class="headerlink" href="#adviser.services.hci.speech.cleaners.collapse_whitespace" title="Permanent link"></a></h5>
<div class="doc doc-contents">
<details class="quote">
<summary>Source code in <code>adviser/services/hci/speech/cleaners.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>200
201</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">collapse_whitespace</span><span class="p">(</span><span class="n">text</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="n">_whitespace_re</span><span class="p">,</span> <span class="s1">' '</span><span class="p">,</span> <span class="n">text</span><span class="p">)</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-function">
<h5 class="doc doc-heading" id="adviser.services.hci.speech.cleaners.convert_to_ascii">
<code class="highlight language-python">
convert_to_ascii<span class="p">(</span><span class="n">text</span><span class="p">)</span> </code>
<a class="headerlink" href="#adviser.services.hci.speech.cleaners.convert_to_ascii" title="Permanent link"></a></h5>
<div class="doc doc-contents">
<details class="quote">
<summary>Source code in <code>adviser/services/hci/speech/cleaners.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>204
205</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">convert_to_ascii</span><span class="p">(</span><span class="n">text</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">unidecode</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-function">
<h5 class="doc doc-heading" id="adviser.services.hci.speech.cleaners.custom_english_cleaners">
<code class="highlight language-python">
custom_english_cleaners<span class="p">(</span><span class="n">text</span><span class="p">)</span> </code>
<a class="headerlink" href="#adviser.services.hci.speech.cleaners.custom_english_cleaners" title="Permanent link"></a></h5>
<div class="doc doc-contents">
<p>Custom pipeline for English text, including number and abbreviation expansion.</p>
<details class="quote">
<summary>Source code in <code>adviser/services/hci/speech/cleaners.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>254
255
256
257
258
259
260
261
262
263
264
265
266</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">custom_english_cleaners</span><span class="p">(</span><span class="n">text</span><span class="p">):</span>
    <span class="sd">"""Custom pipeline for English text, including number and abbreviation expansion."""</span>
    <span class="n">text</span> <span class="o">=</span> <span class="n">convert_to_ascii</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>
    <span class="n">text</span> <span class="o">=</span> <span class="n">expand_email</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>
    <span class="n">text</span> <span class="o">=</span> <span class="n">expand_acronym</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>
    <span class="n">text</span> <span class="o">=</span> <span class="n">lowercase</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>
    <span class="n">text</span> <span class="o">=</span> <span class="n">expand_numbers</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>
    <span class="n">text</span> <span class="o">=</span> <span class="n">expand_abbreviations</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>
    <span class="n">text</span> <span class="o">=</span> <span class="n">expand_symbols</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>
    <span class="n">text</span> <span class="o">=</span> <span class="n">remove_unnecessary_symbols</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>
    <span class="n">text</span> <span class="o">=</span> <span class="n">uppercase</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>
    <span class="n">text</span> <span class="o">=</span> <span class="n">collapse_whitespace</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">text</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-function">
<h5 class="doc doc-heading" id="adviser.services.hci.speech.cleaners.english_cleaners">
<code class="highlight language-python">
english_cleaners<span class="p">(</span><span class="n">text</span><span class="p">)</span> </code>
<a class="headerlink" href="#adviser.services.hci.speech.cleaners.english_cleaners" title="Permanent link"></a></h5>
<div class="doc doc-contents">
<p>Pipeline for English text, including number and abbreviation expansion.</p>
<details class="quote">
<summary>Source code in <code>adviser/services/hci/speech/cleaners.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>223
224
225
226
227
228
229
230</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">english_cleaners</span><span class="p">(</span><span class="n">text</span><span class="p">):</span>
    <span class="sd">"""Pipeline for English text, including number and abbreviation expansion."""</span>
    <span class="n">text</span> <span class="o">=</span> <span class="n">convert_to_ascii</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>
    <span class="n">text</span> <span class="o">=</span> <span class="n">lowercase</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>
    <span class="n">text</span> <span class="o">=</span> <span class="n">expand_numbers</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>
    <span class="n">text</span> <span class="o">=</span> <span class="n">expand_abbreviations</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>
    <span class="n">text</span> <span class="o">=</span> <span class="n">collapse_whitespace</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">text</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-function">
<h5 class="doc doc-heading" id="adviser.services.hci.speech.cleaners.expand_abbreviations">
<code class="highlight language-python">
expand_abbreviations<span class="p">(</span><span class="n">text</span><span class="p">)</span> </code>
<a class="headerlink" href="#adviser.services.hci.speech.cleaners.expand_abbreviations" title="Permanent link"></a></h5>
<div class="doc doc-contents">
<p>Preprocesses a text to turn abbreviations into forms that the TTS can pronounce properly</p>
<p>text (string): Text to be preprocessed</p>
<details class="quote">
<summary>Source code in <code>adviser/services/hci/speech/cleaners.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>137
138
139
140
141
142
143
144
145</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">expand_abbreviations</span><span class="p">(</span><span class="n">text</span><span class="p">):</span>
    <span class="sd">"""</span>
<span class="sd">    Preprocesses a text to turn abbreviations into forms that the TTS can pronounce properly</span>

<span class="sd">    text (string): Text to be preprocessed</span>
<span class="sd">    """</span>
    <span class="k">for</span> <span class="n">regex</span><span class="p">,</span> <span class="n">replacement</span> <span class="ow">in</span> <span class="n">_abbreviations</span><span class="p">:</span>
        <span class="n">text</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="n">regex</span><span class="p">,</span> <span class="n">replacement</span><span class="p">,</span> <span class="n">text</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">text</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-function">
<h5 class="doc doc-heading" id="adviser.services.hci.speech.cleaners.expand_acronym">
<code class="highlight language-python">
expand_acronym<span class="p">(</span><span class="n">text</span><span class="p">)</span> </code>
<a class="headerlink" href="#adviser.services.hci.speech.cleaners.expand_acronym" title="Permanent link"></a></h5>
<div class="doc doc-contents">
<p>Preprocesses a text to turn acronyms into forms that the TTS can pronounce properly</p>
<p>text (string): Text to be preprocessed</p>
<details class="quote">
<summary>Source code in <code>adviser/services/hci/speech/cleaners.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>171
172
173
174
175
176
177
178
179</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">expand_acronym</span><span class="p">(</span><span class="n">text</span><span class="p">):</span>
    <span class="sd">"""</span>
<span class="sd">    Preprocesses a text to turn acronyms into forms that the TTS can pronounce properly</span>

<span class="sd">    text (string): Text to be preprocessed</span>
<span class="sd">    """</span>
    <span class="k">for</span> <span class="n">word</span><span class="p">,</span> <span class="n">replacement</span> <span class="ow">in</span> <span class="n">_acronym</span><span class="p">:</span>
        <span class="n">text</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="n">word</span><span class="p">,</span> <span class="n">replacement</span><span class="p">,</span> <span class="n">text</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">text</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-function">
<h5 class="doc doc-heading" id="adviser.services.hci.speech.cleaners.expand_email">
<code class="highlight language-python">
expand_email<span class="p">(</span><span class="n">text</span><span class="p">)</span> </code>
<a class="headerlink" href="#adviser.services.hci.speech.cleaners.expand_email" title="Permanent link"></a></h5>
<div class="doc doc-contents">
<details class="quote">
<summary>Source code in <code>adviser/services/hci/speech/cleaners.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>188
189
190</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">expand_email</span><span class="p">(</span><span class="n">text</span><span class="p">):</span>
    <span class="n">text</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="n">_email_re</span><span class="p">,</span> <span class="n">_expand_email</span><span class="p">,</span> <span class="n">text</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">text</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-function">
<h5 class="doc doc-heading" id="adviser.services.hci.speech.cleaners.expand_numbers">
<code class="highlight language-python">
expand_numbers<span class="p">(</span><span class="n">text</span><span class="p">)</span> </code>
<a class="headerlink" href="#adviser.services.hci.speech.cleaners.expand_numbers" title="Permanent link"></a></h5>
<div class="doc doc-contents">
<details class="quote">
<summary>Source code in <code>adviser/services/hci/speech/cleaners.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>192
193</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">expand_numbers</span><span class="p">(</span><span class="n">text</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">normalize_numbers</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-function">
<h5 class="doc doc-heading" id="adviser.services.hci.speech.cleaners.expand_symbols">
<code class="highlight language-python">
expand_symbols<span class="p">(</span><span class="n">text</span><span class="p">)</span> </code>
<a class="headerlink" href="#adviser.services.hci.speech.cleaners.expand_symbols" title="Permanent link"></a></h5>
<div class="doc doc-contents">
<details class="quote">
<summary>Source code in <code>adviser/services/hci/speech/cleaners.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>240
241
242
243
244
245
246</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">expand_symbols</span><span class="p">(</span><span class="n">text</span><span class="p">):</span>
    <span class="c1"># added</span>
    <span class="n">text</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="s2">";"</span><span class="p">,</span> <span class="s2">","</span><span class="p">,</span> <span class="n">text</span><span class="p">)</span>
    <span class="n">text</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="s2">":"</span><span class="p">,</span> <span class="s2">","</span><span class="p">,</span> <span class="n">text</span><span class="p">)</span>
    <span class="n">text</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="s2">"-"</span><span class="p">,</span> <span class="s2">" "</span><span class="p">,</span> <span class="n">text</span><span class="p">)</span>
    <span class="n">text</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="s2">"&amp;"</span><span class="p">,</span> <span class="s2">"and"</span><span class="p">,</span> <span class="n">text</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">text</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-function">
<h5 class="doc doc-heading" id="adviser.services.hci.speech.cleaners.lowercase">
<code class="highlight language-python">
lowercase<span class="p">(</span><span class="n">text</span><span class="p">)</span> </code>
<a class="headerlink" href="#adviser.services.hci.speech.cleaners.lowercase" title="Permanent link"></a></h5>
<div class="doc doc-contents">
<details class="quote">
<summary>Source code in <code>adviser/services/hci/speech/cleaners.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>196
197</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">lowercase</span><span class="p">(</span><span class="n">text</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">text</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-function">
<h5 class="doc doc-heading" id="adviser.services.hci.speech.cleaners.normalize_numbers">
<code class="highlight language-python">
normalize_numbers<span class="p">(</span><span class="n">text</span><span class="p">)</span> </code>
<a class="headerlink" href="#adviser.services.hci.speech.cleaners.normalize_numbers" title="Permanent link"></a></h5>
<div class="doc doc-contents">
<p>Normalizes numbers in an utterance as preparation for TTS</p>
<p>text (string): Text to be preprocessed</p>
<details class="quote">
<summary>Source code in <code>adviser/services/hci/speech/cleaners.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span> 93
 94
 95
 96
 97
 98
 99
100
101
102
103
104
105
106</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">normalize_numbers</span><span class="p">(</span><span class="n">text</span><span class="p">):</span>
    <span class="sd">"""</span>
<span class="sd">    Normalizes numbers in an utterance as preparation for TTS</span>

<span class="sd">    text (string): Text to be preprocessed</span>
<span class="sd">    """</span>
    <span class="n">text</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="n">_comma_number_re</span><span class="p">,</span> <span class="n">_remove_commas</span><span class="p">,</span> <span class="n">text</span><span class="p">)</span>
    <span class="n">text</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="n">_pounds_re</span><span class="p">,</span> <span class="sa">r</span><span class="s1">'\1 pounds'</span><span class="p">,</span> <span class="n">text</span><span class="p">)</span>
    <span class="n">text</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="n">_dollars_re</span><span class="p">,</span> <span class="n">_expand_dollars</span><span class="p">,</span> <span class="n">text</span><span class="p">)</span>
    <span class="n">text</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="n">_decimal_number_re</span><span class="p">,</span> <span class="n">_expand_decimal_point</span><span class="p">,</span> <span class="n">text</span><span class="p">)</span>
    <span class="n">text</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="n">_ordinal_re</span><span class="p">,</span> <span class="n">_expand_ordinal</span><span class="p">,</span> <span class="n">text</span><span class="p">)</span>
    <span class="n">text</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="n">_ID_number_re</span><span class="p">,</span> <span class="n">_expand_ID_number</span><span class="p">,</span> <span class="n">text</span><span class="p">)</span>
    <span class="n">text</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="n">_number_re</span><span class="p">,</span> <span class="n">_expand_number</span><span class="p">,</span> <span class="n">text</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">text</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-function">
<h5 class="doc doc-heading" id="adviser.services.hci.speech.cleaners.remove_unnecessary_symbols">
<code class="highlight language-python">
remove_unnecessary_symbols<span class="p">(</span><span class="n">text</span><span class="p">)</span> </code>
<a class="headerlink" href="#adviser.services.hci.speech.cleaners.remove_unnecessary_symbols" title="Permanent link"></a></h5>
<div class="doc doc-contents">
<details class="quote">
<summary>Source code in <code>adviser/services/hci/speech/cleaners.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>233
234
235
236
237</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">remove_unnecessary_symbols</span><span class="p">(</span><span class="n">text</span><span class="p">):</span>
    <span class="c1"># added</span>
    <span class="n">text</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="sa">r</span><span class="s1">'[()[]&lt;&gt;"]+'</span><span class="p">,</span> <span class="s1">''</span><span class="p">,</span> <span class="n">text</span><span class="p">)</span>
    <span class="n">text</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="sa">r</span><span class="s1">'/'</span><span class="p">,</span> <span class="s1">' '</span><span class="p">,</span> <span class="n">text</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">text</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-function">
<h5 class="doc doc-heading" id="adviser.services.hci.speech.cleaners.transliteration_cleaners">
<code class="highlight language-python">
transliteration_cleaners<span class="p">(</span><span class="n">text</span><span class="p">)</span> </code>
<a class="headerlink" href="#adviser.services.hci.speech.cleaners.transliteration_cleaners" title="Permanent link"></a></h5>
<div class="doc doc-contents">
<p>Pipeline for non-English text that transliterates to ASCII.</p>
<details class="quote">
<summary>Source code in <code>adviser/services/hci/speech/cleaners.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>215
216
217
218
219
220</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">transliteration_cleaners</span><span class="p">(</span><span class="n">text</span><span class="p">):</span>
    <span class="sd">"""Pipeline for non-English text that transliterates to ASCII."""</span>
    <span class="n">text</span> <span class="o">=</span> <span class="n">convert_to_ascii</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>
    <span class="n">text</span> <span class="o">=</span> <span class="n">lowercase</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>
    <span class="n">text</span> <span class="o">=</span> <span class="n">collapse_whitespace</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">text</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-function">
<h5 class="doc doc-heading" id="adviser.services.hci.speech.cleaners.uppercase">
<code class="highlight language-python">
uppercase<span class="p">(</span><span class="n">text</span><span class="p">)</span> </code>
<a class="headerlink" href="#adviser.services.hci.speech.cleaners.uppercase" title="Permanent link"></a></h5>
<div class="doc doc-contents">
<details class="quote">
<summary>Source code in <code>adviser/services/hci/speech/cleaners.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>249
250
251</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">uppercase</span><span class="p">(</span><span class="n">text</span><span class="p">):</span>
    <span class="c1"># added</span>
    <span class="k">return</span> <span class="n">text</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
</div>
</div>
</div>
<div class="doc doc-object doc-module">
<h4 class="doc doc-heading" id="adviser.services.hci.speech.speech_utility">
<code>speech_utility</code>
<a class="headerlink" href="#adviser.services.hci.speech.speech_utility" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>Utility for the emotion recognition script that needs the utterance a s file</p>
<div class="doc doc-children">
<div class="doc doc-object doc-function">
<h5 class="doc doc-heading" id="adviser.services.hci.speech.speech_utility.delete_file">
<code class="highlight language-python">
delete_file<span class="p">(</span><span class="n">filepath</span><span class="p">)</span> </code>
<a class="headerlink" href="#adviser.services.hci.speech.speech_utility.delete_file" title="Permanent link"></a></h5>
<div class="doc doc-contents">
<p>Deletes the file at the given path to clean up the audio file
once it's not needed anymore. This is why unique filenames are
important.</p>
<p>filepath (string): path to the file that is to be deleted</p>
<details class="quote">
<summary>Source code in <code>adviser/services/hci/speech/speech_utility.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>47
48
49
50
51
52
53
54
55
56
57
58
59</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">delete_file</span><span class="p">(</span><span class="n">filepath</span><span class="p">):</span>
    <span class="sd">"""</span>
<span class="sd">    Deletes the file at the given path to clean up the audio file</span>
<span class="sd">    once it's not needed anymore. This is why unique filenames are</span>
<span class="sd">    important.</span>

<span class="sd">    filepath (string): path to the file that is to be deleted</span>
<span class="sd">    """</span>
    <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">filepath</span><span class="p">):</span>
        <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">filepath</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">"The file cannot be deleted, as it was not found. "</span>
              <span class="s2">"Please check the provided path for errors: </span><span class="se">\n</span><span class="si">{}</span><span class="s2">"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">filepath</span><span class="p">))</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-function">
<h5 class="doc doc-heading" id="adviser.services.hci.speech.speech_utility.sound_array_to_file">
<code class="highlight language-python">
sound_array_to_file<span class="p">(</span><span class="n">filepath</span><span class="p">,</span> <span class="n">sampling_rate</span><span class="p">,</span> <span class="n">sound_as_array</span><span class="p">)</span> </code>
<a class="headerlink" href="#adviser.services.hci.speech.speech_utility.sound_array_to_file" title="Permanent link"></a></h5>
<div class="doc doc-contents">
<p>Saves the recording of the recorder to a file</p>
<p>Turns the audio from the recorder service into a wav file for 
processing with opensmile c++ scripts </p>
<p>filepath (string): full path, including filename and .wav suffix
at an arbitrary location. Careful: python takes paths as
relative to the main script. The name should be unique, to
ensure files don't get mixed up if there are multiple calls
in short time and one file might get overwriteen or deleted
before it's done being processed.
sampling_rate (int): the sampling rate of the audio, as
published by the recorder
sound_as_array (np.array): the audio in form of an array as
published by the recorder</p>
<details class="quote">
<summary>Source code in <code>adviser/services/hci/speech/speech_utility.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">sound_array_to_file</span><span class="p">(</span><span class="n">filepath</span><span class="p">,</span> <span class="n">sampling_rate</span><span class="p">,</span> <span class="n">sound_as_array</span><span class="p">):</span>
    <span class="sd">"""</span>
<span class="sd">    Saves the recording of the recorder to a file</span>

<span class="sd">    Turns the audio from the recorder service into a wav file for </span>
<span class="sd">    processing with opensmile c++ scripts </span>

<span class="sd">    filepath (string): full path, including filename and .wav suffix</span>
<span class="sd">    at an arbitrary location. Careful: python takes paths as</span>
<span class="sd">    relative to the main script. The name should be unique, to</span>
<span class="sd">    ensure files don't get mixed up if there are multiple calls</span>
<span class="sd">    in short time and one file might get overwriteen or deleted</span>
<span class="sd">    before it's done being processed.</span>
<span class="sd">    sampling_rate (int): the sampling rate of the audio, as</span>
<span class="sd">    published by the recorder</span>
<span class="sd">    sound_as_array (np.array): the audio in form of an array as</span>
<span class="sd">    published by the recorder</span>
<span class="sd">    """</span>
    <span class="n">librosa</span><span class="o">.</span><span class="n">output</span><span class="o">.</span><span class="n">write_wav</span><span class="p">(</span><span class="n">filepath</span><span class="p">,</span> <span class="n">sound_as_array</span><span class="p">,</span> <span class="n">sampling_rate</span><span class="p">)</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
</div>
</div>
</div>
<div class="doc doc-object doc-module">
<h4 class="doc doc-heading" id="adviser.services.hci.speech.SpeechInputDecoder">
<code>SpeechInputDecoder</code>
<a class="headerlink" href="#adviser.services.hci.speech.SpeechInputDecoder" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<div class="doc doc-children">
<div class="doc doc-object doc-class">
<h5 class="doc doc-heading" id="adviser.services.hci.speech.SpeechInputDecoder.SpeechInputDecoder">
<code>SpeechInputDecoder</code>
<a class="headerlink" href="#adviser.services.hci.speech.SpeechInputDecoder.SpeechInputDecoder" title="Permanent link"></a></h5>
<div class="doc doc-contents">
<div class="doc doc-children">
<div class="doc doc-object doc-method">
<h6 class="doc doc-heading" id="adviser.services.hci.speech.SpeechInputDecoder.SpeechInputDecoder.__init__">
<code class="highlight language-python">
__init__<span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">domain</span><span class="o">=</span><span class="s1">''</span><span class="p">,</span> <span class="n">identifier</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">conversation_log_dir</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">use_cuda</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span> </code>
<span class="doc doc-properties">
<small class="doc doc-property doc-property-special"><code>special</code></small>
</span>
<a class="headerlink" href="#adviser.services.hci.speech.SpeechInputDecoder.SpeechInputDecoder.__init__" title="Permanent link"></a></h6>
<div class="doc doc-contents">
<p>Transforms spoken input from the user to text for further processing.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>domain</code></td>
<td><code>Domain</code></td>
<td>
<p>Needed for Service, but has no meaning here</p>
</td>
<td><code>''</code></td>
</tr>
<tr>
<td><code>identifier</code></td>
<td><code>string</code></td>
<td>
<p>Needed for Service</p>
</td>
<td><code>None</code></td>
</tr>
<tr>
<td><code>conversation_log_dir</code></td>
<td><code>str</code></td>
<td>
<p>If this is provided, logfiles will be placed by this Service into the specified directory.</p>
</td>
<td><code>None</code></td>
</tr>
<tr>
<td><code>use_cuda</code></td>
<td><code>boolean</code></td>
<td>
<p>Whether or not to run the computations on a GPU</p>
</td>
<td><code>False</code></td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>adviser/services/hci/speech/SpeechInputDecoder.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">domain</span><span class="p">:</span> <span class="n">Domain</span> <span class="o">=</span> <span class="s2">""</span><span class="p">,</span> <span class="n">identifier</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">conversation_log_dir</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">use_cuda</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="sd">"""</span>
<span class="sd">    Transforms spoken input from the user to text for further processing.</span>

<span class="sd">    Args:</span>
<span class="sd">        domain (Domain): Needed for Service, but has no meaning here</span>
<span class="sd">        identifier (string): Needed for Service</span>
<span class="sd">        conversation_log_dir (string): If this is provided, logfiles will be placed by this Service into the specified directory.</span>
<span class="sd">        use_cuda (boolean): Whether or not to run the computations on a GPU</span>
<span class="sd">    """</span>
    <span class="n">Service</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">domain</span><span class="o">=</span><span class="n">domain</span><span class="p">,</span> <span class="n">identifier</span><span class="o">=</span><span class="n">identifier</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">conversation_log_dir</span> <span class="o">=</span> <span class="n">conversation_log_dir</span>

    <span class="c1"># load model</span>
    <span class="n">model_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">get_root_dir</span><span class="p">(),</span> <span class="s2">"resources"</span><span class="p">,</span> <span class="s2">"models"</span><span class="p">,</span> <span class="s2">"speech"</span><span class="p">,</span> <span class="s2">"multi_en_20190916"</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="p">,</span> <span class="n">conf</span> <span class="o">=</span> <span class="n">load_trained_model</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">model_dir</span><span class="p">,</span> <span class="s2">"model.bin"</span><span class="p">))</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">vocab</span> <span class="o">=</span> <span class="n">conf</span><span class="o">.</span><span class="n">char_list</span>

    <span class="c1"># setup beam search</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">bs</span> <span class="o">=</span> <span class="n">BeamSearch</span><span class="p">(</span><span class="n">scorers</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">scorers</span><span class="p">(),</span>
                         <span class="n">weights</span><span class="o">=</span><span class="p">{</span><span class="s2">"decoder"</span><span class="p">:</span> <span class="mf">1.0</span><span class="p">,</span> <span class="s2">"ctc"</span><span class="p">:</span> <span class="mf">0.0</span><span class="p">},</span>
                         <span class="n">sos</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">sos</span><span class="p">,</span>
                         <span class="n">eos</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">eos</span><span class="p">,</span>
                         <span class="n">beam_size</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span>
                         <span class="n">vocab_size</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">vocab</span><span class="p">),</span>
                         <span class="n">pre_beam_score_key</span><span class="o">=</span><span class="s2">"decoder"</span><span class="p">)</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">bs</span><span class="o">.</span><span class="vm">__class__</span> <span class="o">=</span> <span class="n">BatchBeamSearch</span>

    <span class="c1"># choose hardware to run on</span>
    <span class="k">if</span> <span class="n">use_cuda</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">device</span> <span class="o">=</span> <span class="s2">"cuda"</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">device</span> <span class="o">=</span> <span class="s2">"cpu"</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">device</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">bs</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">device</span><span class="p">)</span>

    <span class="c1"># change from training mode to eval mode</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">eval</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">bs</span><span class="o">.</span><span class="n">eval</span><span class="p">()</span>

    <span class="c1"># scale and offset for feature normalization</span>
    <span class="c1"># follows https://github.com/kaldi-asr/kaldi/blob/33255ed224500f55c8387f1e4fa40e08b73ff48a/src/transform/cmvn.cc#L92-L111</span>
    <span class="n">norm</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">model_dir</span><span class="p">,</span> <span class="s2">"cmvn.bin"</span><span class="p">))</span>
    <span class="n">count</span> <span class="o">=</span> <span class="n">norm</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">mean</span> <span class="o">=</span> <span class="n">norm</span><span class="p">[</span><span class="mi">0</span><span class="p">][:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">/</span> <span class="n">count</span>
    <span class="n">var</span> <span class="o">=</span> <span class="p">(</span><span class="n">norm</span><span class="p">[</span><span class="mi">1</span><span class="p">][:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">/</span> <span class="n">count</span><span class="p">)</span> <span class="o">-</span> <span class="n">mean</span> <span class="o">*</span> <span class="n">mean</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">scale</span> <span class="o">=</span> <span class="mf">1.0</span> <span class="o">/</span> <span class="n">torch</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">var</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">offset</span> <span class="o">=</span> <span class="o">-</span> <span class="p">(</span><span class="n">mean</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">scale</span><span class="p">)</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h6 class="doc doc-heading" id="adviser.services.hci.speech.SpeechInputDecoder.SpeechInputDecoder.features_to_text">
<code class="highlight language-python">
features_to_text<span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> </code>
<a class="headerlink" href="#adviser.services.hci.speech.SpeechInputDecoder.SpeechInputDecoder.features_to_text" title="Permanent link"></a></h6>
<div class="doc doc-contents">
<details class="quote">
<summary>Source code in <code>adviser/services/hci/speech/SpeechInputDecoder.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>551
552
553
554
555
556
557
558
559
560
561
562
563
564
565
566
567
568
569
570
571
572
573
574
575
576
577
578
579
580
581
582</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">delegate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="n">func_inst</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">func</span><span class="o">.</span><span class="vm">__name__</span><span class="p">)</span>

    <span class="n">callargs</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">args</span><span class="p">)</span>
    <span class="k">if</span> <span class="bp">self</span> <span class="ow">in</span> <span class="n">callargs</span><span class="p">:</span>    <span class="c1"># remove self when in *args, because already known to function</span>
        <span class="n">callargs</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">func</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">callargs</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">result</span><span class="p">:</span>
        <span class="c1"># fix! (user could have multiple "/" characters in topic - only use last one )</span>
        <span class="n">domains</span> <span class="o">=</span> <span class="p">{</span><span class="n">res</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">"/"</span><span class="p">)[</span><span class="mi">0</span><span class="p">]:</span> <span class="n">res</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">"/"</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span> <span class="k">if</span> <span class="s2">"/"</span> <span class="ow">in</span> <span class="n">res</span> <span class="k">else</span> <span class="s2">""</span> <span class="k">for</span> <span class="n">res</span> <span class="ow">in</span> <span class="n">result</span><span class="p">}</span>
        <span class="n">result</span> <span class="o">=</span> <span class="p">{</span><span class="n">key</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">"/"</span><span class="p">)[</span><span class="mi">0</span><span class="p">]:</span> <span class="n">result</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">result</span><span class="p">}</span>

    <span class="k">if</span> <span class="n">func_inst</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_publish_sockets</span><span class="p">:</span>
        <span class="c1"># not a publisher, just normal function</span>
        <span class="k">return</span> <span class="n">result</span>

    <span class="n">socket</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_publish_sockets</span><span class="p">[</span><span class="n">func_inst</span><span class="p">]</span>
    <span class="n">domain</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_domain_name</span>
    <span class="k">if</span> <span class="n">socket</span> <span class="ow">and</span> <span class="n">result</span><span class="p">:</span>
        <span class="c1"># publish messages</span>
        <span class="k">for</span> <span class="n">topic</span> <span class="ow">in</span> <span class="n">pub_topics</span><span class="p">:</span>
        <span class="c1"># for topic in result: # NOTE publish any returned value in dict with it's key as topic</span>
            <span class="k">if</span> <span class="n">topic</span> <span class="ow">in</span> <span class="n">result</span><span class="p">:</span>
                <span class="n">domain</span> <span class="o">=</span> <span class="n">domain</span> <span class="k">if</span> <span class="n">domain</span> <span class="k">else</span> <span class="n">domains</span><span class="p">[</span><span class="n">topic</span><span class="p">]</span>
                <span class="n">topic_domain_str</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="n">topic</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">domain</span><span class="si">}</span><span class="s2">"</span> <span class="k">if</span> <span class="n">domain</span> <span class="k">else</span> <span class="n">topic</span>
                <span class="k">if</span> <span class="n">topic</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_pub_topic_domains</span><span class="p">:</span>
                    <span class="n">topic_domain_str</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="n">topic</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_pub_topic_domains</span><span class="p">[</span><span class="n">topic</span><span class="p">]</span><span class="si">}</span><span class="s2">"</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_pub_topic_domains</span><span class="p">[</span><span class="n">topic</span><span class="p">]</span> <span class="k">else</span> <span class="n">topic</span>
                <span class="n">_send_msg</span><span class="p">(</span><span class="n">socket</span><span class="p">,</span> <span class="n">topic_domain_str</span><span class="p">,</span> <span class="n">result</span><span class="p">[</span><span class="n">topic</span><span class="p">])</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">debug_logger</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">debug_logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
                        <span class="sa">f</span><span class="s2">"- (DS): sent message from </span><span class="si">{</span><span class="n">func</span><span class="si">}</span><span class="s2"> to topic </span><span class="si">{</span><span class="n">topic_domain_str</span><span class="si">}</span><span class="s2">:</span><span class="se">\n</span><span class="s2">   </span><span class="si">{</span><span class="n">result</span><span class="p">[</span><span class="n">topic</span><span class="p">]</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">result</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
</div>
</div>
</div>
<div class="doc doc-object doc-function">
<h5 class="doc doc-heading" id="adviser.services.hci.speech.SpeechInputDecoder.get_root_dir">
<code class="highlight language-python">
get_root_dir<span class="p">()</span> </code>
<a class="headerlink" href="#adviser.services.hci.speech.SpeechInputDecoder.get_root_dir" title="Permanent link"></a></h5>
<div class="doc doc-contents">
<details class="quote">
<summary>Source code in <code>adviser/services/hci/speech/SpeechInputDecoder.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>34
35</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">get_root_dir</span><span class="p">():</span>
    <span class="k">return</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="vm">__file__</span><span class="p">)))))</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
</div>
</div>
</div>
<div class="doc doc-object doc-module">
<h4 class="doc doc-heading" id="adviser.services.hci.speech.SpeechInputFeatureExtractor">
<code>SpeechInputFeatureExtractor</code>
<a class="headerlink" href="#adviser.services.hci.speech.SpeechInputFeatureExtractor" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<div class="doc doc-children">
<div class="doc doc-object doc-class">
<h5 class="doc doc-heading" id="adviser.services.hci.speech.SpeechInputFeatureExtractor.SpeechInputFeatureExtractor">
<code>SpeechInputFeatureExtractor</code>
<a class="headerlink" href="#adviser.services.hci.speech.SpeechInputFeatureExtractor.SpeechInputFeatureExtractor" title="Permanent link"></a></h5>
<div class="doc doc-contents">
<div class="doc doc-children">
<div class="doc doc-object doc-method">
<h6 class="doc doc-heading" id="adviser.services.hci.speech.SpeechInputFeatureExtractor.SpeechInputFeatureExtractor.__init__">
<code class="highlight language-python">
__init__<span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">domain</span><span class="o">=</span><span class="s1">''</span><span class="p">)</span> </code>
<span class="doc doc-properties">
<small class="doc doc-property doc-property-special"><code>special</code></small>
</span>
<a class="headerlink" href="#adviser.services.hci.speech.SpeechInputFeatureExtractor.SpeechInputFeatureExtractor.__init__" title="Permanent link"></a></h6>
<div class="doc doc-contents">
<p>Given a sound, this service extracts features and passes them on to the decoder for ASR</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>domain</code></td>
<td><code>Domain</code></td>
<td>
<p>Needed for Service, no meaning here</p>
</td>
<td><code>''</code></td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>adviser/services/hci/speech/SpeechInputFeatureExtractor.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>32
33
34
35
36
37
38
39</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">domain</span><span class="p">:</span> <span class="n">Domain</span> <span class="o">=</span> <span class="s2">""</span><span class="p">):</span>
    <span class="sd">"""</span>
<span class="sd">    Given a sound, this service extracts features and passes them on to the decoder for ASR</span>

<span class="sd">    Args:</span>
<span class="sd">        domain (Domain): Needed for Service, no meaning here</span>
<span class="sd">    """</span>
    <span class="n">Service</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">domain</span><span class="o">=</span><span class="n">domain</span><span class="p">)</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h6 class="doc doc-heading" id="adviser.services.hci.speech.SpeechInputFeatureExtractor.SpeechInputFeatureExtractor.speech_to_fbank">
<code class="highlight language-python">
speech_to_fbank<span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> </code>
<a class="headerlink" href="#adviser.services.hci.speech.SpeechInputFeatureExtractor.SpeechInputFeatureExtractor.speech_to_fbank" title="Permanent link"></a></h6>
<div class="doc doc-contents">
<details class="quote">
<summary>Source code in <code>adviser/services/hci/speech/SpeechInputFeatureExtractor.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>551
552
553
554
555
556
557
558
559
560
561
562
563
564
565
566
567
568
569
570
571
572
573
574
575
576
577
578
579
580
581
582</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">delegate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="n">func_inst</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">func</span><span class="o">.</span><span class="vm">__name__</span><span class="p">)</span>

    <span class="n">callargs</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">args</span><span class="p">)</span>
    <span class="k">if</span> <span class="bp">self</span> <span class="ow">in</span> <span class="n">callargs</span><span class="p">:</span>    <span class="c1"># remove self when in *args, because already known to function</span>
        <span class="n">callargs</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">func</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">callargs</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">result</span><span class="p">:</span>
        <span class="c1"># fix! (user could have multiple "/" characters in topic - only use last one )</span>
        <span class="n">domains</span> <span class="o">=</span> <span class="p">{</span><span class="n">res</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">"/"</span><span class="p">)[</span><span class="mi">0</span><span class="p">]:</span> <span class="n">res</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">"/"</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span> <span class="k">if</span> <span class="s2">"/"</span> <span class="ow">in</span> <span class="n">res</span> <span class="k">else</span> <span class="s2">""</span> <span class="k">for</span> <span class="n">res</span> <span class="ow">in</span> <span class="n">result</span><span class="p">}</span>
        <span class="n">result</span> <span class="o">=</span> <span class="p">{</span><span class="n">key</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">"/"</span><span class="p">)[</span><span class="mi">0</span><span class="p">]:</span> <span class="n">result</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">result</span><span class="p">}</span>

    <span class="k">if</span> <span class="n">func_inst</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_publish_sockets</span><span class="p">:</span>
        <span class="c1"># not a publisher, just normal function</span>
        <span class="k">return</span> <span class="n">result</span>

    <span class="n">socket</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_publish_sockets</span><span class="p">[</span><span class="n">func_inst</span><span class="p">]</span>
    <span class="n">domain</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_domain_name</span>
    <span class="k">if</span> <span class="n">socket</span> <span class="ow">and</span> <span class="n">result</span><span class="p">:</span>
        <span class="c1"># publish messages</span>
        <span class="k">for</span> <span class="n">topic</span> <span class="ow">in</span> <span class="n">pub_topics</span><span class="p">:</span>
        <span class="c1"># for topic in result: # NOTE publish any returned value in dict with it's key as topic</span>
            <span class="k">if</span> <span class="n">topic</span> <span class="ow">in</span> <span class="n">result</span><span class="p">:</span>
                <span class="n">domain</span> <span class="o">=</span> <span class="n">domain</span> <span class="k">if</span> <span class="n">domain</span> <span class="k">else</span> <span class="n">domains</span><span class="p">[</span><span class="n">topic</span><span class="p">]</span>
                <span class="n">topic_domain_str</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="n">topic</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">domain</span><span class="si">}</span><span class="s2">"</span> <span class="k">if</span> <span class="n">domain</span> <span class="k">else</span> <span class="n">topic</span>
                <span class="k">if</span> <span class="n">topic</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_pub_topic_domains</span><span class="p">:</span>
                    <span class="n">topic_domain_str</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="n">topic</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_pub_topic_domains</span><span class="p">[</span><span class="n">topic</span><span class="p">]</span><span class="si">}</span><span class="s2">"</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_pub_topic_domains</span><span class="p">[</span><span class="n">topic</span><span class="p">]</span> <span class="k">else</span> <span class="n">topic</span>
                <span class="n">_send_msg</span><span class="p">(</span><span class="n">socket</span><span class="p">,</span> <span class="n">topic_domain_str</span><span class="p">,</span> <span class="n">result</span><span class="p">[</span><span class="n">topic</span><span class="p">])</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">debug_logger</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">debug_logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
                        <span class="sa">f</span><span class="s2">"- (DS): sent message from </span><span class="si">{</span><span class="n">func</span><span class="si">}</span><span class="s2"> to topic </span><span class="si">{</span><span class="n">topic_domain_str</span><span class="si">}</span><span class="s2">:</span><span class="se">\n</span><span class="s2">   </span><span class="si">{</span><span class="n">result</span><span class="p">[</span><span class="n">topic</span><span class="p">]</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">result</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h6 class="doc doc-heading" id="adviser.services.hci.speech.SpeechInputFeatureExtractor.SpeechInputFeatureExtractor.speech_to_features">
<code class="highlight language-python">
speech_to_features<span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> </code>
<a class="headerlink" href="#adviser.services.hci.speech.SpeechInputFeatureExtractor.SpeechInputFeatureExtractor.speech_to_features" title="Permanent link"></a></h6>
<div class="doc doc-contents">
<details class="quote">
<summary>Source code in <code>adviser/services/hci/speech/SpeechInputFeatureExtractor.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>551
552
553
554
555
556
557
558
559
560
561
562
563
564
565
566
567
568
569
570
571
572
573
574
575
576
577
578
579
580
581
582</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">delegate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="n">func_inst</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">func</span><span class="o">.</span><span class="vm">__name__</span><span class="p">)</span>

    <span class="n">callargs</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">args</span><span class="p">)</span>
    <span class="k">if</span> <span class="bp">self</span> <span class="ow">in</span> <span class="n">callargs</span><span class="p">:</span>    <span class="c1"># remove self when in *args, because already known to function</span>
        <span class="n">callargs</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">func</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">callargs</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">result</span><span class="p">:</span>
        <span class="c1"># fix! (user could have multiple "/" characters in topic - only use last one )</span>
        <span class="n">domains</span> <span class="o">=</span> <span class="p">{</span><span class="n">res</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">"/"</span><span class="p">)[</span><span class="mi">0</span><span class="p">]:</span> <span class="n">res</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">"/"</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span> <span class="k">if</span> <span class="s2">"/"</span> <span class="ow">in</span> <span class="n">res</span> <span class="k">else</span> <span class="s2">""</span> <span class="k">for</span> <span class="n">res</span> <span class="ow">in</span> <span class="n">result</span><span class="p">}</span>
        <span class="n">result</span> <span class="o">=</span> <span class="p">{</span><span class="n">key</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">"/"</span><span class="p">)[</span><span class="mi">0</span><span class="p">]:</span> <span class="n">result</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">result</span><span class="p">}</span>

    <span class="k">if</span> <span class="n">func_inst</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_publish_sockets</span><span class="p">:</span>
        <span class="c1"># not a publisher, just normal function</span>
        <span class="k">return</span> <span class="n">result</span>

    <span class="n">socket</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_publish_sockets</span><span class="p">[</span><span class="n">func_inst</span><span class="p">]</span>
    <span class="n">domain</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_domain_name</span>
    <span class="k">if</span> <span class="n">socket</span> <span class="ow">and</span> <span class="n">result</span><span class="p">:</span>
        <span class="c1"># publish messages</span>
        <span class="k">for</span> <span class="n">topic</span> <span class="ow">in</span> <span class="n">pub_topics</span><span class="p">:</span>
        <span class="c1"># for topic in result: # NOTE publish any returned value in dict with it's key as topic</span>
            <span class="k">if</span> <span class="n">topic</span> <span class="ow">in</span> <span class="n">result</span><span class="p">:</span>
                <span class="n">domain</span> <span class="o">=</span> <span class="n">domain</span> <span class="k">if</span> <span class="n">domain</span> <span class="k">else</span> <span class="n">domains</span><span class="p">[</span><span class="n">topic</span><span class="p">]</span>
                <span class="n">topic_domain_str</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="n">topic</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">domain</span><span class="si">}</span><span class="s2">"</span> <span class="k">if</span> <span class="n">domain</span> <span class="k">else</span> <span class="n">topic</span>
                <span class="k">if</span> <span class="n">topic</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_pub_topic_domains</span><span class="p">:</span>
                    <span class="n">topic_domain_str</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="n">topic</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_pub_topic_domains</span><span class="p">[</span><span class="n">topic</span><span class="p">]</span><span class="si">}</span><span class="s2">"</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_pub_topic_domains</span><span class="p">[</span><span class="n">topic</span><span class="p">]</span> <span class="k">else</span> <span class="n">topic</span>
                <span class="n">_send_msg</span><span class="p">(</span><span class="n">socket</span><span class="p">,</span> <span class="n">topic_domain_str</span><span class="p">,</span> <span class="n">result</span><span class="p">[</span><span class="n">topic</span><span class="p">])</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">debug_logger</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">debug_logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
                        <span class="sa">f</span><span class="s2">"- (DS): sent message from </span><span class="si">{</span><span class="n">func</span><span class="si">}</span><span class="s2"> to topic </span><span class="si">{</span><span class="n">topic_domain_str</span><span class="si">}</span><span class="s2">:</span><span class="se">\n</span><span class="s2">   </span><span class="si">{</span><span class="n">result</span><span class="p">[</span><span class="n">topic</span><span class="p">]</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">result</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h6 class="doc doc-heading" id="adviser.services.hci.speech.SpeechInputFeatureExtractor.SpeechInputFeatureExtractor.speech_to_mfcc">
<code class="highlight language-python">
speech_to_mfcc<span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> </code>
<a class="headerlink" href="#adviser.services.hci.speech.SpeechInputFeatureExtractor.SpeechInputFeatureExtractor.speech_to_mfcc" title="Permanent link"></a></h6>
<div class="doc doc-contents">
<details class="quote">
<summary>Source code in <code>adviser/services/hci/speech/SpeechInputFeatureExtractor.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>551
552
553
554
555
556
557
558
559
560
561
562
563
564
565
566
567
568
569
570
571
572
573
574
575
576
577
578
579
580
581
582</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">delegate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="n">func_inst</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">func</span><span class="o">.</span><span class="vm">__name__</span><span class="p">)</span>

    <span class="n">callargs</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">args</span><span class="p">)</span>
    <span class="k">if</span> <span class="bp">self</span> <span class="ow">in</span> <span class="n">callargs</span><span class="p">:</span>    <span class="c1"># remove self when in *args, because already known to function</span>
        <span class="n">callargs</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">func</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">callargs</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">result</span><span class="p">:</span>
        <span class="c1"># fix! (user could have multiple "/" characters in topic - only use last one )</span>
        <span class="n">domains</span> <span class="o">=</span> <span class="p">{</span><span class="n">res</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">"/"</span><span class="p">)[</span><span class="mi">0</span><span class="p">]:</span> <span class="n">res</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">"/"</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span> <span class="k">if</span> <span class="s2">"/"</span> <span class="ow">in</span> <span class="n">res</span> <span class="k">else</span> <span class="s2">""</span> <span class="k">for</span> <span class="n">res</span> <span class="ow">in</span> <span class="n">result</span><span class="p">}</span>
        <span class="n">result</span> <span class="o">=</span> <span class="p">{</span><span class="n">key</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">"/"</span><span class="p">)[</span><span class="mi">0</span><span class="p">]:</span> <span class="n">result</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">result</span><span class="p">}</span>

    <span class="k">if</span> <span class="n">func_inst</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_publish_sockets</span><span class="p">:</span>
        <span class="c1"># not a publisher, just normal function</span>
        <span class="k">return</span> <span class="n">result</span>

    <span class="n">socket</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_publish_sockets</span><span class="p">[</span><span class="n">func_inst</span><span class="p">]</span>
    <span class="n">domain</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_domain_name</span>
    <span class="k">if</span> <span class="n">socket</span> <span class="ow">and</span> <span class="n">result</span><span class="p">:</span>
        <span class="c1"># publish messages</span>
        <span class="k">for</span> <span class="n">topic</span> <span class="ow">in</span> <span class="n">pub_topics</span><span class="p">:</span>
        <span class="c1"># for topic in result: # NOTE publish any returned value in dict with it's key as topic</span>
            <span class="k">if</span> <span class="n">topic</span> <span class="ow">in</span> <span class="n">result</span><span class="p">:</span>
                <span class="n">domain</span> <span class="o">=</span> <span class="n">domain</span> <span class="k">if</span> <span class="n">domain</span> <span class="k">else</span> <span class="n">domains</span><span class="p">[</span><span class="n">topic</span><span class="p">]</span>
                <span class="n">topic_domain_str</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="n">topic</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">domain</span><span class="si">}</span><span class="s2">"</span> <span class="k">if</span> <span class="n">domain</span> <span class="k">else</span> <span class="n">topic</span>
                <span class="k">if</span> <span class="n">topic</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_pub_topic_domains</span><span class="p">:</span>
                    <span class="n">topic_domain_str</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="n">topic</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_pub_topic_domains</span><span class="p">[</span><span class="n">topic</span><span class="p">]</span><span class="si">}</span><span class="s2">"</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_pub_topic_domains</span><span class="p">[</span><span class="n">topic</span><span class="p">]</span> <span class="k">else</span> <span class="n">topic</span>
                <span class="n">_send_msg</span><span class="p">(</span><span class="n">socket</span><span class="p">,</span> <span class="n">topic_domain_str</span><span class="p">,</span> <span class="n">result</span><span class="p">[</span><span class="n">topic</span><span class="p">])</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">debug_logger</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">debug_logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
                        <span class="sa">f</span><span class="s2">"- (DS): sent message from </span><span class="si">{</span><span class="n">func</span><span class="si">}</span><span class="s2"> to topic </span><span class="si">{</span><span class="n">topic_domain_str</span><span class="si">}</span><span class="s2">:</span><span class="se">\n</span><span class="s2">   </span><span class="si">{</span><span class="n">result</span><span class="p">[</span><span class="n">topic</span><span class="p">]</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">result</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="doc doc-object doc-module">
<h4 class="doc doc-heading" id="adviser.services.hci.speech.SpeechOutputGenerator">
<code>SpeechOutputGenerator</code>
<a class="headerlink" href="#adviser.services.hci.speech.SpeechOutputGenerator" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<div class="doc doc-children">
<div class="doc doc-object doc-class">
<h5 class="doc doc-heading" id="adviser.services.hci.speech.SpeechOutputGenerator.SpeechOutputGenerator">
<code>SpeechOutputGenerator</code>
<a class="headerlink" href="#adviser.services.hci.speech.SpeechOutputGenerator.SpeechOutputGenerator" title="Permanent link"></a></h5>
<div class="doc doc-contents">
<div class="doc doc-children">
<div class="doc doc-object doc-method">
<h6 class="doc doc-heading" id="adviser.services.hci.speech.SpeechOutputGenerator.SpeechOutputGenerator.__init__">
<code class="highlight language-python">
__init__<span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">domain</span><span class="o">=</span><span class="s1">''</span><span class="p">,</span> <span class="n">identifier</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">use_cuda</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">sub_topic_domains</span><span class="o">=</span><span class="p">{})</span> </code>
<span class="doc doc-properties">
<small class="doc doc-property doc-property-special"><code>special</code></small>
</span>
<a class="headerlink" href="#adviser.services.hci.speech.SpeechOutputGenerator.SpeechOutputGenerator.__init__" title="Permanent link"></a></h6>
<div class="doc doc-contents">
<p>Text To Speech Module that reads out the system utterance.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>domain</code></td>
<td><code>Domain</code></td>
<td>
<p>Needed for Service, no meaning here</p>
</td>
<td><code>''</code></td>
</tr>
<tr>
<td><code>identifier</code></td>
<td><code>str</code></td>
<td>
<p>Needed for Service</p>
</td>
<td><code>None</code></td>
</tr>
<tr>
<td><code>use_cuda</code></td>
<td><code>boolean</code></td>
<td>
<p>Whether or not to perform computations on GPU. Highly recommended if available</p>
</td>
<td><code>False</code></td>
</tr>
<tr>
<td><code>sub_topic_domains</code></td>
<td><code>Dict[str, str]</code></td>
<td>
<p>see <code>services.service.Service</code> constructor for more details</p>
</td>
<td><code>{}</code></td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>adviser/services/hci/speech/SpeechOutputGenerator.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span> 45
 46
 47
 48
 49
 50
 51
 52
 53
 54
 55
 56
 57
 58
 59
 60
 61
 62
 63
 64
 65
 66
 67
 68
 69
 70
 71
 72
 73
 74
 75
 76
 77
 78
 79
 80
 81
 82
 83
 84
 85
 86
 87
 88
 89
 90
 91
 92
 93
 94
 95
 96
 97
 98
 99
100
101
102
103
104
105</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">domain</span><span class="p">:</span> <span class="n">Domain</span> <span class="o">=</span> <span class="s2">""</span><span class="p">,</span> <span class="n">identifier</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">use_cuda</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">sub_topic_domains</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}):</span>
    <span class="sd">"""</span>
<span class="sd">    Text To Speech Module that reads out the system utterance.</span>

<span class="sd">    Args:</span>
<span class="sd">        domain (Domain): Needed for Service, no meaning here</span>
<span class="sd">        identifier (string): Needed for Service</span>
<span class="sd">        use_cuda (boolean): Whether or not to perform computations on GPU. Highly recommended if available</span>
<span class="sd">        sub_topic_domains: see `services.service.Service` constructor for more details</span>
<span class="sd">    """</span>
    <span class="n">Service</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">domain</span><span class="o">=</span><span class="n">domain</span><span class="p">,</span> <span class="n">identifier</span><span class="o">=</span><span class="n">identifier</span><span class="p">,</span> <span class="n">sub_topic_domains</span><span class="o">=</span><span class="n">sub_topic_domains</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">models_directory</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">get_root_dir</span><span class="p">(),</span> <span class="s2">"resources"</span><span class="p">,</span> <span class="s2">"models"</span><span class="p">,</span> <span class="s2">"speech"</span><span class="p">)</span>

    <span class="c1"># The following lines can be changed to incorporate different models.</span>
    <span class="c1"># This is the only thing that needs to be changed for that, everything else should be dynamic.</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">transcription_type</span> <span class="o">=</span> <span class="s2">"phn"</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">dict_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">models_directory</span><span class="p">,</span>
                                  <span class="s2">"phn_train_no_dev_pytorch_train_fastspeech.v4"</span><span class="p">,</span> <span class="s2">"data"</span><span class="p">,</span> <span class="s2">"lang_1phn"</span><span class="p">,</span>
                                  <span class="s2">"train_no_dev_units.txt"</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">model_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">models_directory</span><span class="p">,</span>
                                   <span class="s2">"phn_train_no_dev_pytorch_train_fastspeech.v4"</span><span class="p">,</span> <span class="s2">"exp"</span><span class="p">,</span>
                                   <span class="s2">"phn_train_no_dev_pytorch_train_fastspeech.v4"</span><span class="p">,</span> <span class="s2">"results"</span><span class="p">,</span>
                                   <span class="s2">"model.last1.avg.best"</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">vocoder_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">models_directory</span><span class="p">,</span>
                                     <span class="s2">"ljspeech.parallel_wavegan.v1"</span><span class="p">,</span> <span class="s2">"checkpoint-400000steps.pkl"</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">vocoder_conf</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">models_directory</span><span class="p">,</span> <span class="s2">"ljspeech.parallel_wavegan.v1"</span><span class="p">,</span> <span class="s2">"config.yml"</span><span class="p">)</span>

    <span class="c1"># define device to run the synthesis on</span>
    <span class="k">if</span> <span class="n">use_cuda</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">device</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">device</span><span class="p">(</span><span class="s2">"cuda"</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">device</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">device</span><span class="p">(</span><span class="s2">"cpu"</span><span class="p">)</span>

    <span class="c1"># define end to end TTS model</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">input_dimensions</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">output_dimensions</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">train_args</span> <span class="o">=</span> <span class="n">get_model_conf</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model_path</span><span class="p">)</span>
    <span class="n">model_class</span> <span class="o">=</span> <span class="n">dynamic_import</span><span class="o">.</span><span class="n">dynamic_import</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">train_args</span><span class="o">.</span><span class="n">model_module</span><span class="p">)</span>
    <span class="n">model</span> <span class="o">=</span> <span class="n">model_class</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">input_dimensions</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">output_dimensions</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">train_args</span><span class="p">)</span>
    <span class="n">torch_load</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model_path</span><span class="p">,</span> <span class="n">model</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">model</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">eval</span><span class="p">()</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">device</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">inference_args</span> <span class="o">=</span> <span class="n">Namespace</span><span class="p">(</span><span class="o">**</span><span class="p">{</span><span class="s2">"threshold"</span><span class="p">:</span> <span class="mf">0.5</span><span class="p">,</span> <span class="s2">"minlenratio"</span><span class="p">:</span> <span class="mf">0.0</span><span class="p">,</span> <span class="s2">"maxlenratio"</span><span class="p">:</span> <span class="mf">10.0</span><span class="p">})</span>

    <span class="c1"># define neural vocoder</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">vocoder_conf</span><span class="p">)</span> <span class="k">as</span> <span class="n">vocoder_config_file</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">config</span> <span class="o">=</span> <span class="n">yaml</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">vocoder_config_file</span><span class="p">,</span> <span class="n">Loader</span><span class="o">=</span><span class="n">yaml</span><span class="o">.</span><span class="n">Loader</span><span class="p">)</span>
    <span class="n">vocoder</span> <span class="o">=</span> <span class="n">ParallelWaveGANGenerator</span><span class="p">(</span><span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s2">"generator_params"</span><span class="p">])</span>
    <span class="n">vocoder</span><span class="o">.</span><span class="n">load_state_dict</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">vocoder_path</span><span class="p">,</span> <span class="n">map_location</span><span class="o">=</span><span class="s2">"cpu"</span><span class="p">)[</span><span class="s2">"model"</span><span class="p">][</span><span class="s2">"generator"</span><span class="p">])</span>
    <span class="n">vocoder</span><span class="o">.</span><span class="n">remove_weight_norm</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">vocoder</span> <span class="o">=</span> <span class="n">vocoder</span><span class="o">.</span><span class="n">eval</span><span class="p">()</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">device</span><span class="p">)</span>

    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dict_path</span><span class="p">)</span> <span class="k">as</span> <span class="n">dictionary_file</span><span class="p">:</span>
        <span class="n">lines</span> <span class="o">=</span> <span class="n">dictionary_file</span><span class="o">.</span><span class="n">readlines</span><span class="p">()</span>
    <span class="n">lines</span> <span class="o">=</span> <span class="p">[</span><span class="n">line</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">"</span><span class="se">\n</span><span class="s2">"</span><span class="p">,</span> <span class="s2">""</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">" "</span><span class="p">)</span> <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">lines</span><span class="p">]</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">char_to_id</span> <span class="o">=</span> <span class="p">{</span><span class="n">c</span><span class="p">:</span> <span class="nb">int</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">c</span><span class="p">,</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">lines</span><span class="p">}</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">g2p</span> <span class="o">=</span> <span class="n">G2p</span><span class="p">()</span>

    <span class="c1"># download the pretrained Punkt tokenizer from NLTK. This is done only</span>
    <span class="c1"># the first time the code is executed on a machine, if it has been done</span>
    <span class="c1"># before, this line will be skipped and output a warning. We will probably</span>
    <span class="c1"># redirect warnings into a file rather than std_err in the future, since</span>
    <span class="c1"># there's also a lot of pytorch warnings going on etc.</span>
    <span class="n">nltk</span><span class="o">.</span><span class="n">download</span><span class="p">(</span><span class="s1">'punkt'</span><span class="p">,</span> <span class="n">quiet</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h6 class="doc doc-heading" id="adviser.services.hci.speech.SpeechOutputGenerator.SpeechOutputGenerator.generate_speech">
<code class="highlight language-python">
generate_speech<span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> </code>
<a class="headerlink" href="#adviser.services.hci.speech.SpeechOutputGenerator.SpeechOutputGenerator.generate_speech" title="Permanent link"></a></h6>
<div class="doc doc-contents">
<details class="quote">
<summary>Source code in <code>adviser/services/hci/speech/SpeechOutputGenerator.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>551
552
553
554
555
556
557
558
559
560
561
562
563
564
565
566
567
568
569
570
571
572
573
574
575
576
577
578
579
580
581
582</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">delegate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="n">func_inst</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">func</span><span class="o">.</span><span class="vm">__name__</span><span class="p">)</span>

    <span class="n">callargs</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">args</span><span class="p">)</span>
    <span class="k">if</span> <span class="bp">self</span> <span class="ow">in</span> <span class="n">callargs</span><span class="p">:</span>    <span class="c1"># remove self when in *args, because already known to function</span>
        <span class="n">callargs</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">func</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">callargs</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">result</span><span class="p">:</span>
        <span class="c1"># fix! (user could have multiple "/" characters in topic - only use last one )</span>
        <span class="n">domains</span> <span class="o">=</span> <span class="p">{</span><span class="n">res</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">"/"</span><span class="p">)[</span><span class="mi">0</span><span class="p">]:</span> <span class="n">res</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">"/"</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span> <span class="k">if</span> <span class="s2">"/"</span> <span class="ow">in</span> <span class="n">res</span> <span class="k">else</span> <span class="s2">""</span> <span class="k">for</span> <span class="n">res</span> <span class="ow">in</span> <span class="n">result</span><span class="p">}</span>
        <span class="n">result</span> <span class="o">=</span> <span class="p">{</span><span class="n">key</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">"/"</span><span class="p">)[</span><span class="mi">0</span><span class="p">]:</span> <span class="n">result</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">result</span><span class="p">}</span>

    <span class="k">if</span> <span class="n">func_inst</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_publish_sockets</span><span class="p">:</span>
        <span class="c1"># not a publisher, just normal function</span>
        <span class="k">return</span> <span class="n">result</span>

    <span class="n">socket</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_publish_sockets</span><span class="p">[</span><span class="n">func_inst</span><span class="p">]</span>
    <span class="n">domain</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_domain_name</span>
    <span class="k">if</span> <span class="n">socket</span> <span class="ow">and</span> <span class="n">result</span><span class="p">:</span>
        <span class="c1"># publish messages</span>
        <span class="k">for</span> <span class="n">topic</span> <span class="ow">in</span> <span class="n">pub_topics</span><span class="p">:</span>
        <span class="c1"># for topic in result: # NOTE publish any returned value in dict with it's key as topic</span>
            <span class="k">if</span> <span class="n">topic</span> <span class="ow">in</span> <span class="n">result</span><span class="p">:</span>
                <span class="n">domain</span> <span class="o">=</span> <span class="n">domain</span> <span class="k">if</span> <span class="n">domain</span> <span class="k">else</span> <span class="n">domains</span><span class="p">[</span><span class="n">topic</span><span class="p">]</span>
                <span class="n">topic_domain_str</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="n">topic</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">domain</span><span class="si">}</span><span class="s2">"</span> <span class="k">if</span> <span class="n">domain</span> <span class="k">else</span> <span class="n">topic</span>
                <span class="k">if</span> <span class="n">topic</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_pub_topic_domains</span><span class="p">:</span>
                    <span class="n">topic_domain_str</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="n">topic</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_pub_topic_domains</span><span class="p">[</span><span class="n">topic</span><span class="p">]</span><span class="si">}</span><span class="s2">"</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_pub_topic_domains</span><span class="p">[</span><span class="n">topic</span><span class="p">]</span> <span class="k">else</span> <span class="n">topic</span>
                <span class="n">_send_msg</span><span class="p">(</span><span class="n">socket</span><span class="p">,</span> <span class="n">topic_domain_str</span><span class="p">,</span> <span class="n">result</span><span class="p">[</span><span class="n">topic</span><span class="p">])</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">debug_logger</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">debug_logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
                        <span class="sa">f</span><span class="s2">"- (DS): sent message from </span><span class="si">{</span><span class="n">func</span><span class="si">}</span><span class="s2"> to topic </span><span class="si">{</span><span class="n">topic_domain_str</span><span class="si">}</span><span class="s2">:</span><span class="se">\n</span><span class="s2">   </span><span class="si">{</span><span class="n">result</span><span class="p">[</span><span class="n">topic</span><span class="p">]</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">result</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h6 class="doc doc-heading" id="adviser.services.hci.speech.SpeechOutputGenerator.SpeechOutputGenerator.preprocess_text_input">
<code class="highlight language-python">
preprocess_text_input<span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">text</span><span class="p">)</span> </code>
<a class="headerlink" href="#adviser.services.hci.speech.SpeechOutputGenerator.SpeechOutputGenerator.preprocess_text_input" title="Permanent link"></a></h6>
<div class="doc doc-contents">
<p>Clean the text and then convert it to id sequence.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>text</code></td>
<td><code>string</code></td>
<td>
<p>The text to preprocess</p>
</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>adviser/services/hci/speech/SpeechOutputGenerator.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">preprocess_text_input</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">text</span><span class="p">):</span>
    <span class="sd">"""</span>
<span class="sd">    Clean the text and then convert it to id sequence.</span>

<span class="sd">    Args:</span>
<span class="sd">        text (string): The text to preprocess</span>
<span class="sd">    """</span>
    <span class="n">text</span> <span class="o">=</span> <span class="n">custom_english_cleaners</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>  <span class="c1"># cleans the text</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">transcription_type</span> <span class="o">==</span> <span class="s2">"phn"</span><span class="p">:</span>  <span class="c1"># depending on the model type, different preprocessing is needed.</span>
        <span class="n">text</span> <span class="o">=</span> <span class="nb">filter</span><span class="p">(</span><span class="k">lambda</span> <span class="n">s</span><span class="p">:</span> <span class="n">s</span> <span class="o">!=</span> <span class="s2">" "</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">g2p</span><span class="p">(</span><span class="n">text</span><span class="p">))</span>
        <span class="n">text</span> <span class="o">=</span> <span class="s2">" "</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>
        <span class="n">char_sequence</span> <span class="o">=</span> <span class="n">text</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">" "</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">char_sequence</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>
    <span class="n">id_sequence</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">char_sequence</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">c</span><span class="o">.</span><span class="n">isspace</span><span class="p">():</span>
            <span class="n">id_sequence</span> <span class="o">+=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">char_to_id</span><span class="p">[</span><span class="s2">"&lt;space&gt;"</span><span class="p">]]</span>
        <span class="k">elif</span> <span class="n">c</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">char_to_id</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="n">id_sequence</span> <span class="o">+=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">char_to_id</span><span class="p">[</span><span class="s2">"&lt;unk&gt;"</span><span class="p">]]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">id_sequence</span> <span class="o">+=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">char_to_id</span><span class="p">[</span><span class="n">c</span><span class="p">]]</span>
    <span class="n">id_sequence</span> <span class="o">+=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">input_dimensions</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>  <span class="c1"># &lt;eos&gt;</span>
    <span class="k">return</span> <span class="n">torch</span><span class="o">.</span><span class="n">LongTensor</span><span class="p">(</span><span class="n">id_sequence</span><span class="p">)</span><span class="o">.</span><span class="n">view</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">device</span><span class="p">)</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
</div>
</div>
</div>
<div class="doc doc-object doc-function">
<h5 class="doc doc-heading" id="adviser.services.hci.speech.SpeechOutputGenerator.get_root_dir">
<code class="highlight language-python">
get_root_dir<span class="p">()</span> </code>
<a class="headerlink" href="#adviser.services.hci.speech.SpeechOutputGenerator.get_root_dir" title="Permanent link"></a></h5>
<div class="doc doc-contents">
<details class="quote">
<summary>Source code in <code>adviser/services/hci/speech/SpeechOutputGenerator.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>39
40</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">get_root_dir</span><span class="p">():</span>
    <span class="k">return</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="vm">__file__</span><span class="p">)))))</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
</div>
</div>
</div>
<div class="doc doc-object doc-module">
<h4 class="doc doc-heading" id="adviser.services.hci.speech.SpeechOutputPlayer">
<code>SpeechOutputPlayer</code>
<a class="headerlink" href="#adviser.services.hci.speech.SpeechOutputPlayer" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<div class="doc doc-children">
<div class="doc doc-object doc-class">
<h5 class="doc doc-heading" id="adviser.services.hci.speech.SpeechOutputPlayer.SpeechOutputPlayer">
<code>SpeechOutputPlayer</code>
<a class="headerlink" href="#adviser.services.hci.speech.SpeechOutputPlayer.SpeechOutputPlayer" title="Permanent link"></a></h5>
<div class="doc doc-contents">
<div class="doc doc-children">
<div class="doc doc-object doc-method">
<h6 class="doc doc-heading" id="adviser.services.hci.speech.SpeechOutputPlayer.SpeechOutputPlayer.__init__">
<code class="highlight language-python">
__init__<span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">domain</span><span class="o">=</span><span class="s1">''</span><span class="p">,</span> <span class="n">conversation_log_dir</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">identifier</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span> </code>
<span class="doc doc-properties">
<small class="doc doc-property doc-property-special"><code>special</code></small>
</span>
<a class="headerlink" href="#adviser.services.hci.speech.SpeechOutputPlayer.SpeechOutputPlayer.__init__" title="Permanent link"></a></h6>
<div class="doc doc-contents">
<p>Service that plays the system utterance as sound</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>domain</code></td>
<td><code>Domain</code></td>
<td>
<p>Needed for Service, but has no meaning here</p>
</td>
<td><code>''</code></td>
</tr>
<tr>
<td><code>conversation_log_dir</code></td>
<td><code>str</code></td>
<td>
<p>If this is provided it will create log files in the specified directory.</p>
</td>
<td><code>None</code></td>
</tr>
<tr>
<td><code>identifier</code></td>
<td><code>str</code></td>
<td>
<p>Needed for Service.</p>
</td>
<td><code>None</code></td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>adviser/services/hci/speech/SpeechOutputPlayer.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>35
36
37
38
39
40
41
42
43
44
45
46</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">domain</span><span class="p">:</span> <span class="n">Domain</span> <span class="o">=</span> <span class="s2">""</span><span class="p">,</span> <span class="n">conversation_log_dir</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">identifier</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
    <span class="sd">"""</span>
<span class="sd">    Service that plays the system utterance as sound</span>

<span class="sd">    Args:</span>
<span class="sd">        domain (Domain): Needed for Service, but has no meaning here</span>
<span class="sd">        conversation_log_dir (string): If this is provided it will create log files in the specified directory.</span>
<span class="sd">        identifier (string): Needed for Service.</span>
<span class="sd">    """</span>
    <span class="n">Service</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">domain</span><span class="o">=</span><span class="n">domain</span><span class="p">,</span> <span class="n">identifier</span><span class="o">=</span><span class="n">identifier</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">conversation_log_dir</span> <span class="o">=</span> <span class="n">conversation_log_dir</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">interaction_count</span> <span class="o">=</span> <span class="mi">0</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h6 class="doc doc-heading" id="adviser.services.hci.speech.SpeechOutputPlayer.SpeechOutputPlayer.speak">
<code class="highlight language-python">
speak<span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> </code>
<a class="headerlink" href="#adviser.services.hci.speech.SpeechOutputPlayer.SpeechOutputPlayer.speak" title="Permanent link"></a></h6>
<div class="doc doc-contents">
<details class="quote">
<summary>Source code in <code>adviser/services/hci/speech/SpeechOutputPlayer.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>551
552
553
554
555
556
557
558
559
560
561
562
563
564
565
566
567
568
569
570
571
572
573
574
575
576
577
578
579
580
581
582</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">delegate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="n">func_inst</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">func</span><span class="o">.</span><span class="vm">__name__</span><span class="p">)</span>

    <span class="n">callargs</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">args</span><span class="p">)</span>
    <span class="k">if</span> <span class="bp">self</span> <span class="ow">in</span> <span class="n">callargs</span><span class="p">:</span>    <span class="c1"># remove self when in *args, because already known to function</span>
        <span class="n">callargs</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">func</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">callargs</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">result</span><span class="p">:</span>
        <span class="c1"># fix! (user could have multiple "/" characters in topic - only use last one )</span>
        <span class="n">domains</span> <span class="o">=</span> <span class="p">{</span><span class="n">res</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">"/"</span><span class="p">)[</span><span class="mi">0</span><span class="p">]:</span> <span class="n">res</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">"/"</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span> <span class="k">if</span> <span class="s2">"/"</span> <span class="ow">in</span> <span class="n">res</span> <span class="k">else</span> <span class="s2">""</span> <span class="k">for</span> <span class="n">res</span> <span class="ow">in</span> <span class="n">result</span><span class="p">}</span>
        <span class="n">result</span> <span class="o">=</span> <span class="p">{</span><span class="n">key</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">"/"</span><span class="p">)[</span><span class="mi">0</span><span class="p">]:</span> <span class="n">result</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">result</span><span class="p">}</span>

    <span class="k">if</span> <span class="n">func_inst</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_publish_sockets</span><span class="p">:</span>
        <span class="c1"># not a publisher, just normal function</span>
        <span class="k">return</span> <span class="n">result</span>

    <span class="n">socket</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_publish_sockets</span><span class="p">[</span><span class="n">func_inst</span><span class="p">]</span>
    <span class="n">domain</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_domain_name</span>
    <span class="k">if</span> <span class="n">socket</span> <span class="ow">and</span> <span class="n">result</span><span class="p">:</span>
        <span class="c1"># publish messages</span>
        <span class="k">for</span> <span class="n">topic</span> <span class="ow">in</span> <span class="n">pub_topics</span><span class="p">:</span>
        <span class="c1"># for topic in result: # NOTE publish any returned value in dict with it's key as topic</span>
            <span class="k">if</span> <span class="n">topic</span> <span class="ow">in</span> <span class="n">result</span><span class="p">:</span>
                <span class="n">domain</span> <span class="o">=</span> <span class="n">domain</span> <span class="k">if</span> <span class="n">domain</span> <span class="k">else</span> <span class="n">domains</span><span class="p">[</span><span class="n">topic</span><span class="p">]</span>
                <span class="n">topic_domain_str</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="n">topic</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">domain</span><span class="si">}</span><span class="s2">"</span> <span class="k">if</span> <span class="n">domain</span> <span class="k">else</span> <span class="n">topic</span>
                <span class="k">if</span> <span class="n">topic</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_pub_topic_domains</span><span class="p">:</span>
                    <span class="n">topic_domain_str</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="n">topic</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_pub_topic_domains</span><span class="p">[</span><span class="n">topic</span><span class="p">]</span><span class="si">}</span><span class="s2">"</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_pub_topic_domains</span><span class="p">[</span><span class="n">topic</span><span class="p">]</span> <span class="k">else</span> <span class="n">topic</span>
                <span class="n">_send_msg</span><span class="p">(</span><span class="n">socket</span><span class="p">,</span> <span class="n">topic_domain_str</span><span class="p">,</span> <span class="n">result</span><span class="p">[</span><span class="n">topic</span><span class="p">])</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">debug_logger</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">debug_logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
                        <span class="sa">f</span><span class="s2">"- (DS): sent message from </span><span class="si">{</span><span class="n">func</span><span class="si">}</span><span class="s2"> to topic </span><span class="si">{</span><span class="n">topic_domain_str</span><span class="si">}</span><span class="s2">:</span><span class="se">\n</span><span class="s2">   </span><span class="si">{</span><span class="n">result</span><span class="p">[</span><span class="n">topic</span><span class="p">]</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">result</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="doc doc-object doc-module">
<h4 class="doc doc-heading" id="adviser.services.hci.speech.SpeechRecorder">
<code>SpeechRecorder</code>
<a class="headerlink" href="#adviser.services.hci.speech.SpeechRecorder" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<div class="doc doc-children">
<div class="doc doc-object doc-class">
<h5 class="doc doc-heading" id="adviser.services.hci.speech.SpeechRecorder.SpeechRecorder">
<code>SpeechRecorder</code>
<a class="headerlink" href="#adviser.services.hci.speech.SpeechRecorder.SpeechRecorder" title="Permanent link"></a></h5>
<div class="doc doc-contents">
<div class="doc doc-children">
<div class="doc doc-object doc-method">
<h6 class="doc doc-heading" id="adviser.services.hci.speech.SpeechRecorder.SpeechRecorder.__init__">
<code class="highlight language-python">
__init__<span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">domain</span><span class="o">=</span><span class="s1">''</span><span class="p">,</span> <span class="n">conversation_log_dir</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">enable_plotting</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">threshold</span><span class="o">=</span><span class="mi">8000</span><span class="p">,</span> <span class="n">voice_privacy</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">identifier</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span> </code>
<span class="doc doc-properties">
<small class="doc doc-property doc-property-special"><code>special</code></small>
</span>
<a class="headerlink" href="#adviser.services.hci.speech.SpeechRecorder.SpeechRecorder.__init__" title="Permanent link"></a></h6>
<div class="doc doc-contents">
<p>A service that can record a microphone upon a key pressing event 
and publish the result as an array. The end of the utterance is 
detected automatically, also the voice can be masked to alleviate 
privacy issues.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>domain</code></td>
<td><code>Union[str, utils.domain.domain.Domain]</code></td>
<td>
<p>I don't know why this is here. Service needs it, but it means nothing in this context.</p>
</td>
<td><code>''</code></td>
</tr>
<tr>
<td><code>conversation_log_dir</code></td>
<td><code>str</code></td>
<td>
<p>If this parameter is given, log files of the conversation will be created in this directory</p>
</td>
<td><code>None</code></td>
</tr>
<tr>
<td><code>enable_plotting</code></td>
<td><code>bool</code></td>
<td>
<p>If this is set to True, the recorder is no longer real time able and thus the recordings don't work properly. This is just to be used to tune the threshold for the end of utterance detection, not during deployment.</p>
</td>
<td><code>False</code></td>
</tr>
<tr>
<td><code>threshold</code></td>
<td><code>int</code></td>
<td>
<p>The threshold below which the assumption of the end of utterance detection is silence</p>
</td>
<td><code>8000</code></td>
</tr>
<tr>
<td><code>voice_privacy</code></td>
<td><code>bool</code></td>
<td>
<p>Whether or not to enable the masking of the users voice</p>
</td>
<td><code>False</code></td>
</tr>
<tr>
<td><code>identifier</code></td>
<td><code>str</code></td>
<td>
<p>I don't know why this is here. Service needs it.</p>
</td>
<td><code>None</code></td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>adviser/services/hci/speech/SpeechRecorder.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">domain</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Domain</span><span class="p">]</span> <span class="o">=</span> <span class="s2">""</span><span class="p">,</span> <span class="n">conversation_log_dir</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">enable_plotting</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">threshold</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">8000</span><span class="p">,</span>
             <span class="n">voice_privacy</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">identifier</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
    <span class="sd">"""</span>
<span class="sd">    A service that can record a microphone upon a key pressing event </span>
<span class="sd">    and publish the result as an array. The end of the utterance is </span>
<span class="sd">    detected automatically, also the voice can be masked to alleviate </span>
<span class="sd">    privacy issues.</span>

<span class="sd">    Args:</span>
<span class="sd">        domain (Domain): I don't know why this is here. Service needs it, but it means nothing in this context.</span>
<span class="sd">        conversation_log_dir (string): If this parameter is given, log files of the conversation will be created in this directory</span>
<span class="sd">        enable_plotting (boolean): If this is set to True, the recorder is no longer real time able and thus the recordings don't work properly. This is just to be used to tune the threshold for the end of utterance detection, not during deployment.</span>
<span class="sd">        threshold (int): The threshold below which the assumption of the end of utterance detection is silence</span>
<span class="sd">        voice_privacy (boolean): Whether or not to enable the masking of the users voice</span>
<span class="sd">        identifier (string): I don't know why this is here. Service needs it.</span>
<span class="sd">    """</span>
    <span class="n">Service</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">domain</span><span class="o">=</span><span class="n">domain</span><span class="p">,</span> <span class="n">identifier</span><span class="o">=</span><span class="n">identifier</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">conversation_log_dir</span> <span class="o">=</span> <span class="n">conversation_log_dir</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">recording_indicator</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">audio_interface</span> <span class="o">=</span> <span class="n">pyaudio</span><span class="o">.</span><span class="n">PyAudio</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">push_to_talk_listener</span> <span class="o">=</span> <span class="n">keyboard</span><span class="o">.</span><span class="n">Listener</span><span class="p">(</span><span class="n">on_press</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">start_recording</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">threshold</span> <span class="o">=</span> <span class="n">threshold</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">enable_plotting</span> <span class="o">=</span> <span class="n">enable_plotting</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">voice_privacy</span> <span class="o">=</span> <span class="n">voice_privacy</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h6 class="doc doc-heading" id="adviser.services.hci.speech.SpeechRecorder.SpeechRecorder.record_user_utterance">
<code class="highlight language-python">
record_user_utterance<span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> </code>
<a class="headerlink" href="#adviser.services.hci.speech.SpeechRecorder.SpeechRecorder.record_user_utterance" title="Permanent link"></a></h6>
<div class="doc doc-contents">
<details class="quote">
<summary>Source code in <code>adviser/services/hci/speech/SpeechRecorder.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>551
552
553
554
555
556
557
558
559
560
561
562
563
564
565
566
567
568
569
570
571
572
573
574
575
576
577
578
579
580
581
582</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">delegate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="n">func_inst</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">func</span><span class="o">.</span><span class="vm">__name__</span><span class="p">)</span>

    <span class="n">callargs</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">args</span><span class="p">)</span>
    <span class="k">if</span> <span class="bp">self</span> <span class="ow">in</span> <span class="n">callargs</span><span class="p">:</span>    <span class="c1"># remove self when in *args, because already known to function</span>
        <span class="n">callargs</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">func</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">callargs</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">result</span><span class="p">:</span>
        <span class="c1"># fix! (user could have multiple "/" characters in topic - only use last one )</span>
        <span class="n">domains</span> <span class="o">=</span> <span class="p">{</span><span class="n">res</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">"/"</span><span class="p">)[</span><span class="mi">0</span><span class="p">]:</span> <span class="n">res</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">"/"</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span> <span class="k">if</span> <span class="s2">"/"</span> <span class="ow">in</span> <span class="n">res</span> <span class="k">else</span> <span class="s2">""</span> <span class="k">for</span> <span class="n">res</span> <span class="ow">in</span> <span class="n">result</span><span class="p">}</span>
        <span class="n">result</span> <span class="o">=</span> <span class="p">{</span><span class="n">key</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">"/"</span><span class="p">)[</span><span class="mi">0</span><span class="p">]:</span> <span class="n">result</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">result</span><span class="p">}</span>

    <span class="k">if</span> <span class="n">func_inst</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_publish_sockets</span><span class="p">:</span>
        <span class="c1"># not a publisher, just normal function</span>
        <span class="k">return</span> <span class="n">result</span>

    <span class="n">socket</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_publish_sockets</span><span class="p">[</span><span class="n">func_inst</span><span class="p">]</span>
    <span class="n">domain</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_domain_name</span>
    <span class="k">if</span> <span class="n">socket</span> <span class="ow">and</span> <span class="n">result</span><span class="p">:</span>
        <span class="c1"># publish messages</span>
        <span class="k">for</span> <span class="n">topic</span> <span class="ow">in</span> <span class="n">pub_topics</span><span class="p">:</span>
        <span class="c1"># for topic in result: # NOTE publish any returned value in dict with it's key as topic</span>
            <span class="k">if</span> <span class="n">topic</span> <span class="ow">in</span> <span class="n">result</span><span class="p">:</span>
                <span class="n">domain</span> <span class="o">=</span> <span class="n">domain</span> <span class="k">if</span> <span class="n">domain</span> <span class="k">else</span> <span class="n">domains</span><span class="p">[</span><span class="n">topic</span><span class="p">]</span>
                <span class="n">topic_domain_str</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="n">topic</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">domain</span><span class="si">}</span><span class="s2">"</span> <span class="k">if</span> <span class="n">domain</span> <span class="k">else</span> <span class="n">topic</span>
                <span class="k">if</span> <span class="n">topic</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_pub_topic_domains</span><span class="p">:</span>
                    <span class="n">topic_domain_str</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="n">topic</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_pub_topic_domains</span><span class="p">[</span><span class="n">topic</span><span class="p">]</span><span class="si">}</span><span class="s2">"</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_pub_topic_domains</span><span class="p">[</span><span class="n">topic</span><span class="p">]</span> <span class="k">else</span> <span class="n">topic</span>
                <span class="n">_send_msg</span><span class="p">(</span><span class="n">socket</span><span class="p">,</span> <span class="n">topic_domain_str</span><span class="p">,</span> <span class="n">result</span><span class="p">[</span><span class="n">topic</span><span class="p">])</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">debug_logger</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">debug_logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
                        <span class="sa">f</span><span class="s2">"- (DS): sent message from </span><span class="si">{</span><span class="n">func</span><span class="si">}</span><span class="s2"> to topic </span><span class="si">{</span><span class="n">topic_domain_str</span><span class="si">}</span><span class="s2">:</span><span class="se">\n</span><span class="s2">   </span><span class="si">{</span><span class="n">result</span><span class="p">[</span><span class="n">topic</span><span class="p">]</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">result</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h6 class="doc doc-heading" id="adviser.services.hci.speech.SpeechRecorder.SpeechRecorder.start_recorder">
<code class="highlight language-python">
start_recorder<span class="p">(</span><span class="bp">self</span><span class="p">)</span> </code>
<a class="headerlink" href="#adviser.services.hci.speech.SpeechRecorder.SpeechRecorder.start_recorder" title="Permanent link"></a></h6>
<div class="doc doc-contents">
<p>Starts the listener and outputs that the speech recorder is ready for use</p>
<details class="quote">
<summary>Source code in <code>adviser/services/hci/speech/SpeechRecorder.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>137
138
139
140
141
142
143</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">start_recorder</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">"""</span>
<span class="sd">    Starts the listener and outputs that the speech recorder is ready for use</span>
<span class="sd">    """</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">push_to_talk_listener</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">"To speak to the system, tap your right [CTRL] or [CMD] key.</span><span class="se">\n</span><span class="s2">"</span>
          <span class="s2">"It will try to automatically detect when your utterance is over.</span><span class="se">\n</span><span class="s2">"</span><span class="p">)</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h6 class="doc doc-heading" id="adviser.services.hci.speech.SpeechRecorder.SpeechRecorder.start_recording">
<code class="highlight language-python">
start_recording<span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">)</span> </code>
<a class="headerlink" href="#adviser.services.hci.speech.SpeechRecorder.SpeechRecorder.start_recording" title="Permanent link"></a></h6>
<div class="doc doc-contents">
<p>This method is a callback of the push to talk key
listener. It calls the recorder, if it's not already recording.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>key</code></td>
<td><code>Key</code></td>
<td>
<p>The pressed key</p>
</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>adviser/services/hci/speech/SpeechRecorder.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>126
127
128
129
130
131
132
133
134
135</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">start_recording</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
    <span class="sd">"""</span>
<span class="sd">    This method is a callback of the push to talk key</span>
<span class="sd">    listener. It calls the recorder, if it's not already recording.</span>

<span class="sd">    Args:</span>
<span class="sd">        key (Key): The pressed key</span>
<span class="sd">    """</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">key</span> <span class="ow">is</span> <span class="n">keyboard</span><span class="o">.</span><span class="n">Key</span><span class="o">.</span><span class="n">cmd_r</span> <span class="ow">or</span> <span class="n">key</span> <span class="ow">is</span> <span class="n">keyboard</span><span class="o">.</span><span class="n">Key</span><span class="o">.</span><span class="n">ctrl_r</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">recording_indicator</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">record_user_utterance</span><span class="p">()</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h6 class="doc doc-heading" id="adviser.services.hci.speech.SpeechRecorder.SpeechRecorder.threshold_plotter_generator">
<code class="highlight language-python">
threshold_plotter_generator<span class="p">(</span><span class="bp">self</span><span class="p">)</span> </code>
<a class="headerlink" href="#adviser.services.hci.speech.SpeechRecorder.SpeechRecorder.threshold_plotter_generator" title="Permanent link"></a></h6>
<div class="doc doc-contents">
<p>Generates a plotter to visualize when the signal is above the set threshold</p>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>function</code></td>
<td>
<p>Plots the threshold with the current continuous waveform</p>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>adviser/services/hci/speech/SpeechRecorder.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">threshold_plotter_generator</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">"""</span>
<span class="sd">    Generates a plotter to visualize when the signal is above the set threshold</span>

<span class="sd">    Returns:</span>
<span class="sd">        function: Plots the threshold with the current continuous waveform</span>
<span class="sd">    """</span>
    <span class="kn">import</span> <span class="nn">matplotlib</span>
    <span class="n">matplotlib</span><span class="o">.</span><span class="n">use</span><span class="p">(</span><span class="s1">'TkAgg'</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">threshold</span><span class="p">,</span> <span class="n">xmin</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">xmax</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">'r'</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="n">y</span><span class="o">=-</span><span class="bp">self</span><span class="o">.</span><span class="n">threshold</span><span class="p">,</span> <span class="n">xmin</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">xmax</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">'r'</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">pause</span><span class="p">(</span><span class="mf">0.000000000001</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">threshold_plotter</span><span class="p">(</span><span class="n">data</span><span class="p">):</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">clf</span><span class="p">()</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">axis</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">),</span> <span class="o">-</span><span class="mi">20000</span><span class="p">,</span> <span class="mi">20000</span><span class="p">])</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">'b'</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">threshold</span><span class="p">,</span> <span class="n">xmin</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">xmax</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">'r'</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="n">y</span><span class="o">=-</span><span class="bp">self</span><span class="o">.</span><span class="n">threshold</span><span class="p">,</span> <span class="n">xmin</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">xmax</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">'r'</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">pause</span><span class="p">(</span><span class="mf">0.000000000001</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">threshold_plotter</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
</div>
</div>
</div>
<div class="doc doc-object doc-function">
<h5 class="doc doc-heading" id="adviser.services.hci.speech.SpeechRecorder.voice_sanitizer">
<code class="highlight language-python">
voice_sanitizer<span class="p">(</span><span class="n">audio</span><span class="p">)</span> </code>
<a class="headerlink" href="#adviser.services.hci.speech.SpeechRecorder.voice_sanitizer" title="Permanent link"></a></h5>
<div class="doc doc-contents">
<p>While this is by no means a good voice sanitizer,
it works as a proof of concept. It randomly shifts
the spectrogram of a speakers utterance up or down,
making automatic speaker identification much harder
while keeping impact on asr performance as low as
possible. The use should be turned off by default.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>audio</code></td>
<td><code>np.array</code></td>
<td>
<p>The audio represented as array</p>
</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>np.array</code></td>
<td>
<p>The mutated audio as array</p>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>adviser/services/hci/speech/SpeechRecorder.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>171
172
173
174
175
176
177
178
179
180
181
182
183
184
185
186
187
188
189
190
191
192
193
194
195
196
197
198
199
200
201
202
203
204</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">voice_sanitizer</span><span class="p">(</span><span class="n">audio</span><span class="p">):</span>
    <span class="sd">"""</span>
<span class="sd">    While this is by no means a good voice sanitizer,</span>
<span class="sd">    it works as a proof of concept. It randomly shifts</span>
<span class="sd">    the spectrogram of a speakers utterance up or down,</span>
<span class="sd">    making automatic speaker identification much harder</span>
<span class="sd">    while keeping impact on asr performance as low as</span>
<span class="sd">    possible. The use should be turned off by default.</span>

<span class="sd">    Args:</span>
<span class="sd">        audio (np.array): The audio represented as array</span>

<span class="sd">    Returns:</span>
<span class="sd">        np.array: The mutated audio as array</span>
<span class="sd">    """</span>
    <span class="n">spectrogram</span> <span class="o">=</span> <span class="n">librosa</span><span class="o">.</span><span class="n">stft</span><span class="p">(</span><span class="n">audio</span><span class="p">)</span>
    <span class="n">voice_shift</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">6</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">([</span><span class="kc">True</span><span class="p">,</span> <span class="kc">False</span><span class="p">]):</span>
        <span class="k">for</span> <span class="n">frequency_index</span><span class="p">,</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">spectrogram</span><span class="p">):</span>
            <span class="c1"># mutate the voice to be higher</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">spectrogram</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">spectrogram</span><span class="p">)</span> <span class="o">-</span> <span class="p">(</span><span class="n">frequency_index</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)]</span> <span class="o">=</span> <span class="n">spectrogram</span><span class="p">[</span>
                    <span class="nb">len</span><span class="p">(</span><span class="n">spectrogram</span><span class="p">)</span> <span class="o">-</span> <span class="p">(</span><span class="n">frequency_index</span> <span class="o">+</span> <span class="mi">1</span> <span class="o">+</span> <span class="n">voice_shift</span><span class="p">)]</span>
            <span class="k">except</span> <span class="ne">IndexError</span><span class="p">:</span>
                <span class="k">pass</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">frequency_index</span><span class="p">,</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">spectrogram</span><span class="p">):</span>
            <span class="c1"># mutate the voice to be lower</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">spectrogram</span><span class="p">[</span><span class="n">frequency_index</span><span class="p">]</span> <span class="o">=</span> <span class="n">spectrogram</span><span class="p">[</span><span class="n">frequency_index</span> <span class="o">+</span> <span class="n">voice_shift</span><span class="p">]</span>
            <span class="k">except</span> <span class="ne">IndexError</span><span class="p">:</span>
                <span class="k">pass</span>

    <span class="k">return</span> <span class="n">librosa</span><span class="o">.</span><span class="n">istft</span><span class="p">(</span><span class="n">spectrogram</span><span class="p">)</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="doc doc-object doc-module">
<h3 class="doc doc-heading" id="adviser.services.hci.video">
<code>video</code>
<span class="doc doc-properties">
<small class="doc doc-property doc-property-special"><code>special</code></small>
</span>
<a class="headerlink" href="#adviser.services.hci.video" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<div class="doc doc-children">
<div class="doc doc-object doc-module">
<h4 class="doc doc-heading" id="adviser.services.hci.video.FeatureExtractor">
<code>FeatureExtractor</code>
<a class="headerlink" href="#adviser.services.hci.video.FeatureExtractor" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>Feature extraction with openSMILE</p>
<div class="doc doc-children">
<div class="doc doc-object doc-class">
<h5 class="doc doc-heading" id="adviser.services.hci.video.FeatureExtractor.VideoFeatureExtractor">
<code>VideoFeatureExtractor</code>
<a class="headerlink" href="#adviser.services.hci.video.FeatureExtractor.VideoFeatureExtractor" title="Permanent link"></a></h5>
<div class="doc doc-contents">
<p>TODO</p>
<div class="doc doc-children">
<div class="doc doc-object doc-method">
<h6 class="doc doc-heading" id="adviser.services.hci.video.FeatureExtractor.VideoFeatureExtractor.__init__">
<code class="highlight language-python">
__init__<span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">domain</span><span class="o">=</span><span class="s1">''</span><span class="p">)</span> </code>
<span class="doc doc-properties">
<small class="doc doc-property doc-property-special"><code>special</code></small>
</span>
<a class="headerlink" href="#adviser.services.hci.video.FeatureExtractor.VideoFeatureExtractor.__init__" title="Permanent link"></a></h6>
<div class="doc doc-contents">
<details class="quote">
<summary>Source code in <code>adviser/services/hci/video/FeatureExtractor.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>38
39
40
41
42
43
44
45
46
47</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">domain</span><span class="p">:</span> <span class="n">Domain</span> <span class="o">=</span> <span class="s2">""</span><span class="p">):</span>
    <span class="n">Service</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">domain</span><span class="o">=</span><span class="n">domain</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">module_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="vm">__file__</span><span class="p">))</span>
    <span class="c1"># # CLAHE (Contrast Limited Adaptive Histogram Equalization)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">CLAHE</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">createCLAHE</span><span class="p">(</span><span class="n">clipLimit</span><span class="o">=</span><span class="mf">2.0</span><span class="p">,</span> <span class="n">tileGridSize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">8</span><span class="p">))</span>
    <span class="c1"># for detecting faces (returns coordinates of rectangle(s) of face area(s))</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">DETECTOR</span> <span class="o">=</span> <span class="n">dlib</span><span class="o">.</span><span class="n">get_frontal_face_detector</span><span class="p">()</span>
    <span class="c1"># facial landmark predictor</span>
    <span class="n">predictor_file</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">module_dir</span><span class="p">,</span> <span class="s1">'..'</span><span class="p">,</span> <span class="s1">'..'</span><span class="p">,</span> <span class="s1">'..'</span><span class="p">,</span> <span class="s1">'resources'</span><span class="p">,</span> <span class="s1">'models'</span><span class="p">,</span> <span class="s1">'video'</span><span class="p">,</span> <span class="s1">'shape_predictor_68_face_landmarks.dat'</span><span class="p">))</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">PREDICTOR</span> <span class="o">=</span> <span class="n">dlib</span><span class="o">.</span><span class="n">shape_predictor</span><span class="p">(</span><span class="n">predictor_file</span><span class="p">)</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h6 class="doc doc-heading" id="adviser.services.hci.video.FeatureExtractor.VideoFeatureExtractor.extract_fl_features">
<code class="highlight language-python">
extract_fl_features<span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> </code>
<a class="headerlink" href="#adviser.services.hci.video.FeatureExtractor.VideoFeatureExtractor.extract_fl_features" title="Permanent link"></a></h6>
<div class="doc doc-contents">
<details class="quote">
<summary>Source code in <code>adviser/services/hci/video/FeatureExtractor.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>551
552
553
554
555
556
557
558
559
560
561
562
563
564
565
566
567
568
569
570
571
572
573
574
575
576
577
578
579
580
581
582</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">delegate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="n">func_inst</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">func</span><span class="o">.</span><span class="vm">__name__</span><span class="p">)</span>

    <span class="n">callargs</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">args</span><span class="p">)</span>
    <span class="k">if</span> <span class="bp">self</span> <span class="ow">in</span> <span class="n">callargs</span><span class="p">:</span>    <span class="c1"># remove self when in *args, because already known to function</span>
        <span class="n">callargs</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">func</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">callargs</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">result</span><span class="p">:</span>
        <span class="c1"># fix! (user could have multiple "/" characters in topic - only use last one )</span>
        <span class="n">domains</span> <span class="o">=</span> <span class="p">{</span><span class="n">res</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">"/"</span><span class="p">)[</span><span class="mi">0</span><span class="p">]:</span> <span class="n">res</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">"/"</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span> <span class="k">if</span> <span class="s2">"/"</span> <span class="ow">in</span> <span class="n">res</span> <span class="k">else</span> <span class="s2">""</span> <span class="k">for</span> <span class="n">res</span> <span class="ow">in</span> <span class="n">result</span><span class="p">}</span>
        <span class="n">result</span> <span class="o">=</span> <span class="p">{</span><span class="n">key</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">"/"</span><span class="p">)[</span><span class="mi">0</span><span class="p">]:</span> <span class="n">result</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">result</span><span class="p">}</span>

    <span class="k">if</span> <span class="n">func_inst</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_publish_sockets</span><span class="p">:</span>
        <span class="c1"># not a publisher, just normal function</span>
        <span class="k">return</span> <span class="n">result</span>

    <span class="n">socket</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_publish_sockets</span><span class="p">[</span><span class="n">func_inst</span><span class="p">]</span>
    <span class="n">domain</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_domain_name</span>
    <span class="k">if</span> <span class="n">socket</span> <span class="ow">and</span> <span class="n">result</span><span class="p">:</span>
        <span class="c1"># publish messages</span>
        <span class="k">for</span> <span class="n">topic</span> <span class="ow">in</span> <span class="n">pub_topics</span><span class="p">:</span>
        <span class="c1"># for topic in result: # NOTE publish any returned value in dict with it's key as topic</span>
            <span class="k">if</span> <span class="n">topic</span> <span class="ow">in</span> <span class="n">result</span><span class="p">:</span>
                <span class="n">domain</span> <span class="o">=</span> <span class="n">domain</span> <span class="k">if</span> <span class="n">domain</span> <span class="k">else</span> <span class="n">domains</span><span class="p">[</span><span class="n">topic</span><span class="p">]</span>
                <span class="n">topic_domain_str</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="n">topic</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">domain</span><span class="si">}</span><span class="s2">"</span> <span class="k">if</span> <span class="n">domain</span> <span class="k">else</span> <span class="n">topic</span>
                <span class="k">if</span> <span class="n">topic</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_pub_topic_domains</span><span class="p">:</span>
                    <span class="n">topic_domain_str</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="n">topic</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_pub_topic_domains</span><span class="p">[</span><span class="n">topic</span><span class="p">]</span><span class="si">}</span><span class="s2">"</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_pub_topic_domains</span><span class="p">[</span><span class="n">topic</span><span class="p">]</span> <span class="k">else</span> <span class="n">topic</span>
                <span class="n">_send_msg</span><span class="p">(</span><span class="n">socket</span><span class="p">,</span> <span class="n">topic_domain_str</span><span class="p">,</span> <span class="n">result</span><span class="p">[</span><span class="n">topic</span><span class="p">])</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">debug_logger</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">debug_logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
                        <span class="sa">f</span><span class="s2">"- (DS): sent message from </span><span class="si">{</span><span class="n">func</span><span class="si">}</span><span class="s2"> to topic </span><span class="si">{</span><span class="n">topic_domain_str</span><span class="si">}</span><span class="s2">:</span><span class="se">\n</span><span class="s2">   </span><span class="si">{</span><span class="n">result</span><span class="p">[</span><span class="n">topic</span><span class="p">]</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">result</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="doc doc-object doc-module">
<h4 class="doc doc-heading" id="adviser.services.hci.video.VideoInput">
<code>VideoInput</code>
<a class="headerlink" href="#adviser.services.hci.video.VideoInput" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<div class="doc doc-children">
<div class="doc doc-object doc-class">
<h5 class="doc doc-heading" id="adviser.services.hci.video.VideoInput.VideoInput">
<code>VideoInput</code>
<a class="headerlink" href="#adviser.services.hci.video.VideoInput.VideoInput" title="Permanent link"></a></h5>
<div class="doc doc-contents">
<p>Captures frames with a specified capture interval between two consecutive dialog turns and returns a list of frames.</p>
<div class="doc doc-children">
<div class="doc doc-object doc-method">
<h6 class="doc doc-heading" id="adviser.services.hci.video.VideoInput.VideoInput.__init__">
<code class="highlight language-python">
__init__<span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">domain</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">camera_id</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">capture_interval</span><span class="o">=</span><span class="mf">1000000.0</span><span class="p">,</span> <span class="n">identifier</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span> </code>
<span class="doc doc-properties">
<small class="doc doc-property doc-property-special"><code>special</code></small>
</span>
<a class="headerlink" href="#adviser.services.hci.video.VideoInput.VideoInput.__init__" title="Permanent link"></a></h6>
<div class="doc doc-contents">
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>camera_id</code></td>
<td><code>int</code></td>
<td>
<p>device id (if only 1 camera device is connected, id is 0, if two are connected choose between 0 and 1, ...)</p>
</td>
<td><code>0</code></td>
</tr>
<tr>
<td><code>capture_interval</code></td>
<td><code>int</code></td>
<td>
<p>try to capture a frame every x microseconds - is a lower bound, no hard time guarantees (e.g. 5e5 -&gt; every &gt;= 0.5 seconds)</p>
</td>
<td><code>1000000.0</code></td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>adviser/services/hci/video/VideoInput.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">domain</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">camera_id</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">capture_interval</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mf">10e5</span><span class="p">,</span> <span class="n">identifier</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
    <span class="sd">"""</span>
<span class="sd">    Args:</span>
<span class="sd">        camera_id (int): device id (if only 1 camera device is connected, id is 0, if two are connected choose between 0 and 1, ...)</span>
<span class="sd">        capture_interval (int): try to capture a frame every x microseconds - is a lower bound, no hard time guarantees (e.g. 5e5 -&gt; every &gt;= 0.5 seconds)</span>
<span class="sd">    """</span>
    <span class="n">Service</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">domain</span><span class="p">,</span> <span class="n">identifier</span><span class="o">=</span><span class="n">identifier</span><span class="p">)</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">cap</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">VideoCapture</span><span class="p">(</span><span class="n">camera_id</span><span class="p">)</span>  <span class="c1"># get handle to camera device</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">cap</span><span class="o">.</span><span class="n">isOpened</span><span class="p">():</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cap</span><span class="o">.</span><span class="n">open</span><span class="p">()</span>                     <span class="c1"># open</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">terminating</span> <span class="o">=</span> <span class="n">Event</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">terminating</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">capture_thread</span> <span class="o">=</span> <span class="n">Thread</span><span class="p">(</span><span class="n">target</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">capture</span><span class="p">)</span> <span class="c1"># create thread object for capturing</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">capture_interval</span> <span class="o">=</span> <span class="n">capture_interval</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h6 class="doc doc-heading" id="adviser.services.hci.video.VideoInput.VideoInput.capture">
<code class="highlight language-python">
capture<span class="p">(</span><span class="bp">self</span><span class="p">)</span> </code>
<a class="headerlink" href="#adviser.services.hci.video.VideoInput.VideoInput.capture" title="Permanent link"></a></h6>
<div class="doc doc-contents">
<p>Continuous video capture, meant to be run in a loop.
Calls <code>publish_img</code> once per interval tick to publish the captured image.</p>
<details class="quote">
<summary>Source code in <code>adviser/services/hci/video/VideoInput.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">capture</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">"""</span>
<span class="sd">    Continuous video capture, meant to be run in a loop.</span>
<span class="sd">    Calls `publish_img` once per interval tick to publish the captured image.</span>
<span class="sd">    """</span>
    <span class="k">while</span> <span class="bp">self</span><span class="o">.</span><span class="n">cap</span><span class="o">.</span><span class="n">isOpened</span><span class="p">()</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">terminating</span><span class="o">.</span><span class="n">isSet</span><span class="p">():</span>
        <span class="n">start_time</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>

        <span class="c1"># Capture frame-by-frame</span>
        <span class="c1"># cap.read() returns a bool (true when frame was read correctly)</span>
        <span class="n">ret</span><span class="p">,</span> <span class="n">frame</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cap</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
        <span class="c1"># Our operations on the frame come here</span>
        <span class="k">if</span> <span class="n">ret</span><span class="p">:</span>
            <span class="c1"># rgb_img = cv2.cvtColor(frame, cv2.COLOR_BGR2RGB)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">publish_img</span><span class="p">(</span><span class="n">rgb_img</span><span class="o">=</span><span class="n">frame</span><span class="p">)</span>

        <span class="n">end_time</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>
        <span class="n">time_diff</span> <span class="o">=</span> <span class="n">end_time</span> <span class="o">-</span> <span class="n">start_time</span>
        <span class="n">wait_seconds</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">capture_interval</span> <span class="o">-</span> <span class="n">time_diff</span><span class="o">.</span><span class="n">microseconds</span><span class="p">)</span><span class="o">*</span><span class="mf">1e-6</span>   <span class="c1"># note: time to wait for next capture to match specified sampling rate in seconds</span>
        <span class="k">if</span> <span class="n">wait_seconds</span> <span class="o">&gt;</span> <span class="mf">0.0</span><span class="p">:</span>
            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="n">wait_seconds</span><span class="p">)</span>

    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cap</span><span class="o">.</span><span class="n">isOpened</span><span class="p">():</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cap</span><span class="o">.</span><span class="n">release</span><span class="p">()</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h6 class="doc doc-heading" id="adviser.services.hci.video.VideoInput.VideoInput.dialog_end">
<code class="highlight language-python">
dialog_end<span class="p">(</span><span class="bp">self</span><span class="p">)</span> </code>
<a class="headerlink" href="#adviser.services.hci.video.VideoInput.VideoInput.dialog_end" title="Permanent link"></a></h6>
<div class="doc doc-contents">
<p>This function is called after a dialog ended (Topics.DIALOG_END message was received).
You should overwrite this function to record dialog-level information. </p>
<details class="quote">
<summary>Source code in <code>adviser/services/hci/video/VideoInput.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>76
77</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">dialog_end</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">terminating</span><span class="o">.</span><span class="n">set</span><span class="p">()</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h6 class="doc doc-heading" id="adviser.services.hci.video.VideoInput.VideoInput.dialog_start">
<code class="highlight language-python">
dialog_start<span class="p">(</span><span class="bp">self</span><span class="p">)</span> </code>
<a class="headerlink" href="#adviser.services.hci.video.VideoInput.VideoInput.dialog_start" title="Permanent link"></a></h6>
<div class="doc doc-contents">
<p>This function is called before the first message to a new dialog is published.
You should overwrite this function to set/reset dialog-level variables. </p>
<details class="quote">
<summary>Source code in <code>adviser/services/hci/video/VideoInput.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>79
80
81
82</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">dialog_start</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">capture_thread</span><span class="o">.</span><span class="n">is_alive</span><span class="p">():</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">"Starting video capture..."</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">capture_thread</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h6 class="doc doc-heading" id="adviser.services.hci.video.VideoInput.VideoInput.publish_img">
<code class="highlight language-python">
publish_img<span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> </code>
<a class="headerlink" href="#adviser.services.hci.video.VideoInput.VideoInput.publish_img" title="Permanent link"></a></h6>
<div class="doc doc-contents">
<details class="quote">
<summary>Source code in <code>adviser/services/hci/video/VideoInput.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>551
552
553
554
555
556
557
558
559
560
561
562
563
564
565
566
567
568
569
570
571
572
573
574
575
576
577
578
579
580
581
582</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">delegate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="n">func_inst</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">func</span><span class="o">.</span><span class="vm">__name__</span><span class="p">)</span>

    <span class="n">callargs</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">args</span><span class="p">)</span>
    <span class="k">if</span> <span class="bp">self</span> <span class="ow">in</span> <span class="n">callargs</span><span class="p">:</span>    <span class="c1"># remove self when in *args, because already known to function</span>
        <span class="n">callargs</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">func</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">callargs</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">result</span><span class="p">:</span>
        <span class="c1"># fix! (user could have multiple "/" characters in topic - only use last one )</span>
        <span class="n">domains</span> <span class="o">=</span> <span class="p">{</span><span class="n">res</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">"/"</span><span class="p">)[</span><span class="mi">0</span><span class="p">]:</span> <span class="n">res</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">"/"</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span> <span class="k">if</span> <span class="s2">"/"</span> <span class="ow">in</span> <span class="n">res</span> <span class="k">else</span> <span class="s2">""</span> <span class="k">for</span> <span class="n">res</span> <span class="ow">in</span> <span class="n">result</span><span class="p">}</span>
        <span class="n">result</span> <span class="o">=</span> <span class="p">{</span><span class="n">key</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">"/"</span><span class="p">)[</span><span class="mi">0</span><span class="p">]:</span> <span class="n">result</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">result</span><span class="p">}</span>

    <span class="k">if</span> <span class="n">func_inst</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_publish_sockets</span><span class="p">:</span>
        <span class="c1"># not a publisher, just normal function</span>
        <span class="k">return</span> <span class="n">result</span>

    <span class="n">socket</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_publish_sockets</span><span class="p">[</span><span class="n">func_inst</span><span class="p">]</span>
    <span class="n">domain</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_domain_name</span>
    <span class="k">if</span> <span class="n">socket</span> <span class="ow">and</span> <span class="n">result</span><span class="p">:</span>
        <span class="c1"># publish messages</span>
        <span class="k">for</span> <span class="n">topic</span> <span class="ow">in</span> <span class="n">pub_topics</span><span class="p">:</span>
        <span class="c1"># for topic in result: # NOTE publish any returned value in dict with it's key as topic</span>
            <span class="k">if</span> <span class="n">topic</span> <span class="ow">in</span> <span class="n">result</span><span class="p">:</span>
                <span class="n">domain</span> <span class="o">=</span> <span class="n">domain</span> <span class="k">if</span> <span class="n">domain</span> <span class="k">else</span> <span class="n">domains</span><span class="p">[</span><span class="n">topic</span><span class="p">]</span>
                <span class="n">topic_domain_str</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="n">topic</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">domain</span><span class="si">}</span><span class="s2">"</span> <span class="k">if</span> <span class="n">domain</span> <span class="k">else</span> <span class="n">topic</span>
                <span class="k">if</span> <span class="n">topic</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_pub_topic_domains</span><span class="p">:</span>
                    <span class="n">topic_domain_str</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="n">topic</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_pub_topic_domains</span><span class="p">[</span><span class="n">topic</span><span class="p">]</span><span class="si">}</span><span class="s2">"</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_pub_topic_domains</span><span class="p">[</span><span class="n">topic</span><span class="p">]</span> <span class="k">else</span> <span class="n">topic</span>
                <span class="n">_send_msg</span><span class="p">(</span><span class="n">socket</span><span class="p">,</span> <span class="n">topic_domain_str</span><span class="p">,</span> <span class="n">result</span><span class="p">[</span><span class="n">topic</span><span class="p">])</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">debug_logger</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">debug_logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
                        <span class="sa">f</span><span class="s2">"- (DS): sent message from </span><span class="si">{</span><span class="n">func</span><span class="si">}</span><span class="s2"> to topic </span><span class="si">{</span><span class="n">topic_domain_str</span><span class="si">}</span><span class="s2">:</span><span class="se">\n</span><span class="s2">   </span><span class="si">{</span><span class="n">result</span><span class="p">[</span><span class="n">topic</span><span class="p">]</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">result</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="doc doc-object doc-module">
<h2 class="doc doc-heading" id="adviser.services.nlg">
<code>nlg</code>
<span class="doc doc-properties">
<small class="doc doc-property doc-property-special"><code>special</code></small>
</span>
<a class="headerlink" href="#adviser.services.nlg" title="Permanent link"></a></h2>
<div class="doc doc-contents">
<div class="doc doc-children">
<div class="doc doc-object doc-module">
<h3 class="doc doc-heading" id="adviser.services.nlg.affective_nlg">
<code>affective_nlg</code>
<a class="headerlink" href="#adviser.services.nlg.affective_nlg" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>Handcrafted (i.e. template-based) Natural Language Generation Module</p>
<div class="doc doc-children">
<div class="doc doc-object doc-class">
<h4 class="doc doc-heading" id="adviser.services.nlg.affective_nlg.HandcraftedEmotionNLG">
<code>HandcraftedEmotionNLG</code>
<a class="headerlink" href="#adviser.services.nlg.affective_nlg.HandcraftedEmotionNLG" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>A child of the HandcraftedNLG, the HandcraftedEmotionNLG can choose between multiple affective
response templates for each sys_act dependingon the current sys_emotion</p>
<div class="doc doc-children">
<div class="doc doc-object doc-method">
<h5 class="doc doc-heading" id="adviser.services.nlg.affective_nlg.HandcraftedEmotionNLG.__init__">
<code class="highlight language-python">
__init__<span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">domain</span><span class="p">,</span> <span class="n">sub_topic_domains</span><span class="o">=</span><span class="p">{},</span> <span class="n">template_file</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">logger</span><span class="o">=&lt;</span><span class="n">DiasysLogger</span> <span class="n">adviser</span> <span class="p">(</span><span class="n">NOTSET</span><span class="p">)</span><span class="o">&gt;</span><span class="p">,</span> <span class="n">template_file_german</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">emotions</span><span class="o">=</span><span class="p">[],</span> <span class="n">debug_logger</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span> </code>
<span class="doc doc-properties">
<small class="doc doc-property doc-property-special"><code>special</code></small>
</span>
<a class="headerlink" href="#adviser.services.nlg.affective_nlg.HandcraftedEmotionNLG.__init__" title="Permanent link"></a></h5>
<div class="doc doc-contents">
<details class="quote">
<summary>Source code in <code>adviser/services/nlg/affective_nlg.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>41
42
43
44
45
46
47
48
49
50
51
52
53</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">domain</span><span class="p">:</span> <span class="n">Domain</span><span class="p">,</span> <span class="n">sub_topic_domains</span><span class="o">=</span><span class="p">{},</span> <span class="n">template_file</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
             <span class="n">logger</span><span class="p">:</span> <span class="n">DiasysLogger</span> <span class="o">=</span> <span class="n">DiasysLogger</span><span class="p">(),</span> <span class="n">template_file_german</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
             <span class="n">emotions</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="p">[],</span> <span class="n">debug_logger</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
    <span class="sd">"""Constructor mainly extracts methods and rules from the template file"""</span>
    <span class="n">Service</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">domain</span><span class="o">=</span><span class="n">domain</span><span class="p">,</span> <span class="n">sub_topic_domains</span><span class="o">=</span><span class="n">sub_topic_domains</span><span class="p">,</span> <span class="n">debug_logger</span><span class="o">=</span><span class="n">debug_logger</span><span class="p">)</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">domain</span> <span class="o">=</span> <span class="n">domain</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">template_filename</span> <span class="o">=</span> <span class="n">template_file</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">templates</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">logger</span> <span class="o">=</span> <span class="n">logger</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">emotions</span> <span class="o">=</span> <span class="n">emotions</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">_initialise_templates</span><span class="p">()</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h5 class="doc doc-heading" id="adviser.services.nlg.affective_nlg.HandcraftedEmotionNLG.generate_system_utterance">
<code class="highlight language-python">
generate_system_utterance<span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> </code>
<a class="headerlink" href="#adviser.services.nlg.affective_nlg.HandcraftedEmotionNLG.generate_system_utterance" title="Permanent link"></a></h5>
<div class="doc doc-contents">
<details class="quote">
<summary>Source code in <code>adviser/services/nlg/affective_nlg.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>551
552
553
554
555
556
557
558
559
560
561
562
563
564
565
566
567
568
569
570
571
572
573
574
575
576
577
578
579
580
581
582</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">delegate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="n">func_inst</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">func</span><span class="o">.</span><span class="vm">__name__</span><span class="p">)</span>

    <span class="n">callargs</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">args</span><span class="p">)</span>
    <span class="k">if</span> <span class="bp">self</span> <span class="ow">in</span> <span class="n">callargs</span><span class="p">:</span>    <span class="c1"># remove self when in *args, because already known to function</span>
        <span class="n">callargs</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">func</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">callargs</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">result</span><span class="p">:</span>
        <span class="c1"># fix! (user could have multiple "/" characters in topic - only use last one )</span>
        <span class="n">domains</span> <span class="o">=</span> <span class="p">{</span><span class="n">res</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">"/"</span><span class="p">)[</span><span class="mi">0</span><span class="p">]:</span> <span class="n">res</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">"/"</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span> <span class="k">if</span> <span class="s2">"/"</span> <span class="ow">in</span> <span class="n">res</span> <span class="k">else</span> <span class="s2">""</span> <span class="k">for</span> <span class="n">res</span> <span class="ow">in</span> <span class="n">result</span><span class="p">}</span>
        <span class="n">result</span> <span class="o">=</span> <span class="p">{</span><span class="n">key</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">"/"</span><span class="p">)[</span><span class="mi">0</span><span class="p">]:</span> <span class="n">result</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">result</span><span class="p">}</span>

    <span class="k">if</span> <span class="n">func_inst</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_publish_sockets</span><span class="p">:</span>
        <span class="c1"># not a publisher, just normal function</span>
        <span class="k">return</span> <span class="n">result</span>

    <span class="n">socket</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_publish_sockets</span><span class="p">[</span><span class="n">func_inst</span><span class="p">]</span>
    <span class="n">domain</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_domain_name</span>
    <span class="k">if</span> <span class="n">socket</span> <span class="ow">and</span> <span class="n">result</span><span class="p">:</span>
        <span class="c1"># publish messages</span>
        <span class="k">for</span> <span class="n">topic</span> <span class="ow">in</span> <span class="n">pub_topics</span><span class="p">:</span>
        <span class="c1"># for topic in result: # NOTE publish any returned value in dict with it's key as topic</span>
            <span class="k">if</span> <span class="n">topic</span> <span class="ow">in</span> <span class="n">result</span><span class="p">:</span>
                <span class="n">domain</span> <span class="o">=</span> <span class="n">domain</span> <span class="k">if</span> <span class="n">domain</span> <span class="k">else</span> <span class="n">domains</span><span class="p">[</span><span class="n">topic</span><span class="p">]</span>
                <span class="n">topic_domain_str</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="n">topic</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">domain</span><span class="si">}</span><span class="s2">"</span> <span class="k">if</span> <span class="n">domain</span> <span class="k">else</span> <span class="n">topic</span>
                <span class="k">if</span> <span class="n">topic</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_pub_topic_domains</span><span class="p">:</span>
                    <span class="n">topic_domain_str</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="n">topic</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_pub_topic_domains</span><span class="p">[</span><span class="n">topic</span><span class="p">]</span><span class="si">}</span><span class="s2">"</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_pub_topic_domains</span><span class="p">[</span><span class="n">topic</span><span class="p">]</span> <span class="k">else</span> <span class="n">topic</span>
                <span class="n">_send_msg</span><span class="p">(</span><span class="n">socket</span><span class="p">,</span> <span class="n">topic_domain_str</span><span class="p">,</span> <span class="n">result</span><span class="p">[</span><span class="n">topic</span><span class="p">])</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">debug_logger</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">debug_logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
                        <span class="sa">f</span><span class="s2">"- (DS): sent message from </span><span class="si">{</span><span class="n">func</span><span class="si">}</span><span class="s2"> to topic </span><span class="si">{</span><span class="n">topic_domain_str</span><span class="si">}</span><span class="s2">:</span><span class="se">\n</span><span class="s2">   </span><span class="si">{</span><span class="n">result</span><span class="p">[</span><span class="n">topic</span><span class="p">]</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">result</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="doc doc-object doc-module">
<h3 class="doc doc-heading" id="adviser.services.nlg.bc_nlg">
<code>bc_nlg</code>
<a class="headerlink" href="#adviser.services.nlg.bc_nlg" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>Handcrafted (i.e. template-based) Natural Language Generation Module with backchannel</p>
<div class="doc doc-children">
<div class="doc doc-object doc-class">
<h4 class="doc doc-heading" id="adviser.services.nlg.bc_nlg.BackchannelHandcraftedNLG">
<code>BackchannelHandcraftedNLG</code>
<a class="headerlink" href="#adviser.services.nlg.bc_nlg.BackchannelHandcraftedNLG" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>Handcrafted (i.e. template-based) Natural Language Generation Module</p>
<div class="codehilite">
<pre><span></span><code><span class="n">A</span><span class="w"> </span><span class="k">rule</span><span class="o">-</span><span class="n">based</span><span class="w"> </span><span class="n">approach</span><span class="w"> </span><span class="k">on</span><span class="w"> </span><span class="k">natural</span><span class="w"> </span><span class="k">language</span><span class="w"> </span><span class="n">generation</span><span class="p">.</span><span class="w"></span>
<span class="n">The</span><span class="w"> </span><span class="n">rules</span><span class="w"> </span><span class="n">have</span><span class="w"> </span><span class="k">to</span><span class="w"> </span><span class="n">be</span><span class="w"> </span><span class="n">specified</span><span class="w"> </span><span class="k">within</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">template</span><span class="w"> </span><span class="k">file</span><span class="w"> </span><span class="k">using</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">ADVISER</span><span class="w"> </span><span class="n">NLG</span><span class="w"> </span><span class="n">syntax</span><span class="p">.</span><span class="w"></span>
<span class="n">Python</span><span class="w"> </span><span class="n">methods</span><span class="w"> </span><span class="n">that</span><span class="w"> </span><span class="k">are</span><span class="w"> </span><span class="k">called</span><span class="w"> </span><span class="k">within</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">template</span><span class="w"> </span><span class="k">file</span><span class="w"> </span><span class="n">must</span><span class="w"> </span><span class="n">be</span><span class="w"> </span><span class="n">specified</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">the</span><span class="w"></span>
<span class="n">HandcraftedNLG</span><span class="w"> </span><span class="k">class</span><span class="w"> </span><span class="k">by</span><span class="w"> </span><span class="k">using</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="k">prefix</span><span class="w"> </span><span class="ss">"_template_"</span><span class="p">.</span><span class="w"> </span><span class="k">For</span><span class="w"> </span><span class="n">example</span><span class="p">,</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="k">method</span><span class="w"></span>
<span class="ss">"_template_genitive_s"</span><span class="w"> </span><span class="n">can</span><span class="w"> </span><span class="n">be</span><span class="w"> </span><span class="n">accessed</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">template</span><span class="w"> </span><span class="k">file</span><span class="w"> </span><span class="n">via</span><span class="w"> </span><span class="n">calling</span><span class="w"> </span><span class="err">{</span><span class="n">genitive_s</span><span class="p">(</span><span class="n">name</span><span class="p">)</span><span class="err">}</span><span class="w"></span>

<span class="err">!!!</span><span class="w"> </span><span class="n">attributes</span><span class="w"></span>
<span class="w">    </span><span class="k">domain</span><span class="w"> </span><span class="p">(</span><span class="k">Domain</span><span class="p">)</span><span class="err">:</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="k">domain</span><span class="w"></span>
<span class="w">    </span><span class="n">template_filename</span><span class="w"> </span><span class="p">(</span><span class="nf">str</span><span class="p">)</span><span class="err">:</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">NLG</span><span class="w"> </span><span class="n">template</span><span class="w"> </span><span class="n">filename</span><span class="w"></span>
<span class="w">    </span><span class="n">templates</span><span class="w"> </span><span class="p">(</span><span class="n">TemplateFile</span><span class="p">)</span><span class="err">:</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">parsed</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="n">ready</span><span class="o">-</span><span class="k">to</span><span class="o">-</span><span class="k">go</span><span class="w"> </span><span class="n">NLG</span><span class="w"> </span><span class="n">template</span><span class="w"> </span><span class="k">file</span><span class="w"></span>
<span class="w">    </span><span class="n">template_english</span><span class="w"> </span><span class="p">(</span><span class="nf">str</span><span class="p">)</span><span class="err">:</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">name</span><span class="w"> </span><span class="k">of</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">English</span><span class="w"> </span><span class="n">NLG</span><span class="w"> </span><span class="n">template</span><span class="w"> </span><span class="k">file</span><span class="w"></span>
<span class="w">    </span><span class="n">template_german</span><span class="w"> </span><span class="p">(</span><span class="nf">str</span><span class="p">)</span><span class="err">:</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">name</span><span class="w"> </span><span class="k">of</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">German</span><span class="w"> </span><span class="n">NLG</span><span class="w"> </span><span class="n">template</span><span class="w"> </span><span class="k">file</span><span class="w"></span>
<span class="w">    </span><span class="k">language</span><span class="w"> </span><span class="p">(</span><span class="k">Language</span><span class="p">)</span><span class="err">:</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="k">language</span><span class="w"> </span><span class="k">of</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">dialogue</span><span class="w"></span>
</code></pre>
</div>
<div class="doc doc-children">
<div class="doc doc-object doc-method">
<h5 class="doc doc-heading" id="adviser.services.nlg.bc_nlg.BackchannelHandcraftedNLG.__init__">
<code class="highlight language-python">
__init__<span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">domain</span><span class="p">,</span> <span class="n">sub_topic_domains</span><span class="o">=</span><span class="p">{},</span> <span class="n">template_file</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">logger</span><span class="o">=&lt;</span><span class="n">DiasysLogger</span> <span class="n">adviser</span> <span class="p">(</span><span class="n">NOTSET</span><span class="p">)</span><span class="o">&gt;</span><span class="p">,</span> <span class="n">template_file_german</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">language</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span> </code>
<span class="doc doc-properties">
<small class="doc doc-property doc-property-special"><code>special</code></small>
</span>
<a class="headerlink" href="#adviser.services.nlg.bc_nlg.BackchannelHandcraftedNLG.__init__" title="Permanent link"></a></h5>
<div class="doc doc-contents">
<details class="quote">
<summary>Source code in <code>adviser/services/nlg/bc_nlg.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>51
52
53
54
55
56
57
58
59
60
61
62
63
64
65</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">domain</span><span class="p">:</span> <span class="n">Domain</span><span class="p">,</span> <span class="n">sub_topic_domains</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="p">{},</span> <span class="n">template_file</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
             <span class="n">logger</span><span class="p">:</span> <span class="n">DiasysLogger</span> <span class="o">=</span> <span class="n">DiasysLogger</span><span class="p">(),</span> <span class="n">template_file_german</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
             <span class="n">language</span><span class="p">:</span> <span class="n">Language</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
    <span class="sd">"""Constructor mainly extracts methods and rules from the template file"""</span>
    <span class="n">HandcraftedNLG</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">domain</span><span class="p">,</span> <span class="n">template_file</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">logger</span><span class="o">=</span><span class="n">DiasysLogger</span><span class="p">(),</span> <span class="n">template_file_german</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">language</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">sub_topic_domains</span><span class="o">=</span><span class="n">sub_topic_domains</span><span class="p">)</span>

    <span class="c1"># class_int_mapping = {0: b'no_bc', 1: b'assessment', 2: b'continuer'}</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">backchannels</span> <span class="o">=</span> <span class="p">{</span>
        <span class="mi">0</span><span class="p">:</span> <span class="p">[</span><span class="s1">''</span><span class="p">],</span>
        <span class="mi">1</span><span class="p">:</span> <span class="p">[</span><span class="s1">'Okay. '</span><span class="p">,</span> <span class="s1">'Yeah. '</span><span class="p">],</span>
        <span class="mi">2</span><span class="p">:</span> <span class="p">[</span><span class="s1">'Um-hum. '</span><span class="p">,</span> <span class="s1">'Uh-huh. '</span><span class="p">]</span>
    <span class="p">}</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h5 class="doc doc-heading" id="adviser.services.nlg.bc_nlg.BackchannelHandcraftedNLG.publish_system_utterance">
<code class="highlight language-python">
publish_system_utterance<span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> </code>
<a class="headerlink" href="#adviser.services.nlg.bc_nlg.BackchannelHandcraftedNLG.publish_system_utterance" title="Permanent link"></a></h5>
<div class="doc doc-contents">
<details class="quote">
<summary>Source code in <code>adviser/services/nlg/bc_nlg.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>551
552
553
554
555
556
557
558
559
560
561
562
563
564
565
566
567
568
569
570
571
572
573
574
575
576
577
578
579
580
581
582</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">delegate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="n">func_inst</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">func</span><span class="o">.</span><span class="vm">__name__</span><span class="p">)</span>

    <span class="n">callargs</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">args</span><span class="p">)</span>
    <span class="k">if</span> <span class="bp">self</span> <span class="ow">in</span> <span class="n">callargs</span><span class="p">:</span>    <span class="c1"># remove self when in *args, because already known to function</span>
        <span class="n">callargs</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">func</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">callargs</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">result</span><span class="p">:</span>
        <span class="c1"># fix! (user could have multiple "/" characters in topic - only use last one )</span>
        <span class="n">domains</span> <span class="o">=</span> <span class="p">{</span><span class="n">res</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">"/"</span><span class="p">)[</span><span class="mi">0</span><span class="p">]:</span> <span class="n">res</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">"/"</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span> <span class="k">if</span> <span class="s2">"/"</span> <span class="ow">in</span> <span class="n">res</span> <span class="k">else</span> <span class="s2">""</span> <span class="k">for</span> <span class="n">res</span> <span class="ow">in</span> <span class="n">result</span><span class="p">}</span>
        <span class="n">result</span> <span class="o">=</span> <span class="p">{</span><span class="n">key</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">"/"</span><span class="p">)[</span><span class="mi">0</span><span class="p">]:</span> <span class="n">result</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">result</span><span class="p">}</span>

    <span class="k">if</span> <span class="n">func_inst</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_publish_sockets</span><span class="p">:</span>
        <span class="c1"># not a publisher, just normal function</span>
        <span class="k">return</span> <span class="n">result</span>

    <span class="n">socket</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_publish_sockets</span><span class="p">[</span><span class="n">func_inst</span><span class="p">]</span>
    <span class="n">domain</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_domain_name</span>
    <span class="k">if</span> <span class="n">socket</span> <span class="ow">and</span> <span class="n">result</span><span class="p">:</span>
        <span class="c1"># publish messages</span>
        <span class="k">for</span> <span class="n">topic</span> <span class="ow">in</span> <span class="n">pub_topics</span><span class="p">:</span>
        <span class="c1"># for topic in result: # NOTE publish any returned value in dict with it's key as topic</span>
            <span class="k">if</span> <span class="n">topic</span> <span class="ow">in</span> <span class="n">result</span><span class="p">:</span>
                <span class="n">domain</span> <span class="o">=</span> <span class="n">domain</span> <span class="k">if</span> <span class="n">domain</span> <span class="k">else</span> <span class="n">domains</span><span class="p">[</span><span class="n">topic</span><span class="p">]</span>
                <span class="n">topic_domain_str</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="n">topic</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">domain</span><span class="si">}</span><span class="s2">"</span> <span class="k">if</span> <span class="n">domain</span> <span class="k">else</span> <span class="n">topic</span>
                <span class="k">if</span> <span class="n">topic</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_pub_topic_domains</span><span class="p">:</span>
                    <span class="n">topic_domain_str</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="n">topic</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_pub_topic_domains</span><span class="p">[</span><span class="n">topic</span><span class="p">]</span><span class="si">}</span><span class="s2">"</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_pub_topic_domains</span><span class="p">[</span><span class="n">topic</span><span class="p">]</span> <span class="k">else</span> <span class="n">topic</span>
                <span class="n">_send_msg</span><span class="p">(</span><span class="n">socket</span><span class="p">,</span> <span class="n">topic_domain_str</span><span class="p">,</span> <span class="n">result</span><span class="p">[</span><span class="n">topic</span><span class="p">])</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">debug_logger</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">debug_logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
                        <span class="sa">f</span><span class="s2">"- (DS): sent message from </span><span class="si">{</span><span class="n">func</span><span class="si">}</span><span class="s2"> to topic </span><span class="si">{</span><span class="n">topic_domain_str</span><span class="si">}</span><span class="s2">:</span><span class="se">\n</span><span class="s2">   </span><span class="si">{</span><span class="n">result</span><span class="p">[</span><span class="n">topic</span><span class="p">]</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">result</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="doc doc-object doc-module">
<h3 class="doc doc-heading" id="adviser.services.nlg.nlg">
<code>nlg</code>
<a class="headerlink" href="#adviser.services.nlg.nlg" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>Handcrafted (i.e. template-based) Natural Language Generation Module</p>
<div class="doc doc-children">
<div class="doc doc-object doc-class">
<h4 class="doc doc-heading" id="adviser.services.nlg.nlg.HandcraftedNLG">
<code>HandcraftedNLG</code>
<a class="headerlink" href="#adviser.services.nlg.nlg.HandcraftedNLG" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>Handcrafted (i.e. template-based) Natural Language Generation Module</p>
<div class="codehilite">
<pre><span></span><code><span class="n">A</span><span class="w"> </span><span class="k">rule</span><span class="o">-</span><span class="n">based</span><span class="w"> </span><span class="n">approach</span><span class="w"> </span><span class="k">on</span><span class="w"> </span><span class="k">natural</span><span class="w"> </span><span class="k">language</span><span class="w"> </span><span class="n">generation</span><span class="p">.</span><span class="w"></span>
<span class="n">The</span><span class="w"> </span><span class="n">rules</span><span class="w"> </span><span class="n">have</span><span class="w"> </span><span class="k">to</span><span class="w"> </span><span class="n">be</span><span class="w"> </span><span class="n">specified</span><span class="w"> </span><span class="k">within</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">template</span><span class="w"> </span><span class="k">file</span><span class="w"> </span><span class="k">using</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">ADVISER</span><span class="w"> </span><span class="n">NLG</span><span class="w"> </span><span class="n">syntax</span><span class="p">.</span><span class="w"></span>
<span class="n">Python</span><span class="w"> </span><span class="n">methods</span><span class="w"> </span><span class="n">that</span><span class="w"> </span><span class="k">are</span><span class="w"> </span><span class="k">called</span><span class="w"> </span><span class="k">within</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">template</span><span class="w"> </span><span class="k">file</span><span class="w"> </span><span class="n">must</span><span class="w"> </span><span class="n">be</span><span class="w"> </span><span class="n">specified</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">the</span><span class="w"></span>
<span class="n">HandcraftedNLG</span><span class="w"> </span><span class="k">class</span><span class="w"> </span><span class="k">by</span><span class="w"> </span><span class="k">using</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="k">prefix</span><span class="w"> </span><span class="ss">"_template_"</span><span class="p">.</span><span class="w"> </span><span class="k">For</span><span class="w"> </span><span class="n">example</span><span class="p">,</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="k">method</span><span class="w"></span>
<span class="ss">"_template_genitive_s"</span><span class="w"> </span><span class="n">can</span><span class="w"> </span><span class="n">be</span><span class="w"> </span><span class="n">accessed</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">template</span><span class="w"> </span><span class="k">file</span><span class="w"> </span><span class="n">via</span><span class="w"> </span><span class="n">calling</span><span class="w"> </span><span class="err">{</span><span class="n">genitive_s</span><span class="p">(</span><span class="n">name</span><span class="p">)</span><span class="err">}</span><span class="w"></span>

<span class="err">!!!</span><span class="w"> </span><span class="n">attributes</span><span class="w"></span>
<span class="w">    </span><span class="k">domain</span><span class="w"> </span><span class="p">(</span><span class="k">Domain</span><span class="p">)</span><span class="err">:</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="k">domain</span><span class="w"></span>
<span class="w">    </span><span class="n">template_filename</span><span class="w"> </span><span class="p">(</span><span class="nf">str</span><span class="p">)</span><span class="err">:</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">NLG</span><span class="w"> </span><span class="n">template</span><span class="w"> </span><span class="n">filename</span><span class="w"></span>
<span class="w">    </span><span class="n">templates</span><span class="w"> </span><span class="p">(</span><span class="n">TemplateFile</span><span class="p">)</span><span class="err">:</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">parsed</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="n">ready</span><span class="o">-</span><span class="k">to</span><span class="o">-</span><span class="k">go</span><span class="w"> </span><span class="n">NLG</span><span class="w"> </span><span class="n">template</span><span class="w"> </span><span class="k">file</span><span class="w"></span>
<span class="w">    </span><span class="n">template_english</span><span class="w"> </span><span class="p">(</span><span class="nf">str</span><span class="p">)</span><span class="err">:</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">name</span><span class="w"> </span><span class="k">of</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">English</span><span class="w"> </span><span class="n">NLG</span><span class="w"> </span><span class="n">template</span><span class="w"> </span><span class="k">file</span><span class="w"></span>
<span class="w">    </span><span class="n">template_german</span><span class="w"> </span><span class="p">(</span><span class="nf">str</span><span class="p">)</span><span class="err">:</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">name</span><span class="w"> </span><span class="k">of</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">German</span><span class="w"> </span><span class="n">NLG</span><span class="w"> </span><span class="n">template</span><span class="w"> </span><span class="k">file</span><span class="w"></span>
<span class="w">    </span><span class="k">language</span><span class="w"> </span><span class="p">(</span><span class="k">Language</span><span class="p">)</span><span class="err">:</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="k">language</span><span class="w"> </span><span class="k">of</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">dialogue</span><span class="w"></span>
</code></pre>
</div>
<div class="doc doc-children">
<div class="doc doc-object doc-method">
<h5 class="doc doc-heading" id="adviser.services.nlg.nlg.HandcraftedNLG.__init__">
<code class="highlight language-python">
__init__<span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">domain</span><span class="p">,</span> <span class="n">template_file</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">sub_topic_domains</span><span class="o">=</span><span class="p">{},</span> <span class="n">logger</span><span class="o">=&lt;</span><span class="n">DiasysLogger</span> <span class="n">adviser</span> <span class="p">(</span><span class="n">NOTSET</span><span class="p">)</span><span class="o">&gt;</span><span class="p">,</span> <span class="n">template_file_german</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">language</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span> </code>
<span class="doc doc-properties">
<small class="doc doc-property doc-property-special"><code>special</code></small>
</span>
<a class="headerlink" href="#adviser.services.nlg.nlg.HandcraftedNLG.__init__" title="Permanent link"></a></h5>
<div class="doc doc-contents">
<p>Constructor mainly extracts methods and rules from the template file</p>
<details class="quote">
<summary>Source code in <code>adviser/services/nlg/nlg.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">domain</span><span class="p">:</span> <span class="n">Domain</span><span class="p">,</span> <span class="n">template_file</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">sub_topic_domains</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="p">{},</span>
             <span class="n">logger</span><span class="p">:</span> <span class="n">DiasysLogger</span> <span class="o">=</span> <span class="n">DiasysLogger</span><span class="p">(),</span> <span class="n">template_file_german</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
             <span class="n">language</span><span class="p">:</span> <span class="n">Language</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
    <span class="sd">"""Constructor mainly extracts methods and rules from the template file"""</span>
    <span class="n">Service</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">domain</span><span class="o">=</span><span class="n">domain</span><span class="p">,</span> <span class="n">sub_topic_domains</span><span class="o">=</span><span class="n">sub_topic_domains</span><span class="p">)</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">language</span> <span class="o">=</span> <span class="n">language</span> <span class="k">if</span> <span class="n">language</span> <span class="k">else</span> <span class="n">Language</span><span class="o">.</span><span class="n">ENGLISH</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">template_english</span> <span class="o">=</span> <span class="n">template_file</span>
    <span class="c1"># TODO: at some point if we expand languages, maybe make kwargs? --LV</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">template_german</span> <span class="o">=</span> <span class="n">template_file_german</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">domain</span> <span class="o">=</span> <span class="n">domain</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">template_filename</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">templates</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">logger</span> <span class="o">=</span> <span class="n">logger</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">language</span> <span class="o">=</span> <span class="n">Language</span><span class="o">.</span><span class="n">ENGLISH</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_initialise_language</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">language</span><span class="p">)</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h5 class="doc doc-heading" id="adviser.services.nlg.nlg.HandcraftedNLG.generate_system_utterance">
<code class="highlight language-python">
generate_system_utterance<span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sys_act</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span> </code>
<a class="headerlink" href="#adviser.services.nlg.nlg.HandcraftedNLG.generate_system_utterance" title="Permanent link"></a></h5>
<div class="doc doc-contents">
<p>Main function of the NLG module</p>
<p>Takes a system act, searches for a fitting rule, applies it and returns the message.
Overwrite this function if you inherit from the NLG module.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>sys_act</code></td>
<td><code>SysAct</code></td>
<td>
<p>The system act</p>
</td>
<td><code>None</code></td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>str</code></td>
<td>
<p>The utterance generated by applying a fitting template</p>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>adviser/services/nlg/nlg.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span> 84
 85
 86
 87
 88
 89
 90
 91
 92
 93
 94
 95
 96
 97
 98
 99
100
101
102
103
104
105
106
107
108
109
110
111
112</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">generate_system_utterance</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sys_act</span><span class="p">:</span> <span class="n">SysAct</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
    <span class="sd">"""Main function of the NLG module</span>

<span class="sd">    Takes a system act, searches for a fitting rule, applies it and returns the message.</span>
<span class="sd">    Overwrite this function if you inherit from the NLG module.</span>

<span class="sd">    Args:</span>
<span class="sd">        sys_act (SysAct): The system act</span>

<span class="sd">    Returns:</span>
<span class="sd">        The utterance generated by applying a fitting template</span>
<span class="sd">    """</span>
    <span class="n">rule_found</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="n">message</span> <span class="o">=</span> <span class="s2">""</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">message</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">templates</span><span class="o">.</span><span class="n">create_message</span><span class="p">(</span><span class="n">sys_act</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">BaseException</span> <span class="k">as</span> <span class="n">error</span><span class="p">:</span>
        <span class="n">rule_found</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">error</span><span class="p">)</span>
        <span class="k">raise</span><span class="p">(</span><span class="n">error</span><span class="p">)</span>

    <span class="c1"># inform if no applicable rule could be found in the template file</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">rule_found</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">'Could not find a fitting rule for the given system act!'</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">"System Action: "</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">sys_act</span><span class="o">.</span><span class="n">type</span><span class="p">)</span>
                         <span class="o">+</span> <span class="s2">" - Slots: "</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">sys_act</span><span class="o">.</span><span class="n">slot_values</span><span class="p">))</span>

    <span class="c1"># self.logger.dialog_turn("System Action: " + message)</span>
    <span class="k">return</span> <span class="n">message</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h5 class="doc doc-heading" id="adviser.services.nlg.nlg.HandcraftedNLG.publish_system_utterance">
<code class="highlight language-python">
publish_system_utterance<span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> </code>
<a class="headerlink" href="#adviser.services.nlg.nlg.HandcraftedNLG.publish_system_utterance" title="Permanent link"></a></h5>
<div class="doc doc-contents">
<details class="quote">
<summary>Source code in <code>adviser/services/nlg/nlg.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>551
552
553
554
555
556
557
558
559
560
561
562
563
564
565
566
567
568
569
570
571
572
573
574
575
576
577
578
579
580
581
582</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">delegate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="n">func_inst</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">func</span><span class="o">.</span><span class="vm">__name__</span><span class="p">)</span>

    <span class="n">callargs</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">args</span><span class="p">)</span>
    <span class="k">if</span> <span class="bp">self</span> <span class="ow">in</span> <span class="n">callargs</span><span class="p">:</span>    <span class="c1"># remove self when in *args, because already known to function</span>
        <span class="n">callargs</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">func</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">callargs</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">result</span><span class="p">:</span>
        <span class="c1"># fix! (user could have multiple "/" characters in topic - only use last one )</span>
        <span class="n">domains</span> <span class="o">=</span> <span class="p">{</span><span class="n">res</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">"/"</span><span class="p">)[</span><span class="mi">0</span><span class="p">]:</span> <span class="n">res</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">"/"</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span> <span class="k">if</span> <span class="s2">"/"</span> <span class="ow">in</span> <span class="n">res</span> <span class="k">else</span> <span class="s2">""</span> <span class="k">for</span> <span class="n">res</span> <span class="ow">in</span> <span class="n">result</span><span class="p">}</span>
        <span class="n">result</span> <span class="o">=</span> <span class="p">{</span><span class="n">key</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">"/"</span><span class="p">)[</span><span class="mi">0</span><span class="p">]:</span> <span class="n">result</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">result</span><span class="p">}</span>

    <span class="k">if</span> <span class="n">func_inst</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_publish_sockets</span><span class="p">:</span>
        <span class="c1"># not a publisher, just normal function</span>
        <span class="k">return</span> <span class="n">result</span>

    <span class="n">socket</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_publish_sockets</span><span class="p">[</span><span class="n">func_inst</span><span class="p">]</span>
    <span class="n">domain</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_domain_name</span>
    <span class="k">if</span> <span class="n">socket</span> <span class="ow">and</span> <span class="n">result</span><span class="p">:</span>
        <span class="c1"># publish messages</span>
        <span class="k">for</span> <span class="n">topic</span> <span class="ow">in</span> <span class="n">pub_topics</span><span class="p">:</span>
        <span class="c1"># for topic in result: # NOTE publish any returned value in dict with it's key as topic</span>
            <span class="k">if</span> <span class="n">topic</span> <span class="ow">in</span> <span class="n">result</span><span class="p">:</span>
                <span class="n">domain</span> <span class="o">=</span> <span class="n">domain</span> <span class="k">if</span> <span class="n">domain</span> <span class="k">else</span> <span class="n">domains</span><span class="p">[</span><span class="n">topic</span><span class="p">]</span>
                <span class="n">topic_domain_str</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="n">topic</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">domain</span><span class="si">}</span><span class="s2">"</span> <span class="k">if</span> <span class="n">domain</span> <span class="k">else</span> <span class="n">topic</span>
                <span class="k">if</span> <span class="n">topic</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_pub_topic_domains</span><span class="p">:</span>
                    <span class="n">topic_domain_str</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="n">topic</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_pub_topic_domains</span><span class="p">[</span><span class="n">topic</span><span class="p">]</span><span class="si">}</span><span class="s2">"</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_pub_topic_domains</span><span class="p">[</span><span class="n">topic</span><span class="p">]</span> <span class="k">else</span> <span class="n">topic</span>
                <span class="n">_send_msg</span><span class="p">(</span><span class="n">socket</span><span class="p">,</span> <span class="n">topic_domain_str</span><span class="p">,</span> <span class="n">result</span><span class="p">[</span><span class="n">topic</span><span class="p">])</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">debug_logger</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">debug_logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
                        <span class="sa">f</span><span class="s2">"- (DS): sent message from </span><span class="si">{</span><span class="n">func</span><span class="si">}</span><span class="s2"> to topic </span><span class="si">{</span><span class="n">topic_domain_str</span><span class="si">}</span><span class="s2">:</span><span class="se">\n</span><span class="s2">   </span><span class="si">{</span><span class="n">result</span><span class="p">[</span><span class="n">topic</span><span class="p">]</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">result</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="doc doc-object doc-module">
<h3 class="doc doc-heading" id="adviser.services.nlg.templates">
<code>templates</code>
<span class="doc doc-properties">
<small class="doc doc-property doc-property-special"><code>special</code></small>
</span>
<a class="headerlink" href="#adviser.services.nlg.templates" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<div class="doc doc-children">
<div class="doc doc-object doc-module">
<h4 class="doc doc-heading" id="adviser.services.nlg.templates.builtinfunctions">
<code>builtinfunctions</code>
<a class="headerlink" href="#adviser.services.nlg.templates.builtinfunctions" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<div class="doc doc-children">
<div class="doc doc-object doc-class">
<h5 class="doc doc-heading" id="adviser.services.nlg.templates.builtinfunctions.ForEntryFunction">
<code>ForEntryFunction</code>
<a class="headerlink" href="#adviser.services.nlg.templates.builtinfunctions.ForEntryFunction" title="Permanent link"></a></h5>
<div class="doc doc-contents">
<div class="doc doc-children">
<div class="doc doc-object doc-method">
<h6 class="doc doc-heading" id="adviser.services.nlg.templates.builtinfunctions.ForEntryFunction.__init__">
<code class="highlight language-python">
__init__<span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">global_memory</span><span class="p">)</span> </code>
<span class="doc doc-properties">
<small class="doc doc-property doc-property-special"><code>special</code></small>
</span>
<a class="headerlink" href="#adviser.services.nlg.templates.builtinfunctions.ForEntryFunction.__init__" title="Permanent link"></a></h6>
<div class="doc doc-contents">
<details class="quote">
<summary>Source code in <code>adviser/services/nlg/templates/builtinfunctions.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>43
44
45</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">global_memory</span><span class="p">):</span>
    <span class="n">Function</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">'for_entry(slots, function, separator_first, separator_last)'</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">global_memory</span> <span class="o">=</span> <span class="n">global_memory</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h6 class="doc doc-heading" id="adviser.services.nlg.templates.builtinfunctions.ForEntryFunction.apply">
<code class="highlight language-python">
apply<span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parameters</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span> </code>
<a class="headerlink" href="#adviser.services.nlg.templates.builtinfunctions.ForEntryFunction.apply" title="Permanent link"></a></h6>
<div class="doc doc-contents">
<details class="quote">
<summary>Source code in <code>adviser/services/nlg/templates/builtinfunctions.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>50
51
52
53
54
55
56
57
58
59
60
61
62
63</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">apply</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parameters</span><span class="p">:</span> <span class="n">Memory</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
    <span class="n">function</span> <span class="o">=</span> <span class="n">parameters</span><span class="o">.</span><span class="n">get_function</span><span class="p">(</span><span class="n">parameters</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>
    <span class="n">extra_arguments</span> <span class="o">=</span> <span class="p">[</span><span class="n">variable</span><span class="o">.</span><span class="n">value</span> <span class="k">for</span> <span class="n">variable</span> <span class="ow">in</span> <span class="n">parameters</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="mi">4</span><span class="p">:]]</span>
    <span class="n">texts</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">for</span> <span class="n">slot_value_pair</span> <span class="ow">in</span> <span class="n">parameters</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">value</span><span class="p">:</span>
        <span class="n">memory</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_build_memory</span><span class="p">(</span><span class="n">slot_value_pair</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">slot_value_pair</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">extra_arguments</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">function</span><span class="o">.</span><span class="n">is_applicable</span><span class="p">(</span><span class="n">memory</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">BaseException</span><span class="p">(</span><span class="sa">f</span><span class="s1">'The function </span><span class="si">{</span><span class="n">function</span><span class="o">.</span><span class="n">function_name</span><span class="si">}</span><span class="s1"> could not be called '</span>
                                <span class="sa">f</span><span class="s1">'from the for_entry function'</span><span class="p">)</span>
        <span class="n">texts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">function</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">memory</span><span class="p">))</span>

    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_create_text_from_elements</span><span class="p">(</span><span class="n">texts</span><span class="p">,</span> <span class="n">parameters</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">value</span><span class="p">,</span>
                                           <span class="n">parameters</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h6 class="doc doc-heading" id="adviser.services.nlg.templates.builtinfunctions.ForEntryFunction.is_applicable">
<code class="highlight language-python">
is_applicable<span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parameters</span><span class="p">)</span> </code>
<a class="headerlink" href="#adviser.services.nlg.templates.builtinfunctions.ForEntryFunction.is_applicable" title="Permanent link"></a></h6>
<div class="doc doc-contents">
<details class="quote">
<summary>Source code in <code>adviser/services/nlg/templates/builtinfunctions.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>47
48</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">is_applicable</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parameters</span><span class="p">:</span> <span class="n">Memory</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
    <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="n">parameters</span><span class="o">.</span><span class="n">variables</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">4</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
</div>
</div>
</div>
<div class="doc doc-object doc-class">
<h5 class="doc doc-heading" id="adviser.services.nlg.templates.builtinfunctions.ForEntryListFunction">
<code>ForEntryListFunction</code>
<a class="headerlink" href="#adviser.services.nlg.templates.builtinfunctions.ForEntryListFunction" title="Permanent link"></a></h5>
<div class="doc doc-contents">
<div class="doc doc-children">
<div class="doc doc-object doc-method">
<h6 class="doc doc-heading" id="adviser.services.nlg.templates.builtinfunctions.ForEntryListFunction.__init__">
<code class="highlight language-python">
__init__<span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">global_memory</span><span class="p">)</span> </code>
<span class="doc doc-properties">
<small class="doc doc-property doc-property-special"><code>special</code></small>
</span>
<a class="headerlink" href="#adviser.services.nlg.templates.builtinfunctions.ForEntryListFunction.__init__" title="Permanent link"></a></h6>
<div class="doc doc-contents">
<details class="quote">
<summary>Source code in <code>adviser/services/nlg/templates/builtinfunctions.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>128
129
130
131</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">global_memory</span><span class="p">:</span> <span class="n">GlobalMemory</span><span class="p">):</span>
    <span class="n">Function</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">'for_entry_list(slots, function, value_sep, value_sep_last, '</span>
                            <span class="s1">'slot_sep, slot_sep_last)'</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">global_memory</span> <span class="o">=</span> <span class="n">global_memory</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h6 class="doc doc-heading" id="adviser.services.nlg.templates.builtinfunctions.ForEntryListFunction.apply">
<code class="highlight language-python">
apply<span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parameters</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span> </code>
<a class="headerlink" href="#adviser.services.nlg.templates.builtinfunctions.ForEntryListFunction.apply" title="Permanent link"></a></h6>
<div class="doc doc-contents">
<details class="quote">
<summary>Source code in <code>adviser/services/nlg/templates/builtinfunctions.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">apply</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parameters</span><span class="p">:</span> <span class="n">Memory</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
    <span class="n">function</span> <span class="o">=</span> <span class="n">parameters</span><span class="o">.</span><span class="n">get_function</span><span class="p">(</span><span class="n">parameters</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>
    <span class="n">extra_arguments</span> <span class="o">=</span> <span class="p">[</span><span class="n">variable</span><span class="o">.</span><span class="n">value</span> <span class="k">for</span> <span class="n">variable</span> <span class="ow">in</span> <span class="n">parameters</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="mi">6</span><span class="p">:]]</span>
    <span class="n">texts_per_slot</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">for</span> <span class="n">slot_values_pair</span> <span class="ow">in</span> <span class="n">parameters</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">value</span><span class="p">:</span>
        <span class="n">slot_texts</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">slot_values_pair</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span>          <br/>
<span class="n">memory</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_build_memory</span><span class="p">(</span><span class="n">slot_values_pair</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">value</span><span class="p">,</span> <span class="n">extra_arguments</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">function</span><span class="o">.</span><span class="n">is_applicable</span><span class="p">(</span><span class="n">memory</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">BaseException</span><span class="p">(</span><span class="sa">f</span><span class="s1">'The function </span><span class="si">{</span><span class="n">function</span><span class="o">.</span><span class="n">function_name</span><span class="si">}</span><span class="s1"> could not be '</span>
                                    <span class="sa">f</span><span class="s1">'called from the for_entry_list function'</span><span class="p">)</span>
            <span class="n">slot_texts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">function</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">memory</span><span class="p">))</span>
        <span class="n">text</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_create_text_from_elements</span><span class="p">(</span><span class="n">slot_texts</span><span class="p">,</span> <span class="n">parameters</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">value</span><span class="p">,</span>
                                               <span class="n">parameters</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>
        <span class="n">texts_per_slot</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>

    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_create_text_from_elements</span><span class="p">(</span><span class="n">texts_per_slot</span><span class="p">,</span> <span class="n">parameters</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span><span class="o">.</span><span class="n">value</span><span class="p">,</span>
                                           <span class="n">parameters</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h6 class="doc doc-heading" id="adviser.services.nlg.templates.builtinfunctions.ForEntryListFunction.is_applicable">
<code class="highlight language-python">
is_applicable<span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parameters</span><span class="p">)</span> </code>
<a class="headerlink" href="#adviser.services.nlg.templates.builtinfunctions.ForEntryListFunction.is_applicable" title="Permanent link"></a></h6>
<div class="doc doc-contents">
<details class="quote">
<summary>Source code in <code>adviser/services/nlg/templates/builtinfunctions.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>133
134</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">is_applicable</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parameters</span><span class="p">:</span> <span class="n">Memory</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
    <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="n">parameters</span><span class="o">.</span><span class="n">variables</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">6</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
</div>
</div>
</div>
<div class="doc doc-object doc-class">
<h5 class="doc doc-heading" id="adviser.services.nlg.templates.builtinfunctions.ForFunction">
<code>ForFunction</code>
<a class="headerlink" href="#adviser.services.nlg.templates.builtinfunctions.ForFunction" title="Permanent link"></a></h5>
<div class="doc doc-contents">
<div class="doc doc-children">
<div class="doc doc-object doc-method">
<h6 class="doc doc-heading" id="adviser.services.nlg.templates.builtinfunctions.ForFunction.__init__">
<code class="highlight language-python">
__init__<span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">global_memory</span><span class="p">)</span> </code>
<span class="doc doc-properties">
<small class="doc doc-property doc-property-special"><code>special</code></small>
</span>
<a class="headerlink" href="#adviser.services.nlg.templates.builtinfunctions.ForFunction.__init__" title="Permanent link"></a></h6>
<div class="doc doc-contents">
<details class="quote">
<summary>Source code in <code>adviser/services/nlg/templates/builtinfunctions.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>86
87
88</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">global_memory</span><span class="p">):</span>
    <span class="n">Function</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">'for(values, function, separator_first, separator_last, *args)'</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">global_memory</span> <span class="o">=</span> <span class="n">global_memory</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h6 class="doc doc-heading" id="adviser.services.nlg.templates.builtinfunctions.ForFunction.apply">
<code class="highlight language-python">
apply<span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parameters</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span> </code>
<a class="headerlink" href="#adviser.services.nlg.templates.builtinfunctions.ForFunction.apply" title="Permanent link"></a></h6>
<div class="doc doc-contents">
<details class="quote">
<summary>Source code in <code>adviser/services/nlg/templates/builtinfunctions.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span> 93
 94
 95
 96
 97
 98
 99
100
101
102
103
104
105
106</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">apply</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parameters</span><span class="p">:</span> <span class="n">Memory</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
    <span class="n">function</span> <span class="o">=</span> <span class="n">parameters</span><span class="o">.</span><span class="n">get_function</span><span class="p">(</span><span class="n">parameters</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>
    <span class="n">extra_arguments</span> <span class="o">=</span> <span class="p">[</span><span class="n">variable</span><span class="o">.</span><span class="n">value</span> <span class="k">for</span> <span class="n">variable</span> <span class="ow">in</span> <span class="n">parameters</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="mi">4</span><span class="p">:]]</span>
    <span class="n">texts</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">for</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">parameters</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">value</span><span class="p">:</span>
        <span class="n">memory</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_build_memory</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">extra_arguments</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">function</span><span class="o">.</span><span class="n">is_applicable</span><span class="p">(</span><span class="n">memory</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">BaseException</span><span class="p">(</span><span class="sa">f</span><span class="s1">'The function </span><span class="si">{</span><span class="n">function</span><span class="o">.</span><span class="n">function_name</span><span class="si">}</span><span class="s1"> could not be called '</span>
                                <span class="sa">f</span><span class="s1">'from the for function'</span><span class="p">)</span>
        <span class="n">texts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">function</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">memory</span><span class="p">))</span>

    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_create_text_from_elements</span><span class="p">(</span><span class="n">texts</span><span class="p">,</span> <span class="n">parameters</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">value</span><span class="p">,</span>
                                           <span class="n">parameters</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h6 class="doc doc-heading" id="adviser.services.nlg.templates.builtinfunctions.ForFunction.is_applicable">
<code class="highlight language-python">
is_applicable<span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parameters</span><span class="p">)</span> </code>
<a class="headerlink" href="#adviser.services.nlg.templates.builtinfunctions.ForFunction.is_applicable" title="Permanent link"></a></h6>
<div class="doc doc-contents">
<details class="quote">
<summary>Source code in <code>adviser/services/nlg/templates/builtinfunctions.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>90
91</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">is_applicable</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parameters</span><span class="p">:</span> <span class="n">Memory</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
    <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="n">parameters</span><span class="o">.</span><span class="n">variables</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">4</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
</div>
</div>
</div>
<div class="doc doc-object doc-class">
<h5 class="doc doc-heading" id="adviser.services.nlg.templates.builtinfunctions.PythonFunction">
<code>PythonFunction</code>
<a class="headerlink" href="#adviser.services.nlg.templates.builtinfunctions.PythonFunction" title="Permanent link"></a></h5>
<div class="doc doc-contents">
<div class="doc doc-children">
<div class="doc doc-object doc-method">
<h6 class="doc doc-heading" id="adviser.services.nlg.templates.builtinfunctions.PythonFunction.__init__">
<code class="highlight language-python">
__init__<span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">function_name</span><span class="p">,</span> <span class="n">function_to_call</span><span class="p">,</span> <span class="n">obligatory_arguments</span><span class="o">=</span><span class="p">[])</span> </code>
<span class="doc doc-properties">
<small class="doc doc-property doc-property-special"><code>special</code></small>
</span>
<a class="headerlink" href="#adviser.services.nlg.templates.builtinfunctions.PythonFunction.__init__" title="Permanent link"></a></h6>
<div class="doc doc-contents">
<details class="quote">
<summary>Source code in <code>adviser/services/nlg/templates/builtinfunctions.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>27
28
29
30
31</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">function_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">function_to_call</span><span class="p">:</span> <span class="n">Callable</span><span class="p">,</span>
             <span class="n">obligatory_arguments</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">object</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]):</span>
    <span class="n">Function</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="sa">f</span><span class="s1">'</span><span class="si">{</span><span class="n">function_name</span><span class="si">}</span><span class="s1">()'</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">function</span> <span class="o">=</span> <span class="n">function_to_call</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">obligatory_arguments</span> <span class="o">=</span> <span class="n">obligatory_arguments</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h6 class="doc doc-heading" id="adviser.services.nlg.templates.builtinfunctions.PythonFunction.apply">
<code class="highlight language-python">
apply<span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parameters</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span> </code>
<a class="headerlink" href="#adviser.services.nlg.templates.builtinfunctions.PythonFunction.apply" title="Permanent link"></a></h6>
<div class="doc doc-contents">
<details class="quote">
<summary>Source code in <code>adviser/services/nlg/templates/builtinfunctions.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>36
37
38
39</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">apply</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parameters</span><span class="p">:</span> <span class="n">Memory</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
    <span class="n">arguments</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">obligatory_arguments</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    <span class="n">arguments</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="n">variable</span><span class="o">.</span><span class="n">value</span> <span class="k">for</span> <span class="n">variable</span> <span class="ow">in</span> <span class="n">parameters</span><span class="o">.</span><span class="n">variables</span><span class="p">])</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">function</span><span class="p">(</span><span class="o">*</span><span class="n">arguments</span><span class="p">)</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h6 class="doc doc-heading" id="adviser.services.nlg.templates.builtinfunctions.PythonFunction.is_applicable">
<code class="highlight language-python">
is_applicable<span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parameters</span><span class="p">)</span> </code>
<a class="headerlink" href="#adviser.services.nlg.templates.builtinfunctions.PythonFunction.is_applicable" title="Permanent link"></a></h6>
<div class="doc doc-contents">
<details class="quote">
<summary>Source code in <code>adviser/services/nlg/templates/builtinfunctions.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>33
34</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">is_applicable</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parameters</span><span class="p">:</span> <span class="n">Memory</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
    <span class="k">return</span> <span class="kc">True</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="doc doc-object doc-module">
<h4 class="doc doc-heading" id="adviser.services.nlg.templates.parsing">
<code>parsing</code>
<span class="doc doc-properties">
<small class="doc doc-property doc-property-special"><code>special</code></small>
</span>
<a class="headerlink" href="#adviser.services.nlg.templates.parsing" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<div class="doc doc-children">
<div class="doc doc-object doc-module">
<h5 class="doc doc-heading" id="adviser.services.nlg.templates.parsing.automaton">
<code>automaton</code>
<a class="headerlink" href="#adviser.services.nlg.templates.parsing.automaton" title="Permanent link"></a></h5>
<div class="doc doc-contents">
<div class="doc doc-children">
<div class="doc doc-object doc-class">
<h6 class="doc doc-heading" id="adviser.services.nlg.templates.parsing.automaton.ModifiedPushdownAutomaton">
<code>ModifiedPushdownAutomaton</code>
<a class="headerlink" href="#adviser.services.nlg.templates.parsing.automaton.ModifiedPushdownAutomaton" title="Permanent link"></a></h6>
<div class="doc doc-contents">
<div class="doc doc-children">
<div class="doc doc-object doc-method">
<h7 class="doc doc-heading" data-toc-label="__init__()" id="adviser.services.nlg.templates.parsing.automaton.ModifiedPushdownAutomaton.__init__">
<code class="highlight language-python">
__init__<span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">start_state</span><span class="p">,</span> <span class="n">accept_states</span><span class="p">,</span> <span class="n">state_descriptions</span><span class="p">)</span> </code>
<span class="doc doc-properties">
<small class="doc doc-property doc-property-special"><code>special</code></small>
</span>
</h7>
<div class="doc doc-contents">
<details class="quote">
<summary>Source code in <code>adviser/services/nlg/templates/parsing/automaton.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>29
30
31
32
33
34
35
36
37
38</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">start_state</span><span class="p">:</span> <span class="n">State</span><span class="p">,</span> <span class="n">accept_states</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">State</span><span class="p">],</span>
             <span class="n">state_descriptions</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">StateDescription</span><span class="p">]):</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">start_state</span> <span class="o">=</span> <span class="n">start_state</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">accept_states</span> <span class="o">=</span> <span class="n">accept_states</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">state_descriptions</span> <span class="o">=</span> <span class="n">state_descriptions</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">state_transition_mapping</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_create_state_transition_mapping</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">state_default_transition_mapping</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_create_state_default_transition_mapping</span><span class="p">()</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">stack</span> <span class="o">=</span> <span class="n">AutomatonStack</span><span class="p">()</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h7 class="doc doc-heading" data-toc-label="parse()" id="adviser.services.nlg.templates.parsing.automaton.ModifiedPushdownAutomaton.parse">
<code class="highlight language-python">
parse<span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">input_tape</span><span class="p">)</span> </code>
</h7>
<div class="doc doc-contents">
<details class="quote">
<summary>Source code in <code>adviser/services/nlg/templates/parsing/automaton.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">parse</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">input_tape</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">object</span><span class="p">]:</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">stack</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
    <span class="n">current_state</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">start_state</span>
    <span class="n">input_tape_index</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="k">for</span> <span class="n">input_char</span> <span class="ow">in</span> <span class="n">input_tape</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">configuration</span> <span class="o">=</span> <span class="n">Configuration</span><span class="p">(</span><span class="n">current_state</span><span class="p">,</span> <span class="n">input_char</span><span class="p">)</span>
            <span class="n">transition</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_find_transition</span><span class="p">(</span><span class="n">configuration</span><span class="p">)</span>
            <span class="n">current_state</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_apply_transition</span><span class="p">(</span><span class="n">transition</span><span class="p">,</span> <span class="n">configuration</span><span class="p">)</span>
            <span class="n">input_tape_index</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">except</span> <span class="n">ParsingError</span> <span class="k">as</span> <span class="n">error</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">'State:'</span><span class="p">,</span> <span class="n">current_state</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">'Index:'</span><span class="p">,</span> <span class="n">input_tape_index</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">'Original Input:'</span><span class="p">,</span> <span class="n">input_tape</span><span class="p">)</span>
            <span class="k">raise</span> <span class="n">error</span>

    <span class="k">if</span> <span class="n">current_state</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">accept_states</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">'State:'</span><span class="p">,</span> <span class="n">current_state</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="k">raise</span> <span class="n">ParsingError</span><span class="p">(</span><span class="sa">f</span><span class="s1">'Parser was not in a final state after the input tape was read.'</span><span class="p">)</span>

    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">stack</span><span class="o">.</span><span class="n">data_stack</span><span class="p">[:]</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="doc doc-object doc-module">
<h5 class="doc doc-heading" id="adviser.services.nlg.templates.parsing.configuration">
<code>configuration</code>
<a class="headerlink" href="#adviser.services.nlg.templates.parsing.configuration" title="Permanent link"></a></h5>
<div class="doc doc-contents">
<div class="doc doc-children">
<div class="doc doc-object doc-class">
<h6 class="doc doc-heading" id="adviser.services.nlg.templates.parsing.configuration.Configuration">
<code>Configuration</code>
<a class="headerlink" href="#adviser.services.nlg.templates.parsing.configuration.Configuration" title="Permanent link"></a></h6>
<div class="doc doc-contents">
<div class="doc doc-children">
<div class="doc doc-object doc-method">
<h7 class="doc doc-heading" data-toc-label="__init__()" id="adviser.services.nlg.templates.parsing.configuration.Configuration.__init__">
<code class="highlight language-python">
__init__<span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">state</span><span class="p">,</span> <span class="n">character</span><span class="p">)</span> </code>
<span class="doc doc-properties">
<small class="doc doc-property doc-property-special"><code>special</code></small>
</span>
</h7>
<div class="doc doc-contents">
<details class="quote">
<summary>Source code in <code>adviser/services/nlg/templates/parsing/configuration.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>37
38
39</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">state</span><span class="p">:</span> <span class="n">State</span><span class="p">,</span> <span class="n">character</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">state</span> <span class="o">=</span> <span class="n">state</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">character</span> <span class="o">=</span> <span class="n">character</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
</div>
</div>
</div>
<div class="doc doc-object doc-class">
<h6 class="doc doc-heading" id="adviser.services.nlg.templates.parsing.configuration.DefaultTransition">
<code>DefaultTransition</code>
<a class="headerlink" href="#adviser.services.nlg.templates.parsing.configuration.DefaultTransition" title="Permanent link"></a></h6>
<div class="doc doc-contents">
<div class="doc doc-children">
<div class="doc doc-object doc-method">
<h7 class="doc doc-heading" data-toc-label="__init__()" id="adviser.services.nlg.templates.parsing.configuration.DefaultTransition.__init__">
<code class="highlight language-python">
__init__<span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">state</span><span class="p">)</span> </code>
<span class="doc doc-properties">
<small class="doc doc-property doc-property-special"><code>special</code></small>
</span>
</h7>
<div class="doc doc-contents">
<details class="quote">
<summary>Source code in <code>adviser/services/nlg/templates/parsing/configuration.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>54
55</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">state</span><span class="p">:</span> <span class="n">State</span><span class="p">):</span>
    <span class="n">Transition</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">Configuration</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="kc">None</span><span class="p">))</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
</div>
</div>
</div>
<div class="doc doc-object doc-class">
<h6 class="doc doc-heading" id="adviser.services.nlg.templates.parsing.configuration.SimpleForwardDefaultTransition">
<code>SimpleForwardDefaultTransition</code>
<a class="headerlink" href="#adviser.services.nlg.templates.parsing.configuration.SimpleForwardDefaultTransition" title="Permanent link"></a></h6>
<div class="doc doc-contents">
<div class="doc doc-children">
<div class="doc doc-object doc-method">
<h7 class="doc doc-heading" data-toc-label="__init__()" id="adviser.services.nlg.templates.parsing.configuration.SimpleForwardDefaultTransition.__init__">
<code class="highlight language-python">
__init__<span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">state</span><span class="p">)</span> </code>
<span class="doc doc-properties">
<small class="doc doc-property doc-property-special"><code>special</code></small>
</span>
</h7>
<div class="doc doc-contents">
<details class="quote">
<summary>Source code in <code>adviser/services/nlg/templates/parsing/configuration.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>67
68</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">state</span><span class="p">:</span> <span class="n">State</span><span class="p">):</span>
    <span class="n">DefaultTransition</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">state</span><span class="p">)</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h7 class="doc doc-heading" data-toc-label="get_output_configuration()" id="adviser.services.nlg.templates.parsing.configuration.SimpleForwardDefaultTransition.get_output_configuration">
<code class="highlight language-python">
get_output_configuration<span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">input_configuration</span><span class="p">)</span> </code>
</h7>
<div class="doc doc-contents">
<details class="quote">
<summary>Source code in <code>adviser/services/nlg/templates/parsing/configuration.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>70
71</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">get_output_configuration</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">input_configuration</span><span class="p">:</span> <span class="n">Configuration</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Configuration</span><span class="p">:</span>
    <span class="k">return</span> <span class="n">Configuration</span><span class="p">(</span><span class="n">input_configuration</span><span class="o">.</span><span class="n">state</span><span class="p">,</span> <span class="n">input_configuration</span><span class="o">.</span><span class="n">character</span><span class="p">)</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h7 class="doc doc-heading" data-toc-label="perform_stack_action()" id="adviser.services.nlg.templates.parsing.configuration.SimpleForwardDefaultTransition.perform_stack_action">
<code class="highlight language-python">
perform_stack_action<span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">stack</span><span class="p">,</span> <span class="n">configuration</span><span class="p">)</span> </code>
</h7>
<div class="doc doc-contents">
<details class="quote">
<summary>Source code in <code>adviser/services/nlg/templates/parsing/configuration.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>73
74</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">perform_stack_action</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">stack</span><span class="p">:</span> <span class="n">AutomatonStack</span><span class="p">,</span> <span class="n">configuration</span><span class="p">:</span> <span class="n">Configuration</span><span class="p">):</span>
    <span class="k">pass</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
</div>
</div>
</div>
<div class="doc doc-object doc-class">
<h6 class="doc doc-heading" id="adviser.services.nlg.templates.parsing.configuration.State">
<code>State</code>
<a class="headerlink" href="#adviser.services.nlg.templates.parsing.configuration.State" title="Permanent link"></a></h6>
<div class="doc doc-contents">
<div class="doc doc-children">
<div class="doc doc-object doc-method">
<h7 class="doc doc-heading" data-toc-label="__eq__()" id="adviser.services.nlg.templates.parsing.configuration.State.__eq__">
<code class="highlight language-python">
__eq__<span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">)</span> </code>
<span class="doc doc-properties">
<small class="doc doc-property doc-property-special"><code>special</code></small>
</span>
</h7>
<div class="doc doc-contents">
<details class="quote">
<summary>Source code in <code>adviser/services/nlg/templates/parsing/configuration.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>29
30</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="fm">__eq__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
    <span class="k">return</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">State</span><span class="p">)</span> <span class="ow">and</span> <span class="n">other</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h7 class="doc doc-heading" data-toc-label="__hash__()" id="adviser.services.nlg.templates.parsing.configuration.State.__hash__">
<code class="highlight language-python">
__hash__<span class="p">(</span><span class="bp">self</span><span class="p">)</span> </code>
<span class="doc doc-properties">
<small class="doc doc-property doc-property-special"><code>special</code></small>
</span>
</h7>
<div class="doc doc-contents">
<details class="quote">
<summary>Source code in <code>adviser/services/nlg/templates/parsing/configuration.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>32
33</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="fm">__hash__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="k">return</span> <span class="nb">hash</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h7 class="doc doc-heading" data-toc-label="__init__()" id="adviser.services.nlg.templates.parsing.configuration.State.__init__">
<code class="highlight language-python">
__init__<span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span> </code>
<span class="doc doc-properties">
<small class="doc doc-property doc-property-special"><code>special</code></small>
</span>
</h7>
<div class="doc doc-contents">
<details class="quote">
<summary>Source code in <code>adviser/services/nlg/templates/parsing/configuration.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>26
27</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
</div>
</div>
</div>
<div class="doc doc-object doc-class">
<h6 class="doc doc-heading" id="adviser.services.nlg.templates.parsing.configuration.StateDescription">
<code>StateDescription</code>
<a class="headerlink" href="#adviser.services.nlg.templates.parsing.configuration.StateDescription" title="Permanent link"></a></h6>
<div class="doc doc-contents">
<div class="doc doc-children">
<div class="doc doc-object doc-method">
<h7 class="doc doc-heading" data-toc-label="__init__()" id="adviser.services.nlg.templates.parsing.configuration.StateDescription.__init__">
<code class="highlight language-python">
__init__<span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">default_state</span><span class="p">,</span> <span class="n">default_transition</span><span class="p">,</span> <span class="n">transitions</span><span class="p">)</span> </code>
<span class="doc doc-properties">
<small class="doc doc-property doc-property-special"><code>special</code></small>
</span>
</h7>
<div class="doc doc-contents">
<details class="quote">
<summary>Source code in <code>adviser/services/nlg/templates/parsing/configuration.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>59
60
61
62
63</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">default_state</span><span class="p">:</span> <span class="n">State</span><span class="p">,</span> <span class="n">default_transition</span><span class="p">:</span> <span class="n">DefaultTransition</span><span class="p">,</span>
             <span class="n">transitions</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Transition</span><span class="p">]):</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">default_state</span> <span class="o">=</span> <span class="n">default_state</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">default_transition</span> <span class="o">=</span> <span class="n">default_transition</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">transitions</span> <span class="o">=</span> <span class="n">transitions</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
</div>
</div>
</div>
<div class="doc doc-object doc-class">
<h6 class="doc doc-heading" id="adviser.services.nlg.templates.parsing.configuration.Transition">
<code>Transition</code>
<a class="headerlink" href="#adviser.services.nlg.templates.parsing.configuration.Transition" title="Permanent link"></a></h6>
<div class="doc doc-contents">
<div class="doc doc-children">
<div class="doc doc-object doc-method">
<h7 class="doc doc-heading" data-toc-label="__init__()" id="adviser.services.nlg.templates.parsing.configuration.Transition.__init__">
<code class="highlight language-python">
__init__<span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">input_configuration</span><span class="p">)</span> </code>
<span class="doc doc-properties">
<small class="doc doc-property doc-property-special"><code>special</code></small>
</span>
</h7>
<div class="doc doc-contents">
<details class="quote">
<summary>Source code in <code>adviser/services/nlg/templates/parsing/configuration.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>43
44</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">input_configuration</span><span class="p">:</span> <span class="n">Configuration</span><span class="p">):</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">input_configuration</span> <span class="o">=</span> <span class="n">input_configuration</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h7 class="doc doc-heading" data-toc-label="get_output_configuration()" id="adviser.services.nlg.templates.parsing.configuration.Transition.get_output_configuration">
<code class="highlight language-python">
get_output_configuration<span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">input_configuration</span><span class="p">)</span> </code>
</h7>
<div class="doc doc-contents">
<details class="quote">
<summary>Source code in <code>adviser/services/nlg/templates/parsing/configuration.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>46
47</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">get_output_configuration</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">input_configuration</span><span class="p">:</span> <span class="n">Configuration</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Configuration</span><span class="p">:</span>
    <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">()</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h7 class="doc doc-heading" data-toc-label="perform_stack_action()" id="adviser.services.nlg.templates.parsing.configuration.Transition.perform_stack_action">
<code class="highlight language-python">
perform_stack_action<span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">stack</span><span class="p">,</span> <span class="n">configuration</span><span class="p">)</span> </code>
</h7>
<div class="doc doc-contents">
<details class="quote">
<summary>Source code in <code>adviser/services/nlg/templates/parsing/configuration.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>49
50</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">perform_stack_action</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">stack</span><span class="p">:</span> <span class="n">AutomatonStack</span><span class="p">,</span> <span class="n">configuration</span><span class="p">:</span> <span class="n">Configuration</span><span class="p">):</span>
    <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">()</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
</div>
</div>
</div>
<div class="doc doc-object doc-class">
<h6 class="doc doc-heading" id="adviser.services.nlg.templates.parsing.configuration.TransitionWithAction">
<code>TransitionWithAction</code>
<a class="headerlink" href="#adviser.services.nlg.templates.parsing.configuration.TransitionWithAction" title="Permanent link"></a></h6>
<div class="doc doc-contents">
<div class="doc doc-children">
<div class="doc doc-object doc-method">
<h7 class="doc doc-heading" data-toc-label="__init__()" id="adviser.services.nlg.templates.parsing.configuration.TransitionWithAction.__init__">
<code class="highlight language-python">
__init__<span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">input_configuration</span><span class="p">,</span> <span class="n">output_configuration</span><span class="p">,</span> <span class="n">action</span><span class="p">)</span> </code>
<span class="doc doc-properties">
<small class="doc doc-property doc-property-special"><code>special</code></small>
</span>
</h7>
<div class="doc doc-contents">
<details class="quote">
<summary>Source code in <code>adviser/services/nlg/templates/parsing/configuration.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>90
91
92
93
94</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">input_configuration</span><span class="p">:</span> <span class="n">Configuration</span><span class="p">,</span> <span class="n">output_configuration</span><span class="p">:</span> <span class="n">Configuration</span><span class="p">,</span>
             <span class="n">action</span><span class="p">:</span> <span class="n">Callable</span><span class="p">[[</span><span class="n">AutomatonStack</span><span class="p">],</span> <span class="kc">None</span><span class="p">]):</span>
    <span class="n">Transition</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">input_configuration</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">output_configuration</span> <span class="o">=</span> <span class="n">output_configuration</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">action</span> <span class="o">=</span> <span class="n">action</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h7 class="doc doc-heading" data-toc-label="get_output_configuration()" id="adviser.services.nlg.templates.parsing.configuration.TransitionWithAction.get_output_configuration">
<code class="highlight language-python">
get_output_configuration<span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">input_configuration</span><span class="p">)</span> </code>
</h7>
<div class="doc doc-contents">
<details class="quote">
<summary>Source code in <code>adviser/services/nlg/templates/parsing/configuration.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>96
97</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">get_output_configuration</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">input_configuration</span><span class="p">:</span> <span class="n">Configuration</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Configuration</span><span class="p">:</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">output_configuration</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h7 class="doc doc-heading" data-toc-label="perform_stack_action()" id="adviser.services.nlg.templates.parsing.configuration.TransitionWithAction.perform_stack_action">
<code class="highlight language-python">
perform_stack_action<span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">stack</span><span class="p">,</span> <span class="n">configuration</span><span class="p">)</span> </code>
</h7>
<div class="doc doc-contents">
<details class="quote">
<summary>Source code in <code>adviser/services/nlg/templates/parsing/configuration.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span> 99
100</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">perform_stack_action</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">stack</span><span class="p">:</span> <span class="n">AutomatonStack</span><span class="p">,</span> <span class="n">configuration</span><span class="p">:</span> <span class="n">Configuration</span><span class="p">):</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">action</span><span class="p">(</span><span class="n">stack</span><span class="p">)</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
</div>
</div>
</div>
<div class="doc doc-object doc-class">
<h6 class="doc doc-heading" id="adviser.services.nlg.templates.parsing.configuration.TransitionWithoutAction">
<code>TransitionWithoutAction</code>
<a class="headerlink" href="#adviser.services.nlg.templates.parsing.configuration.TransitionWithoutAction" title="Permanent link"></a></h6>
<div class="doc doc-contents">
<div class="doc doc-children">
<div class="doc doc-object doc-method">
<h7 class="doc doc-heading" data-toc-label="__init__()" id="adviser.services.nlg.templates.parsing.configuration.TransitionWithoutAction.__init__">
<code class="highlight language-python">
__init__<span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">input_configuration</span><span class="p">,</span> <span class="n">output_configuration</span><span class="p">)</span> </code>
<span class="doc doc-properties">
<small class="doc doc-property doc-property-special"><code>special</code></small>
</span>
</h7>
<div class="doc doc-contents">
<details class="quote">
<summary>Source code in <code>adviser/services/nlg/templates/parsing/configuration.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>78
79
80</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">input_configuration</span><span class="p">:</span> <span class="n">Configuration</span><span class="p">,</span> <span class="n">output_configuration</span><span class="p">:</span> <span class="n">Configuration</span><span class="p">):</span>
    <span class="n">Transition</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">input_configuration</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">output_configuration</span> <span class="o">=</span> <span class="n">output_configuration</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h7 class="doc doc-heading" data-toc-label="get_output_configuration()" id="adviser.services.nlg.templates.parsing.configuration.TransitionWithoutAction.get_output_configuration">
<code class="highlight language-python">
get_output_configuration<span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">input_configuration</span><span class="p">)</span> </code>
</h7>
<div class="doc doc-contents">
<details class="quote">
<summary>Source code in <code>adviser/services/nlg/templates/parsing/configuration.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>82
83</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">get_output_configuration</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">input_configuration</span><span class="p">:</span> <span class="n">Configuration</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Configuration</span><span class="p">:</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">output_configuration</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h7 class="doc doc-heading" data-toc-label="perform_stack_action()" id="adviser.services.nlg.templates.parsing.configuration.TransitionWithoutAction.perform_stack_action">
<code class="highlight language-python">
perform_stack_action<span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">stack</span><span class="p">,</span> <span class="n">configuration</span><span class="p">)</span> </code>
</h7>
<div class="doc doc-contents">
<details class="quote">
<summary>Source code in <code>adviser/services/nlg/templates/parsing/configuration.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>85
86</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">perform_stack_action</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">stack</span><span class="p">:</span> <span class="n">AutomatonStack</span><span class="p">,</span> <span class="n">configuration</span><span class="p">:</span> <span class="n">Configuration</span><span class="p">):</span>
    <span class="k">pass</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="doc doc-object doc-module">
<h5 class="doc doc-heading" id="adviser.services.nlg.templates.parsing.exceptions">
<code>exceptions</code>
<a class="headerlink" href="#adviser.services.nlg.templates.parsing.exceptions" title="Permanent link"></a></h5>
<div class="doc doc-contents">
<div class="doc doc-children">
<div class="doc doc-object doc-class">
<h6 class="doc doc-heading" id="adviser.services.nlg.templates.parsing.exceptions.ParsingError">
<code>ParsingError</code>
<a class="headerlink" href="#adviser.services.nlg.templates.parsing.exceptions.ParsingError" title="Permanent link"></a></h6>
<div class="doc doc-contents">
<div class="doc doc-children">
<div class="doc doc-object doc-method">
<h7 class="doc doc-heading" data-toc-label="__init__()" id="adviser.services.nlg.templates.parsing.exceptions.ParsingError.__init__">
<code class="highlight language-python">
__init__<span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">message</span><span class="p">)</span> </code>
<span class="doc doc-properties">
<small class="doc doc-property doc-property-special"><code>special</code></small>
</span>
</h7>
<div class="doc doc-contents">
<details class="quote">
<summary>Source code in <code>adviser/services/nlg/templates/parsing/exceptions.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>21
22</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">message</span><span class="p">):</span>
    <span class="ne">Exception</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">message</span><span class="p">)</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="doc doc-object doc-module">
<h5 class="doc doc-heading" id="adviser.services.nlg.templates.parsing.parsers">
<code>parsers</code>
<span class="doc doc-properties">
<small class="doc doc-property doc-property-special"><code>special</code></small>
</span>
<a class="headerlink" href="#adviser.services.nlg.templates.parsing.parsers" title="Permanent link"></a></h5>
<div class="doc doc-contents">
<div class="doc doc-children">
<div class="doc doc-object doc-module">
<h6 class="doc doc-heading" id="adviser.services.nlg.templates.parsing.parsers.messageparser">
<code>messageparser</code>
<span class="doc doc-properties">
<small class="doc doc-property doc-property-special"><code>special</code></small>
</span>
<a class="headerlink" href="#adviser.services.nlg.templates.parsing.parsers.messageparser" title="Permanent link"></a></h6>
<div class="doc doc-contents">
<div class="doc doc-children">
<div class="doc doc-object doc-module">
<h7 class="doc doc-heading" data-toc-label="messageparser" id="adviser.services.nlg.templates.parsing.parsers.messageparser.messageparser">
<code>messageparser</code>
</h7>
<div class="doc doc-contents">
<div class="doc doc-children">
<div class="doc doc-object doc-class">
<h8 class="doc doc-heading" data-toc-label="MessageParser" id="adviser.services.nlg.templates.parsing.parsers.messageparser.messageparser.MessageParser">
<code>MessageParser</code>
</h8>
<div class="doc doc-contents">
<div class="doc doc-children">
<div class="doc doc-object doc-method">
<h9 class="doc doc-heading" data-toc-label="__init__()" id="adviser.services.nlg.templates.parsing.parsers.messageparser.messageparser.MessageParser.__init__">
<code class="highlight language-python">
__init__<span class="p">(</span><span class="bp">self</span><span class="p">)</span> </code>
<span class="doc doc-properties">
<small class="doc doc-property doc-property-special"><code>special</code></small>
</span>
</h9>
<div class="doc doc-contents">
<details class="quote">
<summary>Source code in <code>adviser/services/nlg/templates/parsing/parsers/messageparser/messageparser.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>43
44
45
46
47
48
49
50
51
52
53
54</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="n">ModifiedPushdownAutomaton</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">StartState</span><span class="p">(),</span> <span class="p">[</span><span class="n">AcceptState</span><span class="p">()],</span> <span class="p">[</span>
        <span class="n">StartStateDescription</span><span class="p">(),</span>
        <span class="n">AcceptStateDescription</span><span class="p">(),</span>
        <span class="n">MessageStateDescription</span><span class="p">(),</span>
        <span class="n">EscapeStateDescription</span><span class="p">(),</span>
        <span class="n">CodeStateDescription</span><span class="p">(),</span>
        <span class="n">AdviserStateDescription</span><span class="p">(),</span>
        <span class="n">PythonStateDescription</span><span class="p">(),</span>
        <span class="n">PythonClosingBraceStateDescription</span><span class="p">(),</span>
        <span class="n">CodeStringStateDescription</span><span class="p">()</span>
    <span class="p">])</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="doc doc-object doc-module">
<h5 class="doc doc-heading" id="adviser.services.nlg.templates.parsing.stack">
<code>stack</code>
<a class="headerlink" href="#adviser.services.nlg.templates.parsing.stack" title="Permanent link"></a></h5>
<div class="doc doc-contents">
<div class="doc doc-children">
<div class="doc doc-object doc-class">
<h6 class="doc doc-heading" id="adviser.services.nlg.templates.parsing.stack.AutomatonStack">
<code>AutomatonStack</code>
<a class="headerlink" href="#adviser.services.nlg.templates.parsing.stack.AutomatonStack" title="Permanent link"></a></h6>
<div class="doc doc-contents">
<div class="doc doc-children">
<div class="doc doc-object doc-method">
<h7 class="doc doc-heading" data-toc-label="__init__()" id="adviser.services.nlg.templates.parsing.stack.AutomatonStack.__init__">
<code class="highlight language-python">
__init__<span class="p">(</span><span class="bp">self</span><span class="p">)</span> </code>
<span class="doc doc-properties">
<small class="doc doc-property doc-property-special"><code>special</code></small>
</span>
</h7>
<div class="doc doc-contents">
<details class="quote">
<summary>Source code in <code>adviser/services/nlg/templates/parsing/stack.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>24
25
26
27</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="c1"># self.char_stack = []  # the automaton's stack</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">data_stack</span> <span class="o">=</span> <span class="p">[]</span>  <span class="c1"># the stack in which custom data structures can be stored</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">levels</span> <span class="o">=</span> <span class="p">[[]]</span>  <span class="c1"># multiple automaton stacks are possible here</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h7 class="doc doc-heading" data-toc-label="add_char()" id="adviser.services.nlg.templates.parsing.stack.AutomatonStack.add_char">
<code class="highlight language-python">
add_char<span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">stack_char</span><span class="p">)</span> </code>
</h7>
<div class="doc doc-contents">
<details class="quote">
<summary>Source code in <code>adviser/services/nlg/templates/parsing/stack.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>29
30
31
32</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">add_char</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">stack_char</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">levels</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">ParsingError</span><span class="p">(</span><span class="s1">'No more levels left on the stack'</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">levels</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">stack_char</span><span class="p">)</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h7 class="doc doc-heading" data-toc-label="add_data()" id="adviser.services.nlg.templates.parsing.stack.AutomatonStack.add_data">
<code class="highlight language-python">
add_data<span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span> </code>
</h7>
<div class="doc doc-contents">
<details class="quote">
<summary>Source code in <code>adviser/services/nlg/templates/parsing/stack.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>34
35</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">add_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span> <span class="nb">object</span><span class="p">):</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">data_stack</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h7 class="doc doc-heading" data-toc-label="add_level()" id="adviser.services.nlg.templates.parsing.stack.AutomatonStack.add_level">
<code class="highlight language-python">
add_level<span class="p">(</span><span class="bp">self</span><span class="p">)</span> </code>
</h7>
<div class="doc doc-contents">
<details class="quote">
<summary>Source code in <code>adviser/services/nlg/templates/parsing/stack.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>43
44</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">add_level</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">levels</span><span class="o">.</span><span class="n">append</span><span class="p">([])</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h7 class="doc doc-heading" data-toc-label="clear()" id="adviser.services.nlg.templates.parsing.stack.AutomatonStack.clear">
<code class="highlight language-python">
clear<span class="p">(</span><span class="bp">self</span><span class="p">)</span> </code>
</h7>
<div class="doc doc-contents">
<details class="quote">
<summary>Source code in <code>adviser/services/nlg/templates/parsing/stack.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>56
57
58</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">clear</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">data_stack</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">levels</span> <span class="o">=</span> <span class="p">[[]]</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h7 class="doc doc-heading" data-toc-label="fetch_data()" id="adviser.services.nlg.templates.parsing.stack.AutomatonStack.fetch_data">
<code class="highlight language-python">
fetch_data<span class="p">(</span><span class="bp">self</span><span class="p">)</span> </code>
</h7>
<div class="doc doc-contents">
<details class="quote">
<summary>Source code in <code>adviser/services/nlg/templates/parsing/stack.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>40
41</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">fetch_data</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">object</span><span class="p">:</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_stack</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h7 class="doc doc-heading" data-toc-label="get_current_content()" id="adviser.services.nlg.templates.parsing.stack.AutomatonStack.get_current_content">
<code class="highlight language-python">
get_current_content<span class="p">(</span><span class="bp">self</span><span class="p">)</span> </code>
</h7>
<div class="doc doc-contents">
<details class="quote">
<summary>Source code in <code>adviser/services/nlg/templates/parsing/stack.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>46
47
48
49</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">get_current_content</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">levels</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">ParsingError</span><span class="p">(</span><span class="s1">'No more levels left on the stack'</span><span class="p">)</span>
    <span class="k">return</span> <span class="s1">''</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">levels</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h7 class="doc doc-heading" data-toc-label="pop_data()" id="adviser.services.nlg.templates.parsing.stack.AutomatonStack.pop_data">
<code class="highlight language-python">
pop_data<span class="p">(</span><span class="bp">self</span><span class="p">)</span> </code>
</h7>
<div class="doc doc-contents">
<details class="quote">
<summary>Source code in <code>adviser/services/nlg/templates/parsing/stack.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>37
38</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">pop_data</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">object</span><span class="p">:</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_stack</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h7 class="doc doc-heading" data-toc-label="remove_level()" id="adviser.services.nlg.templates.parsing.stack.AutomatonStack.remove_level">
<code class="highlight language-python">
remove_level<span class="p">(</span><span class="bp">self</span><span class="p">)</span> </code>
</h7>
<div class="doc doc-contents">
<details class="quote">
<summary>Source code in <code>adviser/services/nlg/templates/parsing/stack.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>51
52
53
54</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">remove_level</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">levels</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">ParsingError</span><span class="p">(</span><span class="s1">'No more levels to remove from the stack'</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">levels</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="doc doc-object doc-module">
<h4 class="doc doc-heading" id="adviser.services.nlg.templates.preprocessing">
<code>preprocessing</code>
<a class="headerlink" href="#adviser.services.nlg.templates.preprocessing" title="Permanent link"></a></h4>
<div class="doc doc-contents">
</div>
</div>
<div class="doc doc-object doc-module">
<h4 class="doc doc-heading" id="adviser.services.nlg.templates.templatefile">
<code>templatefile</code>
<a class="headerlink" href="#adviser.services.nlg.templates.templatefile" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<div class="doc doc-children">
<div class="doc doc-object doc-class">
<h5 class="doc doc-heading" id="adviser.services.nlg.templates.templatefile.TemplateFile">
<code>TemplateFile</code>
<a class="headerlink" href="#adviser.services.nlg.templates.templatefile.TemplateFile" title="Permanent link"></a></h5>
<div class="doc doc-contents">
<p>Interprets a template file</p>
<div class="codehilite">
<pre><span></span><code><span class="err">!!! attributes</span>
<span class="err">    global_memory {GlobalMemory} -- memory that can be accessed at all times in the tempaltes</span>
</code></pre>
</div>
<div class="doc doc-children">
<div class="doc doc-object doc-method">
<h6 class="doc doc-heading" id="adviser.services.nlg.templates.templatefile.TemplateFile.__init__">
<code class="highlight language-python">
__init__<span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">,</span> <span class="n">domain</span><span class="p">)</span> </code>
<span class="doc doc-properties">
<small class="doc doc-property doc-property-special"><code>special</code></small>
</span>
<a class="headerlink" href="#adviser.services.nlg.templates.templatefile.TemplateFile.__init__" title="Permanent link"></a></h6>
<div class="doc doc-contents">
<details class="quote">
<summary>Source code in <code>adviser/services/nlg/templates/templatefile.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>63
64
65
66
67
68</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">domain</span><span class="p">:</span> <span class="n">JSONLookupDomain</span><span class="p">):</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">global_memory</span> <span class="o">=</span> <span class="n">GlobalMemory</span><span class="p">(</span><span class="n">domain</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_add_built_in_functions</span><span class="p">()</span>
    <span class="n">tfr</span> <span class="o">=</span> <span class="n">_TemplateFileReader</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_templates</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_create_template_dict</span><span class="p">(</span><span class="n">tfr</span><span class="o">.</span><span class="n">get_templates</span><span class="p">())</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_add_functions_to_global_memory</span><span class="p">(</span><span class="n">tfr</span><span class="o">.</span><span class="n">get_functions</span><span class="p">())</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h6 class="doc doc-heading" id="adviser.services.nlg.templates.templatefile.TemplateFile.add_python_function">
<code class="highlight language-python">
add_python_function<span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">function_name</span><span class="p">,</span> <span class="n">python_function</span><span class="p">,</span> <span class="n">obligatory_arguments</span><span class="o">=</span><span class="p">[])</span> </code>
<a class="headerlink" href="#adviser.services.nlg.templates.templatefile.TemplateFile.add_python_function" title="Permanent link"></a></h6>
<div class="doc doc-contents">
<p>Add a python function to the global memory of the template file interpreter</p>
<p>Keyword Arguments:
    obligatory_arguments {List[object]} -- objects that are always passed as first
        arguments to the python function, e.g. "self" (default: {[]})</p>
<details class="quote">
<summary>Source code in <code>adviser/services/nlg/templates/templatefile.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>111
112
113
114
115
116
117
118
119
120
121
122
123
124
125</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">add_python_function</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">function_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">python_function</span><span class="p">:</span> <span class="n">Callable</span><span class="p">[[</span><span class="nb">object</span><span class="p">],</span> <span class="nb">str</span><span class="p">],</span>
                        <span class="n">obligatory_arguments</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">object</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]):</span>
    <span class="sd">"""Add a python function to the global memory of the template file interpreter</span>

<span class="sd">    Arguments:</span>
<span class="sd">        function_name {str} -- name under which the function can be accessed in template file</span>
<span class="sd">        python_function {Callable[[object], str]} -- python function which is called when being</span>
<span class="sd">            accessed in the template file</span>

<span class="sd">    Keyword Arguments:</span>
<span class="sd">        obligatory_arguments {List[object]} -- objects that are always passed as first</span>
<span class="sd">            arguments to the python function, e.g. "self" (default: {[]})</span>
<span class="sd">    """</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">global_memory</span><span class="o">.</span><span class="n">add_function</span><span class="p">(</span><span class="n">PythonFunction</span><span class="p">(</span><span class="n">function_name</span><span class="p">,</span> <span class="n">python_function</span><span class="p">,</span>
                                                   <span class="n">obligatory_arguments</span><span class="p">))</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h6 class="doc doc-heading" id="adviser.services.nlg.templates.templatefile.TemplateFile.create_message">
<code class="highlight language-python">
create_message<span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sys_act</span><span class="p">)</span> </code>
<a class="headerlink" href="#adviser.services.nlg.templates.templatefile.TemplateFile.create_message" title="Permanent link"></a></h6>
<div class="doc doc-contents">
<p>Iterates through all possible templates and applies the first one to fit the system act</p>
<p><strong>Exceptions:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>BaseException</code></td>
<td>
<p>when no template could be applied</p>
</td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>str</code></td>
<td>
<p>str -- the message returned by the template</p>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>adviser/services/nlg/templates/templatefile.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span> 87
 88
 89
 90
 91
 92
 93
 94
 95
 96
 97
 98
 99
100
101
102
103</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">create_message</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sys_act</span><span class="p">:</span> <span class="n">SysAct</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
    <span class="sd">"""Iterates through all possible templates and applies the first one to fit the system act</span>

<span class="sd">    Arguments:</span>
<span class="sd">        sys_act {SysAct} -- the system act to find a template for</span>

<span class="sd">    Raises:</span>
<span class="sd">        BaseException: when no template could be applied</span>

<span class="sd">    Returns:</span>
<span class="sd">        str -- the message returned by the template</span>
<span class="sd">    """</span>
    <span class="n">slots</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_create_memory_from_sys_act</span><span class="p">(</span><span class="n">sys_act</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">template</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_templates</span><span class="p">[</span><span class="n">sys_act</span><span class="o">.</span><span class="n">type</span><span class="o">.</span><span class="n">value</span><span class="p">]:</span>
        <span class="k">if</span> <span class="n">template</span><span class="o">.</span><span class="n">is_applicable</span><span class="p">(</span><span class="n">slots</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">template</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">slots</span><span class="p">)</span>
    <span class="k">raise</span> <span class="ne">BaseException</span><span class="p">(</span><span class="s1">'No template was found for the given system act.'</span><span class="p">)</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="doc doc-object doc-module">
<h2 class="doc doc-heading" id="adviser.services.nlu">
<code>nlu</code>
<span class="doc doc-properties">
<small class="doc doc-property doc-property-special"><code>special</code></small>
</span>
<a class="headerlink" href="#adviser.services.nlu" title="Permanent link"></a></h2>
<div class="doc doc-contents">
<div class="doc doc-children">
<div class="doc doc-object doc-module">
<h3 class="doc doc-heading" id="adviser.services.nlu.nlu">
<code>nlu</code>
<a class="headerlink" href="#adviser.services.nlu.nlu" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<div class="doc doc-children">
<div class="doc doc-object doc-class">
<h4 class="doc doc-heading" id="adviser.services.nlu.nlu.HandcraftedNLU">
<code>HandcraftedNLU</code>
<a class="headerlink" href="#adviser.services.nlu.nlu.HandcraftedNLU" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>Class for Handcrafted Natural Language Understanding Module (HDC-NLU).</p>
<p>HDC-NLU is a rule-based approach to recognize the user acts as well as
their respective slots and values from the user input (i.e. text)
by means of regular expressions.</p>
<p>HDC-NLU is domain-independet. The regular expressions of are read
from JSON files.</p>
<p>There exist a JSON file that stores general rules (GeneralRules.json),
i.e. rules that apply to any domain, e.g. rules to detect salutation (Hello, Hi).</p>
<p>There are two more files per domain that contain the domain-specific rules
for request and inform user acts, e.g. ImsCoursesInformRules.json and
ImsCoursesRequestRules.json.</p>
<p>The output during dialog interaction of this module is a semantic
representation of the user input.</p>
<p>"I am looking for pizza" --&gt; inform(slot=food,value=italian)</p>
<p>See the regex_generator under tools, if the existing regular expressions
need to be changed or a new domain should be added.</p>
<div class="doc doc-children">
<div class="doc doc-object doc-method">
<h5 class="doc doc-heading" id="adviser.services.nlu.nlu.HandcraftedNLU.__init__">
<code class="highlight language-python">
__init__<span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">domain</span><span class="p">,</span> <span class="n">logger</span><span class="o">=&lt;</span><span class="n">DiasysLogger</span> <span class="n">adviser</span> <span class="p">(</span><span class="n">NOTSET</span><span class="p">)</span><span class="o">&gt;</span><span class="p">,</span> <span class="n">language</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span> </code>
<span class="doc doc-properties">
<small class="doc doc-property doc-property-special"><code>special</code></small>
</span>
<a class="headerlink" href="#adviser.services.nlu.nlu.HandcraftedNLU.__init__" title="Permanent link"></a></h5>
<div class="doc doc-contents">
<p>Loads
    - domain key
    - informable slots
    - requestable slots
    - domain-independent regular expressions
    - domain-specific regualer espressions</p>
<p>It sets the previous system act to None</p>
<details class="quote">
<summary>Source code in <code>adviser/services/nlu/nlu.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span> 68
 69
 70
 71
 72
 73
 74
 75
 76
 77
 78
 79
 80
 81
 82
 83
 84
 85
 86
 87
 88
 89
 90
 91
 92
 93
 94
 95
 96
 97
 98
 99
100
101
102
103
104
105</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">domain</span><span class="p">:</span> <span class="n">JSONLookupDomain</span><span class="p">,</span> <span class="n">logger</span><span class="p">:</span> <span class="n">DiasysLogger</span> <span class="o">=</span> <span class="n">DiasysLogger</span><span class="p">(),</span>
             <span class="n">language</span><span class="p">:</span> <span class="n">Language</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
    <span class="sd">"""</span>
<span class="sd">    Loads</span>
<span class="sd">        - domain key</span>
<span class="sd">        - informable slots</span>
<span class="sd">        - requestable slots</span>
<span class="sd">        - domain-independent regular expressions</span>
<span class="sd">        - domain-specific regualer espressions</span>

<span class="sd">    It sets the previous system act to None</span>

<span class="sd">    Args:</span>
<span class="sd">        domain {domain.jsonlookupdomain.JSONLookupDomain} -- Domain</span>
<span class="sd">    """</span>
    <span class="n">Service</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">domain</span><span class="o">=</span><span class="n">domain</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">logger</span> <span class="o">=</span> <span class="n">logger</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">language</span> <span class="o">=</span> <span class="n">language</span> <span class="k">if</span> <span class="n">language</span> <span class="k">else</span> <span class="n">Language</span><span class="o">.</span><span class="n">ENGLISH</span>

    <span class="c1"># Getting domain information</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">domain_name</span> <span class="o">=</span> <span class="n">domain</span><span class="o">.</span><span class="n">get_domain_name</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">domain_key</span> <span class="o">=</span> <span class="n">domain</span><span class="o">.</span><span class="n">get_primary_key</span><span class="p">()</span>

    <span class="c1"># Getting lists of informable and requestable slots</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">USER_INFORMABLE</span> <span class="o">=</span> <span class="n">domain</span><span class="o">.</span><span class="n">get_informable_slots</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">USER_REQUESTABLE</span> <span class="o">=</span> <span class="n">domain</span><span class="o">.</span><span class="n">get_requestable_slots</span><span class="p">()</span>

    <span class="c1"># Getting the relative path where regexes are stored</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">base_folder</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">get_root_dir</span><span class="p">(),</span> <span class="s1">'resources'</span><span class="p">,</span> <span class="s1">'nlu_regexes'</span><span class="p">)</span>

    <span class="c1"># Setting previous system act to None to signal the first turn</span>
    <span class="c1"># self.prev_sys_act = None</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">sys_act_info</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">'last_act'</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span> <span class="s1">'lastInformedPrimKeyVal'</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span> <span class="s1">'lastRequestSlot'</span><span class="p">:</span> <span class="kc">None</span><span class="p">}</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">language</span> <span class="o">=</span> <span class="n">Language</span><span class="o">.</span><span class="n">ENGLISH</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_initialize</span><span class="p">()</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h5 class="doc doc-heading" id="adviser.services.nlu.nlu.HandcraftedNLU.extract_user_acts">
<code class="highlight language-python">
extract_user_acts<span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> </code>
<a class="headerlink" href="#adviser.services.nlu.nlu.HandcraftedNLU.extract_user_acts" title="Permanent link"></a></h5>
<div class="doc doc-contents">
<details class="quote">
<summary>Source code in <code>adviser/services/nlu/nlu.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>551
552
553
554
555
556
557
558
559
560
561
562
563
564
565
566
567
568
569
570
571
572
573
574
575
576
577
578
579
580
581
582</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">delegate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="n">func_inst</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">func</span><span class="o">.</span><span class="vm">__name__</span><span class="p">)</span>

    <span class="n">callargs</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">args</span><span class="p">)</span>
    <span class="k">if</span> <span class="bp">self</span> <span class="ow">in</span> <span class="n">callargs</span><span class="p">:</span>    <span class="c1"># remove self when in *args, because already known to function</span>
        <span class="n">callargs</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">func</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">callargs</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">result</span><span class="p">:</span>
        <span class="c1"># fix! (user could have multiple "/" characters in topic - only use last one )</span>
        <span class="n">domains</span> <span class="o">=</span> <span class="p">{</span><span class="n">res</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">"/"</span><span class="p">)[</span><span class="mi">0</span><span class="p">]:</span> <span class="n">res</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">"/"</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span> <span class="k">if</span> <span class="s2">"/"</span> <span class="ow">in</span> <span class="n">res</span> <span class="k">else</span> <span class="s2">""</span> <span class="k">for</span> <span class="n">res</span> <span class="ow">in</span> <span class="n">result</span><span class="p">}</span>
        <span class="n">result</span> <span class="o">=</span> <span class="p">{</span><span class="n">key</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">"/"</span><span class="p">)[</span><span class="mi">0</span><span class="p">]:</span> <span class="n">result</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">result</span><span class="p">}</span>

    <span class="k">if</span> <span class="n">func_inst</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_publish_sockets</span><span class="p">:</span>
        <span class="c1"># not a publisher, just normal function</span>
        <span class="k">return</span> <span class="n">result</span>

    <span class="n">socket</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_publish_sockets</span><span class="p">[</span><span class="n">func_inst</span><span class="p">]</span>
    <span class="n">domain</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_domain_name</span>
    <span class="k">if</span> <span class="n">socket</span> <span class="ow">and</span> <span class="n">result</span><span class="p">:</span>
        <span class="c1"># publish messages</span>
        <span class="k">for</span> <span class="n">topic</span> <span class="ow">in</span> <span class="n">pub_topics</span><span class="p">:</span>
        <span class="c1"># for topic in result: # NOTE publish any returned value in dict with it's key as topic</span>
            <span class="k">if</span> <span class="n">topic</span> <span class="ow">in</span> <span class="n">result</span><span class="p">:</span>
                <span class="n">domain</span> <span class="o">=</span> <span class="n">domain</span> <span class="k">if</span> <span class="n">domain</span> <span class="k">else</span> <span class="n">domains</span><span class="p">[</span><span class="n">topic</span><span class="p">]</span>
                <span class="n">topic_domain_str</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="n">topic</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">domain</span><span class="si">}</span><span class="s2">"</span> <span class="k">if</span> <span class="n">domain</span> <span class="k">else</span> <span class="n">topic</span>
                <span class="k">if</span> <span class="n">topic</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_pub_topic_domains</span><span class="p">:</span>
                    <span class="n">topic_domain_str</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="n">topic</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_pub_topic_domains</span><span class="p">[</span><span class="n">topic</span><span class="p">]</span><span class="si">}</span><span class="s2">"</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_pub_topic_domains</span><span class="p">[</span><span class="n">topic</span><span class="p">]</span> <span class="k">else</span> <span class="n">topic</span>
                <span class="n">_send_msg</span><span class="p">(</span><span class="n">socket</span><span class="p">,</span> <span class="n">topic_domain_str</span><span class="p">,</span> <span class="n">result</span><span class="p">[</span><span class="n">topic</span><span class="p">])</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">debug_logger</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">debug_logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
                        <span class="sa">f</span><span class="s2">"- (DS): sent message from </span><span class="si">{</span><span class="n">func</span><span class="si">}</span><span class="s2"> to topic </span><span class="si">{</span><span class="n">topic_domain_str</span><span class="si">}</span><span class="s2">:</span><span class="se">\n</span><span class="s2">   </span><span class="si">{</span><span class="n">result</span><span class="p">[</span><span class="n">topic</span><span class="p">]</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">result</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h5 class="doc doc-heading" id="adviser.services.nlu.nlu.HandcraftedNLU.start_dialog">
<code class="highlight language-python">
start_dialog<span class="p">(</span><span class="bp">self</span><span class="p">)</span> </code>
<a class="headerlink" href="#adviser.services.nlu.nlu.HandcraftedNLU.start_dialog" title="Permanent link"></a></h5>
<div class="doc doc-contents">
<p>Sets the previous system act as None.
This function is called when the dialog starts</p>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>dict</code></td>
<td>
<p>Empty dictionary</p>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>adviser/services/nlu/nlu.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>390
391
392
393
394
395
396
397
398
399
400</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">start_dialog</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
    <span class="sd">"""</span>
<span class="sd">    Sets the previous system act as None.</span>
<span class="sd">    This function is called when the dialog starts</span>

<span class="sd">    Returns:</span>
<span class="sd">        Empty dictionary</span>

<span class="sd">    """</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">sys_act_info</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">'last_act'</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span> <span class="s1">'lastInformedPrimKeyVal'</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span> <span class="s1">'lastRequestSlot'</span><span class="p">:</span> <span class="kc">None</span><span class="p">}</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
</div>
</div>
</div>
<div class="doc doc-object doc-function">
<h4 class="doc doc-heading" id="adviser.services.nlu.nlu.get_root_dir">
<code class="highlight language-python">
get_root_dir<span class="p">()</span> </code>
<a class="headerlink" href="#adviser.services.nlu.nlu.get_root_dir" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<details class="quote">
<summary>Source code in <code>adviser/services/nlu/nlu.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>35
36</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">get_root_dir</span><span class="p">():</span>
    <span class="k">return</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="vm">__file__</span><span class="p">))))</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="doc doc-object doc-module">
<h2 class="doc doc-heading" id="adviser.services.policy">
<code>policy</code>
<span class="doc doc-properties">
<small class="doc doc-property doc-property-special"><code>special</code></small>
</span>
<a class="headerlink" href="#adviser.services.policy" title="Permanent link"></a></h2>
<div class="doc doc-contents">
<div class="doc doc-children">
<div class="doc doc-object doc-module">
<h3 class="doc doc-heading" id="adviser.services.policy.affective_policy">
<code>affective_policy</code>
<a class="headerlink" href="#adviser.services.policy.affective_policy" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<div class="doc doc-children">
<div class="doc doc-object doc-class">
<h4 class="doc doc-heading" id="adviser.services.policy.affective_policy.EmotionPolicy">
<code>EmotionPolicy</code>
<a class="headerlink" href="#adviser.services.policy.affective_policy.EmotionPolicy" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>Module for deciding what type of emotional response/ engagement level of response, the system
       should give</p>
<div class="doc doc-children">
<div class="doc doc-object doc-method">
<h5 class="doc doc-heading" id="adviser.services.policy.affective_policy.EmotionPolicy.__init__">
<code class="highlight language-python">
__init__<span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">domain</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">logger</span><span class="o">=&lt;</span><span class="n">DiasysLogger</span> <span class="n">adviser</span> <span class="p">(</span><span class="n">NOTSET</span><span class="p">)</span><span class="o">&gt;</span><span class="p">)</span> </code>
<span class="doc doc-properties">
<small class="doc doc-property doc-property-special"><code>special</code></small>
</span>
<a class="headerlink" href="#adviser.services.policy.affective_policy.EmotionPolicy.__init__" title="Permanent link"></a></h5>
<div class="doc doc-contents">
<p>Initializes the policy</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>domain</code></td>
<td><code>JSONLookupDomain</code></td>
<td>
<p>the domain that the affective policy should operate in</p>
</td>
<td><code>None</code></td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>adviser/services/policy/affective_policy.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>34
35
36
37
38
39
40
41
42
43
44</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">domain</span><span class="p">:</span> <span class="n">JSONLookupDomain</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">logger</span><span class="p">:</span> <span class="n">DiasysLogger</span> <span class="o">=</span> <span class="n">DiasysLogger</span><span class="p">()):</span>
    <span class="sd">"""</span>
<span class="sd">    Initializes the policy</span>

<span class="sd">    Arguments:</span>
<span class="sd">        domain (JSONLookupDomain): the domain that the affective policy should operate in</span>

<span class="sd">    """</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">first_turn</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="n">Service</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">domain</span><span class="o">=</span><span class="n">domain</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">logger</span> <span class="o">=</span> <span class="n">logger</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h5 class="doc doc-heading" id="adviser.services.policy.affective_policy.EmotionPolicy.choose_sys_emotion">
<code class="highlight language-python">
choose_sys_emotion<span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> </code>
<a class="headerlink" href="#adviser.services.policy.affective_policy.EmotionPolicy.choose_sys_emotion" title="Permanent link"></a></h5>
<div class="doc doc-contents">
<details class="quote">
<summary>Source code in <code>adviser/services/policy/affective_policy.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>551
552
553
554
555
556
557
558
559
560
561
562
563
564
565
566
567
568
569
570
571
572
573
574
575
576
577
578
579
580
581
582</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">delegate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="n">func_inst</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">func</span><span class="o">.</span><span class="vm">__name__</span><span class="p">)</span>

    <span class="n">callargs</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">args</span><span class="p">)</span>
    <span class="k">if</span> <span class="bp">self</span> <span class="ow">in</span> <span class="n">callargs</span><span class="p">:</span>    <span class="c1"># remove self when in *args, because already known to function</span>
        <span class="n">callargs</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">func</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">callargs</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">result</span><span class="p">:</span>
        <span class="c1"># fix! (user could have multiple "/" characters in topic - only use last one )</span>
        <span class="n">domains</span> <span class="o">=</span> <span class="p">{</span><span class="n">res</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">"/"</span><span class="p">)[</span><span class="mi">0</span><span class="p">]:</span> <span class="n">res</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">"/"</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span> <span class="k">if</span> <span class="s2">"/"</span> <span class="ow">in</span> <span class="n">res</span> <span class="k">else</span> <span class="s2">""</span> <span class="k">for</span> <span class="n">res</span> <span class="ow">in</span> <span class="n">result</span><span class="p">}</span>
        <span class="n">result</span> <span class="o">=</span> <span class="p">{</span><span class="n">key</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">"/"</span><span class="p">)[</span><span class="mi">0</span><span class="p">]:</span> <span class="n">result</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">result</span><span class="p">}</span>

    <span class="k">if</span> <span class="n">func_inst</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_publish_sockets</span><span class="p">:</span>
        <span class="c1"># not a publisher, just normal function</span>
        <span class="k">return</span> <span class="n">result</span>

    <span class="n">socket</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_publish_sockets</span><span class="p">[</span><span class="n">func_inst</span><span class="p">]</span>
    <span class="n">domain</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_domain_name</span>
    <span class="k">if</span> <span class="n">socket</span> <span class="ow">and</span> <span class="n">result</span><span class="p">:</span>
        <span class="c1"># publish messages</span>
        <span class="k">for</span> <span class="n">topic</span> <span class="ow">in</span> <span class="n">pub_topics</span><span class="p">:</span>
        <span class="c1"># for topic in result: # NOTE publish any returned value in dict with it's key as topic</span>
            <span class="k">if</span> <span class="n">topic</span> <span class="ow">in</span> <span class="n">result</span><span class="p">:</span>
                <span class="n">domain</span> <span class="o">=</span> <span class="n">domain</span> <span class="k">if</span> <span class="n">domain</span> <span class="k">else</span> <span class="n">domains</span><span class="p">[</span><span class="n">topic</span><span class="p">]</span>
                <span class="n">topic_domain_str</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="n">topic</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">domain</span><span class="si">}</span><span class="s2">"</span> <span class="k">if</span> <span class="n">domain</span> <span class="k">else</span> <span class="n">topic</span>
                <span class="k">if</span> <span class="n">topic</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_pub_topic_domains</span><span class="p">:</span>
                    <span class="n">topic_domain_str</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="n">topic</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_pub_topic_domains</span><span class="p">[</span><span class="n">topic</span><span class="p">]</span><span class="si">}</span><span class="s2">"</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_pub_topic_domains</span><span class="p">[</span><span class="n">topic</span><span class="p">]</span> <span class="k">else</span> <span class="n">topic</span>
                <span class="n">_send_msg</span><span class="p">(</span><span class="n">socket</span><span class="p">,</span> <span class="n">topic_domain_str</span><span class="p">,</span> <span class="n">result</span><span class="p">[</span><span class="n">topic</span><span class="p">])</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">debug_logger</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">debug_logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
                        <span class="sa">f</span><span class="s2">"- (DS): sent message from </span><span class="si">{</span><span class="n">func</span><span class="si">}</span><span class="s2"> to topic </span><span class="si">{</span><span class="n">topic_domain_str</span><span class="si">}</span><span class="s2">:</span><span class="se">\n</span><span class="s2">   </span><span class="si">{</span><span class="n">result</span><span class="p">[</span><span class="n">topic</span><span class="p">]</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">result</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h5 class="doc doc-heading" id="adviser.services.policy.affective_policy.EmotionPolicy.dialog_start">
<code class="highlight language-python">
dialog_start<span class="p">(</span><span class="bp">self</span><span class="p">)</span> </code>
<a class="headerlink" href="#adviser.services.policy.affective_policy.EmotionPolicy.dialog_start" title="Permanent link"></a></h5>
<div class="doc doc-contents">
<p>This function is called before the first message to a new dialog is published.
You should overwrite this function to set/reset dialog-level variables. </p>
<details class="quote">
<summary>Source code in <code>adviser/services/policy/affective_policy.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>46
47</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">dialog_start</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="k">pass</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="doc doc-object doc-module">
<h3 class="doc doc-heading" id="adviser.services.policy.policy_api">
<code>policy_api</code>
<a class="headerlink" href="#adviser.services.policy.policy_api" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<div class="doc doc-children">
<div class="doc doc-object doc-class">
<h4 class="doc doc-heading" id="adviser.services.policy.policy_api.HandcraftedPolicy">
<code>HandcraftedPolicy</code>
<a class="headerlink" href="#adviser.services.policy.policy_api.HandcraftedPolicy" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>Handcrafted policy for API domains</p>
<div class="codehilite">
<pre><span></span><code><span class="err">Differs from the default HandcraftedPolicy class by taking into account mandatory slots,</span>
<span class="err">i.e. slots which have to be informed about before an API can even be called.</span>
<span class="err">The class is currently a copy of an older version of the HandcraftedPolicy class with the</span>
<span class="err">required changes for API usage.</span>
<span class="err">The classes will probably be merged in the future.</span>
</code></pre>
</div>
<div class="doc doc-children">
<div class="doc doc-object doc-method">
<h5 class="doc doc-heading" id="adviser.services.policy.policy_api.HandcraftedPolicy.__init__">
<code class="highlight language-python">
__init__<span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">domain</span><span class="p">,</span> <span class="n">logger</span><span class="o">=&lt;</span><span class="n">DiasysLogger</span> <span class="n">adviser</span> <span class="p">(</span><span class="n">NOTSET</span><span class="p">)</span><span class="o">&gt;</span><span class="p">)</span> </code>
<span class="doc doc-properties">
<small class="doc doc-property doc-property-special"><code>special</code></small>
</span>
<a class="headerlink" href="#adviser.services.policy.policy_api.HandcraftedPolicy.__init__" title="Permanent link"></a></h5>
<div class="doc doc-contents">
<p>Initializes the policy</p>
<details class="quote">
<summary>Source code in <code>adviser/services/policy/policy_api.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>41
42
43
44
45
46
47
48
49
50
51
52
53
54
55</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">domain</span><span class="p">:</span> <span class="n">LookupDomain</span><span class="p">,</span> <span class="n">logger</span><span class="p">:</span> <span class="n">DiasysLogger</span> <span class="o">=</span> <span class="n">DiasysLogger</span><span class="p">()):</span>
    <span class="sd">"""</span>
<span class="sd">    Initializes the policy</span>

<span class="sd">    Arguments:</span>
<span class="sd">        domain {domain.lookupdomain.LookupDomain} -- Domain</span>

<span class="sd">    """</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">first_turn</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="n">Service</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">domain</span><span class="o">=</span><span class="n">domain</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">last_action</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">current_suggestions</span> <span class="o">=</span> <span class="p">[]</span>  <span class="c1"># list of current suggestions</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">s_index</span> <span class="o">=</span> <span class="mi">0</span>  <span class="c1"># the index in current suggestions for the current system reccomendation</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">domain_key</span> <span class="o">=</span> <span class="n">domain</span><span class="o">.</span><span class="n">get_primary_key</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">logger</span> <span class="o">=</span> <span class="n">logger</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h5 class="doc doc-heading" id="adviser.services.policy.policy_api.HandcraftedPolicy.choose_sys_act">
<code class="highlight language-python">
choose_sys_act<span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> </code>
<a class="headerlink" href="#adviser.services.policy.policy_api.HandcraftedPolicy.choose_sys_act" title="Permanent link"></a></h5>
<div class="doc doc-contents">
<details class="quote">
<summary>Source code in <code>adviser/services/policy/policy_api.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>551
552
553
554
555
556
557
558
559
560
561
562
563
564
565
566
567
568
569
570
571
572
573
574
575
576
577
578
579
580
581
582</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">delegate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="n">func_inst</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">func</span><span class="o">.</span><span class="vm">__name__</span><span class="p">)</span>

    <span class="n">callargs</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">args</span><span class="p">)</span>
    <span class="k">if</span> <span class="bp">self</span> <span class="ow">in</span> <span class="n">callargs</span><span class="p">:</span>    <span class="c1"># remove self when in *args, because already known to function</span>
        <span class="n">callargs</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">func</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">callargs</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">result</span><span class="p">:</span>
        <span class="c1"># fix! (user could have multiple "/" characters in topic - only use last one )</span>
        <span class="n">domains</span> <span class="o">=</span> <span class="p">{</span><span class="n">res</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">"/"</span><span class="p">)[</span><span class="mi">0</span><span class="p">]:</span> <span class="n">res</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">"/"</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span> <span class="k">if</span> <span class="s2">"/"</span> <span class="ow">in</span> <span class="n">res</span> <span class="k">else</span> <span class="s2">""</span> <span class="k">for</span> <span class="n">res</span> <span class="ow">in</span> <span class="n">result</span><span class="p">}</span>
        <span class="n">result</span> <span class="o">=</span> <span class="p">{</span><span class="n">key</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">"/"</span><span class="p">)[</span><span class="mi">0</span><span class="p">]:</span> <span class="n">result</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">result</span><span class="p">}</span>

    <span class="k">if</span> <span class="n">func_inst</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_publish_sockets</span><span class="p">:</span>
        <span class="c1"># not a publisher, just normal function</span>
        <span class="k">return</span> <span class="n">result</span>

    <span class="n">socket</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_publish_sockets</span><span class="p">[</span><span class="n">func_inst</span><span class="p">]</span>
    <span class="n">domain</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_domain_name</span>
    <span class="k">if</span> <span class="n">socket</span> <span class="ow">and</span> <span class="n">result</span><span class="p">:</span>
        <span class="c1"># publish messages</span>
        <span class="k">for</span> <span class="n">topic</span> <span class="ow">in</span> <span class="n">pub_topics</span><span class="p">:</span>
        <span class="c1"># for topic in result: # NOTE publish any returned value in dict with it's key as topic</span>
            <span class="k">if</span> <span class="n">topic</span> <span class="ow">in</span> <span class="n">result</span><span class="p">:</span>
                <span class="n">domain</span> <span class="o">=</span> <span class="n">domain</span> <span class="k">if</span> <span class="n">domain</span> <span class="k">else</span> <span class="n">domains</span><span class="p">[</span><span class="n">topic</span><span class="p">]</span>
                <span class="n">topic_domain_str</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="n">topic</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">domain</span><span class="si">}</span><span class="s2">"</span> <span class="k">if</span> <span class="n">domain</span> <span class="k">else</span> <span class="n">topic</span>
                <span class="k">if</span> <span class="n">topic</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_pub_topic_domains</span><span class="p">:</span>
                    <span class="n">topic_domain_str</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="n">topic</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_pub_topic_domains</span><span class="p">[</span><span class="n">topic</span><span class="p">]</span><span class="si">}</span><span class="s2">"</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_pub_topic_domains</span><span class="p">[</span><span class="n">topic</span><span class="p">]</span> <span class="k">else</span> <span class="n">topic</span>
                <span class="n">_send_msg</span><span class="p">(</span><span class="n">socket</span><span class="p">,</span> <span class="n">topic_domain_str</span><span class="p">,</span> <span class="n">result</span><span class="p">[</span><span class="n">topic</span><span class="p">])</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">debug_logger</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">debug_logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
                        <span class="sa">f</span><span class="s2">"- (DS): sent message from </span><span class="si">{</span><span class="n">func</span><span class="si">}</span><span class="s2"> to topic </span><span class="si">{</span><span class="n">topic_domain_str</span><span class="si">}</span><span class="s2">:</span><span class="se">\n</span><span class="s2">   </span><span class="si">{</span><span class="n">result</span><span class="p">[</span><span class="n">topic</span><span class="p">]</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">result</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h5 class="doc doc-heading" id="adviser.services.policy.policy_api.HandcraftedPolicy.dialog_start">
<code class="highlight language-python">
dialog_start<span class="p">(</span><span class="bp">self</span><span class="p">)</span> </code>
<a class="headerlink" href="#adviser.services.policy.policy_api.HandcraftedPolicy.dialog_start" title="Permanent link"></a></h5>
<div class="doc doc-contents">
<p>This function is called before the first message to a new dialog is published.
You should overwrite this function to set/reset dialog-level variables. </p>
<details class="quote">
<summary>Source code in <code>adviser/services/policy/policy_api.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>124
125
126
127
128</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">dialog_start</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">first_turn</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">last_action</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">current_suggestions</span> <span class="o">=</span> <span class="p">[]</span>  <span class="c1"># list of current suggestions</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">s_index</span> <span class="o">=</span> <span class="mi">0</span>  <span class="c1"># the index in current suggestions for the current system reccomendation</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="doc doc-object doc-module">
<h3 class="doc doc-heading" id="adviser.services.policy.policy_handcrafted">
<code>policy_handcrafted</code>
<a class="headerlink" href="#adviser.services.policy.policy_handcrafted" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<div class="doc doc-children">
<div class="doc doc-object doc-class">
<h4 class="doc doc-heading" id="adviser.services.policy.policy_handcrafted.HandcraftedPolicy">
<code>HandcraftedPolicy</code>
<a class="headerlink" href="#adviser.services.policy.policy_handcrafted.HandcraftedPolicy" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>Base class for handcrafted policies.</p>
<p>Provides a simple rule-based policy. Can be used for any domain where a user is
   trying to find an entity (eg. a course from a module handbook) from a database
   by providing constraints (eg. semester the course is offered) or where a user is
   trying to find out additional information about a named entity.</p>
<p>Output is a system action such as:
    * <code>inform</code>: provides information on an entity
    * <code>request</code>: request more information from the user
    * <code>bye</code>: issue parting message and end dialog</p>
<p>In order to create your own policy, you can inherit from this class.
   Make sure to overwrite the <code>choose_sys_act</code>-method with whatever additionally
   rules/functionality required.</p>
<div class="doc doc-children">
<div class="doc doc-object doc-method">
<h5 class="doc doc-heading" id="adviser.services.policy.policy_handcrafted.HandcraftedPolicy.__init__">
<code class="highlight language-python">
__init__<span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">domain</span><span class="p">,</span> <span class="n">logger</span><span class="o">=&lt;</span><span class="n">DiasysLogger</span> <span class="n">adviser</span> <span class="p">(</span><span class="n">NOTSET</span><span class="p">)</span><span class="o">&gt;</span><span class="p">,</span> <span class="n">max_turns</span><span class="o">=</span><span class="mi">25</span><span class="p">)</span> </code>
<span class="doc doc-properties">
<small class="doc doc-property doc-property-special"><code>special</code></small>
</span>
<a class="headerlink" href="#adviser.services.policy.policy_handcrafted.HandcraftedPolicy.__init__" title="Permanent link"></a></h5>
<div class="doc doc-contents">
<p>Initializes the policy</p>
<details class="quote">
<summary>Source code in <code>adviser/services/policy/policy_handcrafted.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">domain</span><span class="p">:</span> <span class="n">JSONLookupDomain</span><span class="p">,</span> <span class="n">logger</span><span class="p">:</span> <span class="n">DiasysLogger</span> <span class="o">=</span> <span class="n">DiasysLogger</span><span class="p">(),</span>
             <span class="n">max_turns</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">25</span><span class="p">):</span>
    <span class="sd">"""</span>
<span class="sd">    Initializes the policy</span>

<span class="sd">    Arguments:</span>
<span class="sd">        domain {domain.jsonlookupdomain.JSONLookupDomain} -- Domain</span>

<span class="sd">    """</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">first_turn</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="n">Service</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">domain</span><span class="o">=</span><span class="n">domain</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">current_suggestions</span> <span class="o">=</span> <span class="p">[]</span>  <span class="c1"># list of current suggestions</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">s_index</span> <span class="o">=</span> <span class="mi">0</span>  <span class="c1"># the index in current suggestions for the current system reccomendation</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">domain_key</span> <span class="o">=</span> <span class="n">domain</span><span class="o">.</span><span class="n">get_primary_key</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">logger</span> <span class="o">=</span> <span class="n">logger</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">max_turns</span> <span class="o">=</span> <span class="n">max_turns</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h5 class="doc doc-heading" id="adviser.services.policy.policy_handcrafted.HandcraftedPolicy.choose_sys_act">
<code class="highlight language-python">
choose_sys_act<span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> </code>
<a class="headerlink" href="#adviser.services.policy.policy_handcrafted.HandcraftedPolicy.choose_sys_act" title="Permanent link"></a></h5>
<div class="doc doc-contents">
<details class="quote">
<summary>Source code in <code>adviser/services/policy/policy_handcrafted.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>551
552
553
554
555
556
557
558
559
560
561
562
563
564
565
566
567
568
569
570
571
572
573
574
575
576
577
578
579
580
581
582</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">delegate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="n">func_inst</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">func</span><span class="o">.</span><span class="vm">__name__</span><span class="p">)</span>

    <span class="n">callargs</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">args</span><span class="p">)</span>
    <span class="k">if</span> <span class="bp">self</span> <span class="ow">in</span> <span class="n">callargs</span><span class="p">:</span>    <span class="c1"># remove self when in *args, because already known to function</span>
        <span class="n">callargs</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">func</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">callargs</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">result</span><span class="p">:</span>
        <span class="c1"># fix! (user could have multiple "/" characters in topic - only use last one )</span>
        <span class="n">domains</span> <span class="o">=</span> <span class="p">{</span><span class="n">res</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">"/"</span><span class="p">)[</span><span class="mi">0</span><span class="p">]:</span> <span class="n">res</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">"/"</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span> <span class="k">if</span> <span class="s2">"/"</span> <span class="ow">in</span> <span class="n">res</span> <span class="k">else</span> <span class="s2">""</span> <span class="k">for</span> <span class="n">res</span> <span class="ow">in</span> <span class="n">result</span><span class="p">}</span>
        <span class="n">result</span> <span class="o">=</span> <span class="p">{</span><span class="n">key</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">"/"</span><span class="p">)[</span><span class="mi">0</span><span class="p">]:</span> <span class="n">result</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">result</span><span class="p">}</span>

    <span class="k">if</span> <span class="n">func_inst</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_publish_sockets</span><span class="p">:</span>
        <span class="c1"># not a publisher, just normal function</span>
        <span class="k">return</span> <span class="n">result</span>

    <span class="n">socket</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_publish_sockets</span><span class="p">[</span><span class="n">func_inst</span><span class="p">]</span>
    <span class="n">domain</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_domain_name</span>
    <span class="k">if</span> <span class="n">socket</span> <span class="ow">and</span> <span class="n">result</span><span class="p">:</span>
        <span class="c1"># publish messages</span>
        <span class="k">for</span> <span class="n">topic</span> <span class="ow">in</span> <span class="n">pub_topics</span><span class="p">:</span>
        <span class="c1"># for topic in result: # NOTE publish any returned value in dict with it's key as topic</span>
            <span class="k">if</span> <span class="n">topic</span> <span class="ow">in</span> <span class="n">result</span><span class="p">:</span>
                <span class="n">domain</span> <span class="o">=</span> <span class="n">domain</span> <span class="k">if</span> <span class="n">domain</span> <span class="k">else</span> <span class="n">domains</span><span class="p">[</span><span class="n">topic</span><span class="p">]</span>
                <span class="n">topic_domain_str</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="n">topic</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">domain</span><span class="si">}</span><span class="s2">"</span> <span class="k">if</span> <span class="n">domain</span> <span class="k">else</span> <span class="n">topic</span>
                <span class="k">if</span> <span class="n">topic</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_pub_topic_domains</span><span class="p">:</span>
                    <span class="n">topic_domain_str</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="n">topic</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_pub_topic_domains</span><span class="p">[</span><span class="n">topic</span><span class="p">]</span><span class="si">}</span><span class="s2">"</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_pub_topic_domains</span><span class="p">[</span><span class="n">topic</span><span class="p">]</span> <span class="k">else</span> <span class="n">topic</span>
                <span class="n">_send_msg</span><span class="p">(</span><span class="n">socket</span><span class="p">,</span> <span class="n">topic_domain_str</span><span class="p">,</span> <span class="n">result</span><span class="p">[</span><span class="n">topic</span><span class="p">])</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">debug_logger</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">debug_logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
                        <span class="sa">f</span><span class="s2">"- (DS): sent message from </span><span class="si">{</span><span class="n">func</span><span class="si">}</span><span class="s2"> to topic </span><span class="si">{</span><span class="n">topic_domain_str</span><span class="si">}</span><span class="s2">:</span><span class="se">\n</span><span class="s2">   </span><span class="si">{</span><span class="n">result</span><span class="p">[</span><span class="n">topic</span><span class="p">]</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">result</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h5 class="doc doc-heading" id="adviser.services.policy.policy_handcrafted.HandcraftedPolicy.dialog_start">
<code class="highlight language-python">
dialog_start<span class="p">(</span><span class="bp">self</span><span class="p">)</span> </code>
<a class="headerlink" href="#adviser.services.policy.policy_handcrafted.HandcraftedPolicy.dialog_start" title="Permanent link"></a></h5>
<div class="doc doc-contents">
<p>resets the policy after each dialog</p>
<details class="quote">
<summary>Source code in <code>adviser/services/policy/policy_handcrafted.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>68
69
70
71
72
73
74
75</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">dialog_start</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">"""</span>
<span class="sd">        resets the policy after each dialog</span>
<span class="sd">    """</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">turns</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">first_turn</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">current_suggestions</span> <span class="o">=</span> <span class="p">[]</span>  <span class="c1"># list of current suggestions</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">s_index</span> <span class="o">=</span> <span class="mi">0</span>  <span class="c1"># the index in current suggestions for the current system reccomendation</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="doc doc-object doc-module">
<h3 class="doc doc-heading" id="adviser.services.policy.rl">
<code>rl</code>
<span class="doc doc-properties">
<small class="doc doc-property doc-property-special"><code>special</code></small>
</span>
<a class="headerlink" href="#adviser.services.policy.rl" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<div class="doc doc-children">
<div class="doc doc-object doc-module">
<h4 class="doc doc-heading" id="adviser.services.policy.rl.dqn">
<code>dqn</code>
<a class="headerlink" href="#adviser.services.policy.rl.dqn" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<div class="doc doc-children">
<div class="doc doc-object doc-class">
<h5 class="doc doc-heading" id="adviser.services.policy.rl.dqn.DQN">
<code>DQN</code>
<a class="headerlink" href="#adviser.services.policy.rl.dqn.DQN" title="Permanent link"></a></h5>
<div class="doc doc-contents">
<p>Simple Deep Q-Network </p>
<div class="doc doc-children">
<div class="doc doc-object doc-method">
<h6 class="doc doc-heading" id="adviser.services.policy.rl.dqn.DQN.__init__">
<code class="highlight language-python">
__init__<span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">state_dim</span><span class="p">,</span> <span class="n">action_dim</span><span class="p">,</span> <span class="n">hidden_layer_sizes</span><span class="o">=</span><span class="p">[</span><span class="mi">300</span><span class="p">,</span> <span class="mi">300</span><span class="p">],</span> <span class="n">dropout_rate</span><span class="o">=</span><span class="mf">0.0</span><span class="p">)</span> </code>
<span class="doc doc-properties">
<small class="doc doc-property doc-property-special"><code>special</code></small>
</span>
<a class="headerlink" href="#adviser.services.policy.rl.dqn.DQN.__init__" title="Permanent link"></a></h6>
<div class="doc doc-contents">
<p>Initialize a DQN Network with an arbitrary amount of linear hidden
layers </p>
<details class="quote">
<summary>Source code in <code>adviser/services/policy/rl/dqn.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">state_dim</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">action_dim</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">hidden_layer_sizes</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="mi">300</span><span class="p">,</span> <span class="mi">300</span><span class="p">],</span>
             <span class="n">dropout_rate</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">):</span>
    <span class="sd">""" Initialize a DQN Network with an arbitrary amount of linear hidden</span>
<span class="sd">        layers """</span>

    <span class="nb">super</span><span class="p">(</span><span class="n">DQN</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">"Architecture: DQN"</span><span class="p">)</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">dropout_rate</span> <span class="o">=</span> <span class="n">dropout_rate</span>

    <span class="c1"># create layers</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">layers</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">ModuleList</span><span class="p">()</span>
    <span class="n">current_input_dim</span> <span class="o">=</span> <span class="n">state_dim</span>
    <span class="k">for</span> <span class="n">layer_size</span> <span class="ow">in</span> <span class="n">hidden_layer_sizes</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">nn</span><span class="o">.</span><span class="n">Linear</span><span class="p">(</span><span class="n">current_input_dim</span><span class="p">,</span> <span class="n">layer_size</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">nn</span><span class="o">.</span><span class="n">ReLU</span><span class="p">())</span>
        <span class="k">if</span> <span class="n">dropout_rate</span> <span class="o">&gt;</span> <span class="mf">0.0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">nn</span><span class="o">.</span><span class="n">Dropout</span><span class="p">(</span><span class="n">p</span><span class="o">=</span><span class="n">dropout_rate</span><span class="p">))</span>
        <span class="n">current_input_dim</span> <span class="o">=</span> <span class="n">layer_size</span>
    <span class="c1"># output layer</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">nn</span><span class="o">.</span><span class="n">Linear</span><span class="p">(</span><span class="n">current_input_dim</span><span class="p">,</span> <span class="n">action_dim</span><span class="p">))</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h6 class="doc doc-heading" id="adviser.services.policy.rl.dqn.DQN.forward">
<code class="highlight language-python">
forward<span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">state_batch</span><span class="p">)</span> </code>
<a class="headerlink" href="#adviser.services.policy.rl.dqn.DQN.forward" title="Permanent link"></a></h6>
<div class="doc doc-contents">
<p>Forward pass: calculate Q(state) for all actions</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>state_batch</code></td>
<td><code>FloatTensor</code></td>
<td>
<p>tensor of size batch_size x state_dim</p>
</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>output</code></td>
<td>
<p>tensor of size batch_size x action_dim</p>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>adviser/services/policy/rl/dqn.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>62
63
64
65
66
67
68
69
70
71
72
73
74
75</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">forward</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">state_batch</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">FloatTensor</span><span class="p">):</span>
    <span class="sd">""" Forward pass: calculate Q(state) for all actions</span>

<span class="sd">    Args:</span>
<span class="sd">        state_batch (torch.FloatTensor): tensor of size batch_size x state_dim</span>

<span class="sd">    Returns:</span>
<span class="sd">        output: tensor of size batch_size x action_dim</span>
<span class="sd">    """</span>

    <span class="n">output</span> <span class="o">=</span> <span class="n">state_batch</span>
    <span class="k">for</span> <span class="n">layer</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">layers</span><span class="p">:</span>
        <span class="n">output</span> <span class="o">=</span> <span class="n">layer</span><span class="p">(</span><span class="n">output</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">output</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
</div>
</div>
</div>
<div class="doc doc-object doc-class">
<h5 class="doc doc-heading" id="adviser.services.policy.rl.dqn.DuelingDQN">
<code>DuelingDQN</code>
<a class="headerlink" href="#adviser.services.policy.rl.dqn.DuelingDQN" title="Permanent link"></a></h5>
<div class="doc doc-contents">
<p>Dueling DQN network architecture</p>
<p>Splits network into value- and advantage stream (V(s) and A(s,a)), 
   recombined in final layer to form Q-value again:
   Q(s,a) = V(s) + A(s,a).</p>
<div class="doc doc-children">
<div class="doc doc-object doc-method">
<h6 class="doc doc-heading" id="adviser.services.policy.rl.dqn.DuelingDQN.__init__">
<code class="highlight language-python">
__init__<span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">state_dim</span><span class="p">,</span> <span class="n">action_dim</span><span class="p">,</span> <span class="n">shared_layer_sizes</span><span class="o">=</span><span class="p">[</span><span class="mi">128</span><span class="p">],</span> <span class="n">value_layer_sizes</span><span class="o">=</span><span class="p">[</span><span class="mi">128</span><span class="p">],</span> <span class="n">advantage_layer_sizes</span><span class="o">=</span><span class="p">[</span><span class="mi">128</span><span class="p">],</span> <span class="n">dropout_rate</span><span class="o">=</span><span class="mf">0.0</span><span class="p">)</span> </code>
<span class="doc doc-properties">
<small class="doc doc-property doc-property-special"><code>special</code></small>
</span>
<a class="headerlink" href="#adviser.services.policy.rl.dqn.DuelingDQN.__init__" title="Permanent link"></a></h6>
<div class="doc doc-contents">
<details class="quote">
<summary>Source code in <code>adviser/services/policy/rl/dqn.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span> 87
 88
 89
 90
 91
 92
 93
 94
 95
 96
 97
 98
 99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">state_dim</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">action_dim</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
             <span class="n">shared_layer_sizes</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="mi">128</span><span class="p">],</span> <span class="n">value_layer_sizes</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="mi">128</span><span class="p">],</span>
             <span class="n">advantage_layer_sizes</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="mi">128</span><span class="p">],</span> <span class="n">dropout_rate</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">):</span>
    <span class="nb">super</span><span class="p">(</span><span class="n">DuelingDQN</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">"ARCHITECTURE: Dueling"</span><span class="p">)</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">dropout_rate</span> <span class="o">=</span> <span class="n">dropout_rate</span>
    <span class="c1"># configure layers</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">shared_layers</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">ModuleList</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">value_layers</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">ModuleList</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">advantage_layers</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">ModuleList</span><span class="p">()</span>

    <span class="c1"># shared layer: state_dim -&gt; shared_layer_sizes[-1]</span>
    <span class="n">shared_layer_dim</span> <span class="o">=</span> <span class="n">state_dim</span>
    <span class="k">for</span> <span class="n">layer_size</span> <span class="ow">in</span> <span class="n">shared_layer_sizes</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">shared_layers</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">nn</span><span class="o">.</span><span class="n">Linear</span><span class="p">(</span><span class="n">shared_layer_dim</span><span class="p">,</span> <span class="n">layer_size</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">shared_layers</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">nn</span><span class="o">.</span><span class="n">ReLU</span><span class="p">())</span>
        <span class="k">if</span> <span class="n">dropout_rate</span> <span class="o">&gt;</span> <span class="mf">0.0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">shared_layers</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">nn</span><span class="o">.</span><span class="n">Dropout</span><span class="p">(</span><span class="n">p</span><span class="o">=</span><span class="n">dropout_rate</span><span class="p">))</span>
        <span class="n">shared_layer_dim</span> <span class="o">=</span> <span class="n">layer_size</span>
    <span class="c1"># value layer: shared_layer_sizes[-1] -&gt; 1</span>
    <span class="n">value_layer_dim</span> <span class="o">=</span> <span class="n">shared_layer_dim</span>
    <span class="k">for</span> <span class="n">layer_size</span> <span class="ow">in</span> <span class="n">value_layer_sizes</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">value_layers</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">nn</span><span class="o">.</span><span class="n">Linear</span><span class="p">(</span><span class="n">value_layer_dim</span><span class="p">,</span> <span class="n">layer_size</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">value_layers</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">nn</span><span class="o">.</span><span class="n">ReLU</span><span class="p">())</span>
        <span class="k">if</span> <span class="n">dropout_rate</span> <span class="o">&gt;</span> <span class="mf">0.0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">value_layers</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">nn</span><span class="o">.</span><span class="n">Dropout</span><span class="p">(</span><span class="n">p</span><span class="o">=</span><span class="n">dropout_rate</span><span class="p">))</span>
        <span class="n">value_layer_dim</span> <span class="o">=</span> <span class="n">layer_size</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">value_layers</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">nn</span><span class="o">.</span><span class="n">Linear</span><span class="p">(</span><span class="n">value_layer_dim</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
    <span class="c1"># advantage layer: shared_layer_sizes[-1] -&gt; actions</span>
    <span class="n">advantage_layer_dim</span> <span class="o">=</span> <span class="n">shared_layer_dim</span>
    <span class="k">for</span> <span class="n">layer_size</span> <span class="ow">in</span> <span class="n">advantage_layer_sizes</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">advantage_layers</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">nn</span><span class="o">.</span><span class="n">Linear</span><span class="p">(</span><span class="n">advantage_layer_dim</span><span class="p">,</span> <span class="n">layer_size</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">advantage_layers</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">nn</span><span class="o">.</span><span class="n">ReLU</span><span class="p">())</span>
        <span class="k">if</span> <span class="n">dropout_rate</span> <span class="o">&gt;</span> <span class="mf">0.0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">advantage_layers</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">nn</span><span class="o">.</span><span class="n">Dropout</span><span class="p">(</span><span class="n">p</span><span class="o">=</span><span class="n">dropout_rate</span><span class="p">))</span>
        <span class="n">advantage_layer_dim</span> <span class="o">=</span> <span class="n">layer_size</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">advantage_layers</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">nn</span><span class="o">.</span><span class="n">Linear</span><span class="p">(</span><span class="n">advantage_layer_dim</span><span class="p">,</span> <span class="n">action_dim</span><span class="p">))</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h6 class="doc doc-heading" id="adviser.services.policy.rl.dqn.DuelingDQN.forward">
<code class="highlight language-python">
forward<span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">state_batch</span><span class="p">)</span> </code>
<a class="headerlink" href="#adviser.services.policy.rl.dqn.DuelingDQN.forward" title="Permanent link"></a></h6>
<div class="doc doc-contents">
<p>Forward pass: calculate Q(state) for all actions</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>input</code></td>
<td><code>torch.FloatTensor</code></td>
<td>
<p>tensor of size batch_size x state_dim</p>
</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code></code></td>
<td>
<p>tensor of size batch_size x action_dim</p>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>adviser/services/policy/rl/dqn.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">forward</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">state_batch</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">FloatTensor</span><span class="p">):</span>
    <span class="sd">""" Forward pass: calculate Q(state) for all actions</span>

<span class="sd">    Args:</span>
<span class="sd">        input (torch.FloatTensor): tensor of size batch_size x state_dim</span>

<span class="sd">    Returns:</span>
<span class="sd">        tensor of size batch_size x action_dim</span>
<span class="sd">    """</span>

    <span class="n">shared_output</span> <span class="o">=</span> <span class="n">state_batch</span>
    <span class="c1"># shared layer representation</span>
    <span class="k">for</span> <span class="n">layer</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">shared_layers</span><span class="p">:</span>
        <span class="n">shared_output</span> <span class="o">=</span> <span class="n">layer</span><span class="p">(</span><span class="n">shared_output</span><span class="p">)</span>
    <span class="c1"># value stream</span>
    <span class="n">value_stream</span> <span class="o">=</span> <span class="n">shared_output</span>
    <span class="k">for</span> <span class="n">layer</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">value_layers</span><span class="p">:</span>
        <span class="n">value_stream</span> <span class="o">=</span> <span class="n">layer</span><span class="p">(</span><span class="n">value_stream</span><span class="p">)</span>
    <span class="c1"># advantage stream</span>
    <span class="n">advantage_stream</span> <span class="o">=</span> <span class="n">shared_output</span>
    <span class="k">for</span> <span class="n">layer</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">advantage_layers</span><span class="p">:</span>
        <span class="n">advantage_stream</span> <span class="o">=</span> <span class="n">layer</span><span class="p">(</span><span class="n">advantage_stream</span><span class="p">)</span>
    <span class="c1"># combine value and advantage streams into Q values</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">value_stream</span> <span class="o">+</span> <span class="n">advantage_stream</span> <span class="o">-</span> <span class="n">advantage_stream</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">result</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
</div>
</div>
</div>
<div class="doc doc-object doc-class">
<h5 class="doc doc-heading" id="adviser.services.policy.rl.dqn.NetArchitecture">
<code>NetArchitecture</code>
<a class="headerlink" href="#adviser.services.policy.rl.dqn.NetArchitecture" title="Permanent link"></a></h5>
<div class="doc doc-contents">
<p>Network architecture for DQN </p>
<div class="codehilite">
<pre><span></span><code><span class="err">   vanilla: normal MLP</span>
<span class="err">   dueling: splits network into value- and advantage stream, recombined in final layer</span>
</code></pre>
</div>
<div class="doc doc-children">
<div class="doc doc-object doc-method">
<h6 class="doc doc-heading" id="adviser.services.policy.rl.dqn.NetArchitecture.__new__">
<code class="highlight language-python">
__new__<span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span> </code>
<span class="doc doc-properties">
<small class="doc doc-property doc-property-special"><code>special</code></small>
</span>
<a class="headerlink" href="#adviser.services.policy.rl.dqn.NetArchitecture.__new__" title="Permanent link"></a></h6>
<div class="doc doc-contents">
<details class="quote">
<summary>Source code in <code>adviser/services/policy/rl/dqn.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>557
558
559
560
561
562
563
564
565
566
567
568
569
570
571
572
573
574
575
576
577
578
579
580
581
582
583
584
585
586
587
588
589
590
591
592
593
594
595</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="fm">__new__</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
    <span class="c1"># all enum instances are actually created during class construction</span>
    <span class="c1"># without calling this method; this method is called by the metaclass'</span>
    <span class="c1"># __call__ (i.e. Color(3) ), and by pickle</span>
    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">value</span><span class="p">)</span> <span class="ow">is</span> <span class="bp">cls</span><span class="p">:</span>
        <span class="c1"># For lookups like Color(Color.RED)</span>
        <span class="k">return</span> <span class="n">value</span>
    <span class="c1"># by-value search for a matching enum member</span>
    <span class="c1"># see if it's in the reverse mapping (for hashable values)</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_value2member_map_</span><span class="p">[</span><span class="n">value</span><span class="p">]</span>
    <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
        <span class="c1"># Not found, no need to do long O(n) search</span>
        <span class="k">pass</span>
    <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span>
        <span class="c1"># not there, now do long search -- O(n) behavior</span>
        <span class="k">for</span> <span class="n">member</span> <span class="ow">in</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_member_map_</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">member</span><span class="o">.</span><span class="n">_value_</span> <span class="o">==</span> <span class="n">value</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">member</span>
    <span class="c1"># still not found -- try _missing_ hook</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">exc</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">result</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_missing_</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">exc</span> <span class="o">=</span> <span class="n">e</span>
        <span class="n">result</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="bp">cls</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">result</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">ve_exc</span> <span class="o">=</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">"</span><span class="si">%r</span><span class="s2"> is not a valid </span><span class="si">%s</span><span class="s2">"</span> <span class="o">%</span> <span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="bp">cls</span><span class="o">.</span><span class="vm">__name__</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">result</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">exc</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">ve_exc</span>
        <span class="k">elif</span> <span class="n">exc</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">exc</span> <span class="o">=</span> <span class="ne">TypeError</span><span class="p">(</span>
                    <span class="s1">'error in </span><span class="si">%s</span><span class="s1">._missing_: returned </span><span class="si">%r</span><span class="s1"> instead of None or a valid member'</span>
                    <span class="o">%</span> <span class="p">(</span><span class="bp">cls</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span> <span class="n">result</span><span class="p">)</span>
                    <span class="p">)</span>
        <span class="n">exc</span><span class="o">.</span><span class="n">__context__</span> <span class="o">=</span> <span class="n">ve_exc</span>
        <span class="k">raise</span> <span class="n">exc</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="doc doc-object doc-module">
<h4 class="doc doc-heading" id="adviser.services.policy.rl.dqnpolicy">
<code>dqnpolicy</code>
<a class="headerlink" href="#adviser.services.policy.rl.dqnpolicy" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<div class="doc doc-children">
<div class="doc doc-object doc-class">
<h5 class="doc doc-heading" id="adviser.services.policy.rl.dqnpolicy.DQNPolicy">
<code>DQNPolicy</code>
<a class="headerlink" href="#adviser.services.policy.rl.dqnpolicy.DQNPolicy" title="Permanent link"></a></h5>
<div class="doc doc-contents">
<div class="doc doc-children">
<div class="doc doc-object doc-method">
<h6 class="doc doc-heading" id="adviser.services.policy.rl.dqnpolicy.DQNPolicy.__init__">
<code class="highlight language-python">
__init__<span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">domain</span><span class="p">,</span> <span class="n">architecture</span><span class="o">=&lt;</span><span class="n">NetArchitecture</span><span class="o">.</span><span class="n">DUELING</span><span class="p">:</span> <span class="s1">'dueling'</span><span class="o">&gt;</span><span class="p">,</span> <span class="n">hidden_layer_sizes</span><span class="o">=</span><span class="p">[</span><span class="mi">256</span><span class="p">,</span> <span class="mi">700</span><span class="p">,</span> <span class="mi">700</span><span class="p">],</span> <span class="n">shared_layer_sizes</span><span class="o">=</span><span class="p">[</span><span class="mi">256</span><span class="p">],</span> <span class="n">value_layer_sizes</span><span class="o">=</span><span class="p">[</span><span class="mi">300</span><span class="p">,</span> <span class="mi">300</span><span class="p">],</span> <span class="n">advantage_layer_sizes</span><span class="o">=</span><span class="p">[</span><span class="mi">400</span><span class="p">,</span> <span class="mi">400</span><span class="p">],</span> <span class="n">lr</span><span class="o">=</span><span class="mf">0.0001</span><span class="p">,</span> <span class="n">discount_gamma</span><span class="o">=</span><span class="mf">0.99</span><span class="p">,</span> <span class="n">target_update_rate</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">replay_buffer_size</span><span class="o">=</span><span class="mi">8192</span><span class="p">,</span> <span class="n">batch_size</span><span class="o">=</span><span class="mi">64</span><span class="p">,</span> <span class="n">buffer_cls</span><span class="o">=&lt;</span><span class="k">class</span> <span class="err">'</span><span class="nc">services</span><span class="o">.</span><span class="n">policy</span><span class="o">.</span><span class="n">rl</span><span class="o">.</span><span class="n">experience_buffer</span><span class="o">.</span><span class="n">NaivePrioritizedBuffer</span><span class="s1">'&gt;, eps_start=0.3, eps_end=0.0, l2_regularisation=0.0, gradient_clipping=5.0, p_dropout=0.0, training_frequency=2, train_dialogs=1000, include_confreq=False, logger=&lt;DiasysLogger adviser (NOTSET)&gt;, max_turns=25, summary_writer=None, device=device(type='</span><span class="n">cpu</span><span class="s1">'))</span> </code>
<span class="doc doc-properties">
<small class="doc doc-property doc-property-special"><code>special</code></small>
</span>
<a class="headerlink" href="#adviser.services.policy.rl.dqnpolicy.DQNPolicy.__init__" title="Permanent link"></a></h6>
<div class="doc doc-contents">
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>target_update_rate</code></td>
<td><code>int</code></td>
<td>
<p>if 1, vanilla dqn update
                if &gt; 1, double dqn with specified target update
                rate</p>
</td>
<td><code>3</code></td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>adviser/services/policy/rl/dqnpolicy.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span> 44
 45
 46
 47
 48
 49
 50
 51
 52
 53
 54
 55
 56
 57
 58
 59
 60
 61
 62
 63
 64
 65
 66
 67
 68
 69
 70
 71
 72
 73
 74
 75
 76
 77
 78
 79
 80
 81
 82
 83
 84
 85
 86
 87
 88
 89
 90
 91
 92
 93
 94
 95
 96
 97
 98
 99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">domain</span><span class="p">:</span> <span class="n">JSONLookupDomain</span><span class="p">,</span>
             <span class="n">architecture</span><span class="p">:</span> <span class="n">NetArchitecture</span> <span class="o">=</span> <span class="n">NetArchitecture</span><span class="o">.</span><span class="n">DUELING</span><span class="p">,</span>
             <span class="n">hidden_layer_sizes</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="mi">256</span><span class="p">,</span> <span class="mi">700</span><span class="p">,</span> <span class="mi">700</span><span class="p">],</span>  <span class="c1"># vanilla architecture</span>
             <span class="n">shared_layer_sizes</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="mi">256</span><span class="p">],</span> <span class="n">value_layer_sizes</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="mi">300</span><span class="p">,</span> <span class="mi">300</span><span class="p">],</span>
             <span class="n">advantage_layer_sizes</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="mi">400</span><span class="p">,</span> <span class="mi">400</span><span class="p">],</span>  <span class="c1"># dueling architecture</span>
             <span class="n">lr</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.0001</span><span class="p">,</span> <span class="n">discount_gamma</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.99</span><span class="p">,</span>
             <span class="n">target_update_rate</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">3</span><span class="p">,</span>
             <span class="n">replay_buffer_size</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">8192</span><span class="p">,</span> <span class="n">batch_size</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">64</span><span class="p">,</span>
             <span class="n">buffer_cls</span><span class="p">:</span> <span class="n">Type</span><span class="p">[</span><span class="n">Buffer</span><span class="p">]</span> <span class="o">=</span> <span class="n">NaivePrioritizedBuffer</span><span class="p">,</span>
             <span class="n">eps_start</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.3</span><span class="p">,</span> <span class="n">eps_end</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">,</span>
             <span class="n">l2_regularisation</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">,</span> <span class="n">gradient_clipping</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">5.0</span><span class="p">,</span>
             <span class="n">p_dropout</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">,</span> <span class="n">training_frequency</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span> <span class="n">train_dialogs</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1000</span><span class="p">,</span>
             <span class="n">include_confreq</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">logger</span><span class="p">:</span> <span class="n">DiasysLogger</span> <span class="o">=</span> <span class="n">DiasysLogger</span><span class="p">(),</span>
             <span class="n">max_turns</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">25</span><span class="p">,</span>
             <span class="n">summary_writer</span><span class="p">:</span> <span class="n">SummaryWriter</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">device</span><span class="o">=</span><span class="n">torch</span><span class="o">.</span><span class="n">device</span><span class="p">(</span><span class="s1">'cpu'</span><span class="p">)):</span>
    <span class="sd">"""</span>
<span class="sd">    Args:</span>
<span class="sd">        target_update_rate: if 1, vanilla dqn update</span>
<span class="sd">                            if &gt; 1, double dqn with specified target update</span>
<span class="sd">                            rate</span>
<span class="sd">    """</span>
    <span class="n">RLPolicy</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">domain</span><span class="p">,</span> <span class="n">buffer_cls</span><span class="o">=</span><span class="n">buffer_cls</span><span class="p">,</span>
        <span class="n">buffer_size</span><span class="o">=</span><span class="n">replay_buffer_size</span><span class="p">,</span> <span class="n">batch_size</span><span class="o">=</span><span class="n">batch_size</span><span class="p">,</span>
        <span class="n">discount_gamma</span><span class="o">=</span><span class="n">discount_gamma</span><span class="p">,</span> <span class="n">include_confreq</span><span class="o">=</span><span class="n">include_confreq</span><span class="p">,</span>
        <span class="n">logger</span><span class="o">=</span><span class="n">logger</span><span class="p">,</span> <span class="n">max_turns</span><span class="o">=</span><span class="n">max_turns</span><span class="p">,</span> <span class="n">device</span><span class="o">=</span><span class="n">device</span><span class="p">)</span>

    <span class="n">Service</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">domain</span><span class="o">=</span><span class="n">domain</span><span class="p">)</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">writer</span> <span class="o">=</span> <span class="n">summary_writer</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">training_frequency</span> <span class="o">=</span> <span class="n">training_frequency</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">train_dialogs</span> <span class="o">=</span> <span class="n">train_dialogs</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">lr</span> <span class="o">=</span> <span class="n">lr</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">gradient_clipping</span> <span class="o">=</span> <span class="n">gradient_clipping</span>
    <span class="k">if</span> <span class="n">gradient_clipping</span> <span class="o">&gt;</span> <span class="mf">0.0</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">"Gradient Clipping: "</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">gradient_clipping</span><span class="p">))</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">target_update_rate</span> <span class="o">=</span> <span class="n">target_update_rate</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">epsilon_start</span> <span class="o">=</span> <span class="n">eps_start</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">epsilon_end</span> <span class="o">=</span> <span class="n">eps_end</span>

    <span class="c1"># Select network architecture</span>
    <span class="k">if</span> <span class="n">architecture</span> <span class="o">==</span> <span class="n">NetArchitecture</span><span class="o">.</span><span class="n">VANILLA</span><span class="p">:</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">"Architecture: Vanilla"</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model</span> <span class="o">=</span> <span class="n">DQN</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">state_dim</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">action_dim</span><span class="p">,</span>
                         <span class="n">hidden_layer_sizes</span><span class="o">=</span><span class="n">hidden_layer_sizes</span><span class="p">,</span>
                         <span class="n">dropout_rate</span><span class="o">=</span><span class="n">p_dropout</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">"Architecture: Dueling"</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model</span> <span class="o">=</span> <span class="n">DuelingDQN</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">state_dim</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">action_dim</span><span class="p">,</span>
                                <span class="n">shared_layer_sizes</span><span class="o">=</span><span class="n">shared_layer_sizes</span><span class="p">,</span>
                                <span class="n">value_layer_sizes</span><span class="o">=</span><span class="n">value_layer_sizes</span><span class="p">,</span>
                                <span class="n">advantage_layer_sizes</span><span class="o">=</span><span class="n">advantage_layer_sizes</span><span class="p">,</span>
                                <span class="n">dropout_rate</span><span class="o">=</span><span class="n">p_dropout</span><span class="p">)</span>
    <span class="c1"># Select network update</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">target_model</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">if</span> <span class="n">target_update_rate</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">"Update: Double"</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">architecture</span> <span class="o">==</span> <span class="n">NetArchitecture</span><span class="o">.</span><span class="n">VANILLA</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">target_model</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="p">)</span>
    <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">"Update: Vanilla"</span><span class="p">)</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">optim</span> <span class="o">=</span> <span class="n">optim</span><span class="o">.</span><span class="n">Adam</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="p">(),</span> <span class="n">lr</span><span class="o">=</span><span class="n">lr</span><span class="p">,</span> <span class="n">weight_decay</span><span class="o">=</span><span class="n">l2_regularisation</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">loss_fun</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">SmoothL1Loss</span><span class="p">(</span><span class="n">reduction</span><span class="o">=</span><span class="s1">'none'</span><span class="p">)</span>
    <span class="c1"># self.loss_fun = nn.MSELoss(reduction='none')</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">train_call_count</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">total_train_dialogs</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">epsilon</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">epsilon_start</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">turns</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">cumulative_train_dialogs</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h6 class="doc doc-heading" id="adviser.services.policy.rl.dqnpolicy.DQNPolicy.choose_sys_act">
<code class="highlight language-python">
choose_sys_act<span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> </code>
<a class="headerlink" href="#adviser.services.policy.rl.dqnpolicy.DQNPolicy.choose_sys_act" title="Permanent link"></a></h6>
<div class="doc doc-contents">
<details class="quote">
<summary>Source code in <code>adviser/services/policy/rl/dqnpolicy.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>551
552
553
554
555
556
557
558
559
560
561
562
563
564
565
566
567
568
569
570
571
572
573
574
575
576
577
578
579
580
581
582</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">delegate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="n">func_inst</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">func</span><span class="o">.</span><span class="vm">__name__</span><span class="p">)</span>

    <span class="n">callargs</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">args</span><span class="p">)</span>
    <span class="k">if</span> <span class="bp">self</span> <span class="ow">in</span> <span class="n">callargs</span><span class="p">:</span>    <span class="c1"># remove self when in *args, because already known to function</span>
        <span class="n">callargs</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">func</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">callargs</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">result</span><span class="p">:</span>
        <span class="c1"># fix! (user could have multiple "/" characters in topic - only use last one )</span>
        <span class="n">domains</span> <span class="o">=</span> <span class="p">{</span><span class="n">res</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">"/"</span><span class="p">)[</span><span class="mi">0</span><span class="p">]:</span> <span class="n">res</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">"/"</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span> <span class="k">if</span> <span class="s2">"/"</span> <span class="ow">in</span> <span class="n">res</span> <span class="k">else</span> <span class="s2">""</span> <span class="k">for</span> <span class="n">res</span> <span class="ow">in</span> <span class="n">result</span><span class="p">}</span>
        <span class="n">result</span> <span class="o">=</span> <span class="p">{</span><span class="n">key</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">"/"</span><span class="p">)[</span><span class="mi">0</span><span class="p">]:</span> <span class="n">result</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">result</span><span class="p">}</span>

    <span class="k">if</span> <span class="n">func_inst</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_publish_sockets</span><span class="p">:</span>
        <span class="c1"># not a publisher, just normal function</span>
        <span class="k">return</span> <span class="n">result</span>

    <span class="n">socket</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_publish_sockets</span><span class="p">[</span><span class="n">func_inst</span><span class="p">]</span>
    <span class="n">domain</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_domain_name</span>
    <span class="k">if</span> <span class="n">socket</span> <span class="ow">and</span> <span class="n">result</span><span class="p">:</span>
        <span class="c1"># publish messages</span>
        <span class="k">for</span> <span class="n">topic</span> <span class="ow">in</span> <span class="n">pub_topics</span><span class="p">:</span>
        <span class="c1"># for topic in result: # NOTE publish any returned value in dict with it's key as topic</span>
            <span class="k">if</span> <span class="n">topic</span> <span class="ow">in</span> <span class="n">result</span><span class="p">:</span>
                <span class="n">domain</span> <span class="o">=</span> <span class="n">domain</span> <span class="k">if</span> <span class="n">domain</span> <span class="k">else</span> <span class="n">domains</span><span class="p">[</span><span class="n">topic</span><span class="p">]</span>
                <span class="n">topic_domain_str</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="n">topic</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">domain</span><span class="si">}</span><span class="s2">"</span> <span class="k">if</span> <span class="n">domain</span> <span class="k">else</span> <span class="n">topic</span>
                <span class="k">if</span> <span class="n">topic</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_pub_topic_domains</span><span class="p">:</span>
                    <span class="n">topic_domain_str</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="n">topic</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_pub_topic_domains</span><span class="p">[</span><span class="n">topic</span><span class="p">]</span><span class="si">}</span><span class="s2">"</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_pub_topic_domains</span><span class="p">[</span><span class="n">topic</span><span class="p">]</span> <span class="k">else</span> <span class="n">topic</span>
                <span class="n">_send_msg</span><span class="p">(</span><span class="n">socket</span><span class="p">,</span> <span class="n">topic_domain_str</span><span class="p">,</span> <span class="n">result</span><span class="p">[</span><span class="n">topic</span><span class="p">])</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">debug_logger</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">debug_logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
                        <span class="sa">f</span><span class="s2">"- (DS): sent message from </span><span class="si">{</span><span class="n">func</span><span class="si">}</span><span class="s2"> to topic </span><span class="si">{</span><span class="n">topic_domain_str</span><span class="si">}</span><span class="s2">:</span><span class="se">\n</span><span class="s2">   </span><span class="si">{</span><span class="n">result</span><span class="p">[</span><span class="n">topic</span><span class="p">]</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">result</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h6 class="doc doc-heading" id="adviser.services.policy.rl.dqnpolicy.DQNPolicy.dialog_end">
<code class="highlight language-python">
dialog_end<span class="p">(</span><span class="bp">self</span><span class="p">)</span> </code>
<a class="headerlink" href="#adviser.services.policy.rl.dqnpolicy.DQNPolicy.dialog_end" title="Permanent link"></a></h6>
<div class="doc doc-contents">
<p>clean up needed at the end of a dialog</p>
<details class="quote">
<summary>Source code in <code>adviser/services/policy/rl/dqnpolicy.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>163
164
165
166
167
168
169
170</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">dialog_end</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">"""</span>
<span class="sd">        clean up needed at the end of a dialog</span>
<span class="sd">    """</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">end_dialog</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sim_goal</span><span class="p">)</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_training</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">total_train_dialogs</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">train_batch</span><span class="p">()</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h6 class="doc doc-heading" id="adviser.services.policy.rl.dqnpolicy.DQNPolicy.dialog_start">
<code class="highlight language-python">
dialog_start<span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dialog_start</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span> </code>
<a class="headerlink" href="#adviser.services.policy.rl.dqnpolicy.DQNPolicy.dialog_start" title="Permanent link"></a></h6>
<div class="doc doc-contents">
<p>This function is called before the first message to a new dialog is published.
You should overwrite this function to set/reset dialog-level variables. </p>
<details class="quote">
<summary>Source code in <code>adviser/services/policy/rl/dqnpolicy.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>121
122
123
124
125
126
127
128
129
130</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">dialog_start</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dialog_start</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">turns</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">last_sys_act</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_training</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cumulative_train_dialogs</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">sys_state</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">"lastInformedPrimKeyVal"</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
        <span class="s2">"lastActionInformNone"</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
        <span class="s2">"offerHappened"</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
        <span class="s1">'informedPrimKeyValsSinceNone'</span><span class="p">:</span> <span class="p">[]}</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h6 class="doc doc-heading" id="adviser.services.policy.rl.dqnpolicy.DQNPolicy.end">
<code class="highlight language-python">
end<span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> </code>
<a class="headerlink" href="#adviser.services.policy.rl.dqnpolicy.DQNPolicy.end" title="Permanent link"></a></h6>
<div class="doc doc-contents">
<details class="quote">
<summary>Source code in <code>adviser/services/policy/rl/dqnpolicy.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>551
552
553
554
555
556
557
558
559
560
561
562
563
564
565
566
567
568
569
570
571
572
573
574
575
576
577
578
579
580
581
582</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">delegate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="n">func_inst</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">func</span><span class="o">.</span><span class="vm">__name__</span><span class="p">)</span>

    <span class="n">callargs</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">args</span><span class="p">)</span>
    <span class="k">if</span> <span class="bp">self</span> <span class="ow">in</span> <span class="n">callargs</span><span class="p">:</span>    <span class="c1"># remove self when in *args, because already known to function</span>
        <span class="n">callargs</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">func</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">callargs</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">result</span><span class="p">:</span>
        <span class="c1"># fix! (user could have multiple "/" characters in topic - only use last one )</span>
        <span class="n">domains</span> <span class="o">=</span> <span class="p">{</span><span class="n">res</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">"/"</span><span class="p">)[</span><span class="mi">0</span><span class="p">]:</span> <span class="n">res</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">"/"</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span> <span class="k">if</span> <span class="s2">"/"</span> <span class="ow">in</span> <span class="n">res</span> <span class="k">else</span> <span class="s2">""</span> <span class="k">for</span> <span class="n">res</span> <span class="ow">in</span> <span class="n">result</span><span class="p">}</span>
        <span class="n">result</span> <span class="o">=</span> <span class="p">{</span><span class="n">key</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">"/"</span><span class="p">)[</span><span class="mi">0</span><span class="p">]:</span> <span class="n">result</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">result</span><span class="p">}</span>

    <span class="k">if</span> <span class="n">func_inst</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_publish_sockets</span><span class="p">:</span>
        <span class="c1"># not a publisher, just normal function</span>
        <span class="k">return</span> <span class="n">result</span>

    <span class="n">socket</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_publish_sockets</span><span class="p">[</span><span class="n">func_inst</span><span class="p">]</span>
    <span class="n">domain</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_domain_name</span>
    <span class="k">if</span> <span class="n">socket</span> <span class="ow">and</span> <span class="n">result</span><span class="p">:</span>
        <span class="c1"># publish messages</span>
        <span class="k">for</span> <span class="n">topic</span> <span class="ow">in</span> <span class="n">pub_topics</span><span class="p">:</span>
        <span class="c1"># for topic in result: # NOTE publish any returned value in dict with it's key as topic</span>
            <span class="k">if</span> <span class="n">topic</span> <span class="ow">in</span> <span class="n">result</span><span class="p">:</span>
                <span class="n">domain</span> <span class="o">=</span> <span class="n">domain</span> <span class="k">if</span> <span class="n">domain</span> <span class="k">else</span> <span class="n">domains</span><span class="p">[</span><span class="n">topic</span><span class="p">]</span>
                <span class="n">topic_domain_str</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="n">topic</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">domain</span><span class="si">}</span><span class="s2">"</span> <span class="k">if</span> <span class="n">domain</span> <span class="k">else</span> <span class="n">topic</span>
                <span class="k">if</span> <span class="n">topic</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_pub_topic_domains</span><span class="p">:</span>
                    <span class="n">topic_domain_str</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="n">topic</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_pub_topic_domains</span><span class="p">[</span><span class="n">topic</span><span class="p">]</span><span class="si">}</span><span class="s2">"</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_pub_topic_domains</span><span class="p">[</span><span class="n">topic</span><span class="p">]</span> <span class="k">else</span> <span class="n">topic</span>
                <span class="n">_send_msg</span><span class="p">(</span><span class="n">socket</span><span class="p">,</span> <span class="n">topic_domain_str</span><span class="p">,</span> <span class="n">result</span><span class="p">[</span><span class="n">topic</span><span class="p">])</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">debug_logger</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">debug_logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
                        <span class="sa">f</span><span class="s2">"- (DS): sent message from </span><span class="si">{</span><span class="n">func</span><span class="si">}</span><span class="s2"> to topic </span><span class="si">{</span><span class="n">topic_domain_str</span><span class="si">}</span><span class="s2">:</span><span class="se">\n</span><span class="s2">   </span><span class="si">{</span><span class="n">result</span><span class="p">[</span><span class="n">topic</span><span class="p">]</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">result</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h6 class="doc doc-heading" id="adviser.services.policy.rl.dqnpolicy.DQNPolicy.eps_scheduler">
<code class="highlight language-python">
eps_scheduler<span class="p">(</span><span class="bp">self</span><span class="p">)</span> </code>
<a class="headerlink" href="#adviser.services.policy.rl.dqnpolicy.DQNPolicy.eps_scheduler" title="Permanent link"></a></h6>
<div class="doc doc-contents">
<p>Linear epsilon decay </p>
<details class="quote">
<summary>Source code in <code>adviser/services/policy/rl/dqnpolicy.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>377
378
379
380
381
382
383
384</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">eps_scheduler</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">""" Linear epsilon decay """</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_training</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">epsilon</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span>
                           <span class="bp">self</span><span class="o">.</span><span class="n">epsilon_start</span> <span class="o">-</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">epsilon_start</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">epsilon_end</span><span class="p">)</span>
                           <span class="o">*</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">num_dialogs</span><span class="p">)</span> <span class="o">/</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">train_dialogs</span><span class="p">))</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">writer</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">writer</span><span class="o">.</span><span class="n">add_scalar</span><span class="p">(</span><span class="s1">'train/eps'</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">epsilon</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">total_train_dialogs</span><span class="p">)</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h6 class="doc doc-heading" id="adviser.services.policy.rl.dqnpolicy.DQNPolicy.eval">
<code class="highlight language-python">
eval<span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">eval</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> </code>
<a class="headerlink" href="#adviser.services.policy.rl.dqnpolicy.DQNPolicy.eval" title="Permanent link"></a></h6>
<div class="doc doc-contents">
<p>Sets module and its subgraph to eval mode </p>
<details class="quote">
<summary>Source code in <code>adviser/services/policy/rl/dqnpolicy.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>425
426
427
428
429
430
431</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">eval</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">eval</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
    <span class="sd">""" Sets module and its subgraph to eval mode """</span>
    <span class="nb">super</span><span class="p">(</span><span class="n">DQNPolicy</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">eval</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">is_training</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">eval</span><span class="p">()</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">target_model</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">target_model</span><span class="o">.</span><span class="n">eval</span><span class="p">()</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h6 class="doc doc-heading" id="adviser.services.policy.rl.dqnpolicy.DQNPolicy.load">
<code class="highlight language-python">
load<span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="o">=</span><span class="s1">'models/dqn'</span><span class="p">,</span> <span class="n">version</span><span class="o">=</span><span class="s1">'1.0'</span><span class="p">)</span> </code>
<a class="headerlink" href="#adviser.services.policy.rl.dqnpolicy.DQNPolicy.load" title="Permanent link"></a></h6>
<div class="doc doc-contents">
<p>Load model weights</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>path</code></td>
<td><code>str</code></td>
<td>
<p>path to model folder</p>
</td>
<td><code>'models/dqn'</code></td>
</tr>
<tr>
<td><code>version</code></td>
<td><code>str</code></td>
<td>
<p>appendix to filename, enables having multiple models for the same domain
           (or saving a model after each training epoch)</p>
</td>
<td><code>'1.0'</code></td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>adviser/services/policy/rl/dqnpolicy.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>400
401
402
403
404
405
406
407
408
409
410
411
412
413
414
415</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">load</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s1">'models'</span><span class="p">,</span> <span class="s1">'dqn'</span><span class="p">),</span> <span class="n">version</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">"1.0"</span><span class="p">):</span>
    <span class="sd">""" Load model weights</span>

<span class="sd">    Args:</span>
<span class="sd">        path (str): path to model folder</span>
<span class="sd">        version (str): appendix to filename, enables having multiple models for the same domain</span>
<span class="sd">                       (or saving a model after each training epoch)</span>
<span class="sd">    """</span>
    <span class="n">model_file</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
        <span class="n">path</span><span class="p">,</span> <span class="s2">"rlpolicy_"</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">domain</span><span class="o">.</span><span class="n">get_domain_name</span><span class="p">()</span> <span class="o">+</span> <span class="s2">"_"</span> <span class="o">+</span> <span class="n">version</span> <span class="o">+</span> <span class="s2">".pt"</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">model_file</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">FileNotFoundError</span><span class="p">(</span><span class="s2">"Could not find DQN policy weight file "</span><span class="p">,</span> <span class="n">model_file</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">model</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">model_file</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">"Loaded DQN weights from file "</span> <span class="o">+</span> <span class="n">model_file</span><span class="p">)</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">target_model</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">target_model</span><span class="o">.</span><span class="n">load_state_dict</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">state_dict</span><span class="p">())</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h6 class="doc doc-heading" id="adviser.services.policy.rl.dqnpolicy.DQNPolicy.loss">
<code class="highlight language-python">
loss<span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">s_batch</span><span class="p">,</span> <span class="n">a_batch</span><span class="p">,</span> <span class="n">s2_batch</span><span class="p">,</span> <span class="n">r_batch</span><span class="p">,</span> <span class="n">t_batch</span><span class="p">,</span> <span class="n">gamma</span><span class="p">)</span> </code>
<a class="headerlink" href="#adviser.services.policy.rl.dqnpolicy.DQNPolicy.loss" title="Permanent link"></a></h6>
<div class="doc doc-contents">
<p>Calculate TD-loss for given experience tuples</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>s_batch</code></td>
<td><code>FloatTensor</code></td>
<td>
<p>states (dimension batch x state_dim)</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>a_batch</code></td>
<td><code>LongTensor</code></td>
<td>
<p>actions (dimension batch x 1)</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>s2_batch</code></td>
<td><code>FloatTensor</code></td>
<td>
<p>next states (dimension: batch x state_dim)</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>r_batch</code></td>
<td><code>FloatTensor</code></td>
<td>
<p>rewards (dimension batch x 1)</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>t_batch</code></td>
<td><code>FloatTensor</code></td>
<td>
<p>indicator {0,1} for terminal states (dimension: batch x 1)</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>gamma</code></td>
<td><code>float</code></td>
<td>
<p>discount factor</p>
</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code></code></td>
<td>
<p>TD-loss</p>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>adviser/services/policy/rl/dqnpolicy.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>284
285
286
287
288
289
290
291
292
293
294
295
296
297
298
299
300
301
302
303
304
305
306
307
308
309
310
311
312
313
314
315</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">loss</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">s_batch</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">FloatTensor</span><span class="p">,</span> <span class="n">a_batch</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">LongTensor</span><span class="p">,</span>
         <span class="n">s2_batch</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">FloatTensor</span><span class="p">,</span> <span class="n">r_batch</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">FloatTensor</span><span class="p">,</span> <span class="n">t_batch</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">FloatTensor</span><span class="p">,</span>
         <span class="n">gamma</span><span class="p">:</span> <span class="nb">float</span><span class="p">):</span>
    <span class="sd">""" Calculate TD-loss for given experience tuples</span>

<span class="sd">    Args:</span>
<span class="sd">        s_batch (torch.FloatTensor): states (dimension batch x state_dim)</span>
<span class="sd">        a_batch (torch.LongTensor): actions (dimension batch x 1)</span>
<span class="sd">        s2_batch (torch.FloatTensor): next states (dimension: batch x state_dim)</span>
<span class="sd">        r_batch (torch.FloatTensor): rewards (dimension batch x 1)</span>
<span class="sd">        t_batch (torch.FloatTensor): indicator {0,1} for terminal states (dimension: batch x 1)</span>
<span class="sd">        gamma (float): discount factor</span>

<span class="sd">    Returns:</span>
<span class="sd">        TD-loss</span>
<span class="sd">    """</span>
    <span class="c1"># forward value</span>
    <span class="n">torch</span><span class="o">.</span><span class="n">autograd</span><span class="o">.</span><span class="n">set_grad_enabled</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">q_val</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_forward</span><span class="p">(</span><span class="n">s_batch</span><span class="p">,</span> <span class="n">a_batch</span><span class="p">)</span>

    <span class="c1"># forward target</span>
    <span class="n">torch</span><span class="o">.</span><span class="n">autograd</span><span class="o">.</span><span class="n">set_grad_enabled</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">target_model</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">q_target</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_forward_target</span><span class="p">(</span><span class="n">s2_batch</span><span class="p">,</span> <span class="n">r_batch</span><span class="p">,</span> <span class="n">t_batch</span><span class="p">,</span> <span class="n">gamma</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">q_target</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_forward_target_ddqn</span><span class="p">(</span><span class="n">s2_batch</span><span class="p">,</span> <span class="n">r_batch</span><span class="p">,</span> <span class="n">t_batch</span><span class="p">,</span>
                                             <span class="n">gamma</span><span class="p">)</span>
    <span class="n">torch</span><span class="o">.</span><span class="n">autograd</span><span class="o">.</span><span class="n">set_grad_enabled</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>

    <span class="c1"># loss</span>
    <span class="n">loss</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">loss_fun</span><span class="p">(</span><span class="n">q_val</span><span class="p">,</span> <span class="n">q_target</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">loss</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h6 class="doc doc-heading" id="adviser.services.policy.rl.dqnpolicy.DQNPolicy.save">
<code class="highlight language-python">
save<span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="o">=</span><span class="s1">'models/dqn'</span><span class="p">,</span> <span class="n">version</span><span class="o">=</span><span class="s1">'1.0'</span><span class="p">)</span> </code>
<a class="headerlink" href="#adviser.services.policy.rl.dqnpolicy.DQNPolicy.save" title="Permanent link"></a></h6>
<div class="doc doc-contents">
<p>Save model weights</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>path</code></td>
<td><code>str</code></td>
<td>
<p>path to model folder</p>
</td>
<td><code>'models/dqn'</code></td>
</tr>
<tr>
<td><code>version</code></td>
<td><code>str</code></td>
<td>
<p>appendix to filename, enables having multiple models for the same domain
           (or saving a model after each training epoch)</p>
</td>
<td><code>'1.0'</code></td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>adviser/services/policy/rl/dqnpolicy.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>386
387
388
389
390
391
392
393
394
395
396
397
398</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">save</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s1">'models'</span><span class="p">,</span> <span class="s1">'dqn'</span><span class="p">),</span> <span class="n">version</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">"1.0"</span><span class="p">):</span>
    <span class="sd">""" Save model weights</span>

<span class="sd">    Args:</span>
<span class="sd">        path (str): path to model folder</span>
<span class="sd">        version (str): appendix to filename, enables having multiple models for the same domain</span>
<span class="sd">                       (or saving a model after each training epoch)</span>
<span class="sd">    """</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
        <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">model_file</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
        <span class="n">path</span><span class="p">,</span> <span class="s2">"rlpolicy_"</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">domain</span><span class="o">.</span><span class="n">get_domain_name</span><span class="p">()</span> <span class="o">+</span> <span class="s2">"_"</span> <span class="o">+</span> <span class="n">version</span> <span class="o">+</span> <span class="s2">".pt"</span><span class="p">)</span>
    <span class="n">torch</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="p">,</span> <span class="n">model_file</span><span class="p">)</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h6 class="doc doc-heading" id="adviser.services.policy.rl.dqnpolicy.DQNPolicy.select_action_eps_greedy">
<code class="highlight language-python">
select_action_eps_greedy<span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">state_vector</span><span class="p">)</span> </code>
<a class="headerlink" href="#adviser.services.policy.rl.dqnpolicy.DQNPolicy.select_action_eps_greedy" title="Permanent link"></a></h6>
<div class="doc doc-contents">
<p>Epsilon-greedy policy.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>state_vector</code></td>
<td><code>FloatTensor</code></td>
<td>
<p>current state (dimension 1 x state_dim)</p>
</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code></code></td>
<td>
<p>action index for action selected by the agent for the current state</p>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>adviser/services/policy/rl/dqnpolicy.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">select_action_eps_greedy</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">state_vector</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">FloatTensor</span><span class="p">):</span>
    <span class="sd">""" Epsilon-greedy policy.</span>

<span class="sd">    Args:</span>
<span class="sd">        state_vector (torch.FloatTensor): current state (dimension 1 x state_dim)</span>

<span class="sd">    Returns:</span>
<span class="sd">        action index for action selected by the agent for the current state</span>
<span class="sd">    """</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">eps_scheduler</span><span class="p">()</span>

    <span class="c1"># epsilon greedy exploration</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_training</span> <span class="ow">and</span> <span class="n">common</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">()</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">epsilon</span><span class="p">:</span>
        <span class="n">next_action_idx</span> <span class="o">=</span> <span class="n">common</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">action_dim</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">torch</span><span class="o">.</span><span class="n">autograd</span><span class="o">.</span><span class="n">set_grad_enabled</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
        <span class="n">q_values</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="p">(</span><span class="n">state_vector</span><span class="p">)</span>
        <span class="n">next_action_idx</span> <span class="o">=</span> <span class="n">q_values</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">dim</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">dim</span><span class="o">=</span><span class="mi">0</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">item</span><span class="p">()</span>
        <span class="n">torch</span><span class="o">.</span><span class="n">autograd</span><span class="o">.</span><span class="n">set_grad_enabled</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">next_action_idx</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h6 class="doc doc-heading" id="adviser.services.policy.rl.dqnpolicy.DQNPolicy.train">
<code class="highlight language-python">
train<span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">train</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> </code>
<a class="headerlink" href="#adviser.services.policy.rl.dqnpolicy.DQNPolicy.train" title="Permanent link"></a></h6>
<div class="doc doc-contents">
<p>Sets module and its subgraph to training mode </p>
<details class="quote">
<summary>Source code in <code>adviser/services/policy/rl/dqnpolicy.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>417
418
419
420
421
422
423</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">train</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">train</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
    <span class="sd">""" Sets module and its subgraph to training mode """</span>
    <span class="nb">super</span><span class="p">(</span><span class="n">DQNPolicy</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">train</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">is_training</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">train</span><span class="p">()</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">target_model</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">target_model</span><span class="o">.</span><span class="n">train</span><span class="p">()</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h6 class="doc doc-heading" id="adviser.services.policy.rl.dqnpolicy.DQNPolicy.train_batch">
<code class="highlight language-python">
train_batch<span class="p">(</span><span class="bp">self</span><span class="p">)</span> </code>
<a class="headerlink" href="#adviser.services.policy.rl.dqnpolicy.DQNPolicy.train_batch" title="Permanent link"></a></h6>
<div class="doc doc-contents">
<p>Train on a minibatch drawn from the experience buffer. </p>
<details class="quote">
<summary>Source code in <code>adviser/services/policy/rl/dqnpolicy.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>317
318
319
320
321
322
323
324
325
326
327
328
329
330
331
332
333
334
335
336
337
338
339
340
341
342
343
344
345
346
347
348
349
350
351
352
353
354
355
356
357
358
359
360
361
362
363
364
365
366
367
368
369
370
371
372
373
374
375</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">train_batch</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">""" Train on a minibatch drawn from the experience buffer. """</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_training</span><span class="p">:</span>
        <span class="k">return</span>

    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">buffer</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">batch_size</span> <span class="o">*</span> <span class="mi">10</span> <span class="ow">and</span> \
            <span class="bp">self</span><span class="o">.</span><span class="n">total_train_dialogs</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">training_frequency</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">train_call_count</span> <span class="o">+=</span> <span class="mi">1</span>

        <span class="n">s_batch</span><span class="p">,</span> <span class="n">a_batch</span><span class="p">,</span> <span class="n">r_batch</span><span class="p">,</span> <span class="n">s2_batch</span><span class="p">,</span> <span class="n">t_batch</span><span class="p">,</span> <span class="n">indices</span><span class="p">,</span> <span class="n">importance_weights</span> <span class="o">=</span> \
            <span class="bp">self</span><span class="o">.</span><span class="n">buffer</span><span class="o">.</span><span class="n">sample</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">optim</span><span class="o">.</span><span class="n">zero_grad</span><span class="p">()</span>
        <span class="n">torch</span><span class="o">.</span><span class="n">autograd</span><span class="o">.</span><span class="n">set_grad_enabled</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">s_batch</span><span class="o">.</span><span class="n">requires_grad_</span><span class="p">()</span>
        <span class="n">gamma</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">discount_gamma</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">batch_size</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">torch</span><span class="o">.</span><span class="n">float</span><span class="p">,</span>
                             <span class="n">device</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">device</span><span class="p">)</span><span class="o">.</span><span class="n">view</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">batch_size</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

        <span class="c1"># calculate loss</span>
        <span class="n">loss</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">loss</span><span class="p">(</span><span class="n">s_batch</span><span class="p">,</span> <span class="n">a_batch</span><span class="p">,</span> <span class="n">s2_batch</span><span class="p">,</span> <span class="n">r_batch</span><span class="p">,</span> <span class="n">t_batch</span><span class="p">,</span> <span class="n">gamma</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">importance_weights</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">loss</span> <span class="o">=</span> <span class="n">loss</span> <span class="o">*</span> <span class="n">importance_weights</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">batch_size</span><span class="p">):</span>
                <span class="c1"># importance weighting</span>
                <span class="c1"># update priorities</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">buffer</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">loss</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">item</span><span class="p">())</span>
        <span class="n">loss</span> <span class="o">=</span> <span class="n">loss</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
        <span class="n">loss</span><span class="o">.</span><span class="n">backward</span><span class="p">()</span>

        <span class="c1"># clip gradients</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">gradient_clipping</span> <span class="o">&gt;</span> <span class="mf">0.0</span><span class="p">:</span>
            <span class="n">nn</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">clip_grad_norm_</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="p">(),</span> <span class="bp">self</span><span class="o">.</span><span class="n">gradient_clipping</span><span class="p">)</span>

        <span class="c1"># update weights</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">optim</span><span class="o">.</span><span class="n">step</span><span class="p">()</span>
        <span class="n">current_loss</span> <span class="o">=</span> <span class="n">loss</span><span class="o">.</span><span class="n">item</span><span class="p">()</span>
        <span class="n">torch</span><span class="o">.</span><span class="n">autograd</span><span class="o">.</span><span class="n">set_grad_enabled</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">writer</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># plot loss</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">writer</span><span class="o">.</span><span class="n">add_scalar</span><span class="p">(</span><span class="s1">'train/loss'</span><span class="p">,</span> <span class="n">current_loss</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">train_call_count</span><span class="p">)</span>
            <span class="c1"># plot min/max gradients</span>
            <span class="n">max_grad_norm</span> <span class="o">=</span> <span class="o">-</span><span class="mf">1.0</span>
            <span class="n">min_grad_norm</span> <span class="o">=</span> <span class="mf">1000000.0</span>
            <span class="k">for</span> <span class="n">param</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="p">():</span>
                <span class="k">if</span> <span class="n">param</span><span class="o">.</span><span class="n">grad</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="c1"># TODO decide on norm</span>
                    <span class="n">current_grad_norm</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">param</span><span class="o">.</span><span class="n">grad</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">current_grad_norm</span> <span class="o">&gt;</span> <span class="n">max_grad_norm</span><span class="p">:</span>
                        <span class="n">max_grad_norm</span> <span class="o">=</span> <span class="n">current_grad_norm</span>
                    <span class="k">if</span> <span class="n">current_grad_norm</span> <span class="o">&lt;</span> <span class="n">min_grad_norm</span><span class="p">:</span>
                        <span class="n">min_grad_norm</span> <span class="o">=</span> <span class="n">current_grad_norm</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">writer</span><span class="o">.</span><span class="n">add_scalar</span><span class="p">(</span><span class="s1">'train/min_grad'</span><span class="p">,</span> <span class="n">min_grad_norm</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">train_call_count</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">writer</span><span class="o">.</span><span class="n">add_scalar</span><span class="p">(</span><span class="s1">'train/max_grad'</span><span class="p">,</span> <span class="n">max_grad_norm</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">train_call_count</span><span class="p">)</span>

        <span class="c1"># update target net</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">target_model</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> \
                <span class="bp">self</span><span class="o">.</span><span class="n">train_call_count</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">target_update_rate</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">target_model</span><span class="o">.</span><span class="n">load_state_dict</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">state_dict</span><span class="p">())</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="doc doc-object doc-module">
<h4 class="doc doc-heading" id="adviser.services.policy.rl.experience_buffer">
<code>experience_buffer</code>
<a class="headerlink" href="#adviser.services.policy.rl.experience_buffer" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<div class="doc doc-children">
<div class="doc doc-object doc-class">
<h5 class="doc doc-heading" id="adviser.services.policy.rl.experience_buffer.Buffer">
<code>Buffer</code>
<a class="headerlink" href="#adviser.services.policy.rl.experience_buffer.Buffer" title="Permanent link"></a></h5>
<div class="doc doc-contents">
<p>Base class for experience replay buffers</p>
<p>Initializes the memory, provides a print function for the memory contents 
   and a method to insert new items into the buffer.
   Sampling has to be implemented by child classes.</p>
<div class="doc doc-children">
<div class="doc doc-object doc-method">
<h6 class="doc doc-heading" id="adviser.services.policy.rl.experience_buffer.Buffer.__init__">
<code class="highlight language-python">
__init__<span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">buffer_size</span><span class="p">,</span> <span class="n">batch_size</span><span class="p">,</span> <span class="n">state_dim</span><span class="p">,</span> <span class="n">discount_gamma</span><span class="o">=</span><span class="mf">0.99</span><span class="p">,</span> <span class="n">device</span><span class="o">=</span><span class="n">device</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="s1">'cpu'</span><span class="p">))</span> </code>
<span class="doc doc-properties">
<small class="doc doc-property doc-property-special"><code>special</code></small>
</span>
<a class="headerlink" href="#adviser.services.policy.rl.experience_buffer.Buffer.__init__" title="Permanent link"></a></h6>
<div class="doc doc-contents">
<details class="quote">
<summary>Source code in <code>adviser/services/policy/rl/experience_buffer.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">buffer_size</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">batch_size</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">state_dim</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
             <span class="n">discount_gamma</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.99</span><span class="p">,</span> <span class="n">device</span><span class="o">=</span><span class="n">torch</span><span class="o">.</span><span class="n">device</span><span class="p">(</span><span class="s1">'cpu'</span><span class="p">)):</span>
    <span class="k">assert</span> <span class="n">buffer_size</span> <span class="o">&gt;=</span> <span class="n">batch_size</span><span class="p">,</span> <span class="s1">'the buffer hast to be larger than the batch size'</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">device</span> <span class="o">=</span> <span class="n">device</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">buffer_size</span> <span class="o">=</span> <span class="n">buffer_size</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">batch_size</span> <span class="o">=</span> <span class="n">batch_size</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">discount_gamma</span> <span class="o">=</span> <span class="n">discount_gamma</span>

    <span class="c1"># construct memory</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">mem_state</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="n">buffer_size</span><span class="p">,</span> <span class="n">state_dim</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">torch</span><span class="o">.</span><span class="n">float</span><span class="p">,</span> <span class="n">device</span><span class="o">=</span><span class="n">device</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">mem_action</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="n">buffer_size</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">torch</span><span class="o">.</span><span class="n">long</span><span class="p">,</span> <span class="n">device</span><span class="o">=</span><span class="n">device</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">mem_reward</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="n">buffer_size</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">torch</span><span class="o">.</span><span class="n">float</span><span class="p">,</span> <span class="n">device</span><span class="o">=</span><span class="n">device</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">mem_next_state</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="n">buffer_size</span><span class="p">,</span> <span class="n">state_dim</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">torch</span><span class="o">.</span><span class="n">float</span><span class="p">,</span> <span class="n">device</span><span class="o">=</span><span class="n">device</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">mem_terminal</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="n">buffer_size</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">torch</span><span class="o">.</span><span class="n">float</span><span class="p">,</span> <span class="n">device</span><span class="o">=</span><span class="n">device</span><span class="p">)</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">write_pos</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">last_write_pos</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">buffer_count</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">_reset</span><span class="p">()</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h6 class="doc doc-heading" id="adviser.services.policy.rl.experience_buffer.Buffer.__len__">
<code class="highlight language-python">
__len__<span class="p">(</span><span class="bp">self</span><span class="p">)</span> </code>
<span class="doc doc-properties">
<small class="doc doc-property doc-property-special"><code>special</code></small>
</span>
<a class="headerlink" href="#adviser.services.policy.rl.experience_buffer.Buffer.__len__" title="Permanent link"></a></h6>
<div class="doc doc-contents">
<p>Returns the number of items currently inside the buffer </p>
<details class="quote">
<summary>Source code in <code>adviser/services/policy/rl/experience_buffer.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>145
146
147</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="fm">__len__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">""" Returns the number of items currently inside the buffer """</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">buffer_count</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h6 class="doc doc-heading" id="adviser.services.policy.rl.experience_buffer.Buffer.print_contents">
<code class="highlight language-python">
print_contents<span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">max_size</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span> </code>
<a class="headerlink" href="#adviser.services.policy.rl.experience_buffer.Buffer.print_contents" title="Permanent link"></a></h6>
<div class="doc doc-contents">
<p>Print contents of the experience replay memory.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>max_size</code></td>
<td><code>int</code></td>
<td>
<p>restrict the number of printed items to this number (if not None)</p>
</td>
<td><code>None</code></td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>adviser/services/policy/rl/experience_buffer.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">print_contents</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">max_size</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
    <span class="sd">""" Print contents of the experience replay memory.</span>

<span class="sd">    Args:</span>
<span class="sd">        max_size (int): restrict the number of printed items to this number (if not None)</span>
<span class="sd">    """</span>
    <span class="c1"># how many entries to print</span>
    <span class="n">print_items</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">max_size</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">print_items</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">print_items</span><span class="p">,</span> <span class="n">max_size</span><span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span><span class="s2">"# REPLAY BUFFER CAPACITY: "</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">buffer_size</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">"# CURRENT ITEM COUNT"</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">))</span>

    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">print_items</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">"entry "</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">"  action"</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">mem_action</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">"  reward"</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">mem_reward</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">"  terminal"</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">mem_terminal</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">'---------'</span><span class="p">)</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h6 class="doc doc-heading" id="adviser.services.policy.rl.experience_buffer.Buffer.sample">
<code class="highlight language-python">
sample<span class="p">(</span><span class="bp">self</span><span class="p">)</span> </code>
<a class="headerlink" href="#adviser.services.policy.rl.experience_buffer.Buffer.sample" title="Permanent link"></a></h6>
<div class="doc doc-contents">
<p>Sample from buffer, has to be implemented by subclasses </p>
<details class="quote">
<summary>Source code in <code>adviser/services/policy/rl/experience_buffer.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>149
150
151</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">sample</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">""" Sample from buffer, has to be implemented by subclasses """</span>
    <span class="k">raise</span> <span class="ne">NotImplementedError</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h6 class="doc doc-heading" id="adviser.services.policy.rl.experience_buffer.Buffer.store">
<code class="highlight language-python">
store<span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">state</span><span class="p">,</span> <span class="n">action</span><span class="p">,</span> <span class="n">reward</span><span class="p">,</span> <span class="n">terminal</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span> </code>
<a class="headerlink" href="#adviser.services.policy.rl.experience_buffer.Buffer.store" title="Permanent link"></a></h6>
<div class="doc doc-contents">
<p>Store an experience of the form (s,a,r,s',t).</p>
<p>Only needs the current state s (will construct transition to s'
automatically).</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>state</code></td>
<td><code>FloatTensor</code></td>
<td>
<p>this turn's state tensor, or None if terminal = True</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>action</code></td>
<td><code>LongTensor</code></td>
<td>
<p>this turn's action index (int), or None if terminal = True</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>reward</code></td>
<td><code>float</code></td>
<td>
<p>this turn's reward (float)</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>terminal</code></td>
<td><code>bool</code></td>
<td>
<p>indicates whether episode finished (boolean)</p>
</td>
<td><code>False</code></td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>adviser/services/policy/rl/experience_buffer.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span> 70
 71
 72
 73
 74
 75
 76
 77
 78
 79
 80
 81
 82
 83
 84
 85
 86
 87
 88
 89
 90
 91
 92
 93
 94
 95
 96
 97
 98
 99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">store</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">state</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">FloatTensor</span><span class="p">,</span> <span class="n">action</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">LongTensor</span><span class="p">,</span> <span class="n">reward</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
          <span class="n">terminal</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">):</span>
    <span class="sd">""" Store an experience of the form (s,a,r,s',t).</span>

<span class="sd">    Only needs the current state s (will construct transition to s'</span>
<span class="sd">    automatically).</span>

<span class="sd">    Args:</span>
<span class="sd">        state (torch.tensor): this turn's state tensor, or None if terminal = True</span>
<span class="sd">        action (torch.tensor): this turn's action index (int), or None if terminal = True</span>
<span class="sd">        reward (torch.tensor): this turn's reward (float)</span>
<span class="sd">        terminal (bool): indicates whether episode finished (boolean)</span>
<span class="sd">    """</span>

    <span class="n">reward</span> <span class="o">/=</span> <span class="mf">20.0</span>

    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">last_state</span><span class="p">,</span> <span class="nb">type</span><span class="p">(</span><span class="kc">None</span><span class="p">)):</span>  <span class="c1"># and terminal == False:</span>
        <span class="c1"># first turn of trajectory, don't record since s' is needed</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">last_state</span> <span class="o">=</span> <span class="n">state</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">last_action</span> <span class="o">=</span> <span class="n">action</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">last_reward</span> <span class="o">=</span> <span class="n">reward</span>
        <span class="k">return</span> <span class="kc">False</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">terminal</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">episode_length</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="c1"># update last state's reward and set it to terminal</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">mem_terminal</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">last_write_pos</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">mem_reward</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">last_write_pos</span><span class="p">]</span> <span class="o">+=</span> <span class="n">reward</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_reset</span><span class="p">()</span>
            <span class="k">return</span> <span class="kc">False</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># in-between turn of trajectory: record</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">mem_state</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">write_pos</span><span class="p">]</span> <span class="o">=</span> \
                <span class="bp">self</span><span class="o">.</span><span class="n">last_state</span><span class="o">.</span><span class="n">clone</span><span class="p">()</span><span class="o">.</span><span class="n">detach</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">mem_action</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">write_pos</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">last_action</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">mem_reward</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">write_pos</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">last_reward</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">mem_next_state</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">write_pos</span><span class="p">]</span> <span class="o">=</span> <span class="n">state</span><span class="o">.</span><span class="n">clone</span><span class="p">()</span><span class="o">.</span><span class="n">detach</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">mem_terminal</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">write_pos</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>

            <span class="c1"># update last encountered state</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">last_state</span> <span class="o">=</span> <span class="n">state</span><span class="o">.</span><span class="n">clone</span><span class="p">()</span><span class="o">.</span><span class="n">detach</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">last_action</span> <span class="o">=</span> <span class="n">action</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">last_reward</span> <span class="o">=</span> <span class="n">reward</span>

            <span class="c1"># update write index</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">last_write_pos</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">write_pos</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">write_pos</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">write_pos</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">buffer_size</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">buffer_count</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">buffer_size</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">buffer_count</span> <span class="o">+=</span> <span class="mi">1</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">episode_length</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="k">return</span> <span class="kc">True</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
</div>
</div>
</div>
<div class="doc doc-object doc-class">
<h5 class="doc doc-heading" id="adviser.services.policy.rl.experience_buffer.NaivePrioritizedBuffer">
<code>NaivePrioritizedBuffer</code>
<a class="headerlink" href="#adviser.services.policy.rl.experience_buffer.NaivePrioritizedBuffer" title="Permanent link"></a></h5>
<div class="doc doc-contents">
<p>Prioritized experience replay buffer.</p>
<p>Assigns sampling probabilities dependent on TD-error of the transitions.</p>
<div class="doc doc-children">
<div class="doc doc-object doc-method">
<h6 class="doc doc-heading" id="adviser.services.policy.rl.experience_buffer.NaivePrioritizedBuffer.__init__">
<code class="highlight language-python">
__init__<span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">buffer_size</span><span class="p">,</span> <span class="n">batch_size</span><span class="p">,</span> <span class="n">state_dim</span><span class="p">,</span> <span class="n">sample_last_transition</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">regularisation</span><span class="o">=</span><span class="mf">1e-05</span><span class="p">,</span> <span class="n">exponent</span><span class="o">=</span><span class="mf">0.6</span><span class="p">,</span> <span class="n">beta</span><span class="o">=</span><span class="mf">0.4</span><span class="p">,</span> <span class="n">discount_gamma</span><span class="o">=</span><span class="mf">0.99</span><span class="p">,</span> <span class="n">device</span><span class="o">=</span><span class="n">device</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="s1">'cpu'</span><span class="p">))</span> </code>
<span class="doc doc-properties">
<small class="doc doc-property doc-property-special"><code>special</code></small>
</span>
<a class="headerlink" href="#adviser.services.policy.rl.experience_buffer.NaivePrioritizedBuffer.__init__" title="Permanent link"></a></h6>
<div class="doc doc-contents">
<details class="quote">
<summary>Source code in <code>adviser/services/policy/rl/experience_buffer.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>209
210
211
212
213
214
215
216
217
218
219
220
221
222
223</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">buffer_size</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">batch_size</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">state_dim</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
             <span class="n">sample_last_transition</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
             <span class="n">regularisation</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.00001</span><span class="p">,</span> <span class="n">exponent</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.6</span><span class="p">,</span> <span class="n">beta</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.4</span><span class="p">,</span>
             <span class="n">discount_gamma</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.99</span><span class="p">,</span> <span class="n">device</span><span class="o">=</span><span class="n">torch</span><span class="o">.</span><span class="n">device</span><span class="p">(</span><span class="s1">'cpu'</span><span class="p">)):</span>
    <span class="nb">super</span><span class="p">(</span><span class="n">NaivePrioritizedBuffer</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">buffer_size</span><span class="p">,</span> <span class="n">batch_size</span><span class="p">,</span> <span class="n">state_dim</span><span class="p">,</span>
                                                 <span class="n">discount_gamma</span><span class="o">=</span><span class="n">discount_gamma</span><span class="p">,</span>
                                                 <span class="n">device</span><span class="o">=</span><span class="n">device</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">"  REPLAY MEMORY: NAIVE Prioritized"</span><span class="p">)</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">probs</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.0</span><span class="p">]</span> <span class="o">*</span> <span class="n">buffer_size</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">regularisation</span> <span class="o">=</span> <span class="n">regularisation</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">exponent</span> <span class="o">=</span> <span class="n">exponent</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">beta</span> <span class="o">=</span> <span class="n">beta</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">max_p</span> <span class="o">=</span> <span class="mf">1.0</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">sample_last_transition</span> <span class="o">=</span> <span class="n">sample_last_transition</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h6 class="doc doc-heading" id="adviser.services.policy.rl.experience_buffer.NaivePrioritizedBuffer.sample">
<code class="highlight language-python">
sample<span class="p">(</span><span class="bp">self</span><span class="p">)</span> </code>
<a class="headerlink" href="#adviser.services.policy.rl.experience_buffer.NaivePrioritizedBuffer.sample" title="Permanent link"></a></h6>
<div class="doc doc-contents">
<p>Sample from buffer.</p>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code></code></td>
<td>
<p>states, actions, rewards, next states, terminal state indicator {0,1}, buffer indices,
importance weights</p>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>adviser/services/policy/rl/experience_buffer.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>259
260
261
262
263
264
265
266
267
268
269
270
271
272
273
274
275
276
277
278
279
280
281
282
283
284
285
286
287
288
289
290
291
292
293
294
295
296
297
298
299
300
301
302
303
304
305</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">sample</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">""" Sample from buffer.</span>

<span class="sd">    Returns:</span>
<span class="sd">        states, actions, rewards, next states, terminal state indicator {0,1}, buffer indices,</span>
<span class="sd">        importance weights</span>
<span class="sd">    """</span>
    <span class="n">batch_size</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">batch_size</span>
    <span class="n">batch_write_pos</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">data_indices</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">batch_size</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">torch</span><span class="o">.</span><span class="n">long</span><span class="p">,</span> <span class="n">device</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">device</span><span class="p">)</span>
    <span class="n">probabilities</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">batch_size</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">torch</span><span class="o">.</span><span class="n">float</span><span class="p">,</span> <span class="n">device</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">device</span><span class="p">)</span>
    <span class="n">indices</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">sample_last_transition</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="n">p_normed</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">probs</span><span class="p">[:</span><span class="bp">self</span><span class="o">.</span><span class="n">buffer_count</span><span class="p">])</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">probs</span><span class="p">[:</span><span class="bp">self</span><span class="o">.</span><span class="n">buffer_count</span><span class="p">],</span> <span class="nb">ord</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">indices</span> <span class="o">=</span> <span class="n">common</span><span class="o">.</span><span class="n">numpy</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">buffer_count</span><span class="p">)),</span> <span class="n">size</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">batch_size</span><span class="p">,</span>
                                         <span class="n">p</span><span class="o">=</span><span class="n">p_normed</span><span class="p">)</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">sample_last_transition</span><span class="p">:</span>
        <span class="c1"># include last transition (was at tree.write - 1) </span>
        <span class="c1"># -&gt; see Sutton: A deeper look at experience replay</span>
        <span class="n">data_indices</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">last_write_pos</span>
        <span class="n">probabilities</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">probs</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">last_write_pos</span><span class="p">]</span>
        <span class="c1"># correct size of batch</span>
        <span class="n">batch_size</span> <span class="o">=</span> <span class="n">batch_size</span> <span class="o">-</span> <span class="mi">1</span>
        <span class="n">batch_write_pos</span> <span class="o">+=</span> <span class="mi">1</span>

    <span class="c1"># TODO add option to sample each segment uniformly</span>

    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">batch_write_pos</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">batch_size</span><span class="p">):</span>
        <span class="n">data_indices</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">indices</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
        <span class="n">probabilities</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">probs</span><span class="p">[</span><span class="n">data_indices</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span>

    <span class="c1"># assemble batch from data indices</span>
    <span class="n">s_batch</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mem_state</span><span class="o">.</span><span class="n">index_select</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">data_indices</span><span class="p">)</span>
    <span class="n">a_batch</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mem_action</span><span class="o">.</span><span class="n">index_select</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">data_indices</span><span class="p">)</span>
    <span class="n">r_batch</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mem_reward</span><span class="o">.</span><span class="n">index_select</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">data_indices</span><span class="p">)</span>
    <span class="n">t_batch</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mem_terminal</span><span class="o">.</span><span class="n">index_select</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">data_indices</span><span class="p">)</span>
    <span class="n">s2_batch</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mem_next_state</span><span class="o">.</span><span class="n">index_select</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">data_indices</span><span class="p">)</span>

    <span class="c1"># calculate importance sampling weights</span>
    <span class="n">importance_weights</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">))</span> <span class="o">*</span> <span class="n">probabilities</span>
    <span class="n">importance_weights</span> <span class="o">=</span> <span class="n">importance_weights</span><span class="o">.</span><span class="n">pow</span><span class="p">(</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">beta</span><span class="p">)</span>
    <span class="n">importance_weights</span> <span class="o">=</span> <span class="n">importance_weights</span> <span class="o">/</span> <span class="n">importance_weights</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">dim</span><span class="o">=</span><span class="mi">0</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">item</span><span class="p">()</span>

    <span class="k">return</span> <span class="n">s_batch</span><span class="p">,</span> <span class="n">a_batch</span><span class="p">,</span> <span class="n">r_batch</span><span class="p">,</span> <span class="n">s2_batch</span><span class="p">,</span> <span class="n">t_batch</span><span class="p">,</span> <span class="n">data_indices</span><span class="p">,</span> \
           <span class="n">importance_weights</span><span class="o">.</span><span class="n">view</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h6 class="doc doc-heading" id="adviser.services.policy.rl.experience_buffer.NaivePrioritizedBuffer.store">
<code class="highlight language-python">
store<span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">state</span><span class="p">,</span> <span class="n">action</span><span class="p">,</span> <span class="n">reward</span><span class="p">,</span> <span class="n">terminal</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span> </code>
<a class="headerlink" href="#adviser.services.policy.rl.experience_buffer.NaivePrioritizedBuffer.store" title="Permanent link"></a></h6>
<div class="doc doc-contents">
<p>Store an experience of the form (s,a,r,s',t).</p>
<p>Only needs the current state s (will construct transition to s'
automatically).</p>
<p>Newly added experience tuples will be assigned maximum priority.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>state</code></td>
<td><code>FloatTensor</code></td>
<td>
<p>this turn's state tensor, or None if terminal = True</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>action</code></td>
<td><code>LongTensor</code></td>
<td>
<p>this turn's action index (int), or None if terminal = True</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>reward</code></td>
<td><code>float</code></td>
<td>
<p>this turn's reward (float)</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>terminal</code></td>
<td><code>bool</code></td>
<td>
<p>indicates whether episode finished (boolean)</p>
</td>
<td><code>False</code></td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>adviser/services/policy/rl/experience_buffer.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>232
233
234
235
236
237
238
239
240
241
242
243
244
245
246
247
248
249
250</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">store</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">state</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">FloatTensor</span><span class="p">,</span> <span class="n">action</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">LongTensor</span><span class="p">,</span> <span class="n">reward</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
          <span class="n">terminal</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">):</span>
    <span class="sd">""" Store an experience of the form (s,a,r,s',t).</span>

<span class="sd">    Only needs the current state s (will construct transition to s'</span>
<span class="sd">    automatically).</span>

<span class="sd">    Newly added experience tuples will be assigned maximum priority.</span>

<span class="sd">    Args:</span>
<span class="sd">        state: this turn's state tensor, or None if terminal = True</span>
<span class="sd">        action: this turn's action index (int), or None if terminal = True</span>
<span class="sd">        reward: this turn's reward (float)</span>
<span class="sd">        terminal: indicates whether episode finished (boolean)</span>
<span class="sd">    """</span>

    <span class="k">if</span> <span class="nb">super</span><span class="p">(</span><span class="n">NaivePrioritizedBuffer</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">store</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="n">action</span><span class="p">,</span> <span class="n">reward</span><span class="p">,</span> <span class="n">terminal</span><span class="o">=</span><span class="n">terminal</span><span class="p">):</span>
        <span class="c1"># create new tree node only if something new was added to the buffers</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">probs</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">last_write_pos</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_priority_to_probability</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">max_p</span><span class="p">)</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h6 class="doc doc-heading" id="adviser.services.policy.rl.experience_buffer.NaivePrioritizedBuffer.update">
<code class="highlight language-python">
update<span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">idx</span><span class="p">,</span> <span class="n">error</span><span class="p">)</span> </code>
<a class="headerlink" href="#adviser.services.policy.rl.experience_buffer.NaivePrioritizedBuffer.update" title="Permanent link"></a></h6>
<div class="doc doc-contents">
<p>Update the priority of transition with index idx </p>
<details class="quote">
<summary>Source code in <code>adviser/services/policy/rl/experience_buffer.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>252
253
254
255
256
257</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">update</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">idx</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">error</span><span class="p">:</span> <span class="nb">float</span><span class="p">):</span>
    <span class="sd">""" Update the priority of transition with index idx """</span>
    <span class="n">p</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_priority_to_probability</span><span class="p">(</span><span class="n">error</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">p</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_p</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">max_p</span> <span class="o">=</span> <span class="n">p</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">probs</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span> <span class="o">=</span> <span class="n">p</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
</div>
</div>
</div>
<div class="doc doc-object doc-class">
<h5 class="doc doc-heading" id="adviser.services.policy.rl.experience_buffer.UniformBuffer">
<code>UniformBuffer</code>
<a class="headerlink" href="#adviser.services.policy.rl.experience_buffer.UniformBuffer" title="Permanent link"></a></h5>
<div class="doc doc-contents">
<p>Experience replay buffer with uniformly random sampling </p>
<div class="doc doc-children">
<div class="doc doc-object doc-method">
<h6 class="doc doc-heading" id="adviser.services.policy.rl.experience_buffer.UniformBuffer.__init__">
<code class="highlight language-python">
__init__<span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">buffer_size</span><span class="p">,</span> <span class="n">batch_size</span><span class="p">,</span> <span class="n">state_dim</span><span class="p">,</span> <span class="n">discount_gamma</span><span class="o">=</span><span class="mf">0.99</span><span class="p">,</span> <span class="n">sample_last_transition</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">device</span><span class="o">=</span><span class="n">device</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="s1">'cpu'</span><span class="p">))</span> </code>
<span class="doc doc-properties">
<small class="doc doc-property doc-property-special"><code>special</code></small>
</span>
<a class="headerlink" href="#adviser.services.policy.rl.experience_buffer.UniformBuffer.__init__" title="Permanent link"></a></h6>
<div class="doc doc-contents">
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>sample_last_transition</code></td>
<td><code>bool</code></td>
<td>
<p>if True, a batch will always include the most recent
                           transition
                           (see Sutton: A deeper look at experience replay)</p>
</td>
<td><code>True</code></td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>adviser/services/policy/rl/experience_buffer.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>157
158
159
160
161
162
163
164
165
166
167
168
169
170</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">buffer_size</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">batch_size</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">state_dim</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
             <span class="n">discount_gamma</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.99</span><span class="p">,</span> <span class="n">sample_last_transition</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
             <span class="n">device</span><span class="o">=</span><span class="n">torch</span><span class="o">.</span><span class="n">device</span><span class="p">(</span><span class="s1">'cpu'</span><span class="p">)):</span>
    <span class="sd">"""</span>
<span class="sd">    Args:</span>
<span class="sd">        sample_last_transition (bool): if True, a batch will always include the most recent</span>
<span class="sd">                                       transition</span>
<span class="sd">                                       (see Sutton: A deeper look at experience replay)</span>
<span class="sd">    """</span>
    <span class="nb">super</span><span class="p">(</span><span class="n">UniformBuffer</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">buffer_size</span><span class="p">,</span> <span class="n">batch_size</span><span class="p">,</span> <span class="n">state_dim</span><span class="p">,</span>
                                        <span class="n">discount_gamma</span><span class="o">=</span><span class="n">discount_gamma</span><span class="p">,</span>
                                        <span class="n">device</span><span class="o">=</span><span class="n">device</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">"  REPLAY MEMORY: Uniform"</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">sample_last_transition</span> <span class="o">=</span> <span class="n">sample_last_transition</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h6 class="doc doc-heading" id="adviser.services.policy.rl.experience_buffer.UniformBuffer.sample">
<code class="highlight language-python">
sample<span class="p">(</span><span class="bp">self</span><span class="p">)</span> </code>
<a class="headerlink" href="#adviser.services.policy.rl.experience_buffer.UniformBuffer.sample" title="Permanent link"></a></h6>
<div class="doc doc-contents">
<p>Sample from buffer.</p>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code></code></td>
<td>
<p>states, actions, rewards, next states, terminal state indicator {0,1}, buffer indices,
None</p>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>adviser/services/policy/rl/experience_buffer.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>172
173
174
175
176
177
178
179
180
181
182
183
184
185
186
187
188
189
190
191
192
193
194
195
196
197
198
199
200</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">sample</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">""" Sample from buffer.</span>

<span class="sd">    Returns:</span>
<span class="sd">        states, actions, rewards, next states, terminal state indicator {0,1}, buffer indices,</span>
<span class="sd">        None</span>
<span class="sd">    """</span>
    <span class="c1"># create random indices</span>
    <span class="n">data_indices</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">sample_last_transition</span><span class="p">:</span>
        <span class="c1"># include last transition (was at write - 1)</span>
        <span class="c1"># - see Sutton: A deeper look at experience replay</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">write_pos</span> <span class="o">-</span> <span class="mi">1</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="c1"># last transition filled the capacity of the buffer</span>
            <span class="n">data_indices</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">buffer_size</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">data_indices</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">write_pos</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>
    <span class="n">data_indices</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="n">common</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">buffer_count</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span>
                         <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">batch_size</span> <span class="o">-</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sample_last_transition</span><span class="p">))])</span>
    <span class="n">data_indices</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">(</span><span class="n">data_indices</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">torch</span><span class="o">.</span><span class="n">long</span><span class="p">,</span> <span class="n">device</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">device</span><span class="p">)</span>

    <span class="n">state_batch</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mem_state</span><span class="o">.</span><span class="n">index_select</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">data_indices</span><span class="p">)</span>
    <span class="n">action_batch</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mem_action</span><span class="o">.</span><span class="n">index_select</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">data_indices</span><span class="p">)</span>
    <span class="n">reward_batch</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mem_reward</span><span class="o">.</span><span class="n">index_select</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">data_indices</span><span class="p">)</span>
    <span class="n">next_state_batch</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mem_next_state</span><span class="o">.</span><span class="n">index_select</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">data_indices</span><span class="p">)</span>
    <span class="n">terminal_batch</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mem_terminal</span><span class="o">.</span><span class="n">index_select</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">data_indices</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">state_batch</span><span class="p">,</span> <span class="n">action_batch</span><span class="p">,</span> <span class="n">reward_batch</span><span class="p">,</span> <span class="n">next_state_batch</span><span class="p">,</span> <span class="n">terminal_batch</span><span class="p">,</span> \
           <span class="n">data_indices</span><span class="p">,</span> <span class="kc">None</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="doc doc-object doc-module">
<h4 class="doc doc-heading" id="adviser.services.policy.rl.policy_rl">
<code>policy_rl</code>
<a class="headerlink" href="#adviser.services.policy.rl.policy_rl" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<div class="doc doc-children">
<div class="doc doc-object doc-class">
<h5 class="doc doc-heading" id="adviser.services.policy.rl.policy_rl.RLPolicy">
<code>RLPolicy</code>
<a class="headerlink" href="#adviser.services.policy.rl.policy_rl.RLPolicy" title="Permanent link"></a></h5>
<div class="doc doc-contents">
<p>Base class for Reinforcement Learning based policies.</p>
<p>Functionality provided includes the setup of state- and action spaces,
   conversion of <code>BeliefState</code> objects into pytorch tensors,
   updating the last performed system actions and informed entities,
   populating the experience replay buffer,
   extraction of most probable user hypothesis and candidate action expansion.</p>
<p>Output of an agent is a candidate action like
   <code>inform_food</code>
   which is then populated with the most probable slot/value pair from the
   beliefstate and database candidates by the <code>expand_system_action</code>-function to become
   <code>inform(slot=food,value=italian)</code>.</p>
<p>In order to create your own policy, you can inherit from this class.
   Make sure to call the <code>turn_end</code>-function after each system turn and the <code>end_dialog</code>-function
   after each completed dialog.</p>
<div class="doc doc-children">
<div class="doc doc-object doc-method">
<h6 class="doc doc-heading" id="adviser.services.policy.rl.policy_rl.RLPolicy.__init__">
<code class="highlight language-python">
__init__<span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">domain</span><span class="p">,</span> <span class="n">buffer_cls</span><span class="o">=&lt;</span><span class="k">class</span> <span class="err">'</span><span class="nc">services</span><span class="o">.</span><span class="n">policy</span><span class="o">.</span><span class="n">rl</span><span class="o">.</span><span class="n">experience_buffer</span><span class="o">.</span><span class="n">UniformBuffer</span><span class="s1">'&gt;, buffer_size=6000, batch_size=64, discount_gamma=0.99, max_turns=25, include_confreq=False, logger=&lt;DiasysLogger adviser (NOTSET)&gt;, include_select=False, device=device(type='</span><span class="n">cpu</span><span class="s1">'))</span> </code>
<span class="doc doc-properties">
<small class="doc doc-property doc-property-special"><code>special</code></small>
</span>
<a class="headerlink" href="#adviser.services.policy.rl.policy_rl.RLPolicy.__init__" title="Permanent link"></a></h6>
<div class="doc doc-contents">
<p>Creates state- and action spaces, initializes experience replay
buffers.</p>
<p>Keyword Arguments:
    subgraph {[type]} -- [see services.Module] (default: {None})
    buffer_cls {services.policy.rl.experience_buffer.Buffer}
    -- [Experience replay buffer <em>class</em>, <strong>not</strong> an instance - will be
        initialized by this constructor!] (default: {UniformBuffer})
    buffer_size {int} -- [see services.policy.rl.experience_buffer.
                          Buffer] (default: {6000})
    batch_size {int} -- [see services.policy.rl.experience_buffer.
                          Buffer] (default: {64})
    discount_gamma {float} -- [Discount factor] (default: {0.99})
    include_confreq {bool} -- [Use confirm_request actions]
                               (default: {False})</p>
<details class="quote">
<summary>Source code in <code>adviser/services/policy/rl/policy_rl.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span> 56
 57
 58
 59
 60
 61
 62
 63
 64
 65
 66
 67
 68
 69
 70
 71
 72
 73
 74
 75
 76
 77
 78
 79
 80
 81
 82
 83
 84
 85
 86
 87
 88
 89
 90
 91
 92
 93
 94
 95
 96
 97
 98
 99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">domain</span><span class="p">:</span> <span class="n">JSONLookupDomain</span><span class="p">,</span> <span class="n">buffer_cls</span><span class="o">=</span><span class="n">UniformBuffer</span><span class="p">,</span>
             <span class="n">buffer_size</span><span class="o">=</span><span class="mi">6000</span><span class="p">,</span> <span class="n">batch_size</span><span class="o">=</span><span class="mi">64</span><span class="p">,</span> <span class="n">discount_gamma</span><span class="o">=</span><span class="mf">0.99</span><span class="p">,</span> <span class="n">max_turns</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">25</span><span class="p">,</span>
             <span class="n">include_confreq</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">logger</span><span class="p">:</span> <span class="n">DiasysLogger</span> <span class="o">=</span> <span class="n">DiasysLogger</span><span class="p">(),</span>
             <span class="n">include_select</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">device</span><span class="o">=</span><span class="n">torch</span><span class="o">.</span><span class="n">device</span><span class="p">(</span><span class="s1">'cpu'</span><span class="p">)):</span>
    <span class="sd">"""</span>
<span class="sd">    Creates state- and action spaces, initializes experience replay</span>
<span class="sd">    buffers.</span>

<span class="sd">    Arguments:</span>
<span class="sd">        domain {domain.jsonlookupdomain.JSONLookupDomain} -- Domain</span>

<span class="sd">    Keyword Arguments:</span>
<span class="sd">        subgraph {[type]} -- [see services.Module] (default: {None})</span>
<span class="sd">        buffer_cls {services.policy.rl.experience_buffer.Buffer}</span>
<span class="sd">        -- [Experience replay buffer *class*, **not** an instance - will be</span>
<span class="sd">            initialized by this constructor!] (default: {UniformBuffer})</span>
<span class="sd">        buffer_size {int} -- [see services.policy.rl.experience_buffer.</span>
<span class="sd">                              Buffer] (default: {6000})</span>
<span class="sd">        batch_size {int} -- [see services.policy.rl.experience_buffer.</span>
<span class="sd">                              Buffer] (default: {64})</span>
<span class="sd">        discount_gamma {float} -- [Discount factor] (default: {0.99})</span>
<span class="sd">        include_confreq {bool} -- [Use confirm_request actions]</span>
<span class="sd">                                   (default: {False})</span>
<span class="sd">    """</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">device</span> <span class="o">=</span> <span class="n">device</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">sys_state</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">"lastInformedPrimKeyVal"</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
        <span class="s2">"lastActionInformNone"</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
        <span class="s2">"offerHappened"</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
        <span class="s1">'informedPrimKeyValsSinceNone'</span><span class="p">:</span> <span class="p">[]}</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">max_turns</span> <span class="o">=</span> <span class="n">max_turns</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">logger</span> <span class="o">=</span> <span class="n">logger</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">domain</span> <span class="o">=</span> <span class="n">domain</span>
    <span class="c1"># setup evaluator for training</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">evaluator</span> <span class="o">=</span> <span class="n">ObjectiveReachedEvaluator</span><span class="p">(</span><span class="n">domain</span><span class="p">,</span> <span class="n">logger</span><span class="o">=</span><span class="n">logger</span><span class="p">)</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">buffer_size</span> <span class="o">=</span> <span class="n">buffer_size</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">batch_size</span> <span class="o">=</span> <span class="n">batch_size</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">discount_gamma</span> <span class="o">=</span> <span class="n">discount_gamma</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">writer</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="c1"># get state size</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">state_dim</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">beliefstate_dict_to_vector</span><span class="p">(</span>
        <span class="n">BeliefState</span><span class="p">(</span><span class="n">domain</span><span class="p">)</span><span class="o">.</span><span class="n">_init_beliefstate</span><span class="p">())</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">"state space dim: "</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">state_dim</span><span class="p">))</span>

    <span class="c1"># get system action list</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">actions</span> <span class="o">=</span> <span class="p">[</span><span class="s2">"inform_byname"</span><span class="p">,</span>  <span class="c1"># TODO rename to 'bykey'</span>
                    <span class="s2">"inform_alternatives"</span><span class="p">,</span>
                    <span class="s2">"reqmore"</span><span class="p">]</span>
    <span class="c1"># TODO badaction</span>
    <span class="k">for</span> <span class="n">req_slot</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">domain</span><span class="o">.</span><span class="n">get_system_requestable_slots</span><span class="p">():</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">actions</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">'request#'</span> <span class="o">+</span> <span class="n">req_slot</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">actions</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">'confirm#'</span> <span class="o">+</span> <span class="n">req_slot</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">include_select</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">actions</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">'select#'</span> <span class="o">+</span> <span class="n">req_slot</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">include_confreq</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">conf_slot</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">domain</span><span class="o">.</span><span class="n">get_system_requestable_slots</span><span class="p">():</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">req_slot</span> <span class="o">==</span> <span class="n">conf_slot</span><span class="p">:</span>
                    <span class="c1"># skip case where confirm slot = request slot</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">actions</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">'confreq#'</span> <span class="o">+</span> <span class="n">conf_slot</span> <span class="o">+</span> <span class="s1">'#'</span> <span class="o">+</span>
                                        <span class="n">req_slot</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">action_dim</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">actions</span><span class="p">)</span>
    <span class="c1"># don't include closingmsg in learnable actions</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">actions</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">'closingmsg'</span><span class="p">)</span>
    <span class="c1"># self.actions.append("closingmsg")</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">"action space dim: "</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">action_dim</span><span class="p">))</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">primary_key</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">domain</span><span class="o">.</span><span class="n">get_primary_key</span><span class="p">()</span>

    <span class="c1"># init replay memory</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">buffer</span> <span class="o">=</span> <span class="n">buffer_cls</span><span class="p">(</span><span class="n">buffer_size</span><span class="p">,</span> <span class="n">batch_size</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">state_dim</span><span class="p">,</span>
                             <span class="n">discount_gamma</span><span class="o">=</span><span class="n">discount_gamma</span><span class="p">,</span> <span class="n">device</span><span class="o">=</span><span class="n">device</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">sys_state</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">last_sys_act</span> <span class="o">=</span> <span class="kc">None</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h6 class="doc doc-heading" id="adviser.services.policy.rl.policy_rl.RLPolicy.action_idx">
<code class="highlight language-python">
action_idx<span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">action_name</span><span class="p">)</span> </code>
<a class="headerlink" href="#adviser.services.policy.rl.policy_rl.RLPolicy.action_idx" title="Permanent link"></a></h6>
<div class="doc doc-contents">
<p>Returns the action index for the specified action name </p>
<details class="quote">
<summary>Source code in <code>adviser/services/policy/rl/policy_rl.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>140
141
142</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">action_idx</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">action_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
    <span class="sd">""" Returns the action index for the specified action name """</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">actions</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">action_name</span><span class="p">)</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h6 class="doc doc-heading" id="adviser.services.policy.rl.policy_rl.RLPolicy.action_name">
<code class="highlight language-python">
action_name<span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">action_idx</span><span class="p">)</span> </code>
<a class="headerlink" href="#adviser.services.policy.rl.policy_rl.RLPolicy.action_name" title="Permanent link"></a></h6>
<div class="doc doc-contents">
<p>Returns the action name for the specified action index </p>
<details class="quote">
<summary>Source code in <code>adviser/services/policy/rl/policy_rl.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>136
137
138</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">action_name</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">action_idx</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
    <span class="sd">""" Returns the action name for the specified action index """</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">actions</span><span class="p">[</span><span class="n">action_idx</span><span class="p">]</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h6 class="doc doc-heading" id="adviser.services.policy.rl.policy_rl.RLPolicy.beliefstate_dict_to_vector">
<code class="highlight language-python">
beliefstate_dict_to_vector<span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">beliefstate</span><span class="p">)</span> </code>
<a class="headerlink" href="#adviser.services.policy.rl.policy_rl.RLPolicy.beliefstate_dict_to_vector" title="Permanent link"></a></h6>
<div class="doc doc-contents">
<p>Converts the beliefstate dict to a torch tensor</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>beliefstate</code></td>
<td><code>BeliefState</code></td>
<td>
<p>dict of belief (with at least beliefs and system keys)</p>
</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code></code></td>
<td>
<p>belief tensor with dimension 1 x state_dim</p>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>adviser/services/policy/rl/policy_rl.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168
169
170
171
172
173
174
175
176
177
178
179
180
181
182
183
184
185
186
187
188
189
190
191
192
193
194</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">beliefstate_dict_to_vector</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">beliefstate</span><span class="p">:</span> <span class="n">BeliefState</span><span class="p">):</span>
    <span class="sd">""" Converts the beliefstate dict to a torch tensor</span>

<span class="sd">    Args:</span>
<span class="sd">        beliefstate: dict of belief (with at least beliefs and system keys)</span>

<span class="sd">    Returns:</span>
<span class="sd">        belief tensor with dimension 1 x state_dim</span>
<span class="sd">    """</span>

    <span class="n">belief_vec</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="c1"># add user acts</span>
    <span class="n">belief_vec</span> <span class="o">+=</span> <span class="p">[</span><span class="mi">1</span> <span class="k">if</span> <span class="n">act</span> <span class="ow">in</span> <span class="n">beliefstate</span><span class="p">[</span><span class="s1">'user_acts'</span><span class="p">]</span> <span class="k">else</span> <span class="mi">0</span> <span class="k">for</span> <span class="n">act</span> <span class="ow">in</span> <span class="n">UserActionType</span><span class="p">]</span>
    <span class="c1"># handle none actions</span>
    <span class="n">belief_vec</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mi">1</span> <span class="k">if</span> <span class="nb">sum</span><span class="p">(</span><span class="n">belief_vec</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span> <span class="k">else</span> <span class="mi">1</span><span class="p">)</span>

    <span class="c1"># add informs (including special flag if slot not mentioned)</span>
    <span class="k">for</span> <span class="n">slot</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">domain</span><span class="o">.</span><span class="n">get_informable_slots</span><span class="p">()):</span>
        <span class="n">values</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">domain</span><span class="o">.</span><span class="n">get_possible_values</span><span class="p">(</span><span class="n">slot</span><span class="p">)</span> <span class="o">+</span> <span class="p">[</span><span class="s2">"dontcare"</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">slot</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">beliefstate</span><span class="p">[</span><span class="s1">'informs'</span><span class="p">]:</span>
            <span class="c1"># add **NONE** value first, then 0.0 for all others</span>
            <span class="n">belief_vec</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mf">1.0</span><span class="p">)</span>
            <span class="c1"># also add value for don't care</span>
            <span class="n">belief_vec</span> <span class="o">+=</span> <span class="p">[</span><span class="mi">0</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">values</span><span class="p">))]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># add **NONE** value first</span>
            <span class="n">belief_vec</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mf">0.0</span><span class="p">)</span>
            <span class="n">bs_slot</span> <span class="o">=</span> <span class="n">beliefstate</span><span class="p">[</span><span class="s1">'informs'</span><span class="p">][</span><span class="n">slot</span><span class="p">]</span>
            <span class="n">belief_vec</span> <span class="o">+=</span> <span class="p">[</span><span class="n">bs_slot</span><span class="p">[</span><span class="n">value</span><span class="p">]</span> <span class="k">if</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">bs_slot</span> <span class="k">else</span> <span class="mf">0.0</span> <span class="k">for</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">values</span><span class="p">]</span>

    <span class="c1"># add requests</span>
    <span class="k">for</span> <span class="n">slot</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">domain</span><span class="o">.</span><span class="n">get_requestable_slots</span><span class="p">()):</span>
        <span class="k">if</span> <span class="n">slot</span> <span class="ow">in</span> <span class="n">beliefstate</span><span class="p">[</span><span class="s1">'requests'</span><span class="p">]:</span>
            <span class="n">belief_vec</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mf">1.0</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">belief_vec</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mf">0.0</span><span class="p">)</span>

    <span class="c1"># append system features</span>
    <span class="n">belief_vec</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sys_state</span><span class="p">[</span><span class="s1">'lastActionInformNone'</span><span class="p">]))</span>
    <span class="n">belief_vec</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sys_state</span><span class="p">[</span><span class="s1">'offerHappened'</span><span class="p">]))</span>
    <span class="n">candidate_count</span> <span class="o">=</span> <span class="n">beliefstate</span><span class="p">[</span><span class="s1">'num_matches'</span><span class="p">]</span>
    <span class="c1"># buckets for match count: 0, 1, 2-4, &gt;4</span>
    <span class="n">belief_vec</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">candidate_count</span> <span class="o">==</span> <span class="mi">0</span><span class="p">))</span>
    <span class="n">belief_vec</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">candidate_count</span> <span class="o">==</span> <span class="mi">1</span><span class="p">))</span>
    <span class="n">belief_vec</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="mi">2</span> <span class="o">&lt;=</span> <span class="n">candidate_count</span> <span class="o">&lt;=</span> <span class="mi">4</span><span class="p">))</span>
    <span class="n">belief_vec</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">candidate_count</span> <span class="o">&gt;</span> <span class="mi">4</span><span class="p">))</span>
    <span class="n">belief_vec</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">beliefstate</span><span class="p">[</span><span class="s2">"discriminable"</span><span class="p">]))</span>

    <span class="c1"># convert to torch tensor</span>
    <span class="k">return</span> <span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">([</span><span class="n">belief_vec</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">torch</span><span class="o">.</span><span class="n">float</span><span class="p">,</span> <span class="n">device</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">device</span><span class="p">)</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h6 class="doc doc-heading" id="adviser.services.policy.rl.policy_rl.RLPolicy.end_dialog">
<code class="highlight language-python">
end_dialog<span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sim_goal</span><span class="p">)</span> </code>
<a class="headerlink" href="#adviser.services.policy.rl.policy_rl.RLPolicy.end_dialog" title="Permanent link"></a></h6>
<div class="doc doc-contents">
<p>Call this function when a dialog ended </p>
<details class="quote">
<summary>Source code in <code>adviser/services/policy/rl/policy_rl.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>544
545
546
547
548
549
550
551
552
553
554</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">end_dialog</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sim_goal</span><span class="p">:</span> <span class="n">Goal</span><span class="p">):</span>
    <span class="sd">""" Call this function when a dialog ended """</span>
    <span class="k">if</span> <span class="n">sim_goal</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="c1"># real user interaction, no simulator - don't have to evaluate</span>
        <span class="c1"># anything, just reset counters</span>
        <span class="k">return</span>

    <span class="n">final_reward</span><span class="p">,</span> <span class="n">success</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">evaluator</span><span class="o">.</span><span class="n">get_final_reward</span><span class="p">(</span><span class="n">sim_goal</span><span class="p">,</span> <span class="n">logging</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_training</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">buffer</span><span class="o">.</span><span class="n">store</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="n">final_reward</span><span class="p">,</span> <span class="n">terminal</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h6 class="doc doc-heading" id="adviser.services.policy.rl.policy_rl.RLPolicy.expand_system_action">
<code class="highlight language-python">
expand_system_action<span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">action_idx</span><span class="p">,</span> <span class="n">beliefstate</span><span class="p">)</span> </code>
<a class="headerlink" href="#adviser.services.policy.rl.policy_rl.RLPolicy.expand_system_action" title="Permanent link"></a></h6>
<div class="doc doc-contents">
<p>Expands an action index to a real sytem act </p>
<details class="quote">
<summary>Source code in <code>adviser/services/policy/rl/policy_rl.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>461
462
463
464
465
466
467
468
469
470
471
472
473
474
475
476
477
478
479
480
481
482
483
484
485
486</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">expand_system_action</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">action_idx</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">beliefstate</span><span class="p">:</span> <span class="n">BeliefState</span><span class="p">):</span>
    <span class="sd">""" Expands an action index to a real sytem act """</span>
    <span class="n">action_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">action_name</span><span class="p">(</span><span class="n">action_idx</span><span class="p">)</span>
    <span class="k">if</span> <span class="s1">'request#'</span> <span class="ow">in</span> <span class="n">action_name</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_expand_request</span><span class="p">(</span><span class="n">action_name</span><span class="p">)</span>
    <span class="k">elif</span> <span class="s1">'select#'</span> <span class="ow">in</span> <span class="n">action_name</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_expand_select</span><span class="p">(</span><span class="n">action_name</span><span class="p">,</span> <span class="n">beliefstate</span><span class="p">)</span>
    <span class="k">elif</span> <span class="s1">'confirm#'</span> <span class="ow">in</span> <span class="n">action_name</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_expand_confirm</span><span class="p">(</span><span class="n">action_name</span><span class="p">,</span> <span class="n">beliefstate</span><span class="p">)</span>
    <span class="k">elif</span> <span class="s1">'confreq#'</span> <span class="ow">in</span> <span class="n">action_name</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_expand_confreq</span><span class="p">(</span><span class="n">action_name</span><span class="p">,</span> <span class="n">beliefstate</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">action_name</span> <span class="o">==</span> <span class="s1">'inform_byname'</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_expand_informbyname</span><span class="p">(</span><span class="n">beliefstate</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">action_name</span> <span class="o">==</span> <span class="s1">'inform_alternatives'</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_expand_informbyalternatives</span><span class="p">(</span><span class="n">beliefstate</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">action_name</span> <span class="o">==</span> <span class="s1">'closingmsg'</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_expand_bye</span><span class="p">()</span>
    <span class="k">elif</span> <span class="n">action_name</span> <span class="o">==</span> <span class="s1">'repeat'</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">last_sys_act</span>
    <span class="k">elif</span> <span class="n">action_name</span> <span class="o">==</span> <span class="s1">'reqmore'</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_expand_reqmore</span><span class="p">()</span>
    <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">"RL POLICY: system action not supported: "</span> <span class="o">+</span>
                            <span class="n">action_name</span><span class="p">)</span>

    <span class="k">return</span> <span class="kc">None</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h6 class="doc doc-heading" id="adviser.services.policy.rl.policy_rl.RLPolicy.turn_end">
<code class="highlight language-python">
turn_end<span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">beliefstate</span><span class="p">,</span> <span class="n">state_vector</span><span class="p">,</span> <span class="n">sys_act_idx</span><span class="p">)</span> </code>
<a class="headerlink" href="#adviser.services.policy.rl.policy_rl.RLPolicy.turn_end" title="Permanent link"></a></h6>
<div class="doc doc-contents">
<p>Call this function after a turn is done by the system </p>
<details class="quote">
<summary>Source code in <code>adviser/services/policy/rl/policy_rl.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>520
521
522
523
524
525
526
527
528
529
530
531
532</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">turn_end</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">beliefstate</span><span class="p">:</span> <span class="n">BeliefState</span><span class="p">,</span> <span class="n">state_vector</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">FloatTensor</span><span class="p">,</span>
             <span class="n">sys_act_idx</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
    <span class="sd">""" Call this function after a turn is done by the system """</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">last_sys_act</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">expand_system_action</span><span class="p">(</span><span class="n">sys_act_idx</span><span class="p">,</span> <span class="n">beliefstate</span><span class="p">)</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">dialog_turn</span><span class="p">(</span><span class="s2">"system action &gt; "</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">last_sys_act</span><span class="p">))</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_update_system_belief</span><span class="p">(</span><span class="n">beliefstate</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">last_sys_act</span><span class="p">)</span>

    <span class="n">turn_reward</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">evaluator</span><span class="o">.</span><span class="n">get_turn_reward</span><span class="p">()</span>

    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_training</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">buffer</span><span class="o">.</span><span class="n">store</span><span class="p">(</span><span class="n">state_vector</span><span class="p">,</span> <span class="n">sys_act_idx</span><span class="p">,</span> <span class="n">turn_reward</span><span class="p">,</span> <span class="n">terminal</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="doc doc-object doc-module">
<h4 class="doc doc-heading" id="adviser.services.policy.rl.train_dqnpolicy">
<code>train_dqnpolicy</code>
<a class="headerlink" href="#adviser.services.policy.rl.train_dqnpolicy" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<h1 id="this-script-can-be-executed-to-train-a-dqn-policy">This script can be executed to train a DQN policy.<a class="headerlink" href="#this-script-can-be-executed-to-train-a-dqn-policy" title="Permanent link"></a></h1>
<h1 id="it-will-create-a-policy-model-file-ending-with-pt">It will create a policy model (file ending with .pt).<a class="headerlink" href="#it-will-create-a-policy-model-file-ending-with-pt" title="Permanent link"></a></h1>
<h1 id="you-need-to-execute-this-script-before-you-can-interact-with-the-rl-agent">You need to execute this script before you can interact with the RL agent.<a class="headerlink" href="#you-need-to-execute-this-script-before-you-can-interact-with-the-rl-agent" title="Permanent link"></a></h1>
<h1 id="_1"><a class="headerlink" href="#_1" title="Permanent link"></a></h1>
<div class="doc doc-children">
<div class="doc doc-object doc-function">
<h5 class="doc doc-heading" id="adviser.services.policy.rl.train_dqnpolicy.get_root_dir">
<code class="highlight language-python">
get_root_dir<span class="p">()</span> </code>
<a class="headerlink" href="#adviser.services.policy.rl.train_dqnpolicy.get_root_dir" title="Permanent link"></a></h5>
<div class="doc doc-contents">
<details class="quote">
<summary>Source code in <code>adviser/services/policy/rl/train_dqnpolicy.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>31
32</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">get_root_dir</span><span class="p">():</span>
    <span class="k">return</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="vm">__file__</span><span class="p">)))))</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-function">
<h5 class="doc doc-heading" id="adviser.services.policy.rl.train_dqnpolicy.train">
<code class="highlight language-python">
train<span class="p">(</span><span class="n">domain_name</span><span class="p">,</span> <span class="n">log_to_file</span><span class="p">,</span> <span class="n">seed</span><span class="p">,</span> <span class="n">train_epochs</span><span class="p">,</span> <span class="n">train_dialogs</span><span class="p">,</span> <span class="n">eval_dialogs</span><span class="p">,</span> <span class="n">max_turns</span><span class="p">,</span> <span class="n">train_error_rate</span><span class="p">,</span> <span class="n">test_error_rate</span><span class="p">,</span> <span class="n">lr</span><span class="p">,</span> <span class="n">eps_start</span><span class="p">,</span> <span class="n">grad_clipping</span><span class="p">,</span> <span class="n">buffer_classname</span><span class="p">,</span> <span class="n">buffer_size</span><span class="p">,</span> <span class="n">use_tensorboard</span><span class="p">)</span> </code>
<a class="headerlink" href="#adviser.services.policy.rl.train_dqnpolicy.train" title="Permanent link"></a></h5>
<div class="doc doc-contents">
<p>Training loop for the RL policy, for information on the parameters, look at the descriptions
of commandline arguments in the "if main" below</p>
<details class="quote">
<summary>Source code in <code>adviser/services/policy/rl/train_dqnpolicy.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span> 52
 53
 54
 55
 56
 57
 58
 59
 60
 61
 62
 63
 64
 65
 66
 67
 68
 69
 70
 71
 72
 73
 74
 75
 76
 77
 78
 79
 80
 81
 82
 83
 84
 85
 86
 87
 88
 89
 90
 91
 92
 93
 94
 95
 96
 97
 98
 99
100
101
102
103
104
105
106
107
108
109
110</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">train</span><span class="p">(</span><span class="n">domain_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">log_to_file</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span> <span class="n">seed</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">train_epochs</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">train_dialogs</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
          <span class="n">eval_dialogs</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">max_turns</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">train_error_rate</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">test_error_rate</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
          <span class="n">lr</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">eps_start</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">grad_clipping</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">buffer_classname</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
          <span class="n">buffer_size</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">use_tensorboard</span><span class="p">:</span> <span class="nb">bool</span><span class="p">):</span>

    <span class="sd">"""</span>
<span class="sd">        Training loop for the RL policy, for information on the parameters, look at the descriptions</span>
<span class="sd">        of commandline arguments in the "if main" below</span>
<span class="sd">    """</span>
    <span class="n">common</span><span class="o">.</span><span class="n">init_random</span><span class="p">(</span><span class="n">seed</span><span class="o">=</span><span class="n">seed</span><span class="p">)</span>

    <span class="n">file_log_lvl</span> <span class="o">=</span> <span class="n">LogLevel</span><span class="o">.</span><span class="n">DIALOGS</span> <span class="k">if</span> <span class="n">log_to_file</span> <span class="k">else</span> <span class="n">LogLevel</span><span class="o">.</span><span class="n">NONE</span>
    <span class="n">logger</span> <span class="o">=</span> <span class="n">DiasysLogger</span><span class="p">(</span><span class="n">console_log_lvl</span><span class="o">=</span><span class="n">LogLevel</span><span class="o">.</span><span class="n">RESULTS</span><span class="p">,</span> <span class="n">file_log_lvl</span><span class="o">=</span><span class="n">file_log_lvl</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">buffer_classname</span> <span class="o">==</span> <span class="s2">"prioritized"</span><span class="p">:</span>
        <span class="n">buffer_cls</span> <span class="o">=</span> <span class="n">NaivePrioritizedBuffer</span>
    <span class="k">elif</span> <span class="n">buffer_classname</span> <span class="o">==</span> <span class="s2">"uniform"</span><span class="p">:</span>
        <span class="n">buffer_cls</span> <span class="o">=</span> <span class="n">UniformBuffer</span>

    <span class="n">domain</span> <span class="o">=</span> <span class="n">JSONLookupDomain</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">domain_name</span><span class="p">)</span>

    <span class="n">bst</span> <span class="o">=</span> <span class="n">HandcraftedBST</span><span class="p">(</span><span class="n">domain</span><span class="o">=</span><span class="n">domain</span><span class="p">,</span> <span class="n">logger</span><span class="o">=</span><span class="n">logger</span><span class="p">)</span>
    <span class="n">user</span> <span class="o">=</span> <span class="n">HandcraftedUserSimulator</span><span class="p">(</span><span class="n">domain</span><span class="p">,</span> <span class="n">logger</span><span class="o">=</span><span class="n">logger</span><span class="p">)</span>
    <span class="c1"># noise = SimpleNoise(domain=domain, train_error_rate=train_error_rate,</span>
    <span class="c1">#                     test_error_rate=test_error_rate, logger=logger)</span>
    <span class="n">policy</span> <span class="o">=</span> <span class="n">DQNPolicy</span><span class="p">(</span><span class="n">domain</span><span class="o">=</span><span class="n">domain</span><span class="p">,</span> <span class="n">lr</span><span class="o">=</span><span class="n">lr</span><span class="p">,</span> <span class="n">eps_start</span><span class="o">=</span><span class="n">eps_start</span><span class="p">,</span>
                    <span class="n">gradient_clipping</span><span class="o">=</span><span class="n">grad_clipping</span><span class="p">,</span> <span class="n">buffer_cls</span><span class="o">=</span><span class="n">buffer_cls</span><span class="p">,</span>
                    <span class="n">replay_buffer_size</span><span class="o">=</span><span class="n">buffer_size</span><span class="p">,</span> <span class="n">train_dialogs</span><span class="o">=</span><span class="n">train_dialogs</span><span class="p">,</span>
                    <span class="n">logger</span><span class="o">=</span><span class="n">logger</span><span class="p">)</span>
    <span class="n">evaluator</span> <span class="o">=</span> <span class="n">PolicyEvaluator</span><span class="p">(</span><span class="n">domain</span><span class="o">=</span><span class="n">domain</span><span class="p">,</span> <span class="n">use_tensorboard</span><span class="o">=</span><span class="n">use_tensorboard</span><span class="p">,</span>
                                <span class="n">experiment_name</span><span class="o">=</span><span class="n">domain_name</span><span class="p">,</span> <span class="n">logger</span><span class="o">=</span><span class="n">logger</span><span class="p">)</span>
    <span class="n">ds</span> <span class="o">=</span> <span class="n">DialogSystem</span><span class="p">(</span><span class="n">services</span><span class="o">=</span><span class="p">[</span><span class="n">user</span><span class="p">,</span> <span class="n">bst</span><span class="p">,</span> <span class="n">policy</span><span class="p">,</span> <span class="n">evaluator</span><span class="p">],</span> <span class="n">protocol</span><span class="o">=</span><span class="s1">'tcp'</span><span class="p">)</span>
    <span class="c1"># ds.draw_system_graph()</span>

    <span class="n">error_free</span> <span class="o">=</span> <span class="n">ds</span><span class="o">.</span><span class="n">is_error_free_messaging_pipeline</span><span class="p">()</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">error_free</span><span class="p">:</span>
        <span class="n">ds</span><span class="o">.</span><span class="n">print_local_inconsistencies</span><span class="p">()</span>

    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">train_epochs</span><span class="p">):</span>
        <span class="c1"># START TRAIN EPOCH</span>
        <span class="n">evaluator</span><span class="o">.</span><span class="n">train</span><span class="p">()</span>
        <span class="n">policy</span><span class="o">.</span><span class="n">train</span><span class="p">()</span>
        <span class="n">evaluator</span><span class="o">.</span><span class="n">start_epoch</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">episode</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">train_dialogs</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">episode</span> <span class="o">%</span> <span class="mi">100</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">"DIALOG"</span><span class="p">,</span> <span class="n">episode</span><span class="p">)</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">dialog_turn</span><span class="p">(</span><span class="s2">"</span><span class="se">\n\n</span><span class="s2">!!!!!!!!!!!!!!!! NEW DIALOG !!!!!!!!!!!!!!!!!!!!!!!!!!!!</span><span class="se">\n\n</span><span class="s2">"</span><span class="p">)</span>
            <span class="n">ds</span><span class="o">.</span><span class="n">run_dialog</span><span class="p">(</span><span class="n">start_signals</span><span class="o">=</span><span class="p">{</span><span class="sa">f</span><span class="s1">'user_acts/</span><span class="si">{</span><span class="n">domain</span><span class="o">.</span><span class="n">get_domain_name</span><span class="p">()</span><span class="si">}</span><span class="s1">'</span><span class="p">:</span> <span class="p">[]})</span>
        <span class="n">evaluator</span><span class="o">.</span><span class="n">end_epoch</span><span class="p">()</span>
        <span class="n">policy</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>

        <span class="c1"># START EVAL EPOCH</span>
        <span class="n">evaluator</span><span class="o">.</span><span class="n">eval</span><span class="p">()</span>
        <span class="n">policy</span><span class="o">.</span><span class="n">eval</span><span class="p">()</span>
        <span class="n">evaluator</span><span class="o">.</span><span class="n">start_epoch</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">episode</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">eval_dialogs</span><span class="p">):</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">dialog_turn</span><span class="p">(</span><span class="s2">"</span><span class="se">\n\n</span><span class="s2">!!!!!!!!!!!!!!!! NEW DIALOG !!!!!!!!!!!!!!!!!!!!!!!!!!!!</span><span class="se">\n\n</span><span class="s2">"</span><span class="p">)</span>
            <span class="n">ds</span><span class="o">.</span><span class="n">run_dialog</span><span class="p">(</span><span class="n">start_signals</span><span class="o">=</span><span class="p">{</span><span class="sa">f</span><span class="s1">'user_acts/</span><span class="si">{</span><span class="n">domain</span><span class="o">.</span><span class="n">get_domain_name</span><span class="p">()</span><span class="si">}</span><span class="s1">'</span><span class="p">:</span> <span class="p">[]})</span>
        <span class="n">evaluator</span><span class="o">.</span><span class="n">end_epoch</span><span class="p">()</span>
    <span class="n">ds</span><span class="o">.</span><span class="n">shutdown</span><span class="p">()</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="doc doc-object doc-module">
<h2 class="doc doc-heading" id="adviser.services.service">
<code>service</code>
<a class="headerlink" href="#adviser.services.service" title="Permanent link"></a></h2>
<div class="doc doc-contents">
<div class="doc doc-children">
<div class="doc doc-object doc-class">
<h3 class="doc doc-heading" id="adviser.services.service.DialogSystem">
<code>DialogSystem</code>
<a class="headerlink" href="#adviser.services.service.DialogSystem" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>This class will constrct a dialog system from the list of services provided to the constructor.
It will also handle synchronization for initalization of services before dialog start / after dialog end / on system shutdown
and lets you discover potential conflicts in you messaging pipeline.
This class is also used to communicate / synchronize with services running on different nodes.</p>
<div class="doc doc-children">
<div class="doc doc-object doc-method">
<h4 class="doc doc-heading" id="adviser.services.service.DialogSystem.__init__">
<code class="highlight language-python">
__init__<span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">services</span><span class="p">,</span> <span class="n">sub_port</span><span class="o">=</span><span class="mi">65533</span><span class="p">,</span> <span class="n">pub_port</span><span class="o">=</span><span class="mi">65534</span><span class="p">,</span> <span class="n">reg_port</span><span class="o">=</span><span class="mi">65535</span><span class="p">,</span> <span class="n">protocol</span><span class="o">=</span><span class="s1">'tcp'</span><span class="p">,</span> <span class="n">debug_logger</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span> </code>
<span class="doc doc-properties">
<small class="doc doc-property doc-property-special"><code>special</code></small>
</span>
<a class="headerlink" href="#adviser.services.service.DialogSystem.__init__" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>services</code></td>
<td><code>List[Union[adviser.services.service.Service, adviser.services.service.RemoteService]]</code></td>
<td>
<p>List of all (remote) services to connect to.
                                            Only once they're specified here will they start listening for
                                            messages.</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>sub_port(int)</code></td>
<td><code></code></td>
<td>
<p>subscriber port</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>sub_addr(str)</code></td>
<td><code></code></td>
<td>
<p>IP-address or domain name of proxy subscriber interface (e.g. 127.0.0.1 for your local machine)</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>pub_port(int)</code></td>
<td><code></code></td>
<td>
<p>publisher port</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>pub_addr(str)</code></td>
<td><code></code></td>
<td>
<p>IP-address or domain name of proxy publisher interface (e.g. 127.0.0.1 for your local machine) </p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>reg_port</code></td>
<td><code>int</code></td>
<td>
<p>registration port for remote services</p>
</td>
<td><code>65535</code></td>
</tr>
<tr>
<td><code>protocol(str)</code></td>
<td><code></code></td>
<td>
<p>communication protol, either 'inproc' or 'tcp' or <code>ipc</code></p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>debug_logger</code></td>
<td><code>DiasysLogger</code></td>
<td>
<p>If not <code>None</code>, all messags are printed to the logger, including send/receive events.
                Can be useful for debugging because you can still see messages received by the <code>DialogSystem</code>
                even if they are never forwarded (as expected) to your <code>Service</code></p>
</td>
<td><code>None</code></td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>adviser/services/service.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>605
606
607
608
609
610
611
612
613
614
615
616
617
618
619
620
621
622
623
624
625
626
627
628
629
630
631
632
633
634
635
636
637
638
639
640
641
642
643
644
645
646
647
648
649
650
651
652
653
654
655
656
657
658
659
660
661
662
663
664
665
666
667
668
669
670
671
672</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">services</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="n">Service</span><span class="p">,</span> <span class="n">RemoteService</span><span class="p">]],</span> <span class="n">sub_port</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">65533</span><span class="p">,</span> <span class="n">pub_port</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">65534</span><span class="p">,</span>
             <span class="n">reg_port</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">65535</span><span class="p">,</span> <span class="n">protocol</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">'tcp'</span><span class="p">,</span> <span class="n">debug_logger</span><span class="p">:</span> <span class="n">DiasysLogger</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
    <span class="sd">"""</span>
<span class="sd">    Args:</span>
<span class="sd">        services (List[Union[Service, RemoteService]]): List of all (remote) services to connect to.</span>
<span class="sd">                                                        Only once they're specified here will they start listening for</span>
<span class="sd">                                                        messages.</span>
<span class="sd">        sub_port(int): subscriber port</span>
<span class="sd">        sub_addr(str): IP-address or domain name of proxy subscriber interface (e.g. 127.0.0.1 for your local machine)</span>
<span class="sd">        pub_port(int): publisher port</span>
<span class="sd">        pub_addr(str): IP-address or domain name of proxy publisher interface (e.g. 127.0.0.1 for your local machine) </span>
<span class="sd">        reg_port (int): registration port for remote services</span>
<span class="sd">        protocol(str): communication protol, either 'inproc' or 'tcp' or `ipc`</span>
<span class="sd">        debug_logger (DiasysLogger): If not `None`, all messags are printed to the logger, including send/receive events.</span>
<span class="sd">                            Can be useful for debugging because you can still see messages received by the `DialogSystem`</span>
<span class="sd">                            even if they are never forwarded (as expected) to your `Service`</span>
<span class="sd">    """</span>
    <span class="c1"># node-local topics</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">debug_logger</span> <span class="o">=</span> <span class="n">debug_logger</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">protocol</span> <span class="o">=</span> <span class="n">protocol</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_sub_topics</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_pub_topics</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_remote_identifiers</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_services</span> <span class="o">=</span> <span class="p">[]</span>  <span class="c1"># collects names and instances of local services</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_start_dialog_services</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>  <span class="c1"># collects names of local services that subscribe to dialog_start</span>

    <span class="c1"># node-local sockets</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_domains</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>

    <span class="c1"># start proxy thread</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_proxy_dev</span> <span class="o">=</span> <span class="n">ProcessProxy</span><span class="p">(</span><span class="n">in_type</span><span class="o">=</span><span class="n">zmq</span><span class="o">.</span><span class="n">XSUB</span><span class="p">,</span> <span class="n">out_type</span><span class="o">=</span><span class="n">zmq</span><span class="o">.</span><span class="n">XPUB</span><span class="p">)</span>  <span class="c1"># , mon_type=zmq.XSUB)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_proxy_dev</span><span class="o">.</span><span class="n">bind_in</span><span class="p">(</span><span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="n">protocol</span><span class="si">}</span><span class="s2">://127.0.0.1:</span><span class="si">{</span><span class="n">pub_port</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_proxy_dev</span><span class="o">.</span><span class="n">bind_out</span><span class="p">(</span><span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="n">protocol</span><span class="si">}</span><span class="s2">://127.0.0.1:</span><span class="si">{</span><span class="n">sub_port</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_proxy_dev</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_sub_port</span> <span class="o">=</span> <span class="n">sub_port</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_pub_port</span> <span class="o">=</span> <span class="n">pub_port</span>

    <span class="c1"># thread control</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_start_topics</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_end_topics</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_terminate_topics</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_stopEvent</span> <span class="o">=</span> <span class="n">threading</span><span class="o">.</span><span class="n">Event</span><span class="p">()</span>

    <span class="c1"># control channels</span>
    <span class="n">ctx</span> <span class="o">=</span> <span class="n">Context</span><span class="o">.</span><span class="n">instance</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_control_channel_pub</span> <span class="o">=</span> <span class="n">ctx</span><span class="o">.</span><span class="n">socket</span><span class="p">(</span><span class="n">zmq</span><span class="o">.</span><span class="n">PUB</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_control_channel_pub</span><span class="o">.</span><span class="n">sndhwm</span> <span class="o">=</span> <span class="mi">1100000</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_control_channel_pub</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="n">protocol</span><span class="si">}</span><span class="s2">://127.0.0.1:</span><span class="si">{</span><span class="n">pub_port</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_control_channel_sub</span> <span class="o">=</span> <span class="n">ctx</span><span class="o">.</span><span class="n">socket</span><span class="p">(</span><span class="n">zmq</span><span class="o">.</span><span class="n">SUB</span><span class="p">)</span>

    <span class="c1"># register services (local and remote)</span>
    <span class="n">remote_services</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">service</span> <span class="ow">in</span> <span class="n">services</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">service</span><span class="p">,</span> <span class="n">Service</span><span class="p">):</span>
            <span class="c1"># register local service</span>
            <span class="n">service_name</span> <span class="o">=</span> <span class="nb">type</span><span class="p">(</span><span class="n">service</span><span class="p">)</span><span class="o">.</span><span class="vm">__name__</span> <span class="k">if</span> <span class="n">service</span><span class="o">.</span><span class="n">_identifier</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">service</span><span class="o">.</span><span class="n">_identifier</span>
            <span class="n">service</span><span class="o">.</span><span class="n">_init_pubsub</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_add_service_info</span><span class="p">(</span><span class="n">service_name</span><span class="p">,</span> <span class="n">service</span><span class="o">.</span><span class="n">_domain_name</span><span class="p">,</span> <span class="n">service</span><span class="o">.</span><span class="n">_sub_topics</span><span class="p">,</span> <span class="n">service</span><span class="o">.</span><span class="n">_pub_topics</span><span class="p">,</span>
                                   <span class="n">service</span><span class="o">.</span><span class="n">_start_topic</span><span class="p">,</span> <span class="n">service</span><span class="o">.</span><span class="n">_end_topic</span><span class="p">,</span> <span class="n">service</span><span class="o">.</span><span class="n">_terminate_topic</span><span class="p">)</span>
            <span class="n">service</span><span class="o">.</span><span class="n">_register_with_dialogsystem</span><span class="p">()</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">service</span><span class="p">,</span> <span class="n">RemoteService</span><span class="p">):</span>
            <span class="n">remote_services</span><span class="p">[</span><span class="nb">getattr</span><span class="p">(</span><span class="n">service</span><span class="p">,</span> <span class="s1">'identifier'</span><span class="p">)]</span> <span class="o">=</span> <span class="n">service</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_register_remote_services</span><span class="p">(</span><span class="n">remote_services</span><span class="p">,</span> <span class="n">reg_port</span><span class="p">)</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">_control_channel_sub</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="n">protocol</span><span class="si">}</span><span class="s2">://127.0.0.1:</span><span class="si">{</span><span class="n">sub_port</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_setup_dialog_end_listener</span><span class="p">()</span>

    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.25</span><span class="p">)</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h4 class="doc doc-heading" id="adviser.services.service.DialogSystem.draw_system_graph">
<code class="highlight language-python">
draw_system_graph<span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">'system'</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s1">'png'</span><span class="p">,</span> <span class="n">show</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> </code>
<a class="headerlink" href="#adviser.services.service.DialogSystem.draw_system_graph" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>Draws a graph of the system as a directed graph.
    Services are represented by nodes, messages by directed edges (from publisher to subscriber).
    Warnings are drawn as yellow edges (and the missing subscribers represented by an 'UNCONNECTED SERVICES' node),
    errors as red edges (and the missing publishers represented by the 'UNCONNECTED SERVICES' node as well).
    Will mark remote services with blue.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>name</code></td>
<td><code>str</code></td>
<td>
<p>used to construct the name of your output file</p>
</td>
<td><code>'system'</code></td>
</tr>
<tr>
<td><code>format</code></td>
<td><code>str</code></td>
<td>
<p>output file format (e.g. png, pdf, jpg, ...)</p>
</td>
<td><code>'png'</code></td>
</tr>
<tr>
<td><code>show</code></td>
<td><code>bool</code></td>
<td>
<p>if True, the graph image will be opened in your default image viewer application</p>
</td>
<td><code>True</code></td>
</tr>
</tbody>
</table>
<div class="admonition requires">
<p class="admonition-title">Requires</p>
<p>graphviz library (pip install graphviz)</p>
</div>
<details class="quote">
<summary>Source code in <code>adviser/services/service.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>876
877
878
879
880
881
882
883
884
885
886
887
888
889
890
891
892
893
894
895
896
897
898
899
900
901
902
903
904
905
906
907
908
909
910
911
912
913
914
915
916
917
918
919
920
921
922
923
924
925
926
927
928
929
930</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">draw_system_graph</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">'system'</span><span class="p">,</span> <span class="nb">format</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">"png"</span><span class="p">,</span> <span class="n">show</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">):</span>
    <span class="sd">""" Draws a graph of the system as a directed graph.</span>
<span class="sd">        Services are represented by nodes, messages by directed edges (from publisher to subscriber).</span>
<span class="sd">        Warnings are drawn as yellow edges (and the missing subscribers represented by an 'UNCONNECTED SERVICES' node),</span>
<span class="sd">        errors as red edges (and the missing publishers represented by the 'UNCONNECTED SERVICES' node as well).</span>
<span class="sd">        Will mark remote services with blue.</span>

<span class="sd">    Args:</span>
<span class="sd">        name (str): used to construct the name of your output file</span>
<span class="sd">        format (str): output file format (e.g. png, pdf, jpg, ...)</span>
<span class="sd">        show (bool): if True, the graph image will be opened in your default image viewer application</span>

<span class="sd">    Requires:</span>
<span class="sd">        graphviz library (pip install graphviz)</span>
<span class="sd">    """</span>
    <span class="kn">from</span> <span class="nn">graphviz</span> <span class="kn">import</span> <span class="n">Digraph</span>
    <span class="n">g</span> <span class="o">=</span> <span class="n">Digraph</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="nb">format</span><span class="p">)</span>

    <span class="c1"># collect all services, errors and warnings</span>
    <span class="n">services</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">service_set</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_pub_topics</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
        <span class="n">services</span> <span class="o">=</span> <span class="n">services</span><span class="o">.</span><span class="n">union</span><span class="p">(</span><span class="n">service_set</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">service_set</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_sub_topics</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
        <span class="n">services</span> <span class="o">=</span> <span class="n">services</span><span class="o">.</span><span class="n">union</span><span class="p">(</span><span class="n">service_set</span><span class="p">)</span>
    <span class="n">errors</span><span class="p">,</span> <span class="n">warnings</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">list_inconsistencies</span><span class="p">()</span>

    <span class="c1"># add services as nodes</span>
    <span class="k">for</span> <span class="n">service</span> <span class="ow">in</span> <span class="n">services</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">service</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_remote_identifiers</span><span class="p">:</span>
            <span class="n">g</span><span class="o">.</span><span class="n">node</span><span class="p">(</span><span class="n">service</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">'#1f618d'</span><span class="p">,</span> <span class="n">style</span><span class="o">=</span><span class="s1">'filled'</span><span class="p">,</span> <span class="n">fontcolor</span><span class="o">=</span><span class="s1">'white'</span><span class="p">,</span> <span class="n">shape</span><span class="o">=</span><span class="s1">'box'</span><span class="p">)</span>  <span class="c1"># remote service</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">g</span><span class="o">.</span><span class="n">node</span><span class="p">(</span><span class="n">service</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">'#1c2833'</span><span class="p">,</span> <span class="n">shape</span><span class="o">=</span><span class="s1">'box'</span><span class="p">)</span>  <span class="c1"># local service</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">errors</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="n">warnings</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">g</span><span class="o">.</span><span class="n">node</span><span class="p">(</span><span class="s1">'UNCONNECTED SERVICES'</span><span class="p">,</span> <span class="n">style</span><span class="o">=</span><span class="s1">'filled'</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">'#922b21'</span><span class="p">,</span> <span class="n">fontcolor</span><span class="o">=</span><span class="s1">'white'</span><span class="p">,</span> <span class="n">shape</span><span class="o">=</span><span class="s1">'box'</span><span class="p">)</span>

    <span class="c1"># draw connections from publisher to subscribers as edges</span>
    <span class="k">for</span> <span class="n">topic</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_pub_topics</span><span class="p">:</span>
        <span class="n">publishers</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_pub_topics</span><span class="p">[</span><span class="n">topic</span><span class="p">]</span>
        <span class="n">receivers</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_sub_topics</span><span class="p">[</span><span class="n">topic</span><span class="p">]</span> <span class="k">if</span> <span class="n">topic</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_sub_topics</span> <span class="k">else</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">receiver</span> <span class="ow">in</span> <span class="n">receivers</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">publisher</span> <span class="ow">in</span> <span class="n">publishers</span><span class="p">:</span>
                <span class="n">g</span><span class="o">.</span><span class="n">edge</span><span class="p">(</span><span class="n">publisher</span><span class="p">,</span> <span class="n">receiver</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">topic</span><span class="p">)</span>

    <span class="c1"># draw warnings and errors as edges to node 'UNCONNECTED SERVICES'</span>
    <span class="k">for</span> <span class="n">topic</span> <span class="ow">in</span> <span class="n">errors</span><span class="p">:</span>
        <span class="n">receivers</span> <span class="o">=</span> <span class="n">errors</span><span class="p">[</span><span class="n">topic</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">receiver</span> <span class="ow">in</span> <span class="n">receivers</span><span class="p">:</span>
            <span class="n">g</span><span class="o">.</span><span class="n">edge</span><span class="p">(</span><span class="s1">'UNCONNECTED SERVICES'</span><span class="p">,</span> <span class="n">receiver</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">'#c34400'</span><span class="p">,</span> <span class="n">fontcolor</span><span class="o">=</span><span class="s1">'#c34400'</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">topic</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">topic</span> <span class="ow">in</span> <span class="n">warnings</span><span class="p">:</span>
        <span class="n">publishers</span> <span class="o">=</span> <span class="n">warnings</span><span class="p">[</span><span class="n">topic</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">publisher</span> <span class="ow">in</span> <span class="n">publishers</span><span class="p">:</span>
            <span class="n">g</span><span class="o">.</span><span class="n">edge</span><span class="p">(</span><span class="n">publisher</span><span class="p">,</span> <span class="s1">'UNCONNECTED SERVICES'</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">'#e37c02'</span><span class="p">,</span> <span class="n">fontcolor</span><span class="o">=</span><span class="s1">'#e37c02'</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">topic</span><span class="p">)</span>

    <span class="c1"># draw graph</span>
    <span class="n">g</span><span class="o">.</span><span class="n">render</span><span class="p">(</span><span class="n">view</span><span class="o">=</span><span class="n">show</span><span class="p">,</span> <span class="n">cleanup</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h4 class="doc doc-heading" id="adviser.services.service.DialogSystem.is_error_free_messaging_pipeline">
<code class="highlight language-python">
is_error_free_messaging_pipeline<span class="p">(</span><span class="bp">self</span><span class="p">)</span> </code>
<a class="headerlink" href="#adviser.services.service.DialogSystem.is_error_free_messaging_pipeline" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>Checks the current messaging pipeline for potential errors.</p>
<p>(Potential) Errors are defined in this context as subscribed topics without publishers.</p>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>bool</code></td>
<td>
<p>True, if no potential errors could be found - else, False</p>
</td>
</tr>
</tbody>
</table>
<div class="admonition notes">
<p class="admonition-title">Notes</p>
<ul>
<li>Call this method after instantiating all services.</li>
<li>Lists only node-local (or process-local) inconsistencies.</li>
<li>Even if there are no errors returned by this method, there is not guarantee that all publishers 
eventually publish to their respective topics.</li>
</ul>
</div>
<details class="quote">
<summary>Source code in <code>adviser/services/service.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>1001
1002
1003
1004
1005
1006
1007
1008
1009
1010
1011
1012
1013
1014
1015</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">is_error_free_messaging_pipeline</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
    <span class="sd">""" Checks the current messaging pipeline for potential errors.</span>

<span class="sd">    (Potential) Errors are defined in this context as subscribed topics without publishers.</span>

<span class="sd">    Returns:</span>
<span class="sd">        True, if no potential errors could be found - else, False</span>

<span class="sd">    Notes:</span>
<span class="sd">        * Call this method after instantiating all services.</span>
<span class="sd">        * Lists only node-local (or process-local) inconsistencies.</span>
<span class="sd">        * Even if there are no errors returned by this method, there is not guarantee that all publishers </span>
<span class="sd">        eventually publish to their respective topics.</span>
<span class="sd">    """</span>
    <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">list_inconsistencies</span><span class="p">()[</span><span class="mi">0</span><span class="p">])</span> <span class="o">==</span> <span class="mi">0</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h4 class="doc doc-heading" id="adviser.services.service.DialogSystem.list_inconsistencies">
<code class="highlight language-python">
list_inconsistencies<span class="p">(</span><span class="bp">self</span><span class="p">)</span> </code>
<a class="headerlink" href="#adviser.services.service.DialogSystem.list_inconsistencies" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>Checks for potential errors in the current messaging pipleline:
e.g. len(list_inconsistencies()[0]) == 0 -&gt; error free pipeline</p>
<p>(Potential) Errors are defined in this context as subscribed topics without publishers.
Warnings are defined in this context as published topics without subscribers.</p>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>A touple of dictionaries</code></td>
<td>
<ul>
<li>the first dictionary contains potential errors (with the mapping topics -&gt; subsribing services) </li>
<li>the second dictionary contains warnings (with the mapping topics -&gt; publishing services).</li>
</ul>
</td>
</tr>
</tbody>
</table>
<div class="admonition notes">
<p class="admonition-title">Notes</p>
<ul>
<li>Call this method after instantiating all services.</li>
<li>Even if there are no errors returned by this method, there is not guarantee that all publishers 
eventually publish to their respective topics.</li>
</ul>
</div>
<details class="quote">
<summary>Source code in <code>adviser/services/service.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>932
933
934
935
936
937
938
939
940
941
942
943
944
945
946
947
948
949
950
951
952
953
954
955
956
957
958
959
960
961
962
963
964
965
966
967
968
969</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">list_inconsistencies</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">""" Checks for potential errors in the current messaging pipleline:</span>
<span class="sd">    e.g. len(list_inconsistencies()[0]) == 0 -&gt; error free pipeline</span>

<span class="sd">    (Potential) Errors are defined in this context as subscribed topics without publishers.</span>
<span class="sd">    Warnings are defined in this context as published topics without subscribers.</span>

<span class="sd">    Returns:</span>
<span class="sd">        A touple of dictionaries:</span>
<span class="sd">        * the first dictionary contains potential errors (with the mapping topics -&gt; subsribing services) </span>
<span class="sd">        * the second dictionary contains warnings (with the mapping topics -&gt; publishing services).</span>
<span class="sd">    Notes:</span>
<span class="sd">        * Call this method after instantiating all services.</span>
<span class="sd">        * Even if there are no errors returned by this method, there is not guarantee that all publishers </span>
<span class="sd">        eventually publish to their respective topics.</span>
<span class="sd">    """</span>
    <span class="c1"># look for subscribers w/o publishers by checking topic prefixes</span>
    <span class="n">errors</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">sub_topic</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_sub_topics</span><span class="p">:</span>
        <span class="n">found_pub</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">for</span> <span class="n">pub_topic</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_pub_topics</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">pub_topic</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="n">sub_topic</span><span class="p">):</span>
                <span class="n">found_pub</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="k">break</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">found_pub</span><span class="p">:</span>
            <span class="n">errors</span><span class="p">[</span><span class="n">sub_topic</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_sub_topics</span><span class="p">[</span><span class="n">sub_topic</span><span class="p">]</span>
    <span class="c1"># look for publishers w/o subscribers by checking topic prefixes</span>
    <span class="n">warnings</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">pub_topic</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_pub_topics</span><span class="p">:</span>
        <span class="n">found_sub</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">for</span> <span class="n">sub_topic</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_sub_topics</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">pub_topic</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="n">sub_topic</span><span class="p">):</span>
                <span class="n">found_sub</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="k">break</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">found_sub</span><span class="p">:</span>
            <span class="n">warnings</span><span class="p">[</span><span class="n">pub_topic</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_pub_topics</span><span class="p">[</span><span class="n">pub_topic</span><span class="p">]</span>

    <span class="k">return</span> <span class="n">errors</span><span class="p">,</span> <span class="n">warnings</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h4 class="doc doc-heading" id="adviser.services.service.DialogSystem.list_published_topics">
<code class="highlight language-python">
list_published_topics<span class="p">(</span><span class="bp">self</span><span class="p">)</span> </code>
<a class="headerlink" href="#adviser.services.service.DialogSystem.list_published_topics" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>Get all declared publisher topics.</p>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code></code></td>
<td>
<p>A dictionary with mapping
    topic (str) -&gt; publishing services (Set[str]).</p>
</td>
</tr>
</tbody>
</table>
<div class="admonition note">
<p class="admonition-title">Note</p>
<ul>
<li>Call this method after instantiating all services.</li>
<li>Even though a publishing topic might be listed here, there is no guarantee that
its publisher(s) might ever publish to it.</li>
</ul>
</div>
<details class="quote">
<summary>Source code in <code>adviser/services/service.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>852
853
854
855
856
857
858
859
860
861
862
863</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">list_published_topics</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">""" Get all declared publisher topics.</span>

<span class="sd">    Returns:</span>
<span class="sd">        A dictionary with mapping</span>
<span class="sd">            topic (str) -&gt; publishing services (Set[str]).</span>
<span class="sd">    Note:</span>
<span class="sd">        * Call this method after instantiating all services.</span>
<span class="sd">        * Even though a publishing topic might be listed here, there is no guarantee that</span>
<span class="sd">        its publisher(s) might ever publish to it.</span>
<span class="sd">    """</span>
    <span class="k">return</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_pub_topics</span><span class="p">)</span>  <span class="c1"># copy s.t. no user changes this list</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h4 class="doc doc-heading" id="adviser.services.service.DialogSystem.list_subscribed_topics">
<code class="highlight language-python">
list_subscribed_topics<span class="p">(</span><span class="bp">self</span><span class="p">)</span> </code>
<a class="headerlink" href="#adviser.services.service.DialogSystem.list_subscribed_topics" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>Get all declared subscribed topics.</p>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code></code></td>
<td>
<p>A dictionary with mapping 
    topic (str) -&gt; subscribing services (Set[str]).</p>
</td>
</tr>
</tbody>
</table>
<div class="admonition notes">
<p class="admonition-title">Notes</p>
<ul>
<li>Call this method after instantiating all services.</li>
</ul>
</div>
<details class="quote">
<summary>Source code in <code>adviser/services/service.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>865
866
867
868
869
870
871
872
873
874</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">list_subscribed_topics</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">""" Get all declared subscribed topics.</span>

<span class="sd">    Returns:</span>
<span class="sd">        A dictionary with mapping </span>
<span class="sd">            topic (str) -&gt; subscribing services (Set[str]).</span>
<span class="sd">    Notes:</span>
<span class="sd">        * Call this method after instantiating all services.</span>
<span class="sd">    """</span>
    <span class="k">return</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_sub_topics</span><span class="p">)</span>  <span class="c1"># copy s.t. no user changes this list</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h4 class="doc doc-heading" id="adviser.services.service.DialogSystem.print_inconsistencies">
<code class="highlight language-python">
print_inconsistencies<span class="p">(</span><span class="bp">self</span><span class="p">)</span> </code>
<a class="headerlink" href="#adviser.services.service.DialogSystem.print_inconsistencies" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>Checks for potential errors in the current messaging pipleline:
e.g. len(list_local_inconsistencies()[0]) == 0 -&gt; error free pipeline and prints them 
to the console.</p>
<p>(Potential) Errors are defined in this context as subscribed topics without publishers.
Warnings are defined in this context as published topics without subscribers.</p>
<div class="admonition notes">
<p class="admonition-title">Notes</p>
<ul>
<li>Call this method after instantiating all services.</li>
<li>Even if there are no errors returned by this method, there is not guarantee that all publishers 
eventually publish to their respective topics.</li>
</ul>
</div>
<details class="quote">
<summary>Source code in <code>adviser/services/service.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>971
972
973
974
975
976
977
978
979
980
981
982
983
984
985
986
987
988
989
990
991
992
993
994
995
996
997
998
999</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">print_inconsistencies</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">""" Checks for potential errors in the current messaging pipleline:</span>
<span class="sd">    e.g. len(list_local_inconsistencies()[0]) == 0 -&gt; error free pipeline and prints them </span>
<span class="sd">    to the console.</span>

<span class="sd">    (Potential) Errors are defined in this context as subscribed topics without publishers.</span>
<span class="sd">    Warnings are defined in this context as published topics without subscribers.</span>

<span class="sd">    Notes:</span>
<span class="sd">        * Call this method after instantiating all services.</span>
<span class="sd">        * Even if there are no errors returned by this method, there is not guarantee that all publishers </span>
<span class="sd">        eventually publish to their respective topics.</span>
<span class="sd">    """</span>
    <span class="c1"># console colors</span>
    <span class="n">WARNING</span> <span class="o">=</span> <span class="s1">'</span><span class="se">\033</span><span class="s1">[93m'</span>
    <span class="n">ERROR</span> <span class="o">=</span> <span class="s1">'</span><span class="se">\033</span><span class="s1">[91m'</span>
    <span class="n">ENDC</span> <span class="o">=</span> <span class="s1">'</span><span class="se">\033</span><span class="s1">[0m'</span>

    <span class="n">errors</span><span class="p">,</span> <span class="n">warnings</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">list_inconsistencies</span><span class="p">()</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">ERROR</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">"(Potential) Errors (subscribed topics without publishers):"</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">topic</span> <span class="ow">in</span> <span class="n">errors</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"  topic: '</span><span class="si">{</span><span class="n">topic</span><span class="si">}</span><span class="s2">', subscribed to in services: </span><span class="si">{</span><span class="n">errors</span><span class="p">[</span><span class="n">topic</span><span class="p">]</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">ENDC</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">WARNING</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">"Warnings (published topics without subscribers):"</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">topic</span> <span class="ow">in</span> <span class="n">warnings</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"  topic: '</span><span class="si">{</span><span class="n">topic</span><span class="si">}</span><span class="s2">', published in services: </span><span class="si">{</span><span class="n">warnings</span><span class="p">[</span><span class="n">topic</span><span class="p">]</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">ENDC</span><span class="p">)</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h4 class="doc doc-heading" id="adviser.services.service.DialogSystem.run_dialog">
<code class="highlight language-python">
run_dialog<span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">start_signals</span><span class="o">=</span><span class="p">{</span><span class="s1">'dialog_end'</span><span class="p">:</span> <span class="kc">False</span><span class="p">})</span> </code>
<a class="headerlink" href="#adviser.services.service.DialogSystem.run_dialog" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>Run a complete dialog (blocking).
    Dialog will be started via messages to the topics specified in <code>start_signals</code>.
    The dialog will end on receiving any <code>Topic.DIALOG_END</code> message with value 'True',
    so make sure at least one service in your dialog graph will publish this message eventually.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>start_signals</code></td>
<td><code>dict</code></td>
<td>
<p>mapping from topic -&gt; value
                            Publishes the value given for each topic to the respective topic.
                            Use this to trigger the start of your dialog system.</p>
</td>
<td><code>{'dialog_end': False}</code></td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>adviser/services/service.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>838
839
840
841
842
843
844
845
846
847
848
849
850</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">run_dialog</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">start_signals</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="p">{</span><span class="n">Topic</span><span class="o">.</span><span class="n">DIALOG_END</span><span class="p">:</span> <span class="kc">False</span><span class="p">}):</span>
    <span class="sd">""" Run a complete dialog (blocking).</span>
<span class="sd">        Dialog will be started via messages to the topics specified in `start_signals`.</span>
<span class="sd">        The dialog will end on receiving any `Topic.DIALOG_END` message with value 'True',</span>
<span class="sd">        so make sure at least one service in your dialog graph will publish this message eventually.</span>

<span class="sd">    Args:</span>
<span class="sd">        start_signals (Dict[str, Any]): mapping from topic -&gt; value</span>
<span class="sd">                                        Publishes the value given for each topic to the respective topic.</span>
<span class="sd">                                        Use this to trigger the start of your dialog system.</span>
<span class="sd">    """</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_start_dialog</span><span class="p">(</span><span class="n">start_signals</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_end_dialog</span><span class="p">()</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h4 class="doc doc-heading" id="adviser.services.service.DialogSystem.shutdown">
<code class="highlight language-python">
shutdown<span class="p">(</span><span class="bp">self</span><span class="p">)</span> </code>
<a class="headerlink" href="#adviser.services.service.DialogSystem.shutdown" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>Shutdown dialog system.
This will trigger <code>terminate</code> messages to be sent to all registered services to stop their listener loops.
Should be called in the end before exiting your program.
Blocks until all services sent ACK's confirming they're stopped.</p>
<details class="quote">
<summary>Source code in <code>adviser/services/service.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>780
781
782
783
784
785
786
787
788
789</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">shutdown</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">""" Shutdown dialog system.</span>
<span class="sd">        This will trigger `terminate` messages to be sent to all registered services to stop their listener loops.</span>
<span class="sd">        Should be called in the end before exiting your program.</span>
<span class="sd">        Blocks until all services sent ACK's confirming they're stopped.</span>
<span class="sd">    """</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_stopEvent</span><span class="o">.</span><span class="n">set</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">terminate_topic</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_terminate_topics</span><span class="p">:</span>
        <span class="n">_send_msg</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_control_channel_pub</span><span class="p">,</span> <span class="n">terminate_topic</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
        <span class="n">_recv_ack</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_control_channel_sub</span><span class="p">,</span> <span class="n">terminate_topic</span><span class="p">)</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h4 class="doc doc-heading" id="adviser.services.service.DialogSystem.stop">
<code class="highlight language-python">
stop<span class="p">(</span><span class="bp">self</span><span class="p">)</span> </code>
<a class="headerlink" href="#adviser.services.service.DialogSystem.stop" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>Set stop event (can be queried by services via the <code>terminating()</code> function) </p>
<details class="quote">
<summary>Source code in <code>adviser/services/service.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>771
772
773
774</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">stop</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">""" Set stop event (can be queried by services via the `terminating()` function) """</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_stopEvent</span><span class="o">.</span><span class="n">set</span><span class="p">()</span>
    <span class="k">pass</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h4 class="doc doc-heading" id="adviser.services.service.DialogSystem.terminating">
<code class="highlight language-python">
terminating<span class="p">(</span><span class="bp">self</span><span class="p">)</span> </code>
<a class="headerlink" href="#adviser.services.service.DialogSystem.terminating" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>Returns True if the system is stopping, else False </p>
<details class="quote">
<summary>Source code in <code>adviser/services/service.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>776
777
778</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">terminating</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">""" Returns True if the system is stopping, else False """</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_stopEvent</span><span class="o">.</span><span class="n">is_set</span><span class="p">()</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
</div>
</div>
</div>
<div class="doc doc-object doc-class">
<h3 class="doc doc-heading" id="adviser.services.service.RemoteService">
<code>RemoteService</code>
<a class="headerlink" href="#adviser.services.service.RemoteService" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>This is a placeholder<code>to be used in the service list argument when constructing a</code>DialogSystem<code>:
* Run the real</code>Service<code>instance on a remote node, give it a *UNIQUE* identifier
    * call</code>run_standalone()<code>on this instance
* Instantiate a remote service on the node about to run the</code>DialogSystem<code>, assign the *SAME* identifier to it
    * add it to the</code>DialogSystem<code>service list
* Now, when calling the constructor of</code>DialogSystem`, you should see messages informing you about the 
  successfull connection, or if the system is still trying to connect, it will block until connected to
  the remote service.</p>
<div class="doc doc-children">
<div class="doc doc-object doc-method">
<h4 class="doc doc-heading" id="adviser.services.service.RemoteService.__init__">
<code class="highlight language-python">
__init__<span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">identifier</span><span class="p">)</span> </code>
<span class="doc doc-properties">
<small class="doc doc-property doc-property-special"><code>special</code></small>
</span>
<a class="headerlink" href="#adviser.services.service.RemoteService.__init__" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>identifier</code></td>
<td><code>str</code></td>
<td>
<p>the <em>UNIQUE</em> identifier to call the remote service instance</p>
</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>adviser/services/service.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>94
95
96
97
98
99</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">identifier</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
    <span class="sd">"""</span>
<span class="sd">    Args:</span>
<span class="sd">        identifier (str): the *UNIQUE* identifier to call the remote service instance</span>
<span class="sd">    """</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">identifier</span> <span class="o">=</span> <span class="n">identifier</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
</div>
</div>
</div>
<div class="doc doc-object doc-class">
<h3 class="doc doc-heading" id="adviser.services.service.Service">
<code>Service</code>
<a class="headerlink" href="#adviser.services.service.Service" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>Service base class.
Inherit from this class, if you want to publish / subscribe to topics <em>(Don't forget to call the super constructor!)</em>.
You may decorate arbitrary functions in the child class with the services.service.PublishSubscribe decorator
for this purpose.</p>
<div class="admonition note">
<p class="admonition-title">A <code>Service</code> will only start listening to messages once it is added to a <code>DialogSystem</code> </p>
<p>(or calling <code>run_standalone()</code> in the remote case and adding a corresponding <code>RemoteService</code> to the <code>DialogSystem</code>).</p>
</div>
<div class="doc doc-children">
<div class="doc doc-object doc-method">
<h4 class="doc doc-heading" id="adviser.services.service.Service.__init__">
<code class="highlight language-python">
__init__<span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">domain</span><span class="o">=</span><span class="s1">''</span><span class="p">,</span> <span class="n">sub_topic_domains</span><span class="o">=</span><span class="p">{},</span> <span class="n">pub_topic_domains</span><span class="o">=</span><span class="p">{},</span> <span class="n">ds_host_addr</span><span class="o">=</span><span class="s1">'127.0.0.1'</span><span class="p">,</span> <span class="n">sub_port</span><span class="o">=</span><span class="mi">65533</span><span class="p">,</span> <span class="n">pub_port</span><span class="o">=</span><span class="mi">65534</span><span class="p">,</span> <span class="n">protocol</span><span class="o">=</span><span class="s1">'tcp'</span><span class="p">,</span> <span class="n">debug_logger</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">identifier</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span> </code>
<span class="doc doc-properties">
<small class="doc doc-property doc-property-special"><code>special</code></small>
</span>
<a class="headerlink" href="#adviser.services.service.Service.__init__" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>Create a new service instance <em>(call this super constructor from your inheriting classes!)</em>.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>domain</code></td>
<td><code>Union[str, utils.domain.domain.Domain]</code></td>
<td>
<p>The domain(-name) of your service (or empty string, if domain-agnostic).
                         If a domain(-name) is set, it will automatically filter out all messages from other domains.
                         If no domain(-name) is set, messages from all domains will be received.</p>
</td>
<td><code>''</code></td>
</tr>
<tr>
<td><code>sub_topic_domains</code></td>
<td><code>Dict[str, str]</code></td>
<td>
<p>change subscribed to topics to listen to a specific domain 
                                (e.g. 'erase'/append a domain for a specific topic)</p>
</td>
<td><code>{}</code></td>
</tr>
<tr>
<td><code>pub_topic_domains</code></td>
<td><code>Dict[str, str]</code></td>
<td>
<p>change published topics to a specific domain
                               (e.g. 'erase'/append a domain for a specific topic)</p>
</td>
<td><code>{}</code></td>
</tr>
<tr>
<td><code>ds_host_addr</code></td>
<td><code>str</code></td>
<td>
<p>IP-address of the parent <code>DialogSystem</code> (default: localhost)</p>
</td>
<td><code>'127.0.0.1'</code></td>
</tr>
<tr>
<td><code>sub_port</code></td>
<td><code>int</code></td>
<td>
<p>subscriber port following zmq's XSUB/XPUB pattern</p>
</td>
<td><code>65533</code></td>
</tr>
<tr>
<td><code>pub_port</code></td>
<td><code>int</code></td>
<td>
<p>publisher port following zmq's XSUB/XPUB pattern</p>
</td>
<td><code>65534</code></td>
</tr>
<tr>
<td><code>protocol</code></td>
<td><code>str</code></td>
<td>
<p>communication protocol with <code>DialogSystem</code> - has to match!
               Possible options: <code>tcp</code>, <code>inproc</code>, <code>ipc</code></p>
</td>
<td><code>'tcp'</code></td>
</tr>
<tr>
<td><code>debug_logger</code></td>
<td><code>DiasysLogger</code></td>
<td>
<p>If not <code>None</code>, all messags are printed to the logger, including send/receive events.
                         Can be useful for debugging because you can still see messages received by the <code>DialogSystem</code>
                         even if they are never forwarded (as expected) to your <code>Service</code>.</p>
</td>
<td><code>None</code></td>
</tr>
<tr>
<td><code>identifier</code></td>
<td><code>str</code></td>
<td>
<p>Set this to a <em>UNIQUE</em> identifier per service to be run remotely.
              See <code>RemoteService</code> for more details.</p>
</td>
<td><code>None</code></td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>adviser/services/service.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168
169
170
171</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">domain</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Domain</span><span class="p">]</span> <span class="o">=</span> <span class="s2">""</span><span class="p">,</span> <span class="n">sub_topic_domains</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="p">{},</span> <span class="n">pub_topic_domains</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="p">{},</span>
             <span class="n">ds_host_addr</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">"127.0.0.1"</span><span class="p">,</span> <span class="n">sub_port</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">65533</span><span class="p">,</span> <span class="n">pub_port</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">65534</span><span class="p">,</span> <span class="n">protocol</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">"tcp"</span><span class="p">,</span>
             <span class="n">debug_logger</span><span class="p">:</span> <span class="n">DiasysLogger</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">identifier</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
    <span class="sd">"""</span>
<span class="sd">    Create a new service instance *(call this super constructor from your inheriting classes!)*.</span>

<span class="sd">    Args:</span>
<span class="sd">        domain (Union[str, Domain]): The domain(-name) of your service (or empty string, if domain-agnostic).</span>
<span class="sd">                                     If a domain(-name) is set, it will automatically filter out all messages from other domains.</span>
<span class="sd">                                     If no domain(-name) is set, messages from all domains will be received.</span>
<span class="sd">        sub_topic_domains (Dict[str, str]): change subscribed to topics to listen to a specific domain </span>
<span class="sd">                                            (e.g. 'erase'/append a domain for a specific topic)</span>
<span class="sd">        pub_topic_domains (Dict[str, str]): change published topics to a specific domain</span>
<span class="sd">                                           (e.g. 'erase'/append a domain for a specific topic)</span>
<span class="sd">        ds_host_addr (str): IP-address of the parent `DialogSystem` (default: localhost)</span>
<span class="sd">        sub_port (int): subscriber port following zmq's XSUB/XPUB pattern</span>
<span class="sd">        pub_port (int): publisher port following zmq's XSUB/XPUB pattern</span>
<span class="sd">        protocol (string): communication protocol with `DialogSystem` - has to match!</span>
<span class="sd">                           Possible options: `tcp`, `inproc`, `ipc`</span>
<span class="sd">        debug_logger (DiasysLogger): If not `None`, all messags are printed to the logger, including send/receive events.</span>
<span class="sd">                                     Can be useful for debugging because you can still see messages received by the `DialogSystem`</span>
<span class="sd">                                     even if they are never forwarded (as expected) to your `Service`.</span>
<span class="sd">        identifier (str): Set this to a *UNIQUE* identifier per service to be run remotely.</span>
<span class="sd">                          See `RemoteService` for more details.</span>
<span class="sd">    """</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">is_training</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">domain</span> <span class="o">=</span> <span class="n">domain</span>
    <span class="c1"># get domain name (gets appended to all sub/pub topics so that different domain topics don't get shared)</span>
    <span class="k">if</span> <span class="n">domain</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_domain_name</span> <span class="o">=</span> <span class="n">domain</span><span class="o">.</span><span class="n">get_domain_name</span><span class="p">()</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">domain</span><span class="p">,</span> <span class="n">Domain</span><span class="p">)</span> <span class="k">else</span> <span class="n">domain</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_domain_name</span> <span class="o">=</span> <span class="s2">""</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_sub_topic_domains</span> <span class="o">=</span> <span class="n">sub_topic_domains</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_pub_topic_domains</span> <span class="o">=</span> <span class="n">pub_topic_domains</span>

    <span class="c1"># socket information</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_host_addr</span> <span class="o">=</span> <span class="n">ds_host_addr</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_sub_port</span> <span class="o">=</span> <span class="n">sub_port</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_pub_port</span> <span class="o">=</span> <span class="n">pub_port</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_protocol</span> <span class="o">=</span> <span class="n">protocol</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_identifier</span> <span class="o">=</span> <span class="n">identifier</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">debug_logger</span> <span class="o">=</span> <span class="n">debug_logger</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">_sub_topics</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_pub_topics</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_publish_sockets</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">_internal_start_topics</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_internal_end_topics</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_internal_terminate_topics</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>

    <span class="c1"># NOTE: class name + memory pointer make topic unique (required, e.g. for running mutliple instances of same module!)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_start_topic</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="nb">id</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="si">}</span><span class="s2">/START"</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_end_topic</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="nb">id</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="si">}</span><span class="s2">/END"</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_terminate_topic</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="nb">id</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="si">}</span><span class="s2">/TERMINATE"</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_train_topic</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="nb">id</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="si">}</span><span class="s2">/TRAIN"</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_eval_topic</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="nb">id</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="si">}</span><span class="s2">/EVAL"</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h4 class="doc doc-heading" id="adviser.services.service.Service.dialog_end">
<code class="highlight language-python">
dialog_end<span class="p">(</span><span class="bp">self</span><span class="p">)</span> </code>
<a class="headerlink" href="#adviser.services.service.Service.dialog_end" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>This function is called after a dialog ended (Topics.DIALOG_END message was received).
You should overwrite this function to record dialog-level information. </p>
<details class="quote">
<summary>Source code in <code>adviser/services/service.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>331
332
333
334</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">dialog_end</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">""" This function is called after a dialog ended (Topics.DIALOG_END message was received).</span>
<span class="sd">        You should overwrite this function to record dialog-level information. """</span>
    <span class="k">pass</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h4 class="doc doc-heading" id="adviser.services.service.Service.dialog_exit">
<code class="highlight language-python">
dialog_exit<span class="p">(</span><span class="bp">self</span><span class="p">)</span> </code>
<a class="headerlink" href="#adviser.services.service.Service.dialog_exit" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>This function is called when the dialog system is shutting down.
You should overwrite this function to stop your threads and cleanup any open resources. </p>
<details class="quote">
<summary>Source code in <code>adviser/services/service.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>336
337
338
339</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">dialog_exit</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">""" This function is called when the dialog system is shutting down.</span>
<span class="sd">        You should overwrite this function to stop your threads and cleanup any open resources. """</span>
    <span class="k">pass</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h4 class="doc doc-heading" id="adviser.services.service.Service.dialog_start">
<code class="highlight language-python">
dialog_start<span class="p">(</span><span class="bp">self</span><span class="p">)</span> </code>
<a class="headerlink" href="#adviser.services.service.Service.dialog_start" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>This function is called before the first message to a new dialog is published.
You should overwrite this function to set/reset dialog-level variables. </p>
<details class="quote">
<summary>Source code in <code>adviser/services/service.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>326
327
328
329</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">dialog_start</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">""" This function is called before the first message to a new dialog is published.</span>
<span class="sd">        You should overwrite this function to set/reset dialog-level variables. """</span>
    <span class="k">pass</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h4 class="doc doc-heading" id="adviser.services.service.Service.eval">
<code class="highlight language-python">
eval<span class="p">(</span><span class="bp">self</span><span class="p">)</span> </code>
<a class="headerlink" href="#adviser.services.service.Service.eval" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>Sets module to eval mode </p>
<details class="quote">
<summary>Source code in <code>adviser/services/service.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>345
346
347</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">eval</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">""" Sets module to eval mode """</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">is_training</span> <span class="o">=</span> <span class="kc">False</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h4 class="doc doc-heading" id="adviser.services.service.Service.get_all_published_topics">
<code class="highlight language-python">
get_all_published_topics<span class="p">(</span><span class="bp">self</span><span class="p">)</span> </code>
<a class="headerlink" href="#adviser.services.service.Service.get_all_published_topics" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code></code></td>
<td>
<p>Set of all topics published to by this <code>Service</code> </p>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>adviser/services/service.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>391
392
393
394
395
396</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">get_all_published_topics</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">"""</span>
<span class="sd">    Returns:</span>
<span class="sd">        Set of all topics published to by this `Service` </span>
<span class="sd">    """</span>
    <span class="k">return</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_pub_topics</span><span class="p">)</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h4 class="doc doc-heading" id="adviser.services.service.Service.get_all_subscribed_topics">
<code class="highlight language-python">
get_all_subscribed_topics<span class="p">(</span><span class="bp">self</span><span class="p">)</span> </code>
<a class="headerlink" href="#adviser.services.service.Service.get_all_subscribed_topics" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code></code></td>
<td>
<p>Set of all topics subscribed to by this <code>Service</code></p>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>adviser/services/service.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>384
385
386
387
388
389</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">get_all_subscribed_topics</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">"""</span>
<span class="sd">    Returns:</span>
<span class="sd">        Set of all topics subscribed to by this `Service`</span>
<span class="sd">    """</span>
    <span class="k">return</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_sub_topics</span><span class="p">)</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h4 class="doc doc-heading" id="adviser.services.service.Service.run_standalone">
<code class="highlight language-python">
run_standalone<span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">host_reg_port</span><span class="o">=</span><span class="mi">65535</span><span class="p">)</span> </code>
<a class="headerlink" href="#adviser.services.service.Service.run_standalone" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>Run this service as a standalone serivce (without a <code>DialogSystem</code>) on a remote node.
Use a <code>RemoteService</code> with <em>corresponding identifier</em> on the <code>DialogSystem</code> node to connect both.
Note: this call is blocking!</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>host_reg_port</code></td>
<td><code>int</code></td>
<td>
<p>The port on the <code>DialogSystem</code> node listening for <code>Service</code> register requests</p>
</td>
<td><code>65535</code></td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>adviser/services/service.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>349
350
351
352
353
354
355
356
357
358
359
360
361
362
363
364
365
366
367
368
369
370
371
372
373
374
375
376
377
378
379
380
381
382</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">run_standalone</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">host_reg_port</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">65535</span><span class="p">):</span>
    <span class="sd">"""</span>
<span class="sd">    Run this service as a standalone serivce (without a `DialogSystem`) on a remote node.</span>
<span class="sd">    Use a `RemoteService` with *corresponding identifier* on the `DialogSystem` node to connect both.</span>
<span class="sd">    Note: this call is blocking!</span>

<span class="sd">    Args:</span>
<span class="sd">        host_reg_port (int): The port on the `DialogSystem` node listening for `Service` register requests</span>
<span class="sd">    """</span>
    <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">_identifier</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">,</span> <span class="s2">"running a service on a remote node requires a unique identifier"</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">"Waiting for dialog system host..."</span><span class="p">)</span>

    <span class="c1"># send service info to dialog system node</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_init_pubsub</span><span class="p">()</span>
    <span class="n">ctx</span> <span class="o">=</span> <span class="n">Context</span><span class="o">.</span><span class="n">instance</span><span class="p">()</span>
    <span class="n">sync_endpoint</span> <span class="o">=</span> <span class="n">ctx</span><span class="o">.</span><span class="n">socket</span><span class="p">(</span><span class="n">zmq</span><span class="o">.</span><span class="n">REQ</span><span class="p">)</span>
    <span class="n">sync_endpoint</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="sa">f</span><span class="s2">"tcp://</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_host_addr</span><span class="si">}</span><span class="s2">:</span><span class="si">{</span><span class="n">host_reg_port</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">pickle</span><span class="o">.</span><span class="n">dumps</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">_domain_name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_sub_topics</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_pub_topics</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_start_topic</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_end_topic</span><span class="p">,</span>
                         <span class="bp">self</span><span class="o">.</span><span class="n">_terminate_topic</span><span class="p">))</span>
    <span class="n">sync_endpoint</span><span class="o">.</span><span class="n">send_multipart</span><span class="p">((</span><span class="nb">bytes</span><span class="p">(</span><span class="sa">f</span><span class="s2">"REGISTER_</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_identifier</span><span class="si">}</span><span class="s2">"</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">"ascii"</span><span class="p">),</span> <span class="n">data</span><span class="p">))</span>

    <span class="c1"># wait for registration confirmation</span>
    <span class="n">registered</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="k">while</span> <span class="ow">not</span> <span class="n">registered</span><span class="p">:</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="n">sync_endpoint</span><span class="o">.</span><span class="n">recv</span><span class="p">()</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="n">msg</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s2">"utf-8"</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">msg</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">"ACK_REGISTER_"</span><span class="p">):</span>
            <span class="n">remote_service_identifier</span> <span class="o">=</span> <span class="n">msg</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="s2">"ACK_REGISTER_"</span><span class="p">):]</span>
            <span class="k">if</span> <span class="n">remote_service_identifier</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">_identifier</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_register_with_dialogsystem</span><span class="p">()</span>
                <span class="n">sync_endpoint</span><span class="o">.</span><span class="n">send_multipart</span><span class="p">(</span>
                    <span class="p">(</span><span class="nb">bytes</span><span class="p">(</span><span class="sa">f</span><span class="s2">"CONF_REGISTER_</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_identifier</span><span class="si">}</span><span class="s2">"</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">"ascii"</span><span class="p">),</span> <span class="n">pickle</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="kc">True</span><span class="p">)))</span>
                <span class="n">registered</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Done"</span><span class="p">)</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h4 class="doc doc-heading" id="adviser.services.service.Service.train">
<code class="highlight language-python">
train<span class="p">(</span><span class="bp">self</span><span class="p">)</span> </code>
<a class="headerlink" href="#adviser.services.service.Service.train" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>Sets module to training mode </p>
<details class="quote">
<summary>Source code in <code>adviser/services/service.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>341
342
343</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">train</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">""" Sets module to training mode """</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">is_training</span> <span class="o">=</span> <span class="kc">True</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
</div>
</div>
</div>
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="adviser.services.service.PublishSubscribe">
<code class="highlight language-python">
PublishSubscribe<span class="p">(</span><span class="n">sub_topics</span><span class="o">=</span><span class="p">[],</span> <span class="n">pub_topics</span><span class="o">=</span><span class="p">[],</span> <span class="n">queued_sub_topics</span><span class="o">=</span><span class="p">[])</span> </code>
<a class="headerlink" href="#adviser.services.service.PublishSubscribe" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>Decorator function for services.
To be able to publish / subscribe to / from topics,
your class is required to inherit from services.service.Service.
Then, decorate any function you like.</p>
<p>Your function will be called as soon as:
    * at least one message is received for each topic in sub_topics (only latest message will be forwarded, others dropped)
    * at least one message is received for each topic in queued_sub_topics (all messages since the previous function call will be forwarded as a list)</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>sub_topics(List[str</code></td>
<td><code>or utils.topics.Topic]</code></td>
<td>
<p>The topics you want to get the latest messages from.
                                         If multiple messages are received until your function is called,
                                         you will only receive the value of the latest message, previously received
                                         values will be discarded.</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>pub_topics(List[str</code></td>
<td><code>or utils.topics.Topic]</code></td>
<td>
<p>The topics you want to publish messages to.</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>queued_sub_topics(List[str</code></td>
<td><code>or utils.topics.Topic]</code></td>
<td>
<p>The topics you want to get all messages from.
                                                If multiple messages are received until your function is called,
                                                you will receive all values since the previous function call as a list.</p>
</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
<div class="admonition notes">
<p class="admonition-title">Notes</p>
<ul>
<li>Subscription topic names have to match your function keywords</li>
<li>Your function should return a dictionary with the keys matching your publish topics names 
  and the value being any arbitrary python object or primitive type you want to send</li>
<li>sub_topics and queued_sub_topics have to be disjoint!</li>
<li>If you need timestamps for your messages, specify a 'timestamps' argument in your subscribing function.
  It will be filled by a dictionary providing timestamps for each received value, indexed by name.</li>
</ul>
</div>
<p>Technical notes:
    * Data will be automatically pickled / unpickled during send / receive to reduce meassage size.
      However, some python objects are not serializable (e.g. database connections) for good reasons
      and will throw an error if you try to publish them.
    * The domain name of your service class will be appended to your publish topics.
      Subscription topics are prefix-matched, so you will receive all messages from 'topic/suffix'
      if you subscibe to 'topic'.</p>
<details class="quote">
<summary>Source code in <code>adviser/services/service.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>512
513
514
515
516
517
518
519
520
521
522
523
524
525
526
527
528
529
530
531
532
533
534
535
536
537
538
539
540
541
542
543
544
545
546
547
548
549
550
551
552
553
554
555
556
557
558
559
560
561
562
563
564
565
566
567
568
569
570
571
572
573
574
575
576
577
578
579
580
581
582
583
584
585
586
587
588
589
590
591
592
593
594</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">PublishSubscribe</span><span class="p">(</span><span class="n">sub_topics</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="p">[],</span> <span class="n">pub_topics</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="p">[],</span> <span class="n">queued_sub_topics</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]):</span>
    <span class="sd">"""</span>
<span class="sd">    Decorator function for services.</span>
<span class="sd">    To be able to publish / subscribe to / from topics,</span>
<span class="sd">    your class is required to inherit from services.service.Service.</span>
<span class="sd">    Then, decorate any function you like.</span>

<span class="sd">    Your function will be called as soon as:</span>
<span class="sd">        * at least one message is received for each topic in sub_topics (only latest message will be forwarded, others dropped)</span>
<span class="sd">        * at least one message is received for each topic in queued_sub_topics (all messages since the previous function call will be forwarded as a list)</span>

<span class="sd">    Args:</span>
<span class="sd">        sub_topics(List[str or utils.topics.Topic]): The topics you want to get the latest messages from.</span>
<span class="sd">                                                     If multiple messages are received until your function is called,</span>
<span class="sd">                                                     you will only receive the value of the latest message, previously received</span>
<span class="sd">                                                     values will be discarded.</span>
<span class="sd">        pub_topics(List[str or utils.topics.Topic]): The topics you want to publish messages to.</span>
<span class="sd">        queued_sub_topics(List[str or utils.topics.Topic]): The topics you want to get all messages from.</span>
<span class="sd">                                                            If multiple messages are received until your function is called,</span>
<span class="sd">                                                            you will receive all values since the previous function call as a list.</span>

<span class="sd">    Notes:</span>
<span class="sd">        * Subscription topic names have to match your function keywords</span>
<span class="sd">        * Your function should return a dictionary with the keys matching your publish topics names </span>
<span class="sd">          and the value being any arbitrary python object or primitive type you want to send</span>
<span class="sd">        * sub_topics and queued_sub_topics have to be disjoint!</span>
<span class="sd">        * If you need timestamps for your messages, specify a 'timestamps' argument in your subscribing function.</span>
<span class="sd">          It will be filled by a dictionary providing timestamps for each received value, indexed by name.</span>

<span class="sd">    Technical notes:</span>
<span class="sd">        * Data will be automatically pickled / unpickled during send / receive to reduce meassage size.</span>
<span class="sd">          However, some python objects are not serializable (e.g. database connections) for good reasons</span>
<span class="sd">          and will throw an error if you try to publish them.</span>
<span class="sd">        * The domain name of your service class will be appended to your publish topics.</span>
<span class="sd">          Subscription topics are prefix-matched, so you will receive all messages from 'topic/suffix'</span>
<span class="sd">          if you subscibe to 'topic'.</span>
<span class="sd">    """</span>

    <span class="k">def</span> <span class="nf">wrapper</span><span class="p">(</span><span class="n">func</span><span class="p">):</span>
        <span class="k">def</span> <span class="nf">delegate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
            <span class="n">func_inst</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">func</span><span class="o">.</span><span class="vm">__name__</span><span class="p">)</span>

            <span class="n">callargs</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">args</span><span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span> <span class="ow">in</span> <span class="n">callargs</span><span class="p">:</span>    <span class="c1"># remove self when in *args, because already known to function</span>
                <span class="n">callargs</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
            <span class="n">result</span> <span class="o">=</span> <span class="n">func</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">callargs</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">result</span><span class="p">:</span>
                <span class="c1"># fix! (user could have multiple "/" characters in topic - only use last one )</span>
                <span class="n">domains</span> <span class="o">=</span> <span class="p">{</span><span class="n">res</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">"/"</span><span class="p">)[</span><span class="mi">0</span><span class="p">]:</span> <span class="n">res</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">"/"</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span> <span class="k">if</span> <span class="s2">"/"</span> <span class="ow">in</span> <span class="n">res</span> <span class="k">else</span> <span class="s2">""</span> <span class="k">for</span> <span class="n">res</span> <span class="ow">in</span> <span class="n">result</span><span class="p">}</span>
                <span class="n">result</span> <span class="o">=</span> <span class="p">{</span><span class="n">key</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">"/"</span><span class="p">)[</span><span class="mi">0</span><span class="p">]:</span> <span class="n">result</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">result</span><span class="p">}</span>

            <span class="k">if</span> <span class="n">func_inst</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_publish_sockets</span><span class="p">:</span>
                <span class="c1"># not a publisher, just normal function</span>
                <span class="k">return</span> <span class="n">result</span>

            <span class="n">socket</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_publish_sockets</span><span class="p">[</span><span class="n">func_inst</span><span class="p">]</span>
            <span class="n">domain</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_domain_name</span>
            <span class="k">if</span> <span class="n">socket</span> <span class="ow">and</span> <span class="n">result</span><span class="p">:</span>
                <span class="c1"># publish messages</span>
                <span class="k">for</span> <span class="n">topic</span> <span class="ow">in</span> <span class="n">pub_topics</span><span class="p">:</span>
                <span class="c1"># for topic in result: # NOTE publish any returned value in dict with it's key as topic</span>
                    <span class="k">if</span> <span class="n">topic</span> <span class="ow">in</span> <span class="n">result</span><span class="p">:</span>
                        <span class="n">domain</span> <span class="o">=</span> <span class="n">domain</span> <span class="k">if</span> <span class="n">domain</span> <span class="k">else</span> <span class="n">domains</span><span class="p">[</span><span class="n">topic</span><span class="p">]</span>
                        <span class="n">topic_domain_str</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="n">topic</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">domain</span><span class="si">}</span><span class="s2">"</span> <span class="k">if</span> <span class="n">domain</span> <span class="k">else</span> <span class="n">topic</span>
                        <span class="k">if</span> <span class="n">topic</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_pub_topic_domains</span><span class="p">:</span>
                            <span class="n">topic_domain_str</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="n">topic</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_pub_topic_domains</span><span class="p">[</span><span class="n">topic</span><span class="p">]</span><span class="si">}</span><span class="s2">"</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_pub_topic_domains</span><span class="p">[</span><span class="n">topic</span><span class="p">]</span> <span class="k">else</span> <span class="n">topic</span>
                        <span class="n">_send_msg</span><span class="p">(</span><span class="n">socket</span><span class="p">,</span> <span class="n">topic_domain_str</span><span class="p">,</span> <span class="n">result</span><span class="p">[</span><span class="n">topic</span><span class="p">])</span>
                        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">debug_logger</span><span class="p">:</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">debug_logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
                                <span class="sa">f</span><span class="s2">"- (DS): sent message from </span><span class="si">{</span><span class="n">func</span><span class="si">}</span><span class="s2"> to topic </span><span class="si">{</span><span class="n">topic_domain_str</span><span class="si">}</span><span class="s2">:</span><span class="se">\n</span><span class="s2">   </span><span class="si">{</span><span class="n">result</span><span class="p">[</span><span class="n">topic</span><span class="p">]</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">result</span>

        <span class="c1"># declare function as publish / subscribe functions and attach the respective topics</span>
        <span class="n">delegate</span><span class="o">.</span><span class="n">pubsub</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="n">delegate</span><span class="o">.</span><span class="n">sub_topics</span> <span class="o">=</span> <span class="n">sub_topics</span>
        <span class="n">delegate</span><span class="o">.</span><span class="n">queued_sub_topics</span> <span class="o">=</span> <span class="n">queued_sub_topics</span>
        <span class="n">delegate</span><span class="o">.</span><span class="n">pub_topics</span> <span class="o">=</span> <span class="n">pub_topics</span>
        <span class="c1"># check arguments: is subsriber interested in timestamps?</span>
        <span class="n">delegate</span><span class="o">.</span><span class="n">timestamp_enabled</span> <span class="o">=</span> <span class="s1">'timestamps'</span> <span class="ow">in</span> <span class="n">inspect</span><span class="o">.</span><span class="n">getfullargspec</span><span class="p">(</span><span class="n">func</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>

        <span class="k">return</span> <span class="n">delegate</span>

    <span class="k">return</span> <span class="n">wrapper</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
</div>
</div>
</div>
<div class="doc doc-object doc-module">
<h2 class="doc doc-heading" id="adviser.services.simulator">
<code>simulator</code>
<span class="doc doc-properties">
<small class="doc doc-property doc-property-special"><code>special</code></small>
</span>
<a class="headerlink" href="#adviser.services.simulator" title="Permanent link"></a></h2>
<div class="doc doc-contents">
<p>This package contains the handcrafted user simulatod and related services.</p>
<div class="doc doc-children">
<div class="doc doc-object doc-module">
<h3 class="doc doc-heading" id="adviser.services.simulator.emotion_simulator">
<code>emotion_simulator</code>
<a class="headerlink" href="#adviser.services.simulator.emotion_simulator" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<div class="doc doc-children">
<div class="doc doc-object doc-class">
<h4 class="doc doc-heading" id="adviser.services.simulator.emotion_simulator.EmotionSimulator">
<code>EmotionSimulator</code>
<a class="headerlink" href="#adviser.services.simulator.emotion_simulator.EmotionSimulator" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>Class which generates user emotion/engagements. Currently outputs either a user defined
or random emotion/engagement level and was designed to test the affective services
work correctly. However, in the future it could be extended to be more realistic.</p>
<div class="doc doc-children">
<div class="doc doc-object doc-method">
<h5 class="doc doc-heading" id="adviser.services.simulator.emotion_simulator.EmotionSimulator.__init__">
<code class="highlight language-python">
__init__<span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">domain</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">logger</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">random</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">static_emotion</span><span class="o">=&lt;</span><span class="n">EmotionType</span><span class="o">.</span><span class="n">Neutral</span><span class="p">:</span> <span class="s1">'neutral'</span><span class="o">&gt;</span><span class="p">,</span> <span class="n">static_engagement</span><span class="o">=&lt;</span><span class="n">EngagementType</span><span class="o">.</span><span class="n">High</span><span class="p">:</span> <span class="s1">'high'</span><span class="o">&gt;</span><span class="p">)</span> </code>
<span class="doc doc-properties">
<small class="doc doc-property doc-property-special"><code>special</code></small>
</span>
<a class="headerlink" href="#adviser.services.simulator.emotion_simulator.EmotionSimulator.__init__" title="Permanent link"></a></h5>
<div class="doc doc-contents">
<details class="quote">
<summary>Source code in <code>adviser/services/simulator/emotion_simulator.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>36
37
38
39
40
41
42
43
44</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">domain</span><span class="p">:</span> <span class="n">JSONLookupDomain</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">logger</span><span class="p">:</span> <span class="n">DiasysLogger</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
             <span class="n">random</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">static_emotion</span><span class="p">:</span> <span class="n">EmotionType</span> <span class="o">=</span> <span class="n">EmotionType</span><span class="o">.</span><span class="n">Neutral</span><span class="p">,</span>
             <span class="n">static_engagement</span><span class="p">:</span> <span class="n">EngagementType</span> <span class="o">=</span> <span class="n">EngagementType</span><span class="o">.</span><span class="n">High</span><span class="p">):</span>
    <span class="n">Service</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">domain</span><span class="o">=</span><span class="n">domain</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">domain</span> <span class="o">=</span> <span class="n">domain</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">logger</span> <span class="o">=</span> <span class="n">logger</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">random</span> <span class="o">=</span> <span class="n">random</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">engagement</span> <span class="o">=</span> <span class="n">static_engagement</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">emotion</span> <span class="o">=</span> <span class="n">static_emotion</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h5 class="doc doc-heading" id="adviser.services.simulator.emotion_simulator.EmotionSimulator.send_emotion">
<code class="highlight language-python">
send_emotion<span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> </code>
<a class="headerlink" href="#adviser.services.simulator.emotion_simulator.EmotionSimulator.send_emotion" title="Permanent link"></a></h5>
<div class="doc doc-contents">
<details class="quote">
<summary>Source code in <code>adviser/services/simulator/emotion_simulator.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>551
552
553
554
555
556
557
558
559
560
561
562
563
564
565
566
567
568
569
570
571
572
573
574
575
576
577
578
579
580
581
582</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">delegate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="n">func_inst</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">func</span><span class="o">.</span><span class="vm">__name__</span><span class="p">)</span>

    <span class="n">callargs</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">args</span><span class="p">)</span>
    <span class="k">if</span> <span class="bp">self</span> <span class="ow">in</span> <span class="n">callargs</span><span class="p">:</span>    <span class="c1"># remove self when in *args, because already known to function</span>
        <span class="n">callargs</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">func</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">callargs</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">result</span><span class="p">:</span>
        <span class="c1"># fix! (user could have multiple "/" characters in topic - only use last one )</span>
        <span class="n">domains</span> <span class="o">=</span> <span class="p">{</span><span class="n">res</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">"/"</span><span class="p">)[</span><span class="mi">0</span><span class="p">]:</span> <span class="n">res</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">"/"</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span> <span class="k">if</span> <span class="s2">"/"</span> <span class="ow">in</span> <span class="n">res</span> <span class="k">else</span> <span class="s2">""</span> <span class="k">for</span> <span class="n">res</span> <span class="ow">in</span> <span class="n">result</span><span class="p">}</span>
        <span class="n">result</span> <span class="o">=</span> <span class="p">{</span><span class="n">key</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">"/"</span><span class="p">)[</span><span class="mi">0</span><span class="p">]:</span> <span class="n">result</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">result</span><span class="p">}</span>

    <span class="k">if</span> <span class="n">func_inst</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_publish_sockets</span><span class="p">:</span>
        <span class="c1"># not a publisher, just normal function</span>
        <span class="k">return</span> <span class="n">result</span>

    <span class="n">socket</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_publish_sockets</span><span class="p">[</span><span class="n">func_inst</span><span class="p">]</span>
    <span class="n">domain</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_domain_name</span>
    <span class="k">if</span> <span class="n">socket</span> <span class="ow">and</span> <span class="n">result</span><span class="p">:</span>
        <span class="c1"># publish messages</span>
        <span class="k">for</span> <span class="n">topic</span> <span class="ow">in</span> <span class="n">pub_topics</span><span class="p">:</span>
        <span class="c1"># for topic in result: # NOTE publish any returned value in dict with it's key as topic</span>
            <span class="k">if</span> <span class="n">topic</span> <span class="ow">in</span> <span class="n">result</span><span class="p">:</span>
                <span class="n">domain</span> <span class="o">=</span> <span class="n">domain</span> <span class="k">if</span> <span class="n">domain</span> <span class="k">else</span> <span class="n">domains</span><span class="p">[</span><span class="n">topic</span><span class="p">]</span>
                <span class="n">topic_domain_str</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="n">topic</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">domain</span><span class="si">}</span><span class="s2">"</span> <span class="k">if</span> <span class="n">domain</span> <span class="k">else</span> <span class="n">topic</span>
                <span class="k">if</span> <span class="n">topic</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_pub_topic_domains</span><span class="p">:</span>
                    <span class="n">topic_domain_str</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="n">topic</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_pub_topic_domains</span><span class="p">[</span><span class="n">topic</span><span class="p">]</span><span class="si">}</span><span class="s2">"</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_pub_topic_domains</span><span class="p">[</span><span class="n">topic</span><span class="p">]</span> <span class="k">else</span> <span class="n">topic</span>
                <span class="n">_send_msg</span><span class="p">(</span><span class="n">socket</span><span class="p">,</span> <span class="n">topic_domain_str</span><span class="p">,</span> <span class="n">result</span><span class="p">[</span><span class="n">topic</span><span class="p">])</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">debug_logger</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">debug_logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
                        <span class="sa">f</span><span class="s2">"- (DS): sent message from </span><span class="si">{</span><span class="n">func</span><span class="si">}</span><span class="s2"> to topic </span><span class="si">{</span><span class="n">topic_domain_str</span><span class="si">}</span><span class="s2">:</span><span class="se">\n</span><span class="s2">   </span><span class="si">{</span><span class="n">result</span><span class="p">[</span><span class="n">topic</span><span class="p">]</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">result</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="doc doc-object doc-module">
<h3 class="doc doc-heading" id="adviser.services.simulator.goal">
<code>goal</code>
<a class="headerlink" href="#adviser.services.simulator.goal" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>This module provides the Goal class and related stuff.</p>
<div class="doc doc-children">
<div class="doc doc-object doc-class">
<h4 class="doc doc-heading" id="adviser.services.simulator.goal.Constraint">
<code>Constraint</code>
<a class="headerlink" href="#adviser.services.simulator.goal.Constraint" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<div class="doc doc-children">
<div class="doc doc-object doc-method">
<h5 class="doc doc-heading" id="adviser.services.simulator.goal.Constraint.__eq__">
<code class="highlight language-python">
__eq__<span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">)</span> </code>
<span class="doc doc-properties">
<small class="doc doc-property doc-property-special"><code>special</code></small>
</span>
<a class="headerlink" href="#adviser.services.simulator.goal.Constraint.__eq__" title="Permanent link"></a></h5>
<div class="doc doc-contents">
<p>Constraint should be equal if the slot and value is the same.</p>
<details class="quote">
<summary>Source code in <code>adviser/services/simulator/goal.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>41
42
43
44
45
46</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="fm">__eq__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
    <span class="sd">"""Constraint should be equal if the slot and value is the same."""</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">Constraint</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">slot</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="n">slot</span>
                <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">value</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>
    <span class="k">return</span> <span class="kc">False</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h5 class="doc doc-heading" id="adviser.services.simulator.goal.Constraint.__getitem__">
<code class="highlight language-python">
__getitem__<span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">)</span> </code>
<span class="doc doc-properties">
<small class="doc doc-property doc-property-special"><code>special</code></small>
</span>
<a class="headerlink" href="#adviser.services.simulator.goal.Constraint.__getitem__" title="Permanent link"></a></h5>
<div class="doc doc-contents">
<details class="quote">
<summary>Source code in <code>adviser/services/simulator/goal.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>48
49
50
51
52
53
54
55
56</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="fm">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">TypeError</span>
    <span class="k">if</span> <span class="n">key</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">slot</span>
    <span class="k">elif</span> <span class="n">key</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">value</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">IndexError</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h5 class="doc doc-heading" id="adviser.services.simulator.goal.Constraint.__hash__">
<code class="highlight language-python">
__hash__<span class="p">(</span><span class="bp">self</span><span class="p">)</span> </code>
<span class="doc doc-properties">
<small class="doc doc-property doc-property-special"><code>special</code></small>
</span>
<a class="headerlink" href="#adviser.services.simulator.goal.Constraint.__hash__" title="Permanent link"></a></h5>
<div class="doc doc-contents">
<details class="quote">
<summary>Source code in <code>adviser/services/simulator/goal.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>61
62</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="fm">__hash__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="k">return</span> <span class="nb">hash</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">slot</span><span class="p">)</span> <span class="o">*</span> <span class="nb">hash</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h5 class="doc doc-heading" id="adviser.services.simulator.goal.Constraint.__init__">
<code class="highlight language-python">
__init__<span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">slot</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span> </code>
<span class="doc doc-properties">
<small class="doc doc-property doc-property-special"><code>special</code></small>
</span>
<a class="headerlink" href="#adviser.services.simulator.goal.Constraint.__init__" title="Permanent link"></a></h5>
<div class="doc doc-contents">
<p>The class for a constraint as used in the goal.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>slot</code></td>
<td><code>str</code></td>
<td>
<p>The slot.</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>value</code></td>
<td><code>str</code></td>
<td>
<p>The value.</p>
</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>adviser/services/simulator/goal.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>29
30
31
32
33
34
35
36
37
38
39</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">slot</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
    <span class="sd">"""</span>
<span class="sd">    The class for a constraint as used in the goal.</span>

<span class="sd">    Args:</span>
<span class="sd">        slot (str): The slot.</span>
<span class="sd">        value (str): The value.</span>

<span class="sd">    """</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">slot</span> <span class="o">=</span> <span class="n">slot</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">value</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h5 class="doc doc-heading" id="adviser.services.simulator.goal.Constraint.__repr__">
<code class="highlight language-python">
__repr__<span class="p">(</span><span class="bp">self</span><span class="p">)</span> </code>
<span class="doc doc-properties">
<small class="doc doc-property doc-property-special"><code>special</code></small>
</span>
<a class="headerlink" href="#adviser.services.simulator.goal.Constraint.__repr__" title="Permanent link"></a></h5>
<div class="doc doc-contents">
<details class="quote">
<summary>Source code in <code>adviser/services/simulator/goal.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>58
59</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="k">return</span> <span class="s2">"Constraint(slot=</span><span class="si">{}</span><span class="s2">, value=</span><span class="si">{}</span><span class="s2">)"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">slot</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
</div>
</div>
</div>
<div class="doc doc-object doc-class">
<h4 class="doc doc-heading" id="adviser.services.simulator.goal.Goal">
<code>Goal</code>
<a class="headerlink" href="#adviser.services.simulator.goal.Goal" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<div class="doc doc-children">
<div class="doc doc-object doc-method">
<h5 class="doc doc-heading" id="adviser.services.simulator.goal.Goal.__init__">
<code class="highlight language-python">
__init__<span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">domain</span><span class="p">,</span> <span class="n">parameters</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span> </code>
<span class="doc doc-properties">
<small class="doc doc-property doc-property-special"><code>special</code></small>
</span>
<a class="headerlink" href="#adviser.services.simulator.goal.Goal.__init__" title="Permanent link"></a></h5>
<div class="doc doc-contents">
<p>The class representing a goal, therefore containing requests and constraints.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>domain</code></td>
<td><code>JSONLookupDomain</code></td>
<td>
<p>The domain for which the goal will be instantiated.
It will only work within this domain.</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>parameters</code></td>
<td><code>dict</code></td>
<td>
<p>The parameters for the goal defined by a key=value mapping: 'MinVenues'
(int) allows to set a minimum number of venues which fulfill the constraints of the goal,
'MinConstraints' (int) and 'MaxConstraints' (int) set the minimum and maximum amount of
constraints respectively, 'MinRequests' (int) and 'MaxRequests' (int) set the minimum and
maximum amount of requests respectively and 'Reachable' (float) allows to specify how many
(in percent) of all generated goals are definitely fulfillable (i.e. there exists a venue
for the current goal) or not (doesn't have to be fulfillable). Although the parameter
'Reachable' equals 1.0 implicitly states that 'MinVenues' equals 1 or more, the
implementation looks different, is more efficient and takes all goals into consideration
(since 'Reachable' is a float (percentage of generated goals)). On the other hand, setting
'MinVenues' to any number bigger than 0 forces every goal to be fulfillable.</p>
</td>
<td><code>None</code></td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>adviser/services/simulator/goal.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span> 66
 67
 68
 69
 70
 71
 72
 73
 74
 75
 76
 77
 78
 79
 80
 81
 82
 83
 84
 85
 86
 87
 88
 89
 90
 91
 92
 93
 94
 95
 96
 97
 98
 99
100
101
102
103
104
105
106
107
108
109
110
111
112</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">domain</span><span class="p">:</span> <span class="n">JSONLookupDomain</span><span class="p">,</span> <span class="n">parameters</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">"""</span>
<span class="sd">    The class representing a goal, therefore containing requests and constraints.</span>

<span class="sd">    Args:</span>
<span class="sd">        domain (JSONLookupDomain): The domain for which the goal will be instantiated.</span>
<span class="sd">            It will only work within this domain.</span>
<span class="sd">        parameters (dict): The parameters for the goal defined by a key=value mapping: 'MinVenues'</span>
<span class="sd">            (int) allows to set a minimum number of venues which fulfill the constraints of the goal,</span>
<span class="sd">            'MinConstraints' (int) and 'MaxConstraints' (int) set the minimum and maximum amount of</span>
<span class="sd">            constraints respectively, 'MinRequests' (int) and 'MaxRequests' (int) set the minimum and</span>
<span class="sd">            maximum amount of requests respectively and 'Reachable' (float) allows to specify how many</span>
<span class="sd">            (in percent) of all generated goals are definitely fulfillable (i.e. there exists a venue</span>
<span class="sd">            for the current goal) or not (doesn't have to be fulfillable). Although the parameter</span>
<span class="sd">            'Reachable' equals 1.0 implicitly states that 'MinVenues' equals 1 or more, the</span>
<span class="sd">            implementation looks different, is more efficient and takes all goals into consideration</span>
<span class="sd">            (since 'Reachable' is a float (percentage of generated goals)). On the other hand, setting</span>
<span class="sd">            'MinVenues' to any number bigger than 0 forces every goal to be fulfillable.</span>

<span class="sd">    """</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">domain</span> <span class="o">=</span> <span class="n">domain</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span> <span class="o">=</span> <span class="n">parameters</span> <span class="ow">or</span> <span class="p">{}</span>

    <span class="c1"># cache inform and request slots</span>
    <span class="c1"># make sure to copy the list (shallow is sufficient)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">inf_slots</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">domain</span><span class="o">.</span><span class="n">get_informable_slots</span><span class="p">())[:])</span>
    <span class="c1"># make sure that primary key is never a constraint</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">domain</span><span class="o">.</span><span class="n">get_primary_key</span><span class="p">()</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">inf_slots</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">inf_slots</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">domain</span><span class="o">.</span><span class="n">get_primary_key</span><span class="p">())</span>

    <span class="c1"># TODO sometimes ask for specific primary key with very small probability (instead of any other constraints?) # pylint: disable=line-too-long</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">inf_slot_values</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">slot</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">inf_slots</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">inf_slot_values</span><span class="p">[</span><span class="n">slot</span><span class="p">]</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span>
            <span class="n">domain</span><span class="o">.</span><span class="n">get_possible_values</span><span class="p">(</span><span class="n">slot</span><span class="p">)[:])</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">req_slots</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">domain</span><span class="o">.</span><span class="n">get_requestable_slots</span><span class="p">()[:])</span>
    <span class="c1"># self.req_slots_without_informables = sorted(list(</span>
    <span class="c1">#     set(self.req_slots).difference(self.inf_slots)))</span>
    <span class="c1"># make sure that primary key is never a request as it is added anyway</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">domain</span><span class="o">.</span><span class="n">get_primary_key</span><span class="p">()</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">req_slots</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">req_slots</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">domain</span><span class="o">.</span><span class="n">get_primary_key</span><span class="p">())</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">constraints</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">requests</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">excluded_inf_slot_values</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">missing_informs</span> <span class="o">=</span> <span class="p">[]</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h5 class="doc doc-heading" id="adviser.services.simulator.goal.Goal.__repr__">
<code class="highlight language-python">
__repr__<span class="p">(</span><span class="bp">self</span><span class="p">)</span> </code>
<span class="doc doc-properties">
<small class="doc doc-property doc-property-special"><code>special</code></small>
</span>
<a class="headerlink" href="#adviser.services.simulator.goal.Goal.__repr__" title="Permanent link"></a></h5>
<div class="doc doc-contents">
<details class="quote">
<summary>Source code in <code>adviser/services/simulator/goal.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>257
258</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="k">return</span> <span class="s2">"Goal(constraints=</span><span class="si">{}</span><span class="s2">, requests=</span><span class="si">{}</span><span class="s2">)"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">constraints</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">requests</span><span class="p">)</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h5 class="doc doc-heading" id="adviser.services.simulator.goal.Goal.fulfill_request">
<code class="highlight language-python">
fulfill_request<span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">slot</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span> </code>
<a class="headerlink" href="#adviser.services.simulator.goal.Goal.fulfill_request" title="Permanent link"></a></h5>
<div class="doc doc-contents">
<p>Fulfills a request, i.e. sets <code>value</code> for request <code>slot</code>.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>slot</code></td>
<td><code>str</code></td>
<td>
<p>The request slot which will be filled.</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>value</code></td>
<td><code>str</code></td>
<td>
<p>The value the request slot will be filled with.</p>
</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>adviser/services/simulator/goal.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>280
281
282
283
284
285
286
287
288
289
290</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">fulfill_request</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">slot</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
    <span class="sd">"""</span>
<span class="sd">    Fulfills a request, i.e. sets ``value`` for request ``slot``.</span>

<span class="sd">    Args:</span>
<span class="sd">        slot (str): The request slot which will be filled.</span>
<span class="sd">        value (str): The value the request slot will be filled with.</span>

<span class="sd">    """</span>
    <span class="k">if</span> <span class="n">slot</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">requests</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">requests</span><span class="p">[</span><span class="n">slot</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h5 class="doc doc-heading" id="adviser.services.simulator.goal.Goal.get_constraint">
<code class="highlight language-python">
get_constraint<span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">slot</span><span class="p">)</span> </code>
<a class="headerlink" href="#adviser.services.simulator.goal.Goal.get_constraint" title="Permanent link"></a></h5>
<div class="doc doc-contents">
<p>Gets the value for a given constraint <code>slot</code>.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>slot</code></td>
<td><code>str</code></td>
<td>
<p>The constraint <code>slot</code> which will be looked up.</p>
</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>bool</code></td>
<td>
<p>The constraint <code>value</code>.</p>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>adviser/services/simulator/goal.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>342
343
344
345
346
347
348
349
350
351
352
353
354
355
356</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">get_constraint</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">slot</span><span class="p">):</span>
    <span class="sd">"""</span>
<span class="sd">    Gets the value for a given constraint ``slot``.</span>

<span class="sd">    Args:</span>
<span class="sd">        slot (str): The constraint ``slot`` which will be looked up.</span>

<span class="sd">    Returns:</span>
<span class="sd">        bool: The constraint ``value``.</span>

<span class="sd">    """</span>
    <span class="k">for</span> <span class="n">_constraint</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">constraints</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">_constraint</span><span class="o">.</span><span class="n">slot</span> <span class="o">==</span> <span class="n">slot</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">_constraint</span><span class="o">.</span><span class="n">value</span>
    <span class="k">return</span> <span class="s1">'dontcare'</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h5 class="doc doc-heading" id="adviser.services.simulator.goal.Goal.init">
<code class="highlight language-python">
init<span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">random_goal</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">constraints</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">requests</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span> </code>
<a class="headerlink" href="#adviser.services.simulator.goal.Goal.init" title="Permanent link"></a></h5>
<div class="doc doc-contents">
<p>Initializes a goal randomly OR using the given constraints and requests.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>random_goal</code></td>
<td><code>bool</code></td>
<td>
<p>If True, a goal will be drawn randomly from available constraints
and requests (considering the parameters given in the constructor, if any). However if
constraints and requests are given and both don't equal None, this parameter is
considered as False. If False, the given constraints and requests are used.</p>
</td>
<td><code>True</code></td>
</tr>
<tr>
<td><code>constraints</code></td>
<td><code>List[Constraint]</code></td>
<td>
<p>The constraints which will be used for the goal.</p>
</td>
<td><code>None</code></td>
</tr>
<tr>
<td><code>requests</code></td>
<td><code>Dict[str, Union[None,str]]</code></td>
<td>
<p>The requests which will be used for the goal.</p>
</td>
<td><code>None</code></td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>adviser/services/simulator/goal.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">init</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">random_goal</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">constraints</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">requests</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
    <span class="sd">"""</span>
<span class="sd">    Initializes a goal randomly OR using the given constraints and requests.</span>

<span class="sd">    Args:</span>
<span class="sd">        random_goal (bool): If True, a goal will be drawn randomly from available constraints</span>
<span class="sd">            and requests (considering the parameters given in the constructor, if any). However if</span>
<span class="sd">            constraints and requests are given and both don't equal None, this parameter is</span>
<span class="sd">            considered as False. If False, the given constraints and requests are used.</span>
<span class="sd">        constraints (List[Constraint]): The constraints which will be used for the goal.</span>
<span class="sd">        requests (Dict[str, Union[None,str]]): The requests which will be used for the goal.</span>

<span class="sd">    """</span>
    <span class="c1"># reset goal</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">constraints</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">requests</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">excluded_inf_slot_values</span> <span class="o">=</span> <span class="p">{</span><span class="n">key</span><span class="p">:</span> <span class="nb">set</span><span class="p">()</span>
                                     <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">inf_slot_values</span><span class="p">}</span>

    <span class="c1"># TODO implement possibility to pass either constraints or requests as a parameter</span>
    <span class="k">if</span> <span class="n">random_goal</span> <span class="ow">and</span> <span class="n">constraints</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">requests</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_init_random_goal</span><span class="p">()</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_init_from_parameters</span><span class="p">(</span><span class="n">constraints</span><span class="p">,</span> <span class="n">requests</span><span class="p">)</span>

    <span class="c1"># make sure that primary key is always requested</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">requests</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">domain</span><span class="o">.</span><span class="n">get_primary_key</span><span class="p">()]</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">missing_informs</span> <span class="o">=</span> <span class="p">[</span><span class="n">UserAct</span><span class="p">(</span><span class="n">act_type</span><span class="o">=</span><span class="n">UserActionType</span><span class="o">.</span><span class="n">Inform</span><span class="p">,</span> <span class="n">slot</span><span class="o">=</span><span class="n">_constraint</span><span class="o">.</span><span class="n">slot</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="n">_constraint</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>
                            <span class="k">for</span> <span class="n">_constraint</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">constraints</span><span class="p">]</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h5 class="doc doc-heading" id="adviser.services.simulator.goal.Goal.is_fulfilled">
<code class="highlight language-python">
is_fulfilled<span class="p">(</span><span class="bp">self</span><span class="p">)</span> </code>
<a class="headerlink" href="#adviser.services.simulator.goal.Goal.is_fulfilled" title="Permanent link"></a></h5>
<div class="doc doc-contents">
<p>Checks whether all requests have been fulfilled.</p>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>bool</code></td>
<td>
<p><code>True</code> if all requests have been fulfilled, <code>False</code> otherwise.</p>
</td>
</tr>
</tbody>
</table>
<p>.. note:: Does not check whether the venue (issued by the system) fulfills the constraints
    since it's the system's task to give an appropriate venue by requesting the user's
    constraints.</p>
<details class="quote">
<summary>Source code in <code>adviser/services/simulator/goal.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>262
263
264
265
266
267
268
269
270
271
272
273
274
275
276
277
278</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">is_fulfilled</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">"""</span>
<span class="sd">    Checks whether all requests have been fulfilled.</span>

<span class="sd">    Returns:</span>
<span class="sd">        bool: ``True`` if all requests have been fulfilled, ``False`` otherwise.</span>

<span class="sd">    .. note:: Does not check whether the venue (issued by the system) fulfills the constraints</span>
<span class="sd">        since it's the system's task to give an appropriate venue by requesting the user's</span>
<span class="sd">        constraints.</span>

<span class="sd">    """</span>
    <span class="k">for</span> <span class="n">slot</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">requests</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="k">assert</span> <span class="n">slot</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">domain</span><span class="o">.</span><span class="n">get_primary_key</span><span class="p">()</span> <span class="ow">or</span> <span class="n">value</span> <span class="o">!=</span> <span class="s1">'none'</span>  <span class="c1"># TODO remove later</span>
        <span class="k">if</span> <span class="n">value</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span>
    <span class="k">return</span> <span class="kc">True</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h5 class="doc doc-heading" id="adviser.services.simulator.goal.Goal.is_inconsistent_constraint">
<code class="highlight language-python">
is_inconsistent_constraint<span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">constraint</span><span class="p">)</span> </code>
<a class="headerlink" href="#adviser.services.simulator.goal.Goal.is_inconsistent_constraint" title="Permanent link"></a></h5>
<div class="doc doc-contents">
<p>Checks whether the given constraint is consistent with the goal. A constraint is also
consistent if it's value is 'dontcare' in the current goal.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>constraint</code></td>
<td><code>Constraint</code></td>
<td>
<p>The constraint which will be checked for consistency.</p>
</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>bool</code></td>
<td>
<p>True if values match or value in goal is 'dontcare', False otherwise.</p>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>adviser/services/simulator/goal.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>300
301
302
303
304
305
306
307
308
309
310
311
312
313
314
315
316</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">is_inconsistent_constraint</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">constraint</span><span class="p">):</span>
    <span class="sd">"""</span>
<span class="sd">    Checks whether the given constraint is consistent with the goal. A constraint is also</span>
<span class="sd">    consistent if it's value is 'dontcare' in the current goal.</span>

<span class="sd">    Args:</span>
<span class="sd">        constraint (Constraint): The constraint which will be checked for consistency.</span>

<span class="sd">    Returns:</span>
<span class="sd">        bool: True if values match or value in goal is 'dontcare', False otherwise.</span>

<span class="sd">    """</span>
    <span class="k">for</span> <span class="n">_constraint</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">constraints</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">_constraint</span><span class="o">.</span><span class="n">slot</span> <span class="o">==</span> <span class="n">constraint</span><span class="o">.</span><span class="n">slot</span> <span class="ow">and</span> <span class="p">(</span><span class="n">_constraint</span><span class="o">.</span><span class="n">value</span> <span class="o">!=</span> <span class="n">constraint</span><span class="o">.</span><span class="n">value</span> \
                                                    <span class="ow">and</span> <span class="n">_constraint</span><span class="o">.</span><span class="n">value</span> <span class="o">!=</span> <span class="s1">'dontcare'</span><span class="p">):</span>
            <span class="k">return</span> <span class="kc">True</span>
    <span class="k">return</span> <span class="kc">False</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h5 class="doc doc-heading" id="adviser.services.simulator.goal.Goal.is_inconsistent_constraint_strict">
<code class="highlight language-python">
is_inconsistent_constraint_strict<span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">constraint</span><span class="p">)</span> </code>
<a class="headerlink" href="#adviser.services.simulator.goal.Goal.is_inconsistent_constraint_strict" title="Permanent link"></a></h5>
<div class="doc doc-contents">
<p>Checks whether the given constraint is strictly consistent with the goal, whereby
'dontcare' is treated as a different value (no match).</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>constraint</code></td>
<td><code>Constraint</code></td>
<td>
<p>The constraint which will be checked for consistency.</p>
</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>bool</code></td>
<td>
<p>True if values match, False otherwise.</p>
</td>
</tr>
</tbody>
</table>
<div class="admonition seealso">
<p class="admonition-title">See Also</p>
<p><a href="https://digitalphonetics.github.io/adviser/api/services/#adviser.services.simulator.goal.Goal.is_inconsistent_constraint"><code>is_inconsistent_constraint</code></a></p>
</div>
<details class="quote">
<summary>Source code in <code>adviser/services/simulator/goal.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>320
321
322
323
324
325
326
327
328
329
330
331
332
333
334
335
336
337
338
339
340</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">is_inconsistent_constraint_strict</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">constraint</span><span class="p">):</span>
    <span class="sd">"""</span>
<span class="sd">    Checks whether the given constraint is strictly consistent with the goal, whereby</span>
<span class="sd">    'dontcare' is treated as a different value (no match).</span>

<span class="sd">    Args:</span>
<span class="sd">        constraint (Constraint): The constraint which will be checked for consistency.</span>

<span class="sd">    Returns:</span>
<span class="sd">        bool: True if values match, False otherwise.</span>

<span class="sd">    !!! seealso "See Also"</span>
<span class="sd">        [`is_inconsistent_constraint`][adviser.services.simulator.goal.Goal.is_inconsistent_constraint]</span>

<span class="sd">    """</span>
    <span class="k">for</span> <span class="n">_constraint</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">constraints</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">_constraint</span><span class="o">.</span><span class="n">slot</span> <span class="o">==</span> <span class="n">constraint</span><span class="o">.</span><span class="n">slot</span> <span class="ow">and</span> <span class="n">_constraint</span><span class="o">.</span><span class="n">value</span> <span class="o">==</span> <span class="n">constraint</span><span class="o">.</span><span class="n">value</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span>
    <span class="c1"># here there are only two possibilities: the constraint is implicitly 'dontcare' because</span>
    <span class="c1"># it is not explicitly listed and the given constraint is either 1) 'dontcare' or 2) not</span>
    <span class="k">return</span> <span class="n">constraint</span><span class="o">.</span><span class="n">value</span> <span class="o">!=</span> <span class="s1">'dontcare'</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h5 class="doc doc-heading" id="adviser.services.simulator.goal.Goal.reset">
<code class="highlight language-python">
reset<span class="p">(</span><span class="bp">self</span><span class="p">)</span> </code>
<a class="headerlink" href="#adviser.services.simulator.goal.Goal.reset" title="Permanent link"></a></h5>
<div class="doc doc-contents">
<p>Resets all requests of the goal.</p>
<details class="quote">
<summary>Source code in <code>adviser/services/simulator/goal.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>250
251
252
253</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">reset</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">"""Resets all requests of the goal."""</span>
    <span class="c1"># reset goal -&gt; empty all requests</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">requests</span> <span class="o">=</span> <span class="nb">dict</span><span class="o">.</span><span class="n">fromkeys</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">requests</span><span class="p">)</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h5 class="doc doc-heading" id="adviser.services.simulator.goal.Goal.update_constraint">
<code class="highlight language-python">
update_constraint<span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">slot</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span> </code>
<a class="headerlink" href="#adviser.services.simulator.goal.Goal.update_constraint" title="Permanent link"></a></h5>
<div class="doc doc-contents">
<p>Update a given constraint <code>slot</code> with <code>value</code>.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>slot</code></td>
<td><code>str</code></td>
<td>
<p>The constraint <em>slot</em> which will be updated.</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>value</code></td>
<td><code>str</code></td>
<td>
<p>The <em>value</em> with which the constraint will be updated.</p>
</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>bool</code></td>
<td>
<p><code>True</code> if update was successful, i.e. the constraint <code>slot</code> is included in
the goal, <code>False</code> otherwise.</p>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>adviser/services/simulator/goal.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>359
360
361
362
363
364
365
366
367
368
369
370
371
372
373
374
375
376</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">update_constraint</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">slot</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
    <span class="sd">"""</span>
<span class="sd">    Update a given constraint ``slot`` with ``value``.</span>

<span class="sd">    Args:</span>
<span class="sd">        slot (str): The constraint *slot* which will be updated.</span>
<span class="sd">        value (str): The *value* with which the constraint will be updated.</span>

<span class="sd">    Returns:</span>
<span class="sd">        bool: ``True`` if update was successful, i.e. the constraint ``slot`` is included in</span>
<span class="sd">        the goal, ``False`` otherwise.</span>

<span class="sd">    """</span>
    <span class="k">for</span> <span class="n">_constraint</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">constraints</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">_constraint</span><span class="o">.</span><span class="n">slot</span> <span class="o">==</span> <span class="n">slot</span><span class="p">:</span>
            <span class="n">_constraint</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">value</span>
            <span class="k">return</span> <span class="kc">True</span>
    <span class="k">return</span> <span class="kc">False</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="doc doc-object doc-module">
<h3 class="doc doc-heading" id="adviser.services.simulator.simulator">
<code>simulator</code>
<a class="headerlink" href="#adviser.services.simulator.simulator" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>This module provides the agenda-based user model for the handcrafted simulator.</p>
<div class="doc doc-children">
<div class="doc doc-object doc-class">
<h4 class="doc doc-heading" id="adviser.services.simulator.simulator.Agenda">
<code>Agenda</code>
<a class="headerlink" href="#adviser.services.simulator.simulator.Agenda" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>A stack-like object representing an agenda. Actions can be pushed on and popped off the agenda.</p>
<div class="doc doc-children">
<div class="doc doc-object doc-method">
<h5 class="doc doc-heading" id="adviser.services.simulator.simulator.Agenda.__bool__">
<code class="highlight language-python">
__bool__<span class="p">(</span><span class="bp">self</span><span class="p">)</span> </code>
<span class="doc doc-properties">
<small class="doc doc-property doc-property-special"><code>special</code></small>
</span>
<a class="headerlink" href="#adviser.services.simulator.simulator.Agenda.__bool__" title="Permanent link"></a></h5>
<div class="doc doc-contents">
<details class="quote">
<summary>Source code in <code>adviser/services/simulator/simulator.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>681
682</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="fm">__bool__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="k">return</span> <span class="nb">bool</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">stack</span><span class="p">)</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h5 class="doc doc-heading" id="adviser.services.simulator.simulator.Agenda.__contains__">
<code class="highlight language-python">
__contains__<span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span> </code>
<span class="doc doc-properties">
<small class="doc doc-property doc-property-special"><code>special</code></small>
</span>
<a class="headerlink" href="#adviser.services.simulator.simulator.Agenda.__contains__" title="Permanent link"></a></h5>
<div class="doc doc-contents">
<details class="quote">
<summary>Source code in <code>adviser/services/simulator/simulator.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>675
676</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="fm">__contains__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">value</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">stack</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h5 class="doc doc-heading" id="adviser.services.simulator.simulator.Agenda.__init__">
<code class="highlight language-python">
__init__<span class="p">(</span><span class="bp">self</span><span class="p">)</span> </code>
<span class="doc doc-properties">
<small class="doc doc-property doc-property-special"><code>special</code></small>
</span>
<a class="headerlink" href="#adviser.services.simulator.simulator.Agenda.__init__" title="Permanent link"></a></h5>
<div class="doc doc-contents">
<details class="quote">
<summary>Source code in <code>adviser/services/simulator/simulator.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>669
670</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">stack</span> <span class="o">=</span> <span class="p">[]</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h5 class="doc doc-heading" id="adviser.services.simulator.simulator.Agenda.__iter__">
<code class="highlight language-python">
__iter__<span class="p">(</span><span class="bp">self</span><span class="p">)</span> </code>
<span class="doc doc-properties">
<small class="doc doc-property doc-property-special"><code>special</code></small>
</span>
<a class="headerlink" href="#adviser.services.simulator.simulator.Agenda.__iter__" title="Permanent link"></a></h5>
<div class="doc doc-contents">
<details class="quote">
<summary>Source code in <code>adviser/services/simulator/simulator.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>672
673</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="fm">__iter__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="k">return</span> <span class="nb">iter</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">stack</span><span class="p">)</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h5 class="doc doc-heading" id="adviser.services.simulator.simulator.Agenda.__len__">
<code class="highlight language-python">
__len__<span class="p">(</span><span class="bp">self</span><span class="p">)</span> </code>
<span class="doc doc-properties">
<small class="doc doc-property doc-property-special"><code>special</code></small>
</span>
<a class="headerlink" href="#adviser.services.simulator.simulator.Agenda.__len__" title="Permanent link"></a></h5>
<div class="doc doc-contents">
<details class="quote">
<summary>Source code in <code>adviser/services/simulator/simulator.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>678
679</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="fm">__len__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">stack</span><span class="p">)</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h5 class="doc doc-heading" id="adviser.services.simulator.simulator.Agenda.__repr__">
<code class="highlight language-python">
__repr__<span class="p">(</span><span class="bp">self</span><span class="p">)</span> </code>
<span class="doc doc-properties">
<small class="doc doc-property doc-property-special"><code>special</code></small>
</span>
<a class="headerlink" href="#adviser.services.simulator.simulator.Agenda.__repr__" title="Permanent link"></a></h5>
<div class="doc doc-contents">
<details class="quote">
<summary>Source code in <code>adviser/services/simulator/simulator.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>684
685</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="k">return</span> <span class="nb">repr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">stack</span><span class="p">)</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h5 class="doc doc-heading" id="adviser.services.simulator.simulator.Agenda.__str__">
<code class="highlight language-python">
__str__<span class="p">(</span><span class="bp">self</span><span class="p">)</span> </code>
<span class="doc doc-properties">
<small class="doc doc-property doc-property-special"><code>special</code></small>
</span>
<a class="headerlink" href="#adviser.services.simulator.simulator.Agenda.__str__" title="Permanent link"></a></h5>
<div class="doc doc-contents">
<details class="quote">
<summary>Source code in <code>adviser/services/simulator/simulator.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>687
688</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">stack</span><span class="p">)</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h5 class="doc doc-heading" id="adviser.services.simulator.simulator.Agenda.clean">
<code class="highlight language-python">
clean<span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">goal</span><span class="p">)</span> </code>
<a class="headerlink" href="#adviser.services.simulator.simulator.Agenda.clean" title="Permanent link"></a></h5>
<div class="doc doc-contents">
<p>Cleans the agenda, i.e. makes sure that actions are consistent with goal and in the
correct order.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>goal</code></td>
<td><code>Goal</code></td>
<td>
<p>The goal which is needed to determine the consistent actions.</p>
</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>adviser/services/simulator/simulator.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>740
741
742
743
744
745
746
747
748
749
750
751
752
753
754
755
756
757
758
759
760
761
762
763
764</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">clean</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">goal</span><span class="p">:</span> <span class="n">Goal</span><span class="p">):</span>
    <span class="sd">"""Cleans the agenda, i.e. makes sure that actions are consistent with goal and in the</span>
<span class="sd">    correct order.</span>

<span class="sd">    Args:</span>
<span class="sd">        goal (Goal): The goal which is needed to determine the consistent actions.</span>

<span class="sd">    """</span>
    <span class="n">cleaned_stack</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="c1"># reverse order since most recent actions are on top of agenda</span>
    <span class="k">for</span> <span class="n">action</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">stack</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]:</span>
        <span class="k">if</span> <span class="n">action</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">cleaned_stack</span><span class="p">:</span>
            <span class="c1"># NOTE sufficient if there is only one slot per (request) action</span>
            <span class="c1"># remove accomplished requests</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">action</span><span class="o">.</span><span class="n">type</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">UserActionType</span><span class="o">.</span><span class="n">Request</span>
                    <span class="ow">or</span> <span class="p">(</span><span class="n">action</span><span class="o">.</span><span class="n">slot</span> <span class="ow">in</span> <span class="n">goal</span><span class="o">.</span><span class="n">requests</span> <span class="ow">and</span> <span class="n">goal</span><span class="o">.</span><span class="n">requests</span><span class="p">[</span><span class="n">action</span><span class="o">.</span><span class="n">slot</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span>
                    <span class="ow">or</span> <span class="n">action</span><span class="o">.</span><span class="n">slot</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">goal</span><span class="o">.</span><span class="n">requests</span><span class="p">):</span>
                <span class="c1"># make sure to remove "old" inform actions</span>
                <span class="k">if</span> <span class="n">action</span><span class="o">.</span><span class="n">type</span> <span class="ow">is</span> <span class="n">UserActionType</span><span class="o">.</span><span class="n">Inform</span><span class="p">:</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="n">goal</span><span class="o">.</span><span class="n">is_inconsistent_constraint</span><span class="p">(</span>
                            <span class="n">Constraint</span><span class="p">(</span><span class="n">action</span><span class="o">.</span><span class="n">slot</span><span class="p">,</span> <span class="n">action</span><span class="o">.</span><span class="n">value</span><span class="p">)):</span>
                        <span class="n">cleaned_stack</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">action</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">cleaned_stack</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">action</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">stack</span> <span class="o">=</span> <span class="n">cleaned_stack</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h5 class="doc doc-heading" id="adviser.services.simulator.simulator.Agenda.clear">
<code class="highlight language-python">
clear<span class="p">(</span><span class="bp">self</span><span class="p">)</span> </code>
<a class="headerlink" href="#adviser.services.simulator.simulator.Agenda.clear" title="Permanent link"></a></h5>
<div class="doc doc-contents">
<p>Empties the agenda.</p>
<details class="quote">
<summary>Source code in <code>adviser/services/simulator/simulator.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>766
767
768</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">clear</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">"""Empties the agenda."""</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">stack</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h5 class="doc doc-heading" id="adviser.services.simulator.simulator.Agenda.contains_action_of_type">
<code class="highlight language-python">
contains_action_of_type<span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">act_type</span><span class="p">,</span> <span class="n">consider_dontcare</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> </code>
<a class="headerlink" href="#adviser.services.simulator.simulator.Agenda.contains_action_of_type" title="Permanent link"></a></h5>
<div class="doc doc-contents">
<p>Checks whether agenda contains actions of a specific type.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>act_type</code></td>
<td><code>UserActionType</code></td>
<td>
<p>The action type (intent) for which the agenda will be checked.</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>consider_dontcare</code></td>
<td><code>bool</code></td>
<td>
<p>If set to True also considers actions for which the value is
                     'dontcare', and ignores them otherwise.</p>
</td>
<td><code>True</code></td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>(bool)</code></td>
<td>
<p>True if agenda contains <em>act_type</em>, False otherwise.</p>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>adviser/services/simulator/simulator.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>779
780
781
782
783
784
785
786
787
788
789
790
791
792
793
794
795
796</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">contains_action_of_type</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">act_type</span><span class="p">:</span> <span class="n">UserActionType</span><span class="p">,</span> <span class="n">consider_dontcare</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
    <span class="sd">"""Checks whether agenda contains actions of a specific type.</span>

<span class="sd">    Args:</span>
<span class="sd">        act_type (UserActionType): The action type (intent) for which the agenda will be checked.</span>
<span class="sd">        consider_dontcare (bool): If set to True also considers actions for which the value is</span>
<span class="sd">                                 'dontcare', and ignores them otherwise.</span>

<span class="sd">    Returns:</span>
<span class="sd">        (bool): True if agenda contains *act_type*, False otherwise.</span>

<span class="sd">    """</span>
    <span class="k">for</span> <span class="n">_action</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">stack</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">consider_dontcare</span> <span class="ow">and</span> <span class="n">_action</span><span class="o">.</span><span class="n">value</span> <span class="o">==</span> <span class="s1">'dontcare'</span><span class="p">:</span>
            <span class="k">continue</span>
        <span class="k">if</span> <span class="n">_action</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="n">act_type</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">True</span>
    <span class="k">return</span> <span class="kc">False</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h5 class="doc doc-heading" id="adviser.services.simulator.simulator.Agenda.fill_with_constraints">
<code class="highlight language-python">
fill_with_constraints<span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">goal</span><span class="p">)</span> </code>
<a class="headerlink" href="#adviser.services.simulator.simulator.Agenda.fill_with_constraints" title="Permanent link"></a></h5>
<div class="doc doc-contents">
<p>Adds all inform actions to the agenda necessary to fulfill the <em>goal</em>. Generally there is
no need to add all constraints from the goal to the agenda apart from the initialisation.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>goal</code></td>
<td><code>Goal</code></td>
<td>
<p>The current goal of the (simulated) user for which actions will be pushed to the agenda.</p>
</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>adviser/services/simulator/simulator.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>853
854
855
856
857
858
859
860
861
862
863
864
865
866
867
868</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">fill_with_constraints</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">goal</span><span class="p">:</span> <span class="n">Goal</span><span class="p">):</span>
    <span class="sd">"""</span>
<span class="sd">    Adds all inform actions to the agenda necessary to fulfill the *goal*. Generally there is</span>
<span class="sd">    no need to add all constraints from the goal to the agenda apart from the initialisation.</span>

<span class="sd">    Args:</span>
<span class="sd">        goal (Goal): The current goal of the (simulated) user for which actions will be pushed to the agenda.</span>

<span class="sd">    """</span>

    <span class="c1"># add informs from goal</span>
    <span class="k">for</span> <span class="n">constraint</span> <span class="ow">in</span> <span class="n">goal</span><span class="o">.</span><span class="n">constraints</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stack</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">UserAct</span><span class="p">(</span>
            <span class="n">act_type</span><span class="o">=</span><span class="n">UserActionType</span><span class="o">.</span><span class="n">Inform</span><span class="p">,</span>
            <span class="n">slot</span><span class="o">=</span><span class="n">constraint</span><span class="o">.</span><span class="n">slot</span><span class="p">,</span>
            <span class="n">value</span><span class="o">=</span><span class="n">constraint</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="n">score</span><span class="o">=</span><span class="mf">1.0</span><span class="p">))</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h5 class="doc doc-heading" id="adviser.services.simulator.simulator.Agenda.fill_with_requests">
<code class="highlight language-python">
fill_with_requests<span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">goal</span><span class="p">,</span> <span class="n">exclude_name</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> </code>
<a class="headerlink" href="#adviser.services.simulator.simulator.Agenda.fill_with_requests" title="Permanent link"></a></h5>
<div class="doc doc-contents">
<p>Adds all request actions to the agenda necessary to fulfill the <em>goal</em>.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>goal</code></td>
<td><code>Goal</code></td>
<td>
<p>The current goal of the (simulated) user for which actions will be pushed to the
         agenda.</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>exclude_name</code></td>
<td><code>bool</code></td>
<td>
<p>whehter or not to include an action to request an entities name.</p>
</td>
<td><code>True</code></td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>adviser/services/simulator/simulator.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>838
839
840
841
842
843
844
845
846
847
848
849
850
851</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">fill_with_requests</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">goal</span><span class="p">:</span> <span class="n">Goal</span><span class="p">,</span> <span class="n">exclude_name</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">):</span>
    <span class="sd">"""Adds all request actions to the agenda necessary to fulfill the *goal*.</span>

<span class="sd">    Args:</span>
<span class="sd">        goal (Goal): The current goal of the (simulated) user for which actions will be pushed to the</span>
<span class="sd">                     agenda.</span>
<span class="sd">        exclude_name (bool): whehter or not to include an action to request an entities name.</span>

<span class="sd">    """</span>
    <span class="c1"># add requests and make sure to add the name at the end (i.e. ask first for name)</span>
    <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">goal</span><span class="o">.</span><span class="n">requests</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="k">if</span> <span class="p">((</span><span class="n">key</span> <span class="o">!=</span> <span class="s1">'name'</span> <span class="ow">and</span> <span class="n">exclude_name</span><span class="p">)</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">exclude_name</span><span class="p">)</span> <span class="ow">and</span> <span class="n">value</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">stack</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                <span class="n">UserAct</span><span class="p">(</span><span class="n">act_type</span><span class="o">=</span><span class="n">UserActionType</span><span class="o">.</span><span class="n">Request</span><span class="p">,</span> <span class="n">slot</span><span class="o">=</span><span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="n">value</span><span class="p">,</span> <span class="n">score</span><span class="o">=</span><span class="mf">1.0</span><span class="p">))</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h5 class="doc doc-heading" id="adviser.services.simulator.simulator.Agenda.get_actions">
<code class="highlight language-python">
get_actions<span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">num_actions</span><span class="p">)</span> </code>
<a class="headerlink" href="#adviser.services.simulator.simulator.Agenda.get_actions" title="Permanent link"></a></h5>
<div class="doc doc-contents">
<p>Retrieves <em>num_actions</em> actions from the agenda.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>num_actions</code></td>
<td><code>int</code></td>
<td>
<p>Amount of actions which will be retrieved from the agenda.</p>
</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>(List[UserAct])</code></td>
<td>
<p>list of <em>num_actions</em> user actions.</p>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>adviser/services/simulator/simulator.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>724
725
726
727
728
729
730
731
732
733
734
735
736
737
738</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">get_actions</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">num_actions</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
    <span class="sd">"""Retrieves *num_actions* actions from the agenda.</span>

<span class="sd">    Args:</span>
<span class="sd">        num_actions (int): Amount of actions which will be retrieved from the agenda.</span>

<span class="sd">    Returns:</span>
<span class="sd">        (List[UserAct]): list of *num_actions* user actions.</span>

<span class="sd">    """</span>

    <span class="k">if</span> <span class="n">num_actions</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">num_actions</span> <span class="o">&gt;</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">stack</span><span class="p">):</span>
        <span class="n">num_actions</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">stack</span><span class="p">)</span>

    <span class="k">return</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">stack</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">num_actions</span><span class="p">)]</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h5 class="doc doc-heading" id="adviser.services.simulator.simulator.Agenda.get_actions_of_type">
<code class="highlight language-python">
get_actions_of_type<span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">act_type</span><span class="o">=&lt;</span><span class="n">enum</span> <span class="s1">'UserActionType'</span><span class="o">&gt;</span><span class="p">,</span> <span class="n">consider_dontcare</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> </code>
<a class="headerlink" href="#adviser.services.simulator.simulator.Agenda.get_actions_of_type" title="Permanent link"></a></h5>
<div class="doc doc-contents">
<p>Get actions of a specific type from the agenda.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>act_type</code></td>
<td><code>UserActionType</code></td>
<td>
<p>The action type (intent) for which the agenda will be checked.</p>
</td>
<td><code>&lt;enum 'UserActionType'&gt;</code></td>
</tr>
<tr>
<td><code>consider_dontcare</code></td>
<td><code>bool</code></td>
<td>
<p>If set to True also considers actions for which the value is
                     'dontcare', and ignores them otherwise.</p>
</td>
<td><code>True</code></td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>(Iterable[UserAct])</code></td>
<td>
<p>A list of user actions of the given type/intent.</p>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>adviser/services/simulator/simulator.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>798
799
800
801
802
803
804
805
806
807
808
809
810
811</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">get_actions_of_type</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">act_type</span><span class="o">=</span><span class="n">UserActionType</span><span class="p">,</span> <span class="n">consider_dontcare</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
    <span class="sd">"""Get actions of a specific type from the agenda.</span>

<span class="sd">    Args:</span>
<span class="sd">        act_type (UserActionType): The action type (intent) for which the agenda will be checked.</span>
<span class="sd">        consider_dontcare (bool): If set to True also considers actions for which the value is</span>
<span class="sd">                                 'dontcare', and ignores them otherwise.</span>
<span class="sd">    Returns:</span>
<span class="sd">        (Iterable[UserAct]): A list of user actions of the given type/intent.</span>

<span class="sd">    """</span>
    <span class="k">return</span> <span class="nb">filter</span><span class="p">(</span>
        <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="n">act_type</span>
                  <span class="ow">and</span> <span class="p">(</span><span class="n">consider_dontcare</span> <span class="ow">or</span> <span class="n">x</span><span class="o">.</span><span class="n">value</span> <span class="o">!=</span> <span class="s1">'dontcare'</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">stack</span><span class="p">)</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h5 class="doc doc-heading" id="adviser.services.simulator.simulator.Agenda.init">
<code class="highlight language-python">
init<span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">goal</span><span class="p">)</span> </code>
<a class="headerlink" href="#adviser.services.simulator.simulator.Agenda.init" title="Permanent link"></a></h5>
<div class="doc doc-contents">
<p>Initializes the agenda given a goal. For this purpose, inform actions for constraints in
the goal and request actions for requests in the goal are added such that the informs are
handled first followed by the requests.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>goal</code></td>
<td><code>Goal</code></td>
<td>
<p>The goal for which the agenda will be initialized.</p>
</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>adviser/services/simulator/simulator.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>690
691
692
693
694
695
696
697
698
699
700
701
702
703
704
705
706
707
708
709
710</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">init</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">goal</span><span class="p">):</span>
    <span class="sd">"""</span>
<span class="sd">    Initializes the agenda given a goal. For this purpose, inform actions for constraints in</span>
<span class="sd">    the goal and request actions for requests in the goal are added such that the informs are</span>
<span class="sd">    handled first followed by the requests.</span>

<span class="sd">    Args:</span>
<span class="sd">        goal (Goal): The goal for which the agenda will be initialized.</span>

<span class="sd">    """</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">stack</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
    <span class="c1"># populate agenda according to goal</span>

    <span class="c1"># NOTE don't push bye action here since bye action could be poppped with another (missing)</span>
    <span class="c1"># request, but user should not end dialog before having the goal fulfilled</span>

    <span class="c1"># NOTE do not add requests to agenda since system can't handle inform and request action in</span>
    <span class="c1"># same turn currently!</span>
    <span class="c1"># self.fill_with_requests(goal)</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">fill_with_constraints</span><span class="p">(</span><span class="n">goal</span><span class="p">)</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h5 class="doc doc-heading" id="adviser.services.simulator.simulator.Agenda.is_empty">
<code class="highlight language-python">
is_empty<span class="p">(</span><span class="bp">self</span><span class="p">)</span> </code>
<a class="headerlink" href="#adviser.services.simulator.simulator.Agenda.is_empty" title="Permanent link"></a></h5>
<div class="doc doc-contents">
<p>Checks whether the agenda is empty.</p>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>(bool)</code></td>
<td>
<p>True if agenda is empty, False otherwise.</p>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>adviser/services/simulator/simulator.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>770
771
772
773
774
775
776
777</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">is_empty</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">"""Checks whether the agenda is empty.</span>

<span class="sd">    Returns:</span>
<span class="sd">        (bool): True if agenda is empty, False otherwise.</span>

<span class="sd">    """</span>
    <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">stack</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h5 class="doc doc-heading" id="adviser.services.simulator.simulator.Agenda.push">
<code class="highlight language-python">
push<span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">item</span><span class="p">)</span> </code>
<a class="headerlink" href="#adviser.services.simulator.simulator.Agenda.push" title="Permanent link"></a></h5>
<div class="doc doc-contents">
<p>Pushes <em>item</em> onto the agenda.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>item</code></td>
<td><code></code></td>
<td>
<p>The goal for which the agenda will be initialized.</p>
</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>adviser/services/simulator/simulator.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>712
713
714
715
716
717
718
719
720
721
722</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">push</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">item</span><span class="p">):</span>
    <span class="sd">"""Pushes *item* onto the agenda.</span>

<span class="sd">    Args:</span>
<span class="sd">        item: The goal for which the agenda will be initialized.</span>

<span class="sd">    """</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stack</span> <span class="o">+=</span> <span class="n">item</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stack</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h5 class="doc doc-heading" id="adviser.services.simulator.simulator.Agenda.remove_actions">
<code class="highlight language-python">
remove_actions<span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">act_type</span><span class="p">,</span> <span class="n">slot</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span> </code>
<a class="headerlink" href="#adviser.services.simulator.simulator.Agenda.remove_actions" title="Permanent link"></a></h5>
<div class="doc doc-contents">
<p>Removes actions of a specific type, slot and optionally value from the agenda. All
arguments (value only if given) have to match in conjunction.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>act_type</code></td>
<td><code>UserActionType</code></td>
<td>
<p>The action type (intent) which will be removed from the agenda.</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>slot</code></td>
<td><code>str</code></td>
<td>
<p>The action type (intent) which will be removed from the agenda.</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>value</code></td>
<td><code>str</code></td>
<td>
<p>The action type (intent) which will be removed from the agenda.</p>
</td>
<td><code>None</code></td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>adviser/services/simulator/simulator.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>822
823
824
825
826
827
828
829
830
831
832
833
834
835
836</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">remove_actions</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">act_type</span><span class="p">:</span> <span class="n">UserActionType</span><span class="p">,</span> <span class="n">slot</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
    <span class="sd">"""Removes actions of a specific type, slot and optionally value from the agenda. All</span>
<span class="sd">    arguments (value only if given) have to match in conjunction.</span>

<span class="sd">    Args:</span>
<span class="sd">        act_type (UserActionType): The action type (intent) which will be removed from the agenda.</span>
<span class="sd">        slot (str): The action type (intent) which will be removed from the agenda.</span>
<span class="sd">        value (str): The action type (intent) which will be removed from the agenda.</span>

<span class="sd">    """</span>
    <span class="k">if</span> <span class="n">value</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stack</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">filter</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">type</span> <span class="o">!=</span> <span class="n">act_type</span> <span class="ow">or</span> <span class="n">x</span><span class="o">.</span><span class="n">slot</span> <span class="o">!=</span> <span class="n">slot</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">stack</span><span class="p">))</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stack</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">filter</span><span class="p">(</span>
            <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">type</span> <span class="o">!=</span> <span class="n">act_type</span> <span class="ow">or</span> <span class="n">x</span><span class="o">.</span><span class="n">slot</span> <span class="o">!=</span> <span class="n">slot</span> <span class="ow">or</span> <span class="n">x</span><span class="o">.</span><span class="n">value</span> <span class="o">!=</span> <span class="n">value</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">stack</span><span class="p">))</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h5 class="doc doc-heading" id="adviser.services.simulator.simulator.Agenda.remove_actions_of_type">
<code class="highlight language-python">
remove_actions_of_type<span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">act_type</span><span class="p">)</span> </code>
<a class="headerlink" href="#adviser.services.simulator.simulator.Agenda.remove_actions_of_type" title="Permanent link"></a></h5>
<div class="doc doc-contents">
<p>Removes actions of a specific type from the agenda.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>act_type</code></td>
<td><code>UserActionType</code></td>
<td>
<p>The action type (intent) which will be removed from the agenda.</p>
</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>adviser/services/simulator/simulator.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>813
814
815
816
817
818
819
820</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">remove_actions_of_type</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">act_type</span><span class="p">:</span> <span class="n">UserActionType</span><span class="p">):</span>
    <span class="sd">"""Removes actions of a specific type from the agenda.</span>

<span class="sd">    Args:</span>
<span class="sd">        act_type (UserActionType): The action type (intent) which will be removed from the agenda.</span>

<span class="sd">    """</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">stack</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">filter</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">type</span> <span class="o">!=</span> <span class="n">act_type</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">stack</span><span class="p">))</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
</div>
</div>
</div>
<div class="doc doc-object doc-class">
<h4 class="doc doc-heading" id="adviser.services.simulator.simulator.HandcraftedUserSimulator">
<code>HandcraftedUserSimulator</code>
<a class="headerlink" href="#adviser.services.simulator.simulator.HandcraftedUserSimulator" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>The class for a handcrafted (agenda-based) user simulator.</p>
<div class="codehilite">
<pre><span></span><code><span class="err">!!! args</span>
<span class="err">    domain (Domain): The domain for which the user simulator will be instantiated. It will use</span>
<span class="err">    this domain to generate the goals.</span>
</code></pre>
</div>
<div class="doc doc-children">
<div class="doc doc-object doc-method">
<h5 class="doc doc-heading" id="adviser.services.simulator.simulator.HandcraftedUserSimulator.__init__">
<code class="highlight language-python">
__init__<span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">domain</span><span class="p">,</span> <span class="n">logger</span><span class="o">=&lt;</span><span class="n">DiasysLogger</span> <span class="n">adviser</span> <span class="p">(</span><span class="n">NOTSET</span><span class="p">)</span><span class="o">&gt;</span><span class="p">)</span> </code>
<span class="doc doc-properties">
<small class="doc doc-property doc-property-special"><code>special</code></small>
</span>
<a class="headerlink" href="#adviser.services.simulator.simulator.HandcraftedUserSimulator.__init__" title="Permanent link"></a></h5>
<div class="doc doc-contents">
<details class="quote">
<summary>Source code in <code>adviser/services/simulator/simulator.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span> 43
 44
 45
 46
 47
 48
 49
 50
 51
 52
 53
 54
 55
 56
 57
 58
 59
 60
 61
 62
 63
 64
 65
 66
 67
 68
 69
 70
 71
 72
 73
 74
 75
 76
 77
 78
 79
 80
 81
 82
 83
 84
 85
 86
 87
 88
 89
 90
 91
 92
 93
 94
 95
 96
 97
 98
 99
100
101
102
103</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">domain</span><span class="p">:</span> <span class="n">Domain</span><span class="p">,</span> <span class="n">logger</span><span class="p">:</span> <span class="n">DiasysLogger</span> <span class="o">=</span> <span class="n">DiasysLogger</span><span class="p">()):</span>
    <span class="nb">super</span><span class="p">(</span><span class="n">HandcraftedUserSimulator</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">domain</span><span class="p">)</span>

    <span class="c1"># possible system actions</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">receive_options</span> <span class="o">=</span> <span class="p">{</span><span class="n">SysActionType</span><span class="o">.</span><span class="n">Welcome</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_receive_welcome</span><span class="p">,</span>
                            <span class="n">SysActionType</span><span class="o">.</span><span class="n">InformByName</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_receive_informbyname</span><span class="p">,</span>
                            <span class="n">SysActionType</span><span class="o">.</span><span class="n">InformByAlternatives</span><span class="p">:</span>
                                <span class="bp">self</span><span class="o">.</span><span class="n">_receive_informbyalternatives</span><span class="p">,</span>
                            <span class="n">SysActionType</span><span class="o">.</span><span class="n">Request</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_receive_request</span><span class="p">,</span>
                            <span class="n">SysActionType</span><span class="o">.</span><span class="n">Confirm</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_receive_confirm</span><span class="p">,</span>
                            <span class="n">SysActionType</span><span class="o">.</span><span class="n">Select</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_receive_select</span><span class="p">,</span>
                            <span class="n">SysActionType</span><span class="o">.</span><span class="n">RequestMore</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_receive_requestmore</span><span class="p">,</span>
                            <span class="n">SysActionType</span><span class="o">.</span><span class="n">Bad</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_receive_bad</span><span class="p">,</span>
                            <span class="n">SysActionType</span><span class="o">.</span><span class="n">ConfirmRequest</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_receive_confirmrequest</span><span class="p">}</span>

    <span class="c1"># parse config file</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">logger</span> <span class="o">=</span> <span class="n">logger</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">config</span> <span class="o">=</span> <span class="n">configparser</span><span class="o">.</span><span class="n">ConfigParser</span><span class="p">(</span>
        <span class="n">inline_comment_prefixes</span><span class="o">=</span><span class="p">(</span><span class="s1">'#'</span><span class="p">,</span> <span class="s1">';'</span><span class="p">))</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">optionxform</span> <span class="o">=</span> <span class="nb">str</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span>
        <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="vm">__file__</span><span class="p">)),</span> <span class="s1">'usermodel.cfg'</span><span class="p">))</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="c1"># goal</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="s1">'goal'</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s2">"goal"</span><span class="p">]:</span>
        <span class="n">val</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">"goal"</span><span class="p">,</span> <span class="n">key</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="s1">'goal'</span><span class="p">][</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">val</span><span class="p">)</span>

    <span class="c1"># usermodel</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="s1">'usermodel'</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s2">"usermodel"</span><span class="p">]:</span>
        <span class="n">val</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
            <span class="s2">"usermodel"</span><span class="p">,</span> <span class="n">key</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">key</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">'patience'</span><span class="p">]:</span>
            <span class="c1"># patience will be sampled on begin of each dialog</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="s1">'usermodel'</span><span class="p">][</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="p">(</span>
                <span class="n">val</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">' '</span><span class="p">,</span> <span class="s1">''</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s1">'[]'</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">','</span><span class="p">))]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">val</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">"["</span><span class="p">)</span> <span class="ow">and</span> <span class="n">val</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">"]"</span><span class="p">):</span>
                <span class="c1"># value is a list to sample the probability from</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="s1">'usermodel'</span><span class="p">][</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">common</span><span class="o">.</span><span class="n">numpy</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span>
                    <span class="o">*</span><span class="p">[</span><span class="nb">float</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">val</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">' '</span><span class="p">,</span> <span class="s1">''</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s1">'[]'</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">','</span><span class="p">)])</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># value is the probability</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="s1">'usermodel'</span><span class="p">][</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">val</span><span class="p">)</span>

    <span class="c1"># member declarations</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">turn</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">domain</span> <span class="o">=</span> <span class="n">domain</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">dialog_patience</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">patience</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">last_user_actions</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">last_system_action</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">excluded_venues</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="c1"># member definitions</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">goal</span> <span class="o">=</span> <span class="n">Goal</span><span class="p">(</span><span class="n">domain</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="s1">'goal'</span><span class="p">])</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">agenda</span> <span class="o">=</span> <span class="n">Agenda</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">num_actions_next_turn</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h5 class="doc doc-heading" id="adviser.services.simulator.simulator.HandcraftedUserSimulator.dialog_start">
<code class="highlight language-python">
dialog_start<span class="p">(</span><span class="bp">self</span><span class="p">)</span> </code>
<a class="headerlink" href="#adviser.services.simulator.simulator.HandcraftedUserSimulator.dialog_start" title="Permanent link"></a></h5>
<div class="doc doc-contents">
<p>Resets the user model at the beginning of a dialog, e.g. draws a new goal and populates
the agenda according to the goal.</p>
<details class="quote">
<summary>Source code in <code>adviser/services/simulator/simulator.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">dialog_start</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">"""Resets the user model at the beginning of a dialog, e.g. draws a new goal and populates</span>
<span class="sd">    the agenda according to the goal."""</span>
    <span class="c1"># self.goal = Goal(self.domain, self.parameters['goal'])</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">goal</span><span class="o">.</span><span class="n">init</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">agenda</span><span class="o">.</span><span class="n">init</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">goal</span><span class="p">)</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">dialog_turn</span><span class="p">(</span>
            <span class="s2">"New goal has constraints </span><span class="si">{}</span><span class="s2"> and requests </span><span class="si">{}</span><span class="s2">."</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">goal</span><span class="o">.</span><span class="n">constraints</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">goal</span><span class="o">.</span><span class="n">requests</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">dialog_turn</span><span class="p">(</span><span class="s2">"New agenda initialized: </span><span class="si">{}</span><span class="s2">"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">agenda</span><span class="p">))</span>

    <span class="c1"># add hello action with some probability</span>
    <span class="k">if</span> <span class="n">common</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">()</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="s1">'usermodel'</span><span class="p">][</span><span class="s1">'Greeting'</span><span class="p">]:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">agenda</span><span class="o">.</span><span class="n">push</span><span class="p">(</span><span class="n">UserAct</span><span class="p">(</span><span class="n">act_type</span><span class="o">=</span><span class="n">UserActionType</span><span class="o">.</span><span class="n">Hello</span><span class="p">,</span> <span class="n">score</span><span class="o">=</span><span class="mf">1.0</span><span class="p">))</span>

    <span class="c1"># needed for possibility to reset patience</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="s1">'usermodel'</span><span class="p">][</span><span class="s1">'patience'</span><span class="p">])</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dialog_patience</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="s1">'usermodel'</span><span class="p">][</span><span class="s1">'patience'</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dialog_patience</span> <span class="o">=</span> <span class="n">common</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span>
            <span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="s1">'usermodel'</span><span class="p">][</span><span class="s1">'patience'</span><span class="p">])</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">patience</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dialog_patience</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">last_user_actions</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">last_system_action</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">excluded_venues</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">turn</span> <span class="o">=</span> <span class="mi">0</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h5 class="doc doc-heading" id="adviser.services.simulator.simulator.HandcraftedUserSimulator.receive">
<code class="highlight language-python">
receive<span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sys_act</span><span class="p">)</span> </code>
<a class="headerlink" href="#adviser.services.simulator.simulator.HandcraftedUserSimulator.receive" title="Permanent link"></a></h5>
<div class="doc doc-contents">
<p>This function makes sure that the agenda reflects all changes needed for the received
system action.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>sys_act</code></td>
<td><code>SysAct</code></td>
<td>
<p>The action the system took</p>
</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>adviser/services/simulator/simulator.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>164
165
166
167
168
169
170
171
172
173
174
175
176
177
178
179
180
181
182
183
184
185
186
187
188
189
190
191
192
193
194
195
196
197
198
199
200
201
202
203
204
205
206
207
208
209
210
211
212
213
214
215
216
217
218</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">receive</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sys_act</span><span class="p">:</span> <span class="n">SysAct</span><span class="p">):</span>
    <span class="sd">"""</span>
<span class="sd">    This function makes sure that the agenda reflects all changes needed for the received</span>
<span class="sd">    system action.</span>

<span class="sd">    Args:</span>
<span class="sd">        sys_act (SysAct): The action the system took</span>
<span class="sd">    """</span>

    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">last_system_action</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="c1"># check whether system action is the same as before</span>
        <span class="k">if</span> <span class="n">sys_act</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">last_system_action</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">patience</span> <span class="o">-=</span> <span class="mi">1</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="s1">'usermodel'</span><span class="p">][</span><span class="s1">'resetPatience'</span><span class="p">]:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">patience</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dialog_patience</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">last_system_action</span> <span class="o">=</span> <span class="n">sys_act</span>

    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">patience</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">dialog_turn</span><span class="p">(</span><span class="s2">"User patience run out, ending dialog."</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">agenda</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_finish_dialog</span><span class="p">(</span><span class="n">ungrateful</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">ignored_requests</span><span class="p">,</span> <span class="n">ignored_requests_alt</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_check_system_ignored_request</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">last_user_actions</span><span class="p">,</span> <span class="n">sys_act</span><span class="p">)</span>

        <span class="c1"># first stage: push operations on top of agenda</span>
        <span class="k">if</span> <span class="n">sys_act</span><span class="o">.</span><span class="n">type</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">receive_options</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">receive_options</span><span class="p">[</span><span class="n">sys_act</span><span class="o">.</span><span class="n">type</span><span class="p">](</span><span class="n">sys_act</span><span class="p">)</span>

            <span class="c1"># handle missing requests</span>
            <span class="k">if</span> <span class="n">ignored_requests</span><span class="p">:</span>
                <span class="c1"># repeat unanswered requests from user from last turn</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">agenda</span><span class="o">.</span><span class="n">push</span><span class="p">(</span><span class="n">ignored_requests</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">ignored_requests_alt</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">agenda</span><span class="o">.</span><span class="n">push</span><span class="p">(</span><span class="n">ignored_requests_alt</span><span class="p">)</span>
                <span class="c1"># make sure to pick only the requestalt actions (should be 1)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">num_actions_next_turn</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">ignored_requests_alt</span><span class="p">)</span>
                <span class="c1"># make sure that old request actions verifying an offer are removed</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">agenda</span><span class="o">.</span><span class="n">remove_actions_of_type</span><span class="p">(</span><span class="n">act_type</span><span class="o">=</span><span class="n">UserActionType</span><span class="o">.</span><span class="n">Request</span><span class="p">)</span>

            <span class="c1"># second stage: clean agenda</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">agenda</span><span class="o">.</span><span class="n">clean</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">goal</span><span class="p">)</span>
            <span class="c1"># agenda might be empty -&gt; add requests again</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">agenda</span><span class="o">.</span><span class="n">is_empty</span><span class="p">():</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">goal</span><span class="o">.</span><span class="n">is_fulfilled</span><span class="p">():</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_finish_dialog</span><span class="p">()</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">agenda</span><span class="o">.</span><span class="n">fill_with_requests</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">goal</span><span class="p">,</span> <span class="n">exclude_name</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span>
                <span class="s2">"System Action Type is </span><span class="si">{}</span><span class="s2">, but I don't know how to handle it!"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                    <span class="n">sys_act</span><span class="o">.</span><span class="n">type</span><span class="p">))</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h5 class="doc doc-heading" id="adviser.services.simulator.simulator.HandcraftedUserSimulator.respond">
<code class="highlight language-python">
respond<span class="p">(</span><span class="bp">self</span><span class="p">)</span> </code>
<a class="headerlink" href="#adviser.services.simulator.simulator.HandcraftedUserSimulator.respond" title="Permanent link"></a></h5>
<div class="doc doc-contents">
<p>Gets n actions from the agenda, where n is drawn depending on the agenda or a pdf.</p>
<details class="quote">
<summary>Source code in <code>adviser/services/simulator/simulator.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>407
408
409
410
411
412
413
414
415
416
417
418
419
420
421
422
423
424
425
426
427
428
429
430
431
432
433
434
435
436
437
438
439
440</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">respond</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">"""</span>
<span class="sd">    Gets n actions from the agenda, where n is drawn depending on the agenda or a pdf.</span>
<span class="sd">    """</span>
    <span class="c1"># get some actions from the agenda</span>

    <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">agenda</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">"Agenda is empty, this must not happen at this point!"</span>

    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">num_actions_next_turn</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="c1"># use and reset self.num_actions_next_turn if set</span>
        <span class="n">num_actions</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">num_actions_next_turn</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">num_actions_next_turn</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
    <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">agenda</span><span class="o">.</span><span class="n">stack</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="n">UserActionType</span><span class="o">.</span><span class="n">Bye</span><span class="p">:</span>
        <span class="c1"># pop all actions from agenda since agenda can only contain thanks (optional) and</span>
        <span class="c1"># bye action</span>
        <span class="n">num_actions</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># draw amount of actions</span>
        <span class="n">num_actions</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">agenda</span><span class="p">),</span> <span class="n">common</span><span class="o">.</span><span class="n">numpy</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span>
            <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span> <span class="n">p</span><span class="o">=</span><span class="p">[</span><span class="o">.</span><span class="mi">6</span><span class="p">,</span> <span class="o">.</span><span class="mi">3</span><span class="p">,</span> <span class="o">.</span><span class="mi">1</span><span class="p">]))</span>  <span class="c1"># hardcoded pdf</span>

    <span class="c1"># get actions from agenda</span>
    <span class="n">user_actions</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">agenda</span><span class="o">.</span><span class="n">get_actions</span><span class="p">(</span><span class="n">num_actions</span><span class="p">)</span>
    <span class="c1"># copy needed for repeat action since they might be changed in other modules</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">last_user_actions</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">user_actions</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">action</span> <span class="ow">in</span> <span class="n">user_actions</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">action</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="n">UserActionType</span><span class="o">.</span><span class="n">Inform</span><span class="p">:</span>
            <span class="n">_constraint</span> <span class="o">=</span> <span class="n">Constraint</span><span class="p">(</span><span class="n">action</span><span class="o">.</span><span class="n">slot</span><span class="p">,</span> <span class="n">action</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>
            <span class="c1"># if _constraint in self.goal.constraints:</span>
            <span class="k">if</span> <span class="n">action</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">goal</span><span class="o">.</span><span class="n">missing_informs</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">goal</span><span class="o">.</span><span class="n">missing_informs</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">action</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">user_actions</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h5 class="doc doc-heading" id="adviser.services.simulator.simulator.HandcraftedUserSimulator.user_turn">
<code class="highlight language-python">
user_turn<span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> </code>
<a class="headerlink" href="#adviser.services.simulator.simulator.HandcraftedUserSimulator.user_turn" title="Permanent link"></a></h5>
<div class="doc doc-contents">
<details class="quote">
<summary>Source code in <code>adviser/services/simulator/simulator.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>551
552
553
554
555
556
557
558
559
560
561
562
563
564
565
566
567
568
569
570
571
572
573
574
575
576
577
578
579
580
581
582</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">delegate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="n">func_inst</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">func</span><span class="o">.</span><span class="vm">__name__</span><span class="p">)</span>

    <span class="n">callargs</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">args</span><span class="p">)</span>
    <span class="k">if</span> <span class="bp">self</span> <span class="ow">in</span> <span class="n">callargs</span><span class="p">:</span>    <span class="c1"># remove self when in *args, because already known to function</span>
        <span class="n">callargs</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">func</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">callargs</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">result</span><span class="p">:</span>
        <span class="c1"># fix! (user could have multiple "/" characters in topic - only use last one )</span>
        <span class="n">domains</span> <span class="o">=</span> <span class="p">{</span><span class="n">res</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">"/"</span><span class="p">)[</span><span class="mi">0</span><span class="p">]:</span> <span class="n">res</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">"/"</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span> <span class="k">if</span> <span class="s2">"/"</span> <span class="ow">in</span> <span class="n">res</span> <span class="k">else</span> <span class="s2">""</span> <span class="k">for</span> <span class="n">res</span> <span class="ow">in</span> <span class="n">result</span><span class="p">}</span>
        <span class="n">result</span> <span class="o">=</span> <span class="p">{</span><span class="n">key</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">"/"</span><span class="p">)[</span><span class="mi">0</span><span class="p">]:</span> <span class="n">result</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">result</span><span class="p">}</span>

    <span class="k">if</span> <span class="n">func_inst</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_publish_sockets</span><span class="p">:</span>
        <span class="c1"># not a publisher, just normal function</span>
        <span class="k">return</span> <span class="n">result</span>

    <span class="n">socket</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_publish_sockets</span><span class="p">[</span><span class="n">func_inst</span><span class="p">]</span>
    <span class="n">domain</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_domain_name</span>
    <span class="k">if</span> <span class="n">socket</span> <span class="ow">and</span> <span class="n">result</span><span class="p">:</span>
        <span class="c1"># publish messages</span>
        <span class="k">for</span> <span class="n">topic</span> <span class="ow">in</span> <span class="n">pub_topics</span><span class="p">:</span>
        <span class="c1"># for topic in result: # NOTE publish any returned value in dict with it's key as topic</span>
            <span class="k">if</span> <span class="n">topic</span> <span class="ow">in</span> <span class="n">result</span><span class="p">:</span>
                <span class="n">domain</span> <span class="o">=</span> <span class="n">domain</span> <span class="k">if</span> <span class="n">domain</span> <span class="k">else</span> <span class="n">domains</span><span class="p">[</span><span class="n">topic</span><span class="p">]</span>
                <span class="n">topic_domain_str</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="n">topic</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">domain</span><span class="si">}</span><span class="s2">"</span> <span class="k">if</span> <span class="n">domain</span> <span class="k">else</span> <span class="n">topic</span>
                <span class="k">if</span> <span class="n">topic</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_pub_topic_domains</span><span class="p">:</span>
                    <span class="n">topic_domain_str</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="n">topic</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_pub_topic_domains</span><span class="p">[</span><span class="n">topic</span><span class="p">]</span><span class="si">}</span><span class="s2">"</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_pub_topic_domains</span><span class="p">[</span><span class="n">topic</span><span class="p">]</span> <span class="k">else</span> <span class="n">topic</span>
                <span class="n">_send_msg</span><span class="p">(</span><span class="n">socket</span><span class="p">,</span> <span class="n">topic_domain_str</span><span class="p">,</span> <span class="n">result</span><span class="p">[</span><span class="n">topic</span><span class="p">])</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">debug_logger</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">debug_logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
                        <span class="sa">f</span><span class="s2">"- (DS): sent message from </span><span class="si">{</span><span class="n">func</span><span class="si">}</span><span class="s2"> to topic </span><span class="si">{</span><span class="n">topic_domain_str</span><span class="si">}</span><span class="s2">:</span><span class="se">\n</span><span class="s2">   </span><span class="si">{</span><span class="n">result</span><span class="p">[</span><span class="n">topic</span><span class="p">]</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">result</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="doc doc-object doc-module">
<h2 class="doc doc-heading" id="adviser.services.stats">
<code>stats</code>
<span class="doc doc-properties">
<small class="doc doc-property doc-property-special"><code>special</code></small>
</span>
<a class="headerlink" href="#adviser.services.stats" title="Permanent link"></a></h2>
<div class="doc doc-contents">
<div class="doc doc-children">
<div class="doc doc-object doc-module">
<h3 class="doc doc-heading" id="adviser.services.stats.evaluation">
<code>evaluation</code>
<a class="headerlink" href="#adviser.services.stats.evaluation" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<div class="doc doc-children">
<div class="doc doc-object doc-class">
<h4 class="doc doc-heading" id="adviser.services.stats.evaluation.ObjectiveReachedEvaluator">
<code>ObjectiveReachedEvaluator</code>
<a class="headerlink" href="#adviser.services.stats.evaluation.ObjectiveReachedEvaluator" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>Evaluate single turns and complete dialog.</p>
<div class="codehilite">
<pre><span></span><code>   <span class="n">This</span> <span class="k">class</span> <span class="n">assigns</span> <span class="n">a</span> <span class="n">negative</span> <span class="n">reward</span> <span class="k">to</span> <span class="k">each</span> <span class="n">turn</span><span class="p">.</span>
   <span class="k">In</span> <span class="k">case</span> <span class="n">the</span> <span class="k">user</span><span class="err">'</span><span class="n">s</span> <span class="n">goal</span> <span class="n">could</span> <span class="n">be</span> <span class="n">satisfied</span> <span class="p">(</span><span class="n">meaning</span> <span class="n">a</span> <span class="n">matching</span> <span class="k">database</span>
   <span class="n">entry</span> <span class="n">was</span> <span class="k">found</span><span class="p">),</span> <span class="n">a</span> <span class="k">large</span> <span class="k">final</span> <span class="n">reward</span> <span class="k">is</span> <span class="n">returned</span><span class="p">.</span>

   <span class="k">Only</span> <span class="n">needed</span> <span class="k">when</span> <span class="n">training</span> <span class="n">against</span> <span class="n">a</span> <span class="n">simulator</span><span class="p">.</span>
</code></pre>
</div>
<div class="doc doc-children">
<div class="doc doc-object doc-method">
<h5 class="doc doc-heading" id="adviser.services.stats.evaluation.ObjectiveReachedEvaluator.__init__">
<code class="highlight language-python">
__init__<span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">domain</span><span class="p">,</span> <span class="n">turn_reward</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> <span class="n">success_reward</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">logger</span><span class="o">=&lt;</span><span class="n">DiasysLogger</span> <span class="n">adviser</span> <span class="p">(</span><span class="n">NOTSET</span><span class="p">)</span><span class="o">&gt;</span><span class="p">)</span> </code>
<span class="doc doc-properties">
<small class="doc doc-property doc-property-special"><code>special</code></small>
</span>
<a class="headerlink" href="#adviser.services.stats.evaluation.ObjectiveReachedEvaluator.__init__" title="Permanent link"></a></h5>
<div class="doc doc-contents">
<details class="quote">
<summary>Source code in <code>adviser/services/stats/evaluation.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>38
39
40
41
42
43
44</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">domain</span><span class="p">:</span> <span class="n">Domain</span><span class="p">,</span> <span class="n">turn_reward</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> <span class="n">success_reward</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span>
             <span class="n">logger</span><span class="p">:</span> <span class="n">DiasysLogger</span> <span class="o">=</span> <span class="n">DiasysLogger</span><span class="p">()):</span>
    <span class="k">assert</span> <span class="n">turn_reward</span> <span class="o">&lt;=</span> <span class="mf">0.0</span><span class="p">,</span> <span class="s1">'the turn reward should be negative'</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">domain</span> <span class="o">=</span> <span class="n">domain</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">turn_reward</span> <span class="o">=</span> <span class="n">turn_reward</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">success_reward</span> <span class="o">=</span> <span class="n">success_reward</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">logger</span> <span class="o">=</span> <span class="n">logger</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h5 class="doc doc-heading" id="adviser.services.stats.evaluation.ObjectiveReachedEvaluator.get_final_reward">
<code class="highlight language-python">
get_final_reward<span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sim_goal</span><span class="p">,</span> <span class="n">logging</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> </code>
<a class="headerlink" href="#adviser.services.stats.evaluation.ObjectiveReachedEvaluator.get_final_reward" title="Permanent link"></a></h5>
<div class="doc doc-contents">
<p>Check whether the user's goal was completed.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>sim_goal</code></td>
<td><code>Goal</code></td>
<td>
<p>the simulation's goal</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>logging</code></td>
<td><code>bool</code></td>
<td>
<p>whether or not the evaluation results should be logged</p>
</td>
<td><code>True</code></td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>float</code></td>
<td>
<p>Reward - the final reward (0 (unsuccessful) or 20 (successful))
bool: Success</p>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>adviser/services/stats/evaluation.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">get_final_reward</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sim_goal</span><span class="p">:</span> <span class="n">Goal</span><span class="p">,</span> <span class="n">logging</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
    <span class="sd">""" </span>
<span class="sd">    Check whether the user's goal was completed.</span>

<span class="sd">    Args:</span>
<span class="sd">        sim_goal (Goal): the simulation's goal</span>
<span class="sd">        logging (bool): whether or not the evaluation results should be logged</span>

<span class="sd">    Returns:</span>
<span class="sd">        float: Reward - the final reward (0 (unsuccessful) or 20 (successful))</span>
<span class="sd">        bool: Success</span>
<span class="sd">    """</span>

    <span class="n">requests</span> <span class="o">=</span> <span class="n">sim_goal</span><span class="o">.</span><span class="n">requests</span>
    <span class="n">constraints</span> <span class="o">=</span> <span class="n">sim_goal</span><span class="o">.</span><span class="n">constraints</span>  <span class="c1"># list of constraints</span>
    <span class="c1"># self.logger.dialog_turn("User Goal &gt; " + str(sim_goal.constraints))</span>

    <span class="k">if</span> <span class="kc">None</span> <span class="ow">in</span> <span class="n">requests</span><span class="o">.</span><span class="n">values</span><span class="p">()</span> <span class="ow">or</span> <span class="n">requests</span><span class="p">[</span><span class="s1">'name'</span><span class="p">]</span> <span class="o">==</span> <span class="s1">'none'</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">logging</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">dialog_turn</span><span class="p">(</span><span class="s2">"Fail with user requests </span><span class="se">\n</span><span class="si">{}</span><span class="s2">"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">requests</span><span class="p">))</span>
        <span class="k">return</span> <span class="mf">0.0</span><span class="p">,</span> <span class="kc">False</span>
        <span class="c1"># TODO think about this more? if goals not satisfiable,</span>
        <span class="c1"># should system take the blame? not fair</span>

    <span class="c1"># print(requests['name'])</span>
    <span class="n">db_matches</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">domain</span><span class="o">.</span><span class="n">find_info_about_entity</span><span class="p">(</span>
        <span class="n">entity_id</span><span class="o">=</span><span class="n">requests</span><span class="p">[</span><span class="s1">'name'</span><span class="p">],</span>
        <span class="n">requested_slots</span><span class="o">=</span><span class="p">[</span><span class="n">constraint</span><span class="o">.</span><span class="n">slot</span> <span class="k">for</span> <span class="n">constraint</span> <span class="ow">in</span> <span class="n">constraints</span><span class="p">])</span>
    <span class="k">if</span> <span class="n">db_matches</span><span class="p">:</span>
        <span class="n">match</span> <span class="o">=</span> <span class="n">db_matches</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">const</span> <span class="ow">in</span> <span class="n">constraints</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">const</span><span class="o">.</span><span class="n">value</span> <span class="o">!=</span> <span class="n">match</span><span class="p">[</span><span class="n">const</span><span class="o">.</span><span class="n">slot</span><span class="p">]</span> <span class="ow">and</span> <span class="n">const</span><span class="o">.</span><span class="n">value</span> <span class="o">!=</span> <span class="s1">'dontcare'</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">logging</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">dialog_turn</span><span class="p">(</span><span class="s2">"Fail with user requests </span><span class="se">\n</span><span class="si">{}</span><span class="s2">"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">requests</span><span class="p">))</span>
                <span class="k">return</span> <span class="mf">0.0</span><span class="p">,</span> <span class="kc">False</span>
        <span class="k">if</span> <span class="n">logging</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">dialog_turn</span><span class="p">(</span><span class="s2">"Success with user requests </span><span class="se">\n</span><span class="si">{}</span><span class="s2">"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">requests</span><span class="p">))</span>
        <span class="k">return</span> <span class="mf">20.0</span><span class="p">,</span> <span class="kc">True</span>

    <span class="k">if</span> <span class="n">logging</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">dialog_turn</span><span class="p">(</span><span class="s2">"Fail with user requests </span><span class="se">\n</span><span class="si">{}</span><span class="s2">"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">requests</span><span class="p">))</span>
    <span class="k">return</span> <span class="mf">0.0</span><span class="p">,</span> <span class="kc">False</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h5 class="doc doc-heading" id="adviser.services.stats.evaluation.ObjectiveReachedEvaluator.get_turn_reward">
<code class="highlight language-python">
get_turn_reward<span class="p">(</span><span class="bp">self</span><span class="p">)</span> </code>
<a class="headerlink" href="#adviser.services.stats.evaluation.ObjectiveReachedEvaluator.get_turn_reward" title="Permanent link"></a></h5>
<div class="doc doc-contents">
<p>Get the reward for one turn</p>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>(int)</code></td>
<td>
<p>the reward for the given turn</p>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>adviser/services/stats/evaluation.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>46
47
48
49
50
51
52
53</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">get_turn_reward</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">""" </span>
<span class="sd">    Get the reward for one turn</span>

<span class="sd">    Returns:</span>
<span class="sd">        (int): the reward for the given turn</span>
<span class="sd">    """</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">turn_reward</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
</div>
</div>
</div>
<div class="doc doc-object doc-class">
<h4 class="doc doc-heading" id="adviser.services.stats.evaluation.PolicyEvaluator">
<code>PolicyEvaluator</code>
<a class="headerlink" href="#adviser.services.stats.evaluation.PolicyEvaluator" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>Policy evaluation module</p>
<p>Plug this module into the dialog graph (somewhere <em>after</em> the policy),
   and policy metrics like success rate and reward will be recorded.</p>
<div class="doc doc-children">
<div class="doc doc-object doc-method">
<h5 class="doc doc-heading" id="adviser.services.stats.evaluation.PolicyEvaluator.__init__">
<code class="highlight language-python">
__init__<span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">domain</span><span class="p">,</span> <span class="n">subgraph</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">use_tensorboard</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">experiment_name</span><span class="o">=</span><span class="s1">''</span><span class="p">,</span> <span class="n">turn_reward</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> <span class="n">success_reward</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">logger</span><span class="o">=&lt;</span><span class="n">DiasysLogger</span> <span class="n">adviser</span> <span class="p">(</span><span class="n">NOTSET</span><span class="p">)</span><span class="o">&gt;</span><span class="p">,</span> <span class="n">summary_writer</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span> </code>
<span class="doc doc-properties">
<small class="doc doc-property doc-property-special"><code>special</code></small>
</span>
<a class="headerlink" href="#adviser.services.stats.evaluation.PolicyEvaluator.__init__" title="Permanent link"></a></h5>
<div class="doc doc-contents">
<p>Keyword Arguments:
    use_tensorboard {bool} -- [If true, metrics will be written to
                               tensorboard in a <em>runs</em> directory]
                               (default: {False})
    experiment_name {str} -- [Name suffix for the log files]
                              (default: {''})
    turn_reward {float} -- [Reward for one turn - usually negative to
                            penalize dialog length] (default: {-1})
    success_reward {float} -- [Reward of the final transition if the
                               dialog goal was reached] (default: {20})</p>
<details class="quote">
<summary>Source code in <code>adviser/services/stats/evaluation.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">domain</span><span class="p">:</span> <span class="n">Domain</span><span class="p">,</span> <span class="n">subgraph</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">use_tensorboard</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
             <span class="n">experiment_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">''</span><span class="p">,</span> <span class="n">turn_reward</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> <span class="n">success_reward</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span>
             <span class="n">logger</span><span class="p">:</span> <span class="n">DiasysLogger</span> <span class="o">=</span> <span class="n">DiasysLogger</span><span class="p">(),</span> <span class="n">summary_writer</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">"""</span>
<span class="sd">    Keyword Arguments:</span>
<span class="sd">        use_tensorboard {bool} -- [If true, metrics will be written to</span>
<span class="sd">                                   tensorboard in a *runs* directory]</span>
<span class="sd">                                   (default: {False})</span>
<span class="sd">        experiment_name {str} -- [Name suffix for the log files]</span>
<span class="sd">                                  (default: {''})</span>
<span class="sd">        turn_reward {float} -- [Reward for one turn - usually negative to</span>
<span class="sd">                                penalize dialog length] (default: {-1})</span>
<span class="sd">        success_reward {float} -- [Reward of the final transition if the</span>
<span class="sd">                                   dialog goal was reached] (default: {20})</span>
<span class="sd">    """</span>
    <span class="nb">super</span><span class="p">(</span><span class="n">PolicyEvaluator</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">domain</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">logger</span> <span class="o">=</span> <span class="n">logger</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">epoch</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">evaluator</span> <span class="o">=</span> <span class="n">ObjectiveReachedEvaluator</span><span class="p">(</span>
        <span class="n">domain</span><span class="p">,</span> <span class="n">turn_reward</span><span class="o">=</span><span class="n">turn_reward</span><span class="p">,</span> <span class="n">success_reward</span><span class="o">=</span><span class="n">success_reward</span><span class="p">,</span> <span class="n">logger</span><span class="o">=</span><span class="n">logger</span><span class="p">)</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">writer</span> <span class="o">=</span> <span class="n">summary_writer</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">total_train_dialogs</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">total_eval_dialogs</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">epoch_train_dialogs</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">epoch_eval_dialogs</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">train_rewards</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">eval_rewards</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">train_success</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">eval_success</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">train_turns</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">eval_turns</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">is_training</span> <span class="o">=</span> <span class="kc">False</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h5 class="doc doc-heading" id="adviser.services.stats.evaluation.PolicyEvaluator.dialog_start">
<code class="highlight language-python">
dialog_start<span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dialog_start</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span> </code>
<a class="headerlink" href="#adviser.services.stats.evaluation.PolicyEvaluator.dialog_start" title="Permanent link"></a></h5>
<div class="doc doc-contents">
<p>Clears the state of the evaluator in preparation to start a new dialog</p>
<details class="quote">
<summary>Source code in <code>adviser/services/stats/evaluation.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>159
160
161
162
163
164</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">dialog_start</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dialog_start</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="sd">"""</span>
<span class="sd">        Clears the state of the evaluator in preparation to start a new dialog</span>
<span class="sd">    """</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">dialog_reward</span> <span class="o">=</span> <span class="mf">0.0</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">dialog_turns</span> <span class="o">=</span> <span class="mi">0</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h5 class="doc doc-heading" id="adviser.services.stats.evaluation.PolicyEvaluator.end_dialog">
<code class="highlight language-python">
end_dialog<span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> </code>
<a class="headerlink" href="#adviser.services.stats.evaluation.PolicyEvaluator.end_dialog" title="Permanent link"></a></h5>
<div class="doc doc-contents">
<details class="quote">
<summary>Source code in <code>adviser/services/stats/evaluation.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>551
552
553
554
555
556
557
558
559
560
561
562
563
564
565
566
567
568
569
570
571
572
573
574
575
576
577
578
579
580
581
582</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">delegate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="n">func_inst</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">func</span><span class="o">.</span><span class="vm">__name__</span><span class="p">)</span>

    <span class="n">callargs</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">args</span><span class="p">)</span>
    <span class="k">if</span> <span class="bp">self</span> <span class="ow">in</span> <span class="n">callargs</span><span class="p">:</span>    <span class="c1"># remove self when in *args, because already known to function</span>
        <span class="n">callargs</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">func</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">callargs</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">result</span><span class="p">:</span>
        <span class="c1"># fix! (user could have multiple "/" characters in topic - only use last one )</span>
        <span class="n">domains</span> <span class="o">=</span> <span class="p">{</span><span class="n">res</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">"/"</span><span class="p">)[</span><span class="mi">0</span><span class="p">]:</span> <span class="n">res</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">"/"</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span> <span class="k">if</span> <span class="s2">"/"</span> <span class="ow">in</span> <span class="n">res</span> <span class="k">else</span> <span class="s2">""</span> <span class="k">for</span> <span class="n">res</span> <span class="ow">in</span> <span class="n">result</span><span class="p">}</span>
        <span class="n">result</span> <span class="o">=</span> <span class="p">{</span><span class="n">key</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">"/"</span><span class="p">)[</span><span class="mi">0</span><span class="p">]:</span> <span class="n">result</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">result</span><span class="p">}</span>

    <span class="k">if</span> <span class="n">func_inst</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_publish_sockets</span><span class="p">:</span>
        <span class="c1"># not a publisher, just normal function</span>
        <span class="k">return</span> <span class="n">result</span>

    <span class="n">socket</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_publish_sockets</span><span class="p">[</span><span class="n">func_inst</span><span class="p">]</span>
    <span class="n">domain</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_domain_name</span>
    <span class="k">if</span> <span class="n">socket</span> <span class="ow">and</span> <span class="n">result</span><span class="p">:</span>
        <span class="c1"># publish messages</span>
        <span class="k">for</span> <span class="n">topic</span> <span class="ow">in</span> <span class="n">pub_topics</span><span class="p">:</span>
        <span class="c1"># for topic in result: # NOTE publish any returned value in dict with it's key as topic</span>
            <span class="k">if</span> <span class="n">topic</span> <span class="ow">in</span> <span class="n">result</span><span class="p">:</span>
                <span class="n">domain</span> <span class="o">=</span> <span class="n">domain</span> <span class="k">if</span> <span class="n">domain</span> <span class="k">else</span> <span class="n">domains</span><span class="p">[</span><span class="n">topic</span><span class="p">]</span>
                <span class="n">topic_domain_str</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="n">topic</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">domain</span><span class="si">}</span><span class="s2">"</span> <span class="k">if</span> <span class="n">domain</span> <span class="k">else</span> <span class="n">topic</span>
                <span class="k">if</span> <span class="n">topic</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_pub_topic_domains</span><span class="p">:</span>
                    <span class="n">topic_domain_str</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="n">topic</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_pub_topic_domains</span><span class="p">[</span><span class="n">topic</span><span class="p">]</span><span class="si">}</span><span class="s2">"</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_pub_topic_domains</span><span class="p">[</span><span class="n">topic</span><span class="p">]</span> <span class="k">else</span> <span class="n">topic</span>
                <span class="n">_send_msg</span><span class="p">(</span><span class="n">socket</span><span class="p">,</span> <span class="n">topic_domain_str</span><span class="p">,</span> <span class="n">result</span><span class="p">[</span><span class="n">topic</span><span class="p">])</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">debug_logger</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">debug_logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
                        <span class="sa">f</span><span class="s2">"- (DS): sent message from </span><span class="si">{</span><span class="n">func</span><span class="si">}</span><span class="s2"> to topic </span><span class="si">{</span><span class="n">topic_domain_str</span><span class="si">}</span><span class="s2">:</span><span class="se">\n</span><span class="s2">   </span><span class="si">{</span><span class="n">result</span><span class="p">[</span><span class="n">topic</span><span class="p">]</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">result</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h5 class="doc doc-heading" id="adviser.services.stats.evaluation.PolicyEvaluator.end_epoch">
<code class="highlight language-python">
end_epoch<span class="p">(</span><span class="bp">self</span><span class="p">)</span> </code>
<a class="headerlink" href="#adviser.services.stats.evaluation.PolicyEvaluator.end_epoch" title="Permanent link"></a></h5>
<div class="doc doc-contents">
<p>Handles calculating statistics at the end of an epoch        </p>
<details class="quote">
<summary>Source code in <code>adviser/services/stats/evaluation.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>239
240
241
242
243
244
245
246
247
248
249
250
251
252
253
254
255
256
257
258
259
260
261
262
263
264
265
266
267</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">end_epoch</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">"""</span>
<span class="sd">    Handles calculating statistics at the end of an epoch        </span>
<span class="sd">    """</span>

    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="p">:</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">epoch_train_dialogs</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">result</span><span class="p">(</span><span class="s2">" ### Train ###"</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">result</span><span class="p">(</span><span class="s2">"# Num Dialogs "</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">epoch_train_dialogs</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">result</span><span class="p">(</span><span class="s2">"# Avg Turns "</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">sum</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">train_turns</span><span class="p">)</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">epoch_train_dialogs</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">result</span><span class="p">(</span><span class="s2">"# Avg Success "</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">sum</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">train_success</span><span class="p">)</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">epoch_train_dialogs</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">result</span><span class="p">(</span><span class="s2">"# Avg Reward "</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">sum</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">train_rewards</span><span class="p">)</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">epoch_train_dialogs</span><span class="p">))</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">epoch_eval_dialogs</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">result</span><span class="p">(</span><span class="s2">" ### Eval ###"</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">result</span><span class="p">(</span><span class="s2">"# Num Dialogs "</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">epoch_eval_dialogs</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">result</span><span class="p">(</span><span class="s2">"# Avg Turns "</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">sum</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">eval_turns</span><span class="p">)</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">epoch_eval_dialogs</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">result</span><span class="p">(</span><span class="s2">"# Avg Success "</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">sum</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">eval_success</span><span class="p">)</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">epoch_eval_dialogs</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">result</span><span class="p">(</span><span class="s2">"# Avg Reward "</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">sum</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">eval_rewards</span><span class="p">)</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">epoch_eval_dialogs</span><span class="p">))</span>

    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_training</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">{</span><span class="s1">'num_dialogs'</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">epoch_train_dialogs</span><span class="p">,</span>
                <span class="s1">'turns'</span><span class="p">:</span> <span class="nb">sum</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">train_turns</span><span class="p">)</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">epoch_train_dialogs</span><span class="p">,</span>
                <span class="s1">'success'</span><span class="p">:</span> <span class="nb">float</span><span class="p">(</span><span class="nb">sum</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">train_success</span><span class="p">))</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">epoch_train_dialogs</span><span class="p">,</span>
                <span class="s1">'reward'</span><span class="p">:</span> <span class="nb">float</span><span class="p">(</span><span class="nb">sum</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">eval_rewards</span><span class="p">))</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">epoch_train_dialogs</span><span class="p">}</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">{</span><span class="s1">'num_dialogs'</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">epoch_eval_dialogs</span><span class="p">,</span>
                <span class="s1">'turns'</span><span class="p">:</span> <span class="nb">sum</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">eval_turns</span><span class="p">)</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">epoch_eval_dialogs</span><span class="p">,</span>
                <span class="s1">'success'</span><span class="p">:</span> <span class="nb">float</span><span class="p">(</span><span class="nb">sum</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">eval_success</span><span class="p">))</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">epoch_eval_dialogs</span><span class="p">,</span>
                <span class="s1">'reward'</span><span class="p">:</span> <span class="nb">float</span><span class="p">(</span><span class="nb">sum</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">eval_rewards</span><span class="p">))</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">epoch_eval_dialogs</span><span class="p">}</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h5 class="doc doc-heading" id="adviser.services.stats.evaluation.PolicyEvaluator.eval">
<code class="highlight language-python">
eval<span class="p">(</span><span class="bp">self</span><span class="p">)</span> </code>
<a class="headerlink" href="#adviser.services.stats.evaluation.PolicyEvaluator.eval" title="Permanent link"></a></h5>
<div class="doc doc-contents">
<p>sets teh evaluator in eval mode</p>
<details class="quote">
<summary>Source code in <code>adviser/services/stats/evaluation.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>172
173
174
175
176</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">eval</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">"""</span>
<span class="sd">        sets teh evaluator in eval mode</span>
<span class="sd">    """</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">is_training</span> <span class="o">=</span> <span class="kc">False</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h5 class="doc doc-heading" id="adviser.services.stats.evaluation.PolicyEvaluator.evaluate_turn">
<code class="highlight language-python">
evaluate_turn<span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> </code>
<a class="headerlink" href="#adviser.services.stats.evaluation.PolicyEvaluator.evaluate_turn" title="Permanent link"></a></h5>
<div class="doc doc-contents">
<details class="quote">
<summary>Source code in <code>adviser/services/stats/evaluation.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>551
552
553
554
555
556
557
558
559
560
561
562
563
564
565
566
567
568
569
570
571
572
573
574
575
576
577
578
579
580
581
582</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">delegate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="n">func_inst</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">func</span><span class="o">.</span><span class="vm">__name__</span><span class="p">)</span>

    <span class="n">callargs</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">args</span><span class="p">)</span>
    <span class="k">if</span> <span class="bp">self</span> <span class="ow">in</span> <span class="n">callargs</span><span class="p">:</span>    <span class="c1"># remove self when in *args, because already known to function</span>
        <span class="n">callargs</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">func</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">callargs</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">result</span><span class="p">:</span>
        <span class="c1"># fix! (user could have multiple "/" characters in topic - only use last one )</span>
        <span class="n">domains</span> <span class="o">=</span> <span class="p">{</span><span class="n">res</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">"/"</span><span class="p">)[</span><span class="mi">0</span><span class="p">]:</span> <span class="n">res</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">"/"</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span> <span class="k">if</span> <span class="s2">"/"</span> <span class="ow">in</span> <span class="n">res</span> <span class="k">else</span> <span class="s2">""</span> <span class="k">for</span> <span class="n">res</span> <span class="ow">in</span> <span class="n">result</span><span class="p">}</span>
        <span class="n">result</span> <span class="o">=</span> <span class="p">{</span><span class="n">key</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">"/"</span><span class="p">)[</span><span class="mi">0</span><span class="p">]:</span> <span class="n">result</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">result</span><span class="p">}</span>

    <span class="k">if</span> <span class="n">func_inst</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_publish_sockets</span><span class="p">:</span>
        <span class="c1"># not a publisher, just normal function</span>
        <span class="k">return</span> <span class="n">result</span>

    <span class="n">socket</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_publish_sockets</span><span class="p">[</span><span class="n">func_inst</span><span class="p">]</span>
    <span class="n">domain</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_domain_name</span>
    <span class="k">if</span> <span class="n">socket</span> <span class="ow">and</span> <span class="n">result</span><span class="p">:</span>
        <span class="c1"># publish messages</span>
        <span class="k">for</span> <span class="n">topic</span> <span class="ow">in</span> <span class="n">pub_topics</span><span class="p">:</span>
        <span class="c1"># for topic in result: # NOTE publish any returned value in dict with it's key as topic</span>
            <span class="k">if</span> <span class="n">topic</span> <span class="ow">in</span> <span class="n">result</span><span class="p">:</span>
                <span class="n">domain</span> <span class="o">=</span> <span class="n">domain</span> <span class="k">if</span> <span class="n">domain</span> <span class="k">else</span> <span class="n">domains</span><span class="p">[</span><span class="n">topic</span><span class="p">]</span>
                <span class="n">topic_domain_str</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="n">topic</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">domain</span><span class="si">}</span><span class="s2">"</span> <span class="k">if</span> <span class="n">domain</span> <span class="k">else</span> <span class="n">topic</span>
                <span class="k">if</span> <span class="n">topic</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_pub_topic_domains</span><span class="p">:</span>
                    <span class="n">topic_domain_str</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="n">topic</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_pub_topic_domains</span><span class="p">[</span><span class="n">topic</span><span class="p">]</span><span class="si">}</span><span class="s2">"</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_pub_topic_domains</span><span class="p">[</span><span class="n">topic</span><span class="p">]</span> <span class="k">else</span> <span class="n">topic</span>
                <span class="n">_send_msg</span><span class="p">(</span><span class="n">socket</span><span class="p">,</span> <span class="n">topic_domain_str</span><span class="p">,</span> <span class="n">result</span><span class="p">[</span><span class="n">topic</span><span class="p">])</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">debug_logger</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">debug_logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
                        <span class="sa">f</span><span class="s2">"- (DS): sent message from </span><span class="si">{</span><span class="n">func</span><span class="si">}</span><span class="s2"> to topic </span><span class="si">{</span><span class="n">topic_domain_str</span><span class="si">}</span><span class="s2">:</span><span class="se">\n</span><span class="s2">   </span><span class="si">{</span><span class="n">result</span><span class="p">[</span><span class="n">topic</span><span class="p">]</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">result</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h5 class="doc doc-heading" id="adviser.services.stats.evaluation.PolicyEvaluator.start_epoch">
<code class="highlight language-python">
start_epoch<span class="p">(</span><span class="bp">self</span><span class="p">)</span> </code>
<a class="headerlink" href="#adviser.services.stats.evaluation.PolicyEvaluator.start_epoch" title="Permanent link"></a></h5>
<div class="doc doc-contents">
<p>Handles resetting variables between epochs</p>
<details class="quote">
<summary>Source code in <code>adviser/services/stats/evaluation.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>221
222
223
224
225
226
227
228
229
230
231
232
233
234
235
236
237</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">start_epoch</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">"""</span>
<span class="sd">    Handles resetting variables between epochs</span>
<span class="sd">    """</span>

    <span class="c1"># global statistics</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">epoch_train_dialogs</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">epoch_eval_dialogs</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">train_rewards</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">eval_rewards</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">train_success</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">eval_success</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">train_turns</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">eval_turns</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">epoch</span> <span class="o">+=</span> <span class="mi">1</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">"###</span><span class="se">\n</span><span class="s2">### EPOCH"</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">epoch</span><span class="p">)</span> <span class="o">+</span> <span class="s2">" ###</span><span class="se">\n</span><span class="s2">###"</span><span class="p">)</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h5 class="doc doc-heading" id="adviser.services.stats.evaluation.PolicyEvaluator.train">
<code class="highlight language-python">
train<span class="p">(</span><span class="bp">self</span><span class="p">)</span> </code>
<a class="headerlink" href="#adviser.services.stats.evaluation.PolicyEvaluator.train" title="Permanent link"></a></h5>
<div class="doc doc-contents">
<p>sets the evaluator in train mode</p>
<details class="quote">
<summary>Source code in <code>adviser/services/stats/evaluation.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>166
167
168
169
170</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">train</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">"""</span>
<span class="sd">        sets the evaluator in train mode</span>
<span class="sd">    """</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">is_training</span> <span class="o">=</span> <span class="kc">True</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="doc doc-object doc-module">
<h2 class="doc doc-heading" id="adviser.services.ust">
<code>ust</code>
<span class="doc doc-properties">
<small class="doc doc-property doc-property-special"><code>special</code></small>
</span>
<a class="headerlink" href="#adviser.services.ust" title="Permanent link"></a></h2>
<div class="doc doc-contents">
<div class="doc doc-children">
<div class="doc doc-object doc-module">
<h3 class="doc doc-heading" id="adviser.services.ust.ust">
<code>ust</code>
<a class="headerlink" href="#adviser.services.ust.ust" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<div class="doc doc-children">
<div class="doc doc-object doc-class">
<h4 class="doc doc-heading" id="adviser.services.ust.ust.HandcraftedUST">
<code>HandcraftedUST</code>
<a class="headerlink" href="#adviser.services.ust.ust.HandcraftedUST" title="Permanent link"></a></h4>
<div class="doc doc-contents">
<p>A rule-based approach on user state tracking. Currently very minimalist</p>
<div class="doc doc-children">
<div class="doc doc-object doc-method">
<h5 class="doc doc-heading" id="adviser.services.ust.ust.HandcraftedUST.__init__">
<code class="highlight language-python">
__init__<span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">domain</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">logger</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span> </code>
<span class="doc doc-properties">
<small class="doc doc-property doc-property-special"><code>special</code></small>
</span>
<a class="headerlink" href="#adviser.services.ust.ust.HandcraftedUST.__init__" title="Permanent link"></a></h5>
<div class="doc doc-contents">
<details class="quote">
<summary>Source code in <code>adviser/services/ust/ust.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>30
31
32
33</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">domain</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">logger</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="n">Service</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">domain</span><span class="o">=</span><span class="n">domain</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">logger</span> <span class="o">=</span> <span class="n">logger</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">us</span> <span class="o">=</span> <span class="n">UserState</span><span class="p">()</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h5 class="doc doc-heading" id="adviser.services.ust.ust.HandcraftedUST.dialog_start">
<code class="highlight language-python">
dialog_start<span class="p">(</span><span class="bp">self</span><span class="p">)</span> </code>
<a class="headerlink" href="#adviser.services.ust.ust.HandcraftedUST.dialog_start" title="Permanent link"></a></h5>
<div class="doc doc-contents">
<p>Resets the user state so it is ready for a new dialog</p>
<details class="quote">
<summary>Source code in <code>adviser/services/ust/ust.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>56
57
58
59
60
61</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">dialog_start</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">"""</span>
<span class="sd">        Resets the user state so it is ready for a new dialog</span>
<span class="sd">    """</span>
    <span class="c1"># initialize belief state</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">us</span> <span class="o">=</span> <span class="n">UserState</span><span class="p">()</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h5 class="doc doc-heading" id="adviser.services.ust.ust.HandcraftedUST.update_emotion">
<code class="highlight language-python">
update_emotion<span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> </code>
<a class="headerlink" href="#adviser.services.ust.ust.HandcraftedUST.update_emotion" title="Permanent link"></a></h5>
<div class="doc doc-contents">
<details class="quote">
<summary>Source code in <code>adviser/services/ust/ust.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>551
552
553
554
555
556
557
558
559
560
561
562
563
564
565
566
567
568
569
570
571
572
573
574
575
576
577
578
579
580
581
582</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">delegate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="n">func_inst</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">func</span><span class="o">.</span><span class="vm">__name__</span><span class="p">)</span>

    <span class="n">callargs</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">args</span><span class="p">)</span>
    <span class="k">if</span> <span class="bp">self</span> <span class="ow">in</span> <span class="n">callargs</span><span class="p">:</span>    <span class="c1"># remove self when in *args, because already known to function</span>
        <span class="n">callargs</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">func</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">callargs</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">result</span><span class="p">:</span>
        <span class="c1"># fix! (user could have multiple "/" characters in topic - only use last one )</span>
        <span class="n">domains</span> <span class="o">=</span> <span class="p">{</span><span class="n">res</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">"/"</span><span class="p">)[</span><span class="mi">0</span><span class="p">]:</span> <span class="n">res</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">"/"</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span> <span class="k">if</span> <span class="s2">"/"</span> <span class="ow">in</span> <span class="n">res</span> <span class="k">else</span> <span class="s2">""</span> <span class="k">for</span> <span class="n">res</span> <span class="ow">in</span> <span class="n">result</span><span class="p">}</span>
        <span class="n">result</span> <span class="o">=</span> <span class="p">{</span><span class="n">key</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">"/"</span><span class="p">)[</span><span class="mi">0</span><span class="p">]:</span> <span class="n">result</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">result</span><span class="p">}</span>

    <span class="k">if</span> <span class="n">func_inst</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_publish_sockets</span><span class="p">:</span>
        <span class="c1"># not a publisher, just normal function</span>
        <span class="k">return</span> <span class="n">result</span>

    <span class="n">socket</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_publish_sockets</span><span class="p">[</span><span class="n">func_inst</span><span class="p">]</span>
    <span class="n">domain</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_domain_name</span>
    <span class="k">if</span> <span class="n">socket</span> <span class="ow">and</span> <span class="n">result</span><span class="p">:</span>
        <span class="c1"># publish messages</span>
        <span class="k">for</span> <span class="n">topic</span> <span class="ow">in</span> <span class="n">pub_topics</span><span class="p">:</span>
        <span class="c1"># for topic in result: # NOTE publish any returned value in dict with it's key as topic</span>
            <span class="k">if</span> <span class="n">topic</span> <span class="ow">in</span> <span class="n">result</span><span class="p">:</span>
                <span class="n">domain</span> <span class="o">=</span> <span class="n">domain</span> <span class="k">if</span> <span class="n">domain</span> <span class="k">else</span> <span class="n">domains</span><span class="p">[</span><span class="n">topic</span><span class="p">]</span>
                <span class="n">topic_domain_str</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="n">topic</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">domain</span><span class="si">}</span><span class="s2">"</span> <span class="k">if</span> <span class="n">domain</span> <span class="k">else</span> <span class="n">topic</span>
                <span class="k">if</span> <span class="n">topic</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_pub_topic_domains</span><span class="p">:</span>
                    <span class="n">topic_domain_str</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="n">topic</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_pub_topic_domains</span><span class="p">[</span><span class="n">topic</span><span class="p">]</span><span class="si">}</span><span class="s2">"</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_pub_topic_domains</span><span class="p">[</span><span class="n">topic</span><span class="p">]</span> <span class="k">else</span> <span class="n">topic</span>
                <span class="n">_send_msg</span><span class="p">(</span><span class="n">socket</span><span class="p">,</span> <span class="n">topic_domain_str</span><span class="p">,</span> <span class="n">result</span><span class="p">[</span><span class="n">topic</span><span class="p">])</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">debug_logger</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">debug_logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
                        <span class="sa">f</span><span class="s2">"- (DS): sent message from </span><span class="si">{</span><span class="n">func</span><span class="si">}</span><span class="s2"> to topic </span><span class="si">{</span><span class="n">topic_domain_str</span><span class="si">}</span><span class="s2">:</span><span class="se">\n</span><span class="s2">   </span><span class="si">{</span><span class="n">result</span><span class="p">[</span><span class="n">topic</span><span class="p">]</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">result</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</article>
</div>
</div>
</main>
<footer class="md-footer">
<div class="md-footer-nav">
<nav aria-label="Footer" class="md-footer-nav__inner md-grid">
<a class="md-footer-nav__link md-footer-nav__link--prev" href="../../getting-started/" rel="prev" title="Getting Started">
<div class="md-footer-nav__button md-icon">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"></path></svg>
</div>
<div class="md-footer-nav__title">
<div class="md-ellipsis">
<span class="md-footer-nav__direction">
                  Previous
                </span>
                Getting Started
              </div>
</div>
</a>
<a class="md-footer-nav__link md-footer-nav__link--next" href="../examples/" rel="next" title="Examples">
<div class="md-footer-nav__title">
<div class="md-ellipsis">
<span class="md-footer-nav__direction">
                  Next
                </span>
                Examples
              </div>
</div>
<div class="md-footer-nav__button md-icon">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4z"></path></svg>
</div>
</a>
</nav>
</div>
<div class="md-footer-meta md-typeset">
<div class="md-footer-meta__inner md-grid">
<div class="md-footer-copyright">
        
        Made with
        <a href="https://squidfunk.github.io/mkdocs-material/" rel="noopener" target="_blank">
          Material for MkDocs
        </a>
</div>
</div>
</div>
</footer>
</div>
<script src="../../assets/javascripts/vendor.83fe6e3c.min.js"></script>
<script src="../../assets/javascripts/bundle.7e1cb91c.min.js"></script><script id="__lang" type="application/json">{"clipboard.copy": "Copy to clipboard", "clipboard.copied": "Copied to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.result.placeholder": "Type to start searching", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents"}</script>
<script>
        app = initialize({
          base: "../..",
          features: [],
          search: Object.assign({
            worker: "../../assets/javascripts/worker/search.37585f48.min.js"
          }, typeof search !== "undefined" && search)
        })
      </script>
</body>
</html>